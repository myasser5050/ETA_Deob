(function () {
  "use strict";

  const vLSHttpsetasubscription = "https://eta-subscriptions-worker.ms0223048.workers.dev/";
  const vLS01060872599 = "01060872599";
  async function signDataLocally() {
    const v = await getIssuerFullData();
    const v2 = v?.id;
    if (!v2) {
      alert("Ø®Ø·Ø£ ÙØ§Ø¯Ø­: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ Ù„Ù„Ù…Ù…ÙˆÙ„ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ.");
      return false;
    }
    const vLSEta_subscription_dat = "eta_subscription_data";
    const v3 = JSON.parse(localStorage.getItem(vLSEta_subscription_dat) || "{}");
    const v4 = new Date().getTime();
    if (v3.regNumber === v2 && v3.expiry && v3.expiry > v4 && v3.status === true) {
      console.log("Subscription check: Using cached valid status for regNumber: " + v2);
      return true;
    }
    console.log("Subscription check: Cache invalid or for different user. Fetching from API for regNumber: " + v2);
    try {
      const v5 = await fetch(vLSHttpsetasubscription, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          regNumber: v2
        })
      });
      if (!v5.ok) {
        throw new Error("API Error: " + v5.status);
      }
      const v6 = await v5.json();
      const v7 = v6.active === true;
      const v8 = v4 + 3600000;
      localStorage.setItem(vLSEta_subscription_dat, JSON.stringify({
        regNumber: v2,
        status: v7,
        expiry: v8
      }));
      console.log("Subscription check: API response is " + v7 + ". Status cached for " + v2);
      return v7;
    } catch (e) {
      console.error("Subscription check failed:", e);
      return true;
    }
  }
  function f2() {
    if (document.getElementById("subscriptionModal")) {
      return;
    }
    const v9 = document.createElement("div");
    v9.id = "subscriptionModal";
    v9.style.cssText = "\n            position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background-color: rgba(0, 0, 0, 0.7); z-index: 20000;\n            display: flex; align-items: center; justify-content: center;\n            direction: rtl; font-family: 'Cairo', 'Segoe UI', sans-serif;\n            backdrop-filter: blur(5px);\n        ";
    v9.innerHTML = "\n    <div style=\"background: #fff; width: 600px; max-width: 90%; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); text-align: center; padding: 30px; animation: zoomIn 0.3s ease-out;\">\n        <h2 style=\"color: #1d3557; margin-top: 0; font-size: 26px;\">ğŸ”’ Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø£ÙˆÙ„Ø§Ù‹</h2>\n\n        <p style=\"font-size: 17px; color: #495057; line-height: 1.8; margin-bottom: 25px;\">\n            Ù„Ù„Ø§Ø³ØªÙØ§Ø¯Ø© Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ùƒ.\n        </p>\n\n        <div style=\"background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 10px; padding: 20px; margin-bottom: 25px; text-align: center;\">\n            <h3 style=\"color: #007bff; margin-top: 0; font-size: 20px;\">ğŸ’³ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h3>\n            \n            <p style=\"font-size: 18px; color: #1d3557; margin: 10px 0; line-height: 1.7;\">\n                Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ: <strong style=\"color:#e63946; font-size:20px;\">50 Ø¬Ù€</strong><br>\n                Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø³Ù†ÙˆÙŠ: <strong style=\"color:#e63946; font-size:20px;\">600 Ø¬Ù€</strong>\n            </p>\n\n            <hr style=\"margin: 18px 0; border: none; border-top: 1px solid #dee2e6;\">\n\n            <h3 style=\"color: #007bff; margin: 5px 0 12px; font-size: 20px;\">Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…ØªØ§Ø­Ø©:</h3>\n\n            <p style=\"font-size: 18px; font-weight: bold; margin-bottom: 15px;\">\n                ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´ Ø£Ùˆ Ø§Ù†Ø³ØªØ§Ø¨Ø§ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù…:\n            </p>\n\n            <p style=\"font-size: 28px; color: #e63946; user-select: all; cursor: pointer;\" title=\"Ø§Ø¶ØºØ· Ù„Ù„Ù†Ø³Ø®\">\n                " + vLS01060872599 + "\n            </p>\n\n            <p style=\"font-size: 15px; color: #6c757d; line-height: 1.8; margin-top: 15px;\">\n                Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„:<br>\n                <strong>âœ” ØµÙˆØ±Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„</strong><br>\n                <strong>âœ” Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ Ù„Ù„Ù…ÙˆÙ„</strong><br>\n                <strong>âœ” ÙØªØ±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Ø´Ù‡Ø±ÙŠ / Ø³Ù†ÙˆÙŠ)</strong><br>\n                Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù… Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ.\n            </p>\n        </div>\n\n        <button id=\"closeSubscriptionModalBtn\" style=\"background: #6c757d; color: white; padding: 12px 40px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px;\">\n            ÙÙ‡Ù…ØªØŒ Ø¥ØºÙ„Ø§Ù‚\n        </button>\n    </div>\n\n    <style>\n        @keyframes zoomIn { \n            from { opacity: 0; transform: scale(0.9); } \n            to { opacity: 1; transform: scale(1); } \n        }\n    </style>\n";
    document.body.appendChild(v9);
    document.getElementById("closeSubscriptionModalBtn").onclick = () => v9.remove();
  }
  function createInfoField(p, p2, p3 = false, p4 = false) {
    if (!p2 && !p4) {
      return "";
    }
    let v10;
    if (p4) {
      const v11 = String(p2).toLowerCase() === "Ù†Ø´Ø·" || String(p2).toLowerCase() === "active";
      const v12 = v11 ? "status active" : "status inactive";
      const v13 = v11 ? "Ù†Ø´Ø·" : "ØºÙŠØ± Ù†Ø´Ø·";
      v10 = "<span class=\"" + v12 + "\">" + v13 + "</span>";
    } else {
      const v14 = p3 ? "value ltr" : "value";
      v10 = "<span class=\"" + v14 + "\">" + p2 + "</span>";
    }
    return "\n        <div class=\"info-field\">\n            <span class=\"label-icon\">" + p + "</span>\n            " + v10 + "\n        </div>\n    ";
  }
  function f4(p5) {
    const v15 = new Date();
    let v16;
    const v17 = p5 ? new Date(p5) : null;
    if (v17 && !isNaN(v17.getTime())) {
      v16 = v17;
      v16.setHours(v15.getHours(), v15.getMinutes(), v15.getSeconds());
    } else {
      v16 = v15;
    }
    return v16.toISOString().split(".")[0] + "Z";
  }
  const vF = function () {
    async function f5(p6) {
      const v18 = new TextEncoder();
      const v19 = await crypto.subtle.digest("SHA-256", v18.encode(p6));
      return Array.from(new Uint8Array(v19)).map(p7 => p7.toString(16).padStart(2, "0")).join("");
    }
    function f6(p8) {
      return p8 === 32 || p8 === 10 || p8 === 13 || p8 === 9;
    }
    function f7(p9) {
      this.s = p9;
      this.n = p9.length;
      this.i = 0;
      this.out = [];
    }
    f7.prototype.peek = function () {
      if (this.i < this.n) {
        return this.s.charCodeAt(this.i);
      } else {
        return -1;
      }
    };
    f7.prototype.skip = function () {
      while (this.i < this.n && f6(this.s.charCodeAt(this.i))) {
        this.i++;
      }
    };
    f7.prototype.expect = function (p10) {
      if (this.s[this.i] !== p10) {
        throw new Error("Expected " + p10 + " at " + this.i);
      }
      this.i++;
    };
    f7.prototype.readString = function () {
      let v20 = this.i;
      this.expect("\"");
      while (this.i < this.n) {
        const v21 = this.s.charCodeAt(this.i);
        if (v21 === 34) {
          this.i++;
          break;
        }
        if (v21 === 92) {
          this.i += 2;
        } else {
          this.i++;
        }
      }
      return this.s.slice(v20, this.i);
    };
    f7.prototype.readNumber = function () {
      let v22 = this.i;
      if (this.s[this.i] === "-") {
        this.i++;
      }
      if (this.s[this.i] === "0") {
        this.i++;
      } else {
        if (!(this.s[this.i] >= "1") || !(this.s[this.i] <= "9")) {
          throw new Error("num");
        }
        while (this.s[this.i] >= "0" && this.s[this.i] <= "9") {
          this.i++;
        }
      }
      if (this.s[this.i] === ".") {
        this.i++;
        if (!(this.s[this.i] >= "0") || !(this.s[this.i] <= "9")) {
          throw new Error("frac");
        }
        while (this.s[this.i] >= "0" && this.s[this.i] <= "9") {
          this.i++;
        }
      }
      if (this.s[this.i] === "e" || this.s[this.i] === "E") {
        this.i++;
        if (this.s[this.i] === "+" || this.s[this.i] === "-") {
          this.i++;
        }
        if (!(this.s[this.i] >= "0") || !(this.s[this.i] <= "9")) {
          throw new Error("exp");
        }
        while (this.s[this.i] >= "0" && this.s[this.i] <= "9") {
          this.i++;
        }
      }
      return this.s.slice(v22, this.i);
    };
    f7.prototype.readLiteral = function () {
      if (this.s.startsWith("true", this.i)) {
        this.i += 4;
        return "true";
      }
      if (this.s.startsWith("false", this.i)) {
        this.i += 5;
        return "false";
      }
      if (this.s.startsWith("null", this.i)) {
        this.i += 4;
        return "null";
      }
      throw new Error("literal@" + this.i);
    };
    f7.prototype.emitKey = function (p11) {
      this.out.push("\"" + p11 + "\"");
    };
    f7.prototype.emitScalar = function (p12) {
      this.out.push("\"" + p12 + "\"");
    };
    f7.prototype.serializeObject = function (p13, p14) {
      this.skip();
      this.expect("{");
      this.skip();
      let v23 = true;
      while (this.i < this.n && this.s[this.i] !== "}") {
        if (!v23 && this.s[this.i] === ",") {
          this.i++;
          this.skip();
        }
        const v24 = this.readString();
        const v25 = JSON.parse(v24);
        const v26 = v25.toUpperCase();
        this.skip();
        this.expect(":");
        this.skip();
        const v27 = p13 ? p13 + "." + v25 : v25;
        const v28 = p14.indexOf(v27) !== -1;
        const v29 = this.peek();
        if (v29 === 34) {
          const v30 = this.readString();
          if (!v28) {
            this.emitKey(v26);
            this.emitScalar(v30.slice(1, -1));
          }
        } else if (v29 === 123) {
          if (!v28) {
            this.emitKey(v26);
          }
          this.serializeObject(v27, p14);
        } else if (v29 === 91) {
          if (!v28) {
            this.emitKey(v26);
          }
          this.serializeArray(v27, p14, v28, v26);
        } else if (v29 === 45 || v29 >= 48 && v29 <= 57) {
          const v31 = this.readNumber();
          if (!v28) {
            this.emitKey(v26);
            this.emitScalar(v31);
          }
        } else {
          const v32 = this.readLiteral();
          if (!v28) {
            this.emitKey(v26);
            this.emitScalar(v32);
          }
        }
        this.skip();
        v23 = false;
      }
      this.expect("}");
    };
    f7.prototype.serializeArray = function (p15, p16, p17, p18) {
      this.skip();
      this.expect("[");
      this.skip();
      let v33 = true;
      while (this.i < this.n && this.s[this.i] !== "]") {
        if (!v33 && this.s[this.i] === ",") {
          this.i++;
          this.skip();
        }
        if (!p17 && p18) {
          this.emitKey(p18);
        }
        const v34 = this.peek();
        if (v34 === 123) {
          this.serializeObject(p15, p16);
        } else if (v34 === 34) {
          const v35 = this.readString();
          if (!p17) {
            this.emitScalar(v35.slice(1, -1));
          }
        } else if (v34 === 45 || v34 >= 48 && v34 <= 57) {
          const v36 = this.readNumber();
          if (!p17) {
            this.emitScalar(v36);
          }
        } else {
          const v37 = this.readLiteral();
          if (!p17) {
            this.emitScalar(v37);
          }
        }
        this.skip();
        v33 = false;
      }
      this.expect("]");
    };
    function f8(p19) {
      const v38 = p19.match(/"receipts"\s*:\s*\[/);
      if (!v38) {
        return p19.trim();
      }
      let v39 = v38.index + v38[0].length;
      while (v39 < p19.length && /\s/.test(p19[v39])) {
        v39++;
      }
      if (p19[v39] !== "{") {
        return p19.trim();
      }
      let vLN0 = 0;
      let vV39 = v39;
      while (v39 < p19.length) {
        const v40 = p19[v39];
        if (v40 === "\"") {
          v39++;
          while (v39 < p19.length) {
            if (p19[v39] === "\\") {
              v39 += 2;
              continue;
            }
            if (p19[v39] === "\"") {
              v39++;
              break;
            }
            v39++;
          }
          continue;
        }
        if (v40 === "{") {
          vLN0++;
        }
        if (v40 === "}") {
          vLN0--;
          if (vLN0 === 0) {
            v39++;
            break;
          }
        }
        v39++;
      }
      return p19.slice(vV39, v39);
    }
    function f9(p20) {
      const vF8 = f8(p20);
      const v41 = new f7(vF8);
      v41.serializeObject("", []);
      return v41.out.join("");
    }
    async function f10(p21) {
      const vF9 = f9(p21);
      return await f5(vF9);
    }
    return {
      computeUuidFromRawText: f10
    };
  }();
  let v42 = location.href;
  setInterval(() => {
    if (v42 !== location.href) {
      v42 = location.href;
      const v43 = document.getElementById("invoiceCreatorMainUI");
      const v44 = document.getElementById("receiptUploaderTabbedUI");
      if (v43) {
        v43.remove();
      }
      if (v44) {
        v44.remove();
      }
      attemptToAddButton();
    }
  }, 500);
  attemptToAddButton();
  let vLSAr = "ar";
  try {
    const v45 = new PerformanceObserver(p22 => {
      for (const v46 of p22.getEntries()) {
        if (v46.name.includes("lang=")) {
          const v47 = new URL(v46.name);
          const v48 = v47.searchParams.get("lang");
          if ((v48 === "ar" || v48 === "en") && vLSAr !== v48) {
            vLSAr = v48;
          }
        }
      }
    });
    v45.observe({
      type: "resource",
      buffered: true
    });
  } catch (e2) {
    const v49 = Array.from(document.querySelectorAll("button span")).find(p23 => p23.textContent.trim() === "Logout" || p23.textContent.trim() === "Ø®Ø±ÙˆØ¬");
    vLSAr = v49 && v49.textContent.trim() === "Logout" ? "en" : "ar";
  }
  function injectScriptFromLocal(p24) {
    return new Promise((p25, p26) => {
      const v50 = document.createElement("script");
      v50.src = chrome.runtime.getURL(p24);
      v50.onload = () => p25(true);
      v50.onerror = p27 => {
        p26(p27);
      };
      (document.head || document.documentElement).appendChild(v50);
    });
  }
  async function loadJsPDF() {
    if (typeof window.jspdf !== "undefined") {
      return true;
    }
    try {
      await injectScriptFromLocal("jspdf.umd.min.js");
      return true;
    } catch (e3) {
      return false;
    }
  }
  function attemptToAddButton() {
    if (window.location.pathname === "/newdocument") {
      const vSetInterval = setInterval(() => {
        const v51 = document.querySelector("div[role='tablist']");
        if (v51) {
          clearInterval(vSetInterval);
          addInvoiceCreatorButton(v51);
        }
      }, 50);
      setTimeout(() => clearInterval(vSetInterval), 10000);
    } else if (window.location.pathname === "/uploadReceipts") {
      const vSetInterval2 = setInterval(() => {
        const v52 = document.querySelector(".fileSelection");
        if (v52 && v52.parentElement) {
          clearInterval(vSetInterval2);
          addReceiptUploaderButton(v52.parentElement);
        }
      }, 50);
      setTimeout(() => clearInterval(vSetInterval2), 10000);
    }
  }
  function addReceiptUploaderButton(p28) {
    if (document.getElementById("customReceiptUploaderBtn")) {
      return;
    }
    const v53 = document.createElement("button");
    v53.id = "customReceiptUploaderBtn";
    v53.type = "button";
    v53.className = "ms-Button ms-Button--default root-122";
    p28.style.display = "flex";
    p28.style.alignItems = "center";
    v53.style.marginRight = "15px";
    const vLSsvgWidth24Height24Vi = "\n        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n            <path d=\"M14 2H6C4.89543 2 4 2.89543 4 4V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V8L14 2Z\" fill=\"#a2d2ff\"/>\n            <path d=\"M12.5 13.5L15 17M15 13.5L12.5 17\" stroke=\"#03045e\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n            <path d=\"M9.5 17H10.5L12 14.75L10.5 12H9.5L8 14.25L9.5 17Z\" stroke=\"#03045e\" stroke-width=\"2\" stroke-linejoin=\"round\"/>\n        </svg>\n    ";
    v53.innerHTML = "\n        <span class=\"ms-Button-flexContainer flexContainer-96\" style=\"gap: 10px; align-items: center; padding: 0 10px;\">\n            <span class=\"icon-wrapper\">" + vLSsvgWidth24Height24Vi + "</span>\n            <span class=\"ms-Button-textContainer textContainer-97\">\n                <span class=\"ms-Button-label label-123\" style=\"color: #ffffff; font-weight: 600; font-size: 15px; font-family: 'Segoe UI', Tahoma, sans-serif;\">\n                    Ø±ÙØ¹ Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª Ù…Ù† Excel\n                </span>\n            </span>\n        </span>\n    ";
    Object.assign(v53.style, {
      height: "42px",
      backgroundColor: "#023e8a",
      color: "#ffffff",
      border: "none",
      borderRadius: "8px",
      boxShadow: "0 4px 6px rgba(0, 0, 0, 0.1 ), 0 1px 3px rgba(0, 0, 0, 0.08)",
      transition: "all 0.2s ease-in-out",
      cursor: "pointer",
      transform: "translateY(0)"
    });
    v53.onmouseenter = () => {
      v53.style.transform = "translateY(-2px)";
      v53.style.boxShadow = "0 7px 14px rgba(0, 0, 0, 0.1), 0 3px 6px rgba(0, 0, 0, 0.08)";
      v53.style.backgroundColor = "#003566";
    };
    v53.onmouseleave = () => {
      v53.style.transform = "translateY(0)";
      v53.style.boxShadow = "0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08)";
      v53.style.backgroundColor = "#023e8a";
    };
    v53.onmousedown = () => {
      v53.style.transform = "translateY(1px)";
      v53.style.boxShadow = "0 2px 4px rgba(0, 0, 0, 0.1)";
    };
    v53.onmouseup = () => {
      v53.style.transform = "translateY(-2px)";
      v53.style.boxShadow = "0 7px 14px rgba(0, 0, 0, 0.1), 0 3px 6px rgba(0, 0, 0, 0.08)";
    };
    v53.addEventListener("click", async p29 => {
      p29.preventDefault();
      const v54 = await signDataLocally();
      injectReceiptUploaderUIWithTabs(v54);
    });
    p28.appendChild(v53);
  }
  function f17(p30) {
    if (!p30) {
      return;
    }
    p30.innerHTML = "\n    <div class=\"panel-header\">\n        <h2>â­ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h2>\n        <p>Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ ÙˆØµÙˆÙ„ ÙƒØ§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© Ø¹Ø¨Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ.</p>\n    </div>\n\n    <div style=\"background: #fff; border-radius: 12px; padding: 30px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05);\">\n\n        <h3 style=\"color: #007bff; margin-top: 0; font-size: 22px;\">\n            ğŸ’³ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ\n        </h3>\n\n        <div style=\"margin: 18px 0; font-size: 18px; line-height: 1.7; color: #1d3557;\">\n            <p style=\"margin: 6px 0;\">\n                Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ: \n                <strong style=\"color:#e63946; font-size:20px;\">50 Ø¬Ù€</strong>\n            </p>\n            <p style=\"margin: 6px 0;\">\n                Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø³Ù†ÙˆÙŠ: \n                <strong style=\"color:#e63946; font-size:20px;\">600 Ø¬Ù€</strong>\n            </p>\n        </div>\n\n        <hr style=\"margin: 20px auto; width: 80%; border: none; border-top: 1px solid #e9ecef;\">\n\n        <h3 style=\"color: #007bff; margin-top: 0; font-size: 22px;\">\n            Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…ØªØ§Ø­Ø©\n        </h3>\n\n        <div style=\"font-size: 18px; font-weight: bold; margin: 20px 0;\">\n            <p style=\"margin: 5px 0;\">ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´ Ø£Ùˆ Ø§Ù†Ø³ØªØ§Ø¨Ø§ÙŠ (InstaPay) Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù…:</p>\n            <p style=\"font-size: 32px; color: #e63946; user-select: all; cursor: pointer; background: #f8f9fa; padding: 10px; border-radius: 8px; border: 1px dashed #ccc;\" title=\"Ø§Ø¶ØºØ· Ù„Ù„Ù†Ø³Ø®\">\n                " + vLS01060872599 + "\n            </p>\n        </div>\n\n        <p style=\"font-size: 16px; color: #6c757d; line-height: 1.8; margin-top: 10px;\">\n            Ø¨Ø¹Ø¯ Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„:\n            <br>âœ” <strong>ØµÙˆØ±Ø© Ù…Ù† Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„</strong>\n            <br>âœ” <strong>Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ</strong> Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ù…ÙˆÙ„\n            <br>âœ” <strong>Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</strong> (Ø´Ù‡Ø±ÙŠ / Ø³Ù†ÙˆÙŠ)\n            <br>Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù… Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙˆØ±Ù‹Ø§.\n        </p>\n    </div>\n";
  }
  function f16(p31) {
    let v55;
    let v56;
    if (p31 === "receipts") {
      v55 = "receiptUploaderTabbedUI";
      v56 = injectReceiptUploaderUIWithTabs;
    } else {
      v55 = "invoiceCreatorMainUI";
      v56 = injectInvoiceCreatorUI;
    }
    let v57 = document.getElementById(v55);
    if (!v57) {
      v56();
      v57 = document.getElementById(v55);
    }
    if (!v57) {
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© ÙØªØ­ ÙˆØ§Ø¬Ù‡Ø© " + p31 + ".");
      return;
    }
    v57.style.display = "flex";
    f2();
  }
  function f17(p32) {
    if (!p32) {
      return;
    }
    p32.innerHTML = "\n    <div class=\"panel-header\">\n        <h2>â­ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h2>\n        <p>Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ ÙˆØµÙˆÙ„ ÙƒØ§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© Ø¹Ø¨Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ.</p>\n    </div>\n\n    <div style=\"background: #fff; border-radius: 12px; padding: 30px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05);\">\n\n        <h3 style=\"color: #007bff; margin-top: 0; font-size: 22px;\">\n            ğŸ’³ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ\n        </h3>\n\n        <div style=\"margin: 18px 0; font-size: 18px; line-height: 1.7; color: #1d3557;\">\n            <p style=\"margin: 6px 0;\">\n                Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ: \n                <strong style=\"color:#e63946; font-size:20px;\">50 Ø¬Ù€</strong>\n            </p>\n            <p style=\"margin: 6px 0;\">\n                Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø³Ù†ÙˆÙŠ: \n                <strong style=\"color:#e63946; font-size:20px;\">600 Ø¬Ù€</strong>\n            </p>\n        </div>\n\n        <hr style=\"margin: 20px auto; width: 80%; border: none; border-top: 1px solid #e9ecef;\">\n\n        <h3 style=\"color: #007bff; margin-top: 0; font-size: 22px;\">\n            Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…ØªØ§Ø­Ø©\n        </h3>\n\n        <div style=\"font-size: 18px; font-weight: bold; margin: 20px 0;\">\n            <p style=\"margin: 5px 0;\">ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´ Ø£Ùˆ Ø§Ù†Ø³ØªØ§Ø¨Ø§ÙŠ (InstaPay) Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù…:</p>\n            <p style=\"font-size: 32px; color: #e63946; user-select: all; cursor: pointer; background: #f8f9fa; padding: 10px; border-radius: 8px; border: 1px dashed #ccc;\" title=\"Ø§Ø¶ØºØ· Ù„Ù„Ù†Ø³Ø®\">\n                " + vLS01060872599 + "\n            </p>\n        </div>\n\n        <p style=\"font-size: 16px; color: #6c757d; line-height: 1.8; margin-top: 10px;\">\n            Ø¨Ø¹Ø¯ Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„:\n            <br>âœ” <strong>ØµÙˆØ±Ø© Ù…Ù† Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„</strong>\n            <br>âœ” <strong>Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ</strong> Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ù…ÙˆÙ„\n            <br>âœ” <strong>Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</strong> (Ø´Ù‡Ø±ÙŠ / Ø³Ù†ÙˆÙŠ)\n            <br>Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù… Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙˆØ±Ù‹Ø§.\n        </p>\n    </div>\n";
  }
  const vA = [{
    code: "EGP",
    Desc_ar: "Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ"
  }, {
    code: "USD",
    Desc_ar: "Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ"
  }, {
    code: "EUR",
    Desc_ar: "ÙŠÙˆØ±Ùˆ"
  }, {
    code: "GBP",
    Desc_ar: "Ø¬Ù†ÙŠÙ‡ Ø¥Ø³ØªØ±Ù„ÙŠÙ†ÙŠ"
  }, {
    code: "SAR",
    Desc_ar: "Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ"
  }, {
    code: "AED",
    Desc_ar: "Ø¯Ø±Ù‡Ù… Ø¥Ù…Ø§Ø±Ø§ØªÙŠ"
  }, {
    code: "KWD",
    Desc_ar: "Ø¯ÙŠÙ†Ø§Ø± ÙƒÙˆÙŠØªÙŠ"
  }, {
    code: "QAR",
    Desc_ar: "Ø±ÙŠØ§Ù„ Ù‚Ø·Ø±ÙŠ"
  }, {
    code: "JPY",
    Desc_ar: "ÙŠÙ† ÙŠØ§Ø¨Ø§Ù†ÙŠ"
  }, {
    code: "CNY",
    Desc_ar: "ÙŠÙˆØ§Ù† ØµÙŠÙ†ÙŠ"
  }];
  const vO = {
    currencies: Object.fromEntries(vA.map(p33 => [p33.Desc_ar, p33.code]))
  };
  async function injectReceiptUploaderUIWithTabs(p34 = true) {
    const vLSReceiptUploaderTabbe = "receiptUploaderTabbedUI";
    const v58 = document.getElementById(vLSReceiptUploaderTabbe);
    if (v58) {
      if (p34 && v58.dataset.mode === "unsubscribed") {
        v58.remove();
      } else {
        v58.style.display = "flex";
        if (p34) {
          v58.querySelector(".sidebar-btn[data-target=\"panel-upload\"]")?.click();
        }
        return;
      }
    }
    const v59 = document.createElement("div");
    v59.id = vLSReceiptUploaderTabbe;
    v59.dataset.mode = p34 ? "subscribed" : "unsubscribed";
    Object.assign(v59.style, {
      position: "fixed",
      top: "50%",
      left: "50%",
      transform: "translate(-50%, -50%)",
      width: "1080px",
      height: "700px",
      backgroundColor: "#ffffff",
      borderRadius: "12px",
      boxShadow: "0 10px 40px rgba(0, 0, 0, 0.2)",
      zIndex: "9999",
      fontFamily: "'Cairo', 'Segoe UI', Tahoma, sans-serif",
      overflow: "hidden",
      display: "flex",
      direction: "rtl"
    });
    const vLSbuttonClasssidebarbt = "\n        <button class=\"sidebar-btn\" data-target=\"panel-upload\"><span class=\"btn-icon\">ğŸ“¤</span> Ø±ÙØ¹ Ù…Ù† Excel</button>\n        <button class=\"sidebar-btn\" data-target=\"panel-manual\"><span class=\"btn-icon\">âœï¸</span> Ø¥Ø±Ø³Ø§Ù„ ÙŠØ¯ÙˆÙŠ</button>\n    ";
    const vLSdivIdpaneluploadClas = "\n        <div id=\"panel-upload\" class=\"panel-content\"></div>\n        <div id=\"panel-manual\" class=\"panel-content\"></div>\n    ";
    const vLSbuttonClasssidebarbt2 = "\n        <button class=\"sidebar-btn active\" data-target=\"panel-subscription\" style=\"margin-top: auto; background-color: #1a4a7d;\">\n            <span class=\"btn-icon\">â­</span> Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ§Ù„Ø¯Ø¹Ù…\n        </button>\n    ";
    const vLSdivIdpanelsubscripti = "<div id=\"panel-subscription\" class=\"panel-content\"></div>";
    v59.innerHTML = "\n        <div class=\"sidebar\" style=\"width: 220px; background-color: #0d1b2a; color: #e0e1dd; display: flex; flex-direction: column; flex-shrink: 0; cursor: move;\">\n            <div class=\"sidebar-header\" style=\"padding: 20px; text-align: center; border-bottom: 1px solid #415a77;\"><h3>ğŸ§¾ Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª</h3></div>\n            <div class=\"sidebar-menu\" style=\"flex-grow: 1; padding-top: 15px;\">\n                " + (p34 ? vLSbuttonClasssidebarbt : "") + "\n                <button class=\"sidebar-btn\" data-target=\"panel-drafts\"><span class=\"btn-icon\">ğŸ“</span> Ø§Ù„Ù…Ø³ÙˆØ¯Ø§Øª</button>\n                " + (!p34 ? vLSbuttonClasssidebarbt2 : "") + "\n            </div>\n        </div>\n        <div class=\"main-panel\" style=\"flex-grow: 1; background-color: #f4f7fa; display: flex; position: relative;\">\n            <button id=\"closeReceiptTabbedUIBtn\" title=\"Ø¥ØºÙ„Ø§Ù‚\" style=\"position: absolute; top: 10px; left: 10px; width: 32px; height: 32px; background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; border-radius: 50%; font-size: 24px; line-height: 30px; text-align: center; cursor: pointer; z-index: 10;\">&times;</button>\n            <div class=\"panel-content-wrapper\" style=\"flex-grow: 1; overflow-y: auto; position: relative;\">\n                " + (p34 ? vLSdivIdpaneluploadClas : "") + "\n                <div id=\"panel-drafts\" class=\"panel-content\"></div>\n                " + (!p34 ? vLSdivIdpanelsubscripti : "") + "\n            </div>\n        </div>\n    ";
    document.body.appendChild(v59);
    if (!document.getElementById("receiptUIStyles")) {
      const v60 = document.createElement("style");
      v60.id = "receiptUIStyles";
      v60.innerHTML = "\n            .sidebar-btn { display: flex; align-items: center; width: 100%; padding: 15px 20px; background-color: transparent; border: none; color: #e0e1dd; font-size: 16px; font-family: 'Cairo', sans-serif; text-align: right; cursor: pointer; transition: background-color 0.3s, color 0.3s; border-right: 4px solid transparent; }\n            .sidebar-btn:hover { background-color: #1b263b; }\n            .sidebar-btn.active { background-color: #415a77; color: #ffffff; font-weight: 700; border-right-color: #778da9; }\n            .sidebar-btn .btn-icon { margin-left: 12px; font-size: 18px; }\n            .panel-content { display: none; padding: 25px; height: 100%; box-sizing: border-box; }\n            .panel-content.active { display: block; animation: fadeIn 0.5s; }\n            @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }\n        ";
      document.head.appendChild(v60);
    }
    document.getElementById("closeReceiptTabbedUIBtn").onclick = () => v59.remove();
    v59.querySelectorAll(".sidebar-btn").forEach(p35 => {
      p35.addEventListener("click", () => {
        v59.querySelectorAll(".sidebar-btn").forEach(p36 => p36.classList.remove("active"));
        v59.querySelectorAll(".panel-content").forEach(p37 => p37.classList.remove("active"));
        p35.classList.add("active");
        const v61 = p35.getAttribute("data-target");
        const v62 = document.getElementById(v61);
        if (v62) {
          v62.classList.add("active");
        }
      });
    });
    makeDraggable(v59, v59.querySelector(".sidebar"));
    if (p34) {
      populateReceiptTabs();
      setTimeout(() => v59.querySelector(".sidebar-btn[data-target=\"panel-upload\"]")?.click(), 100);
    } else {
      f17(document.getElementById("panel-subscription"));
      setTimeout(() => v59.querySelector(".sidebar-btn[data-target=\"panel-subscription\"]")?.click(), 100);
    }
  }
  function overrideFetch() {
    const v63 = window.fetch;
    window.fetch = async function (..._0x54e443) {
      const v64 = _0x54e443[0];
      const v65 = await v63.apply(this, _0x54e443);
      if (v65.ok && typeof v64 === "string" && v64.includes("/api/v1/documents/")) {
        try {
          const v66 = v65.clone();
          const v67 = await v66.json();
          const v68 = new CustomEvent("apiResponseIntercepted", {
            detail: {
              url: v64,
              data: v67
            }
          });
          window.dispatchEvent(v68);
        } catch (e4) {}
      }
      return v65;
    };
  }
  overrideFetch();
  async function populateReceiptTabs() {
    document.getElementById("panel-upload").innerHTML = "\n        <div class=\"panel-header\"><h2>Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù…Ù† Ù…Ù„Ù Excel</h2><p>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø±ÙØ¹Ù‡ Ø«Ù… Ø§ØªØ¨Ø¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª.</p></div>\n        <div class=\"content-step\" style=\"margin-bottom: 25px;\">\n            <label for=\"documentTypeSelect\" class=\"content-label\" style=\"font-size: 16px; color: #0d1b2a;\">Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯</label>\n            <select id=\"documentTypeSelect\" class=\"content-select\" style=\"padding: 12px; font-size: 16px; background-color: white; border: 1px solid #ced4da; border-radius: 8px;\">\n                <option value=\"sale\">ğŸ§¾ Ø¥ÙŠØµØ§Ù„ Ø¨ÙŠØ¹ (Sale Receipt)</option>\n                <option value=\"return\">â†©ï¸ Ø¥Ø´Ø¹Ø§Ø± Ù…Ø±ØªØ¬Ø¹ (Return Receipt)</option>\n            </select>\n        </div>\n        <hr style=\"border: none; border-top: 1px solid #eee; margin: 20px 0;\">\n        <div id=\"dynamicUploaderContent\"></div>\n        <div style=\"text-align:center; margin-top:25px; padding:15px; background:#f8f9fa; border-top:2px solid #e9ecef; font-family:'Cairo','Segoe UI',sans-serif; line-height:1.8; font-size:16px; color:#333;\">\n            Ø§Ù„Ù„Ù‡ÙÙ… ØµÙ„Ù‘Ù Ø¹Ù„Ù‰ Ù…ÙØ­Ù…Ø¯  \n              \n\n            ğŸ’» Ø§Ù„Ù…ØµÙ…Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ : Ù…Ø­Ù…Ø¯ ØµØ¨Ø±ÙŠ  \n              \n\n            ğŸ“ ÙˆØ§ØªØ³Ø§Ø¨: 01060872599\n        </div>\n\n    ";
    function updateUploaderUI() {
      const v69 = document.getElementById("documentTypeSelect").value;
      const v70 = document.getElementById("dynamicUploaderContent");
      const vLSDisplayBlockTextalig = "display: block; text-align: center; padding: 12px; border-radius: 8px; text-decoration: none; cursor: pointer; color: white; font-weight: 600;";
      if (v69 === "sale") {
        v70.innerHTML = "\n                <div><h3 style=\"margin-top:0; color: #333;\">Ø§Ù„Ø®Ø·ÙˆØ© 2: ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ ÙˆØ±ÙØ¹ Ù…Ù„ÙØ§Øª Ø§Ù„Ø¨ÙŠØ¹</h3></div>\n                <div style=\"margin-bottom: 20px;\"><a id=\"downloadReceiptTemplateBtn\" style=\"" + vLSDisplayBlockTextalig + " background-color: #5a67d8;\">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø°ÙƒÙŠ</a></div>\n                <div><label for=\"receiptExcelInput\" style=\"" + vLSDisplayBlockTextalig + " background-color: #38a169;\">ğŸ“‚ Ø§Ø®ØªØ± Ù…Ù„Ù Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„Ø¨ÙŠØ¹</label><input type=\"file\" id=\"receiptExcelInput\" accept=\".xlsx, .xls\" style=\"display: none;\"></div>\n            ";
        document.getElementById("downloadReceiptTemplateBtn").onclick = downloadSaleReceiptTemplate;
        document.getElementById("receiptExcelInput").onchange = handleReceiptExcelUpload;
      } else {
        v70.innerHTML = "\n                <div><h3 style=\"margin-top:0; color: #333;\">Ø§Ù„Ø®Ø·ÙˆØ© 2: ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ ÙˆØ±ÙØ¹ Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª</h3></div>\n                <div style=\"margin-bottom: 20px;\"><a id=\"downloadReturnTemplateBtn\" style=\"" + vLSDisplayBlockTextalig + " background-color: #c0392b;\">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø±ØªØ¬Ø¹</a></div>\n                <div><label for=\"returnExcelInput\" style=\"" + vLSDisplayBlockTextalig + " background-color: #e67e22;\">ğŸ“‚ Ø§Ø®ØªØ± Ù…Ù„Ù Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø±ØªØ¬Ø¹</label><input type=\"file\" id=\"returnExcelInput\" accept=\".xlsx, .xls\" style=\"display: none;\"></div>\n            ";
        document.getElementById("downloadReturnTemplateBtn").onclick = downloadReturnReceiptExcelTemplate;
        document.getElementById("returnExcelInput").onchange = handleReturnReceiptExcelUpload;
      }
    }
    document.getElementById("documentTypeSelect").addEventListener("change", updateUploaderUI);
    updateUploaderUI();
    const v71 = document.getElementById("panel-manual");
    v71.innerHTML = "\n        <div class=\"panel-header\"><h2>Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙ†Ø¯ ÙŠØ¯ÙˆÙŠ</h2><p>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø¥Ù†Ø´Ø§Ø¦Ù‡ ÙŠØ¯ÙˆÙŠÙ‹Ø§.</p></div>\n        <div class=\"content-step\">\n            <label for=\"manualDocumentTypeSelect\" class=\"content-label\" style=\"font-size: 16px; color: #0d1b2a;\">Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯</label>\n            <select id=\"manualDocumentTypeSelect\" class=\"content-select\" style=\"padding: 12px; font-size: 16px; background-color: white; border: 1px solid #ced4da; border-radius: 8px;\"><option value=\"\" selected disabled>-- ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± --</option><option value=\"sale\">ğŸ§¾ Ø¥Ù†Ø´Ø§Ø¡ Ø¥ÙŠØµØ§Ù„ Ø¨ÙŠØ¹ ÙŠØ¯ÙˆÙŠ</option><option value=\"return\">â†©ï¸ Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ù…Ø±ØªØ¬Ø¹ ÙŠØ¯ÙˆÙŠ</option></select>\n        </div>\n        <hr style=\"border: none; border-top: 1px solid #eee; margin: 20px 0;\">\n        <div id=\"dynamicManualSendContent\"><p style=\"text-align:center; color:#888; padding: 20px;\">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ø¹Ù„Ø§Ù‡ Ù„Ù„Ø¨Ø¯Ø¡.</p></div>\n        <div style=\"text-align:center; margin-top:25px; padding:15px; background:#f8f9fa; border-top:2px solid #e9ecef; font-family:'Cairo','Segoe UI',sans-serif; line-height:1.8; font-size:16px; color:#333;\">\n            Ø§Ù„Ù„Ù‡ÙÙ… ØµÙ„Ù‘Ù Ø¹Ù„Ù‰ Ù…ÙØ­Ù…Ø¯  \n              \n\n            ğŸ’» Ø§Ù„Ù…ØµÙ…Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ : Ù…Ø­Ù…Ø¯ ØµØ¨Ø±ÙŠ  \n              \n\n            ğŸ“ ÙˆØ§ØªØ³Ø§Ø¨: 01060872599\n        </div>\n    ";
    async function updateManualSendUI() {
      const v72 = document.getElementById("manualDocumentTypeSelect").value;
      const v73 = document.getElementById("dynamicManualSendContent");
      if (!v72) {
        v73.innerHTML = "<p style=\"text-align:center; color:#888; padding: 20px;\">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ø¹Ù„Ø§Ù‡ Ù„Ù„Ø¨Ø¯Ø¡.</p>";
        return;
      }
      v73.innerHTML = "<p style=\"text-align:center; color:#333; padding: 20px;\">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ø¬Ù‡Ø© Ø¥Ù†Ø´Ø§Ø¡ " + (v72 === "sale" ? "Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¨ÙŠØ¹" : "Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø±ØªØ¬Ø¹") + "...</p>";
      try {
        const v74 = await getIssuerFullData();
        const v75 = v74.activities || [];
        let vLS = "";
        if (v75.length > 0) {
          const v76 = v75.find(p38 => p38.toDate === null) || v75[0];
          vLS = "<div class=\"info-field full-width\"><label for=\"manual-activity-code\" class=\"label\">ÙƒÙˆØ¯ Ø§Ù„Ù†Ø´Ø§Ø·:</label><select id=\"manual-activity-code\" class=\"form-group-select\">" + v75.map(p39 => "<option value=\"" + p39.activityTypeCode + "\" " + (p39.activityTypeCode === v76.activityTypeCode ? "selected" : "") + ">" + p39.activityTypeCode + " - " + p39.activityTypeNameSecondaryLang + "</option>").join("") + "</select></div>";
        }
        await buildManualSendForm(v73, vLS, v72);
      } catch (e5) {
        v73.innerHTML = "<p style=\"color: red; text-align: center;\">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©: " + e5.message + "</p>";
      }
    }
    document.getElementById("manualDocumentTypeSelect").addEventListener("change", updateManualSendUI);
    document.getElementById("panel-drafts").innerHTML = "\n        <div class=\"panel-header\"><h2>Ù…Ø³ÙˆØ¯Ø§Øª Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª</h2><p>Ù‡Ù†Ø§ ØªØ¸Ù‡Ø± Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„ØªÙŠ Ø­ÙØ¸ØªÙ‡Ø§ Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§.</p></div>\n        <div id=\"drafts-container\" style=\"border: 1px solid #ccc; border-radius: 8px; background: #fff; min-height: 300px; padding: 15px;\"></div>\n        <div style=\"text-align:center; margin-top:25px; padding:15px; background:#f8f9fa; border-top:2px solid #e9ecef; font-family:'Cairo','Segoe UI',sans-serif; line-height:1.8; font-size:16px; color:#333;\">\n            Ø§Ù„Ù„Ù‡ÙÙ… ØµÙ„Ù‘Ù Ø¹Ù„Ù‰ Ù…ÙØ­Ù…Ø¯  \n              \n\n            ğŸ’» Ø§Ù„Ù…ØµÙ…Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ : Ù…Ø­Ù…Ø¯ ØµØ¨Ø±ÙŠ  \n              \n\n            ğŸ“ ÙˆØ§ØªØ³Ø§Ø¨: 01060872599\n        </div>\n    ";
    renderReceiptDrafts();
    document.querySelectorAll(".collapsible-header").forEach(p40 => {
      p40.addEventListener("click", () => {
        const v77 = p40.closest(".collapsible-section");
        v77.classList.toggle("open");
      });
    });
    try {
      if (!window.receiptUploaderData || !window.receiptUploaderData.seller) {
        const [v78, v79] = await Promise.all([f51(), getDeviceSerialNumber()]);
        if (!v78 || !v79 || v79.length === 0) {
          throw new Error("ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ù…Ù…ÙˆÙ„ Ø£Ùˆ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹.");
        }
        window.receiptUploaderData = {
          seller: v78,
          devices: v79,
          serial: v79[0].serialNumber
        };
      }
    } catch (e6) {}
  }
  async function downloadSaleReceiptTemplate() {
    const v_0x39bd1e = f74("Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø´Ø§Ù…Ù„...", 0);
    try {
      if (typeof ExcelJS === "undefined") {
        throw new Error("Ù…ÙƒØªØ¨Ø© ExcelJS ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ù.");
      }
      const v80 = new ExcelJS.Workbook();
      const v81 = v80.addWorksheet("Ù‚Ø§Ù„Ø¨ Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„Ø¨ÙŠØ¹");
      const v82 = v80.addWorksheet("Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
      const vA2 = [{
        code: "EGS"
      }, {
        code: "GS1"
      }];
      v82.getCell("A1").value = "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯";
      vA2.forEach((p41, p42) => {
        v82.getCell("A" + (p42 + 2)).value = p41.code;
      });
      v82.getCell("B1").value = "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ÙˆØ­Ø¯Ø§Øª";
      vA53.forEach((p43, p44) => {
        v82.getCell("B" + (p44 + 2)).value = p43.desc_ar;
      });
      v82.getCell("C1").value = "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©";
      Object.values(vO62).forEach((p45, p46) => {
        v82.getCell("C" + (p46 + 2)).value = p45.desc;
      });
      v82.getCell("D1").value = "Currencies";
      vA.forEach((p47, p48) => {
        v82.getCell("D" + (p48 + 2)).value = p47.Desc_ar;
      });
      let vLN5 = 5;
      Object.values(vO62).forEach(p49 => {
        const v83 = v82.getCell(1, vLN5);
        const v84 = p49.desc.replace(/[ ()]/g, "_");
        v83.value = v84;
        p49.subtypes.forEach((p50, p51) => {
          v82.getCell(p51 + 2, vLN5).value = p50.desc;
        });
        const v85 = String.fromCharCode("A".charCodeAt(0) + vLN5 - 1);
        const v86 = "'Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'!$" + v85 + "$2:$" + v85 + "$" + (p49.subtypes.length + 1);
        v80.definedNames.add(v86, v84);
        vLN5++;
      });
      const vO2 = {
        "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø± (YYYY-MM-DD)": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø£Ø¯Ø®Ù„ ØªØ§Ø±ÙŠØ® Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø¥ÙŠØµØ§Ù„.",
        "Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø±Ù‚Ù… ÙØ±ÙŠØ¯ ÙŠÙ…ÙŠØ² Ø§Ù„Ø¥ÙŠØµØ§Ù„.",
        "Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±ÙŠ.",
        "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø´ØªØ±ÙŠ (14 Ø±Ù‚Ù…).",
        "Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„ØµÙ†Ù": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù†Ø¸Ø§Ù…Ùƒ.",
        "ÙˆØµÙ Ø§Ù„ØµÙ†Ù (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø³Ù… Ø£Ùˆ ÙˆØµÙ ÙˆØ§Ø¶Ø­ Ù„Ù„Ø³Ù„Ø¹Ø©.",
        "Ù†ÙˆØ¹ ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (EGS Ø£Ùˆ GS1).",
        "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù„ØµÙ†Ù.",
        "ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø®ØªØ± ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.",
        "Ø§Ù„ÙƒÙ…ÙŠØ© (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨Ø§Ø¹ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„ØµÙ†Ù.",
        "Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø³Ø¹Ø± Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø© Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©.",
        "Ø¹Ù…Ù„Ø© Ø§Ù„Ø¨ÙŠØ¹": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©. Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù‡Ùˆ Ø§Ù„Ø¬Ù†ÙŠÙ‡ Ø§Ù„Ù…ØµØ±ÙŠ.",
        "Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù": "Ø¥Ø¬Ø¨Ø§Ø±ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¹Ù…Ù„Ø© ØºÙŠØ± Ø§Ù„Ø¬Ù†ÙŠÙ‡. Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± ØµØ±Ù Ø§Ù„Ø¹Ù…Ù„Ø© Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø¬Ù†ÙŠÙ‡.",
        "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ.",
        "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ Ù„Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ Ù„Ù„Ø¶Ø±ÙŠØ¨Ø©.",
        "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„Ù„Ø¶Ø±ÙŠØ¨Ø©.",
        "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 2 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØµÙ†Ù Ø®Ø§Ø¶Ø¹Ù‹Ø§ Ù„Ø¶Ø±ÙŠØ¨Ø© Ø£Ø®Ø±Ù‰.",
        "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ Ù„Ù„Ø¶Ø±ÙŠØ¨Ø© 2 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ Ù„Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©.",
        "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 2 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©."
      };
      const v87 = Object.keys(vO2);
      v81.columns = v87.map(p52 => ({
        header: p52,
        key: p52,
        width: 35
      }));
      v81.getRow(1).eachCell(p53 => {
        p53.note = vO2[p53.value] || "";
        p53.font = {
          name: "Arial",
          bold: true,
          size: 12,
          color: {
            argb: "FFFFFFFF"
          }
        };
        p53.fill = {
          type: "pattern",
          pattern: "solid",
          fgColor: {
            argb: "FF007BFF"
          }
        };
        p53.alignment = {
          vertical: "middle",
          horizontal: "center",
          wrapText: true
        };
      });
      const vF2 = (p54, p55) => {
        for (let vLN2 = 2; vLN2 <= 1001; vLN2++) {
          v81.getCell("" + p54 + vLN2).dataValidation = {
            type: "list",
            allowBlank: true,
            formulae: [p55]
          };
        }
      };
      vF2("G", "='Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'!$A$2:$A$3");
      vF2("I", "='Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'!$B$2:$B$" + (vA53.length + 1));
      vF2("L", "='Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'!$D$2:$D$" + (vA.length + 1));
      vF2("N", "='Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'!$C$2:$C$" + (Object.keys(vO62).length + 1));
      vF2("Q", "='Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'!$C$2:$C$" + (Object.keys(vO62).length + 1));
      const vLSINDIRECTSUBSTITUTESU = "=INDIRECT(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(N2,\" \",\"_\"),\"(\",\"_\"),\")\",\"_\"))";
      const vLSINDIRECTSUBSTITUTESU2 = "=INDIRECT(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(Q2,\" \",\"_\"),\"(\",\"_\"),\")\",\"_\"))";
      vF2("O", vLSINDIRECTSUBSTITUTESU);
      vF2("R", vLSINDIRECTSUBSTITUTESU2);
      v82.state = "hidden";
      v81.views = [{
        rightToLeft: true,
        state: "frozen",
        ySplit: 1
      }];
      const v88 = await v80.xlsx.writeBuffer();
      const v89 = new Blob([v88], {
        type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
      });
      if (typeof saveAs === "undefined") {
        throw new Error("Ù…ÙƒØªØ¨Ø© FileSaver.js ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©.");
      }
      saveAs(v89, "Ù†Ù…ÙˆØ°Ø¬_Ø¥ÙŠØµØ§Ù„Ø§Øª_Ø§Ù„Ø¨ÙŠØ¹_Ø¨Ø§Ù„Ø¹Ù…Ù„Ø§Øª.xlsx");
    } catch (e7) {
      alert("ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø¥ÙƒØ³Ù„ Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª: " + e7.message);
    } finally {
      v_0x39bd1e.remove();
    }
  }
  async function generateCustomPdf(p56) {
    const v90 = p56.dataset.uuid;
    p56.textContent = "Ø¬Ø§Ø±ÙŠ...";
    p56.disabled = true;
    try {
      if (typeof jsPDF === "undefined" || typeof jsPDF.autoTable === "undefined" || typeof qrcode === "undefined") {
        throw new Error("Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (jsPDF, AutoTable, qrcode) ØºÙŠØ± Ù…Ø¹Ø±Ù‘ÙØ© ÙÙŠ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ø§Ù….");
      }
      const v91 = p56.closest("tr");
      const vO3 = {
        uuid: v90,
        receiptNumber: v91.cells[0].textContent,
        dateTimeIssued: v91.cells[2].textContent,
        receiverName: v91.cells[3].textContent,
        totalAmount: parseFloat(v91.cells[4].textContent),
        seller: window.receiptUploaderData?.seller || {}
      };
      const v92 = new jsPDF({
        orientation: "p",
        unit: "mm",
        format: "a4"
      });
      v92.setFont("Helvetica");
      v92.setRtl(true);
      const vF3 = p57 => {
        if (!p57) {
          return "";
        }
        return String(p57).split("").reverse().join("");
      };
      const vQrcode = qrcode(0, "M");
      const v93 = new Date(vO3.dateTimeIssued.replace("ØŒ", "")).toISOString();
      const v94 = "https://invoicing.eta.gov.eg/receipts/details/print/" + v90 + "/share/" + v93;
      vQrcode.addData(v94);
      vQrcode.make();
      const v95 = vQrcode.createDataURL(4);
      const margin = 15;
      const v96 = v92.internal.pageSize.getWidth();
      v92.setFontSize(18).text(vF3("Ø¥ÙŠØµØ§Ù„ Ø¨ÙŠØ¹"), v96 - margin, margin, {
        align: "right"
      });
      v92.addImage(v95, "JPEG", margin, margin, 35, 35);
      let v97 = margin + 10;
      v92.setFontSize(8);
      v92.text(vF3("Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ") + vO3.uuid, v96 - margin - 40, v97, {
        align: "right"
      });
      v97 += 5;
      v92.text(vF3("Ø±Ù‚Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ: ") + vO3.receiptNumber, v96 - margin - 40, v97, {
        align: "right"
      });
      v97 += 5;
      v92.text(vF3("ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±: ") + vO3.dateTimeIssued, v96 - margin - 40, v97, {
        align: "right"
      });
      v97 += 5;
      v92.text(vF3("Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨Ø§Ø¦Ø¹: ") + (vO3.seller.id || "N/A"), v96 - margin - 40, v97, {
        align: "right"
      });
      v97 += 10;
      v92.autoTable({
        startY: v97,
        head: [[vF3("Ø§Ù„Ù…Ø´ØªØ±ÙŠ"), vF3("Ø§Ù„Ø¨Ø§Ø¦Ø¹")]],
        body: [[vF3(vO3.receiverName || ""), vF3((vO3.seller.name || "") + "\n" + (vO3.seller.id || "") + "\n" + (vO3.seller.street || "") + ", " + (vO3.seller.regionCity || ""))]],
        theme: "grid",
        styles: {
          font: "Helvetica",
          halign: "right"
        },
        headStyles: {
          fillColor: [220, 220, 220],
          textColor: 0
        }
      });
      v97 = v92.lastAutoTable.finalY + 10;
      const v98 = vO3.totalAmount;
      const vLN014 = 0.14;
      const v99 = v98 / (1 + vLN014);
      const v100 = v98 - v99;
      v92.autoTable({
        startY: v97,
        head: [[vF3("Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹"), vF3("Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"), vF3("Ø§Ù„ØµØ§ÙÙŠ"), vF3("Ø§Ù„ÙˆØµÙ")]],
        body: [[v98.toFixed(2), v100.toFixed(2), v99.toFixed(2), vF3("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø¥ÙŠØµØ§Ù„")]],
        theme: "grid",
        styles: {
          font: "Helvetica",
          halign: "right"
        },
        headStyles: {
          fillColor: [220, 220, 220],
          textColor: 0
        }
      });
      v97 = v92.lastAutoTable.finalY + 10;
      const vA3 = [[v99.toFixed(2), vF3("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ø¬.Ù…)")], [v100.toFixed(2), vF3("Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© (ØªÙ‚Ø±ÙŠØ¨ÙŠ)")], [{
        content: v98.toFixed(2),
        styles: {
          fontStyle: "bold"
        }
      }, {
        content: vF3("Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø¬.Ù…)"),
        styles: {
          fontStyle: "bold"
        }
      }]];
      v92.autoTable({
        startY: v97,
        body: vA3,
        theme: "plain",
        styles: {
          font: "Helvetica",
          halign: "right"
        },
        columnStyles: {
          0: {
            halign: "left"
          }
        },
        margin: {
          left: v96 / 2
        }
      });
      v92.save("receipt-" + v90 + ".pdf");
    } catch (e8) {
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ PDF: " + e8.message);
    } finally {
      p56.textContent = "ØªØ­Ù…ÙŠÙ„ PDF";
      p56.disabled = false;
    }
  }
  async function buildManualSendForm(p58, p59, p60 = "sale") {
    const v101 = p60 === "return";
    const v102 = v101 ? "Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ù…Ø±ØªØ¬Ø¹ ÙŠØ¯ÙˆÙŠ" : "Ø¥Ù†Ø´Ø§Ø¡ Ø¥ÙŠØµØ§Ù„ Ø¨ÙŠØ¹ ÙŠØ¯ÙˆÙŠ";
    const v103 = v101 ? "Ø±Ù‚Ù… Ø§Ù„Ù…Ø±ØªØ¬Ø¹ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ" : "Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ";
    const v104 = v101 ? "RTN-" + Date.now() : "RCPT-" + Date.now();
    const v105 = v101 ? "Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø±ØªØ¬Ø¹" : "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠØµØ§Ù„";
    const v_0x39bd1e2 = f74("Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù…ÙˆÙ„ ÙˆÙ†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹...", 0);
    const [v106, v107] = await Promise.all([getIssuerFullData(), getDeviceSerialNumber()]);
    v_0x39bd1e2.remove();
    if (!v106 || !v107 || v107.length === 0) {
      p58.innerHTML = "<p style=\"color: red; text-align: center; padding: 20px;\">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù…ÙˆÙ„ Ø£Ùˆ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.</p>";
      return;
    }
    const v108 = v107[0];
    const vA4 = [{
      Code: "T1",
      Desc_ar: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©"
    }, {
      Code: "T2",
      Desc_ar: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ù†Ø³Ø¨ÙŠØ©)"
    }, {
      Code: "T3",
      Desc_ar: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø§Ù„Ù†ÙˆØ¹ÙŠØ©)"
    }, {
      Code: "T4",
      Desc_ar: "Ø§Ù„Ø®ØµÙ… ØªØ­Øª Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"
    }, {
      Code: "T5",
      Desc_ar: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¯Ù…ØºØ© (Ù†Ø³Ø¨ÙŠØ©)"
    }, {
      Code: "T6",
      Desc_ar: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¯Ù…ØºØ© (Ù‚Ø·Ø¹ÙŠØ© Ø¨Ù…Ù‚Ø¯Ø§Ø± Ø«Ø§Ø¨Øª)"
    }, {
      Code: "T7",
      Desc_ar: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù…Ù„Ø§Ù‡ÙŠ"
    }, {
      Code: "T8",
      Desc_ar: "Ø±Ø³Ù… ØªÙ†Ù…ÙŠØ© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯"
    }, {
      Code: "T9",
      Desc_ar: "Ø±Ø³Ù… Ø®Ø¯Ù…Ø©"
    }, {
      Code: "T10",
      Desc_ar: "Ø±Ø³Ù… Ø§Ù„Ù…Ø­Ù„ÙŠØ§Øª"
    }, {
      Code: "T11",
      Desc_ar: "Ø±Ø³Ù… Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„ØµØ­ÙŠ"
    }, {
      Code: "T12",
      Desc_ar: "Ø±Ø³ÙˆÙ… Ø£Ø®Ø±Ù‰"
    }];
    const vA5 = [{
      Code: "V001",
      Desc_en: "Export",
      Desc_ar: "ØªØµØ¯ÙŠØ± Ù„Ù„Ø®Ø§Ø±Ø¬",
      TaxtypeReference: "T1"
    }, {
      Code: "V002",
      Desc_en: "Export to free areas and other areas",
      Desc_ar: "ØªØµØ¯ÙŠØ± Ù…Ù†Ø§Ø·Ù‚ Ø­Ø±Ø© ÙˆØ£Ø®Ø±Ù‰",
      TaxtypeReference: "T1"
    }, {
      Code: "V003",
      Desc_en: "Exempted good or service",
      Desc_ar: "Ø³Ù„Ø¹Ø© Ø£Ùˆ Ø®Ø¯Ù…Ø© Ù…Ø¹ÙØ§Ø©",
      TaxtypeReference: "T1"
    }, {
      Code: "V004",
      Desc_en: "A non-taxable good or service",
      Desc_ar: "Ø³Ù„Ø¹Ø© Ø£Ùˆ Ø®Ø¯Ù…Ø© ØºÙŠØ± Ø®Ø§Ø¶Ø¹Ø© Ù„Ù„Ø¶Ø±ÙŠØ¨Ø©",
      TaxtypeReference: "T1"
    }, {
      Code: "V005",
      Desc_en: "Exemptions for diplomats, consulates and embassies",
      Desc_ar: "Ø¥Ø¹ÙØ§Ø¡Ø§Øª Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠÙ† ÙˆØ§Ù„Ù‚Ù†ØµÙ„ÙŠØ§Øª ÙˆØ§Ù„Ø³ÙØ§Ø±Ø§Øª",
      TaxtypeReference: "T1"
    }, {
      Code: "V006",
      Desc_en: "Defence and National security Exemptions",
      Desc_ar: "Ø¥Ø¹ÙØ§Ø¡Ø§Øª Ø§Ù„Ø¯ÙØ§Ø¹ ÙˆØ§Ù„Ø£Ù…Ù† Ø§Ù„Ù‚ÙˆÙ…Ù‰",
      TaxtypeReference: "T1"
    }, {
      Code: "V007",
      Desc_en: "Agreements exemptions",
      Desc_ar: "Ø¥Ø¹ÙØ§Ø¡Ø§Øª Ø§ØªÙØ§Ù‚ÙŠØ§Øª",
      TaxtypeReference: "T1"
    }, {
      Code: "V008",
      Desc_en: "Special Exemptios and other reasons",
      Desc_ar: "Ø¥Ø¹ÙØ§Ø¡Ø§Øª Ø®Ø§ØµØ© Ùˆ Ø£Ø®Ø±Ù‰",
      TaxtypeReference: "T1"
    }, {
      Code: "V009",
      Desc_en: "General Item sales",
      Desc_ar: "Ø³Ù„Ø¹ Ø¹Ø§Ù…Ø©",
      TaxtypeReference: "T1"
    }, {
      Code: "V010",
      Desc_en: "Other Rates",
      Desc_ar: "Ù†Ø³Ø¨ Ø¶Ø±ÙŠØ¨Ø© Ø£Ø®Ø±Ù‰",
      TaxtypeReference: "T1"
    }, {
      Code: "Tbl01",
      Desc_en: "Table tax (percentage)",
      Desc_ar: "Ø¶Ø±ÙŠØ¨Ù‡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ù†Ø³Ø¨ÙŠÙ‡)",
      TaxtypeReference: "T2"
    }, {
      Code: "Tbl02",
      Desc_en: "Table tax (Fixed Amount)",
      Desc_ar: "Ø¶Ø±ÙŠØ¨Ù‡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø§Ù„Ù†ÙˆØ¹ÙŠØ©)",
      TaxtypeReference: "T3"
    }, {
      Code: "W001",
      Desc_en: "Contracting",
      Desc_ar: "Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª",
      TaxtypeReference: "T4"
    }, {
      Code: "W002",
      Desc_en: "Supplies",
      Desc_ar: "Ø§Ù„ØªÙˆØ±ÙŠØ¯Ø§Øª",
      TaxtypeReference: "T4"
    }, {
      Code: "W003",
      Desc_en: "Purachases",
      Desc_ar: "Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª",
      TaxtypeReference: "T4"
    }, {
      Code: "W004",
      Desc_en: "Services",
      Desc_ar: "Ø§Ù„Ø®Ø¯Ù…Ø§Øª",
      TaxtypeReference: "T4"
    }, {
      Code: "W010",
      Desc_en: "Professional fees",
      Desc_ar: "Ø§ØªØ¹Ø§Ø¨ Ù…Ù‡Ù†ÙŠØ©",
      TaxtypeReference: "T4"
    }, {
      Code: "ST01",
      Desc_en: "Stamping tax (percentage)",
      Desc_ar: "Ø¶Ø±ÙŠØ¨Ù‡ Ø§Ù„Ø¯Ù…ØºÙ‡ (Ù†Ø³Ø¨ÙŠÙ‡)",
      TaxtypeReference: "T5"
    }, {
      Code: "ST02",
      Desc_en: "Stamping Tax (amount)",
      Desc_ar: "Ø¶Ø±ÙŠØ¨Ù‡ Ø§Ù„Ø¯Ù…ØºÙ‡ (Ù‚Ø·Ø¹ÙŠÙ‡ Ø¨Ù…Ù‚Ø¯Ø§Ø± Ø«Ø§Ø¨Øª)",
      TaxtypeReference: "T6"
    }, {
      Code: "Ent01",
      Desc_en: "Entertainment tax (rate)",
      Desc_ar: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù…Ù„Ø§Ù‡Ù‰ (Ù†Ø³Ø¨Ø©)",
      TaxtypeReference: "T7"
    }, {
      Code: "RD01",
      Desc_en: "Resource development fee (rate)",
      Desc_ar: "Ø±Ø³Ù… ØªÙ†Ù…ÙŠÙ‡ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ (Ù†Ø³Ø¨Ø©)",
      TaxtypeReference: "T8"
    }, {
      Code: "SC01",
      Desc_en: "Service charges (rate)",
      Desc_ar: "Ø±Ø³Ù… Ø®Ø¯Ù…Ø© (Ù†Ø³Ø¨Ø©)",
      TaxtypeReference: "T9"
    }, {
      Code: "Mn01",
      Desc_en: "Municipality Fees (rate)",
      Desc_ar: "Ø±Ø³Ù… Ø§Ù„Ù…Ø­Ù„ÙŠØ§Øª (Ù†Ø³Ø¨Ø©)",
      TaxtypeReference: "T10"
    }, {
      Code: "MI01",
      Desc_en: "Medical insurance fee (rate)",
      Desc_ar: "Ø±Ø³Ù… Ø§Ù„ØªØ§Ù…ÙŠÙ† Ø§Ù„ØµØ­Ù‰ (Ù†Ø³Ø¨Ø©)",
      TaxtypeReference: "T11"
    }, {
      Code: "OF01",
      Desc_en: "Other fees (rate)",
      Desc_ar: "Ø±Ø³ÙˆÙ… Ø£Ø®Ø±Ù‰",
      TaxtypeReference: "T12"
    }];
    let vA6 = [];
    let v109 = -1;
    let v110 = null;
    const vF4 = () => {
      const v111 = p58.querySelector("#item-quantity");
      const v112 = p58.querySelector("#item-unit-price");
      const v113 = p58.querySelector("#item-total");
      if (v111 && v112 && v113) {
        v113.value = ((parseFloat(v111.value) || 0) * (parseFloat(v112.value) || 0)).toFixed(5);
      }
    };
    const v114 = v101 ? "\n        <div class=\"form-group\">\n            <label for=\"manual-reference-uuid\">UUID Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© (*)</label>\n            <div style=\"display: flex; align-items: center; gap: 10px;\">\n                <input type=\"text\" id=\"manual-reference-uuid\" required placeholder=\"Ø£Ø¯Ø®Ù„ UUID Ù‡Ù†Ø§ ÙˆØ§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¨Ø­Ø«\" style=\"flex-grow: 1;\">\n                <button type=\"button\" id=\"fetch-invoice-details-btn\" title=\"Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©\" class=\"action-button\" style=\"padding: 10px 15px; flex-shrink: 0; background-color: #007bff; width: auto;\">ğŸ”</button>\n            </div>\n        </div>\n    " : "";
    const v115 = "\n        <!-- âœ… Ø­Ø§ÙˆÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¹Ø±Ø¶ Ø£ØµÙ†Ø§Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© (Ù„Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª) -->\n        <div id=\"original-invoice-items-container\" style=\"display: none; background: #e9f5ff; border: 1px solid #b3d7ff; border-radius: 8px; padding: 15px; margin-bottom: 25px;\">\n            <h4 style=\"margin-top: 0; color: #0056b3;\">Ø£ØµÙ†Ø§Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© (Ø­Ø¯Ø¯ Ù„Ù„Ø¥Ø±Ø¬Ø§Ø¹)</h4>\n            <div id=\"original-items-list\" style=\"max-height: 200px; overflow-y: auto; margin-bottom: 15px; border: 1px solid #ddd; background: #fff; padding: 10px;\">\n                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù‡Ù†Ø§ -->\n            </div>\n            <button type=\"button\" id=\"add-selected-to-return-btn\" class=\"action-button\" style=\"width: auto; padding: 10px 30px; background-color: #28a745;\">+ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù„Ù„Ù…Ø±ØªØ¬Ø¹</button>\n        </div>\n\n        <!-- Ø²Ø± Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯ -->\n        <button type=\"button\" id=\"add-new-item-button\" class=\"action-button\" style=\"width: auto; padding: 12px 30px; background-color: #007bff; margin-bottom: 20px;\">+ Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</button>\n\n        <!-- Ø­Ø§ÙˆÙŠØ© Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù (Ù…Ø®ÙÙŠØ© Ù…Ø¨Ø¯Ø¦ÙŠÙ‹Ø§) -->\n        <div id=\"item-form-wrapper\" style=\"display: none; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; background-color: #f8f9fa; margin-bottom: 20px;\">\n            <form id=\"item-form\">\n                <div class=\"form-grid\" style=\"align-items: flex-end;\">\n                    <div class=\"form-group\"><label>Ù†ÙˆØ¹ Ø§Ù„ÙƒÙˆØ¯</label><select id=\"item-code-type\" required><option value=\"EGS\">EGS</option><option value=\"GS1\">GS1</option></select></div>\n                    <div class=\"form-group\"><label>Ø§Ù„ÙƒÙˆØ¯</label><input type=\"text\" id=\"item-code\" required></div>\n                    <div class=\"form-group\"><label>Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ¯ (ØªÙ„Ù‚Ø§Ø¦ÙŠ)</label><input type=\"text\" id=\"item-code-name\" readonly style=\"background:#eee;\"></div>\n                    <div class=\"form-group\"><label>ÙˆØµÙ Ø§Ù„ØµÙ†Ù</label><input type=\"text\" id=\"item-description\" required></div>\n                    <div class=\"form-group\"><label>Ø§Ù„ÙƒÙ…ÙŠØ©</label><input type=\"number\" id=\"item-quantity\" value=\"1\" step=\"any\" required></div>\n <!-- âœ¨âœ¨âœ¨ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ù„Ù…Ø¹Ø¯Ù„ âœ¨âœ¨âœ¨ -->\n\n <!-- âœ¨ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø°ÙŠ ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„ØµØ­ÙŠØ­ -->\n<div class=\"form-group\">\n    <label>Ø§Ù„Ø¹Ù…Ù„Ø©</label>\n    <select id=\"item-currency\">\n        " + vA.map(p61 => "<option value=\"" + p61.code + "\">" + p61.Desc_ar + "</option>").join("") + "\n    </select>\n</div>\n\n <div class=\"form-group\">\n     <label>Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù</label>\n     <input type=\"number\" id=\"item-exchange-rate\" value=\"1\" step=\"any\" required>\n </div>\n <div class=\"form-group\">\n     <label>Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© (Ø¨Ø§Ù„Ø¹Ù…Ù„Ø©)</label>\n     <input type=\"number\" id=\"item-unit-price\" step=\"any\" required>\n </div>\n <div class=\"form-group\">\n     <label>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø¨Ø§Ù„Ø¬Ù†ÙŠÙ‡ Ø§Ù„Ù…ØµØ±ÙŠ)</label>\n     <input type=\"text\" id=\"item-total-egp\" readonly style=\"background:#eee; font-weight: bold;\">\n </div>\n\n\n                    </div>\n              <!-- --- âœ… Ø¨Ø¯Ø§ÙŠØ© ØªØ¹Ø¯ÙŠÙ„ ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ --- -->\n<div style=\"margin-top: 20px; display: flex; align-items: center; gap: 15px;\">\n    <h4 style=\"margin: 0;\">Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø¹Ù„Ù‰ Ø§Ù„ØµÙ†Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</h4>\n    <button type=\"button\" id=\"add-tax-row-btn\" class=\"action-button\" style=\"width: auto; padding: 5px 15px; font-size: 14px;\">+ Ø¥Ø¶Ø§ÙØ© Ø¶Ø±ÙŠØ¨Ø©</button>\n</div>\n<div id=\"item-taxes-container\" style=\"margin-top: 10px; display: flex; flex-direction: column; gap: 10px;\">\n    <!-- ØµÙÙˆÙ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø³ØªØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù‡Ù†Ø§ Ø¹Ø¨Ø± JavaScript -->\n</div>\n<!-- --- âœ… Ù†Ù‡Ø§ÙŠØ© ØªØ¹Ø¯ÙŠÙ„ ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ --- -->\n                <hr>\n                <div id=\"item-form-actions\" style=\"display: flex; gap: 10px;\">\n                    <button type=\"submit\" id=\"add-item-btn\" class=\"action-button\" style=\"width: auto; padding: 10px 30px;\">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù</button>\n                    <button type=\"button\" id=\"cancel-edit-btn\" class=\"action-button\" style=\"width: auto; padding: 10px 30px; background-color: #6c757d; display: none;\">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>\n                </div>\n            </form>\n        </div>\n        \n        <h4 style=\"margin-top: 25px;\">Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø¶Ø§ÙØ© (Ø§Ø¶ØºØ· Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)</h4>\n<!-- --- âœ… ØªØ¹Ø¯ÙŠÙ„ 1: Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ù„Ù„Ø¬Ø¯ÙˆÙ„ --- -->\n<table id=\"items-table\"><thead><tr><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø§Ù„ÙˆØµÙ</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead><tbody></tbody></table>\n    ";
    p58.innerHTML = "\n        <div id=\"manual-send-container\">\n            <div id=\"manualSendModal\" class=\"manual-modal\" style=\"display:flex;\">\n                <div class=\"manual-modal-content\">\n                  <div class=\"manual-modal-header\" style=\"cursor: move;\">\n    <h3>" + v102 + "</h3>\n    <button id=\"closeManualModalBtn\" title=\"Ø¥ØºÙ„Ø§Ù‚\" style=\"background: #f1f1f1; color: #555; border: none; width: 30px; height: 30px; border-radius: 50%; font-size: 20px; cursor: pointer; transition: all 0.2s;\">&times;</button>\n</div>\n\n                    <div class=\"manual-modal-body\">\n                        <div class=\"manual-tabs\">\n                            <button class=\"manual-tab-btn active\" data-tab-index=\"0\"><span class=\"tab-status-indicator\"></span>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</button>\n                            <button class=\"manual-tab-btn\" data-tab-index=\"1\"><span class=\"tab-status-indicator\"></span>Ø§Ù„Ø£ØµÙ†Ø§Ù</button>\n                            <button class=\"manual-tab-btn\" data-tab-index=\"2\"><span class=\"tab-status-indicator\"></span>Ø§Ù„Ù…Ù„Ø®Øµ ÙˆØ§Ù„Ø¯ÙØ¹</button>\n                        </div>\n                        <div class=\"manual-tab-content-wrapper\">\n                            <div id=\"tab-basic\" class=\"manual-tab-content active\">\n                            <div class=\"form-grid\">\n    <div class=\"form-group\"><label for=\"manual-receipt-number\">" + v103 + " (*)</label><input type=\"text\" id=\"manual-receipt-number\" required value=\"" + v104 + "\"></div>\n    \n    <div class=\"form-group\">\n        <label for=\"manual-datetime-issued\">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø± (*)</label>\n        <input type=\"date\" id=\"manual-datetime-issued\" required style=\"font-family: sans-serif; text-align: right;\">\n    </div>\n\n    " + v114 + "\n<div class=\"form-group\"><label for=\"manual-buyer-name\">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label><input type=\"text\" id=\"manual-buyer-name\" placeholder=\"Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºÙ‹Ø§ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø§Ø³Ù…\"></div>\n\n<div class=\"form-group\">\n    <label for=\"manual-buyer-id\">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ (14 Ø±Ù‚Ù…)</label>\n    <input type=\"text\" id=\"manual-buyer-id\" maxlength=\"14\" pattern=\"[0-9]{14}\" style=\"transition: all 0.3s ease;\">\n    <small id=\"nid-validation-status\" style=\"margin-top: 5px; font-weight: bold; height: 15px; display: block;\"></small>\n</div>\n                                </div>\n    <hr style=\"margin: 20px 0;\">\n<!-- âœ… Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ¯Ø± ÙˆÙ†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ -->\n<div class=\"collapsible-section open\">\n    <div class=\"collapsible-header\">\n        <h4 style=\"margin: 0;\">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ¯Ø± ÙˆÙ†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ (Ø§Ø¶ØºØ· Ù„Ù„ØªÙˆØ³ÙŠØ¹/Ø§Ù„Ø·ÙŠ)</h4>\n        <span class=\"collapsible-icon\">â–¼</span>\n    </div>\n    <div class=\"collapsible-content\">\n        <div class=\"form-grid\">\n            <!-- Ø§Ø®ØªÙŠØ§Ø± Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->\n            <div class=\"form-group\">\n                <label for=\"pos-device-select\">Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ (POS):</label>\n              \n            \n<select id=\"pos-device-select\" class=\"form-group-select\">\n    " + v107.map(p62 => {
      const v116 = p62.address || {};
      const v117 = (p62.formatedAddress || (v116.street || "") + ", " + (v116.regionCity || "")).replace(/^0\s+/, "").trim();
      let vO4 = {};
      if (p62.formatedAddress) {
        const v118 = p62.formatedAddress.trim();
        const v119 = v118.split(",");
        const v120 = v119[0] || "";
        const v121 = v120.match(/^(\d+)\s+/);
        let vLS2 = "";
        let vV120 = v120;
        if (v121) {
          vLS2 = v121[1];
          vV120 = v120.substring(v121[0].length).trim();
        }
        vO4 = {
          buildingNumber: vLS2,
          street: vV120,
          regionCity: v119[1]?.trim() || "",
          governate: v119[2]?.trim() || ""
        };
      } else if (p62.address) {
        vO4 = {
          ...p62.address,
          buildingNumber: p62.address.buildingNo || ""
        };
      }
      return "<option value=\"" + p62.serialNumber + "\" data-address='" + JSON.stringify(vO4) + "' " + (p62.serialNumber === v108.serialNumber ? "selected" : "") + ">\n                    " + (v117 || p62.serialNumber) + "\n                </option>";
    }).join("") + "\n</select>\n\n                \n\n            </div>\n            " + p59 + "\n        </div>\n        <div class=\"form-grid\" style=\"margin-top: 15px;\">\n            <!-- Ø­Ù‚ÙˆÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ -->\n            <div class=\"form-group\"><label>Ø§Ø³Ù… Ø§Ù„Ù…ØµØ¯Ø±</label><input type=\"text\" id=\"manual-seller-name\" value=\"" + v106.name + "\"></div>\n            <div class=\"form-group\"><label>Ø§Ù„Ø¯ÙˆÙ„Ø©</label><input type=\"text\" id=\"manual-seller-country\" value=\"EG\" readonly></div>\n            <div class=\"form-group\"><label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label><input type=\"text\" id=\"manual-seller-governate\" value=\"" + v106.governate + "\"></div>\n            <div class=\"form-group\"><label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><input type=\"text\" id=\"manual-seller-regionCity\" value=\"" + v106.regionCity + "\"></div>\n            <div class=\"form-group\"><label>Ø§Ù„Ø´Ø§Ø±Ø¹</label><input type=\"text\" id=\"manual-seller-street\" value=\"" + v106.street + "\"></div>\n            <div class=\"form-group\"><label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰</label><input type=\"text\" id=\"manual-seller-building\" value=\"" + v106.buildingNumber + "\"></div>\n        </div>\n    </div>\n</div>\n\n\n                                \n                            </div>\n                            <div id=\"tab-items\" class=\"manual-tab-content\">" + v115 + "</div>\n\n                            <!-- --- âœ… Ø¨Ø¯Ø§ÙŠØ© ØªØ¹Ø¯ÙŠÙ„ Ù‡ÙŠÙƒÙ„ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù„Ø®Øµ --- -->\n<!-- --- âœ… Ø¨Ø¯Ø§ÙŠØ© ØªØ¹Ø¯ÙŠÙ„ Ù‡ÙŠÙƒÙ„ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø±Ø£Ø³ÙŠ --- -->\n<div id=\"tab-summary\" class=\"manual-tab-content\">\n    <div class=\"summary-container\">\n        <h3 class=\"summary-header\">Ù…Ù„Ø®Øµ Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠ</h3>\n        \n        <div class=\"summary-list\">\n            <!-- 1. Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª -->\n            <div class=\"summary-item\">\n                <span class=\"summary-label\">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨)</span>\n                <span class=\"summary-value sales\" id=\"summary-sales-total\">0.00 Ø¬.Ù…</span>\n            </div>\n\n            <!-- 2. Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª (Ø³ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø®ØµÙ…) -->\n            <div class=\"summary-item\" id=\"summary-discount-row\" style=\"display: none;\">\n                <span class=\"summary-label\">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙ…</span>\n                <span class=\"summary-value discount\" id=\"summary-discount-total\">0.00 Ø¬.Ù…</span>\n            </div>\n\n            <!-- 3. Ø­Ø§ÙˆÙŠØ© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ -->\n            <div id=\"summary-tax-details\">\n                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->\n            </div>\n        </div>\n\n        <!-- 4. Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ -->\n        <div class=\"summary-item grand-total\">\n            <span class=\"summary-label\">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</span>\n            <span class=\"summary-value\" id=\"summary-grand-total\">0.00 Ø¬.Ù…</span>\n        </div>\n    </div>\n\n    <!-- 5. Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ -->\n    <div class=\"payment-section-vertical\">\n        <label for=\"payment-method\">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>\n        <select id=\"payment-method\">\n            <option value=\"C\" selected>Ù†Ù‚Ø¯ÙŠ (Cash)</option>\n            <option value=\"V\">ÙÙŠØ²Ø§/Ù…Ø§Ø³ØªØ±ÙƒØ§Ø±Ø¯ (Visa/Mastercard)</option>\n        </select>\n    </div>\n\n    <!-- 6. Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->\n\n    <!-- âœ¨ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ Ø²Ø± Ù‚Ø±Ø§Ø¡Ø© JSON âœ¨ -->\n<div class=\"actions-container\">\n    <button id=\"save-draft-btn\" class=\"action-button draft-btn\">ğŸ“ Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø©</button>\n    \n    <!-- âœ… Ø§Ù„Ø²Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù‡Ù†Ø§ âœ… -->\n    <button id=\"read-json-btn\" type=\"button\" class=\"action-button\" style=\"background-color: #fd7e14; color: white;\">ğŸ” Ù‚Ø±Ø§Ø¡Ø© JSON</button>\n    \n    <button id=\"send-manual-receipt-btn\" class=\"action-button send-btn\">" + v105 + "</button>\n</div>\n\n</div>\n<!-- --- âœ… Ù†Ù‡Ø§ÙŠØ© ØªØ¹Ø¯ÙŠÙ„ Ù‡ÙŠÙƒÙ„ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø±Ø£Ø³ÙŠ --- -->\n\n\n\n                        </div>\n                        <div class=\"manual-modal-footer\"><button id=\"prevTabBtn\" class=\"navigation-btn\" disabled>Ø§Ù„Ø³Ø§Ø¨Ù‚</button><button id=\"nextTabBtn\" class=\"navigation-btn\">Ø§Ù„ØªØ§Ù„ÙŠ</button></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ";
    const v122 = document.createElement("style");
    v122.id = "manualSendFormStyles";
    if (!document.getElementById(v122.id)) {
      v122.innerHTML = "\n\n\n\n\n\n        /* --- Ø£Ù†Ù…Ø§Ø· ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© --- */\n.code-search-modal {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.6);\n    z-index: 10002; /* ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    backdrop-filter: blur(5px);\n}\n.code-search-content {\n    width: 700px;\n    height: 80%;\n    background: #fff;\n    border-radius: 12px;\n    display: flex;\n    flex-direction: column;\n    box-shadow: 0 5px 25px rgba(0,0,0,0.2);\n}\n.code-search-header {\n    padding: 15px 20px;\n    border-bottom: 1px solid #dee2e6;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n.code-search-header h4 { margin: 0; color: #1d3557; }\n.code-search-header input {\n    width: 50%;\n    padding: 8px 12px;\n    border: 1px solid #ced4da;\n    border-radius: 8px;\n    font-size: 15px;\n}\n.code-search-body {\n    flex-grow: 1;\n    overflow-y: auto;\n    padding: 10px;\n}\n.code-search-table {\n    width: 100%;\n    border-collapse: collapse;\n}\n.code-search-table th, .code-search-table td {\n    padding: 12px;\n    text-align: right;\n    border-bottom: 1px solid #e9ecef;\n}\n.code-search-table th { background-color: #f8f9fa; font-weight: 600; }\n.code-search-table tbody tr { cursor: pointer; transition: background-color 0.2s; }\n.code-search-table tbody tr:hover { background-color: #e9f5ff; }\n.code-search-table .code-value { font-family: monospace; color: #007bff; direction: ltr; text-align: left; }\n.code-search-placeholder { text-align: center; padding: 40px; color: #888; font-size: 18px; }\n\n            /* --- ØªØµÙ…ÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© --- */\n            .manual-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 10001; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }\n            .manual-modal-content { width: 95%; max-width: 1300px; height: 90vh; background: #f4f7fa; border-radius: 16px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); animation: zoomIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); }\n            @keyframes zoomIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }\n            /* --- ØªØµÙ…ÙŠÙ… Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ (Header) --- */\n            .manual-modal-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 25px; border-bottom: 1px solid #dee2e6; background-color: #ffffff; cursor: move; }\n            .manual-modal-header h3 { margin: 0; font-size: 20px; color: #1d3557; }\n            .manual-modal-header #closeManualModalBtn { background: #f1f1f1; color: #555; border: none; width: 30px; height: 30px; border-radius: 50%; font-size: 20px; cursor: pointer; transition: all 0.2s; }\n            .manual-modal-header #closeManualModalBtn:hover { background: #e63946; color: white; transform: rotate(90deg); }\n            /* --- ØªØµÙ…ÙŠÙ… Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª (Tabs) --- */\n            .manual-modal-body { flex-grow: 1; display: flex; flex-direction: column; overflow-y: auto; }\n            .manual-tabs { display: flex; border-bottom: 1px solid #dee2e6; padding: 0 20px; background-color: #ffffff; }\n            .manual-tab-btn { padding: 18px 25px; border: none; background: transparent; cursor: pointer; font-size: 16px; font-weight: 600; color: #6c757d; border-bottom: 4px solid transparent; transition: all 0.3s; display: flex; align-items: center; gap: 10px; }\n            .manual-tab-btn:hover { color: #007bff; background-color: #f8f9fa; }\n            .manual-tab-btn.active { border-bottom-color: #007bff; color: #007bff; }\n            .manual-tab-content-wrapper { flex-grow: 1; overflow-y: auto; }\n            .manual-tab-content { display: none; padding: 30px; }\n            .manual-tab-content.active { display: block; }\n            /* --- Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚ ÙˆØ£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ --- */\n            .tab-status-indicator { display: inline-block; width: 18px; height: 18px; border-radius: 50%; line-height: 18px; text-align: center; font-size: 12px; font-weight: bold; color: white; background-color: #ced4da; transition: all 0.3s; }\n            .tab-status-indicator.valid { background-color: #28a745; } .tab-status-indicator.valid::before { content: 'âœ”'; }\n            .tab-status-indicator.invalid { background-color: #dc3545; } .tab-status-indicator.invalid::before { content: 'âœ–'; }\n            .manual-modal-footer { padding: 15px 25px; border-top: 1px solid #dee2e6; display: flex; justify-content: space-between; background-color: #f8f9fa; }\n            .navigation-btn { padding: 10px 30px; font-size: 16px; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; transition: all 0.2s; }\n            .navigation-btn:disabled { background-color: #e9ecef; color: #6c757d; cursor: not-allowed; }\n            #nextTabBtn { background-color: #007bff; color: white; }\n            #prevTabBtn { background-color: #6c757d; color: white; }\n            /* --- ØªØµÙ…ÙŠÙ… Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ù„Ø¬Ø¯Ø§ÙˆÙ„ --- */\n            .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; }\n            .form-group { display: flex; flex-direction: column; }\n            .form-group label { margin-bottom: 8px; font-weight: 600; color: #495057; font-size: 14px; }\n            .form-group input, .form-group select { padding: 12px; border: 1px solid #ced4da; border-radius: 8px; font-size: 15px; transition: all 0.2s; }\n            .form-group input:focus, .form-group select:focus { border-color: #007bff; box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1); outline: none; }\n            .form-group input[readonly] { background-color: #e9ecef; cursor: not-allowed; }\n            #items-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }\n            #items-table th, #items-table td { border: 1px solid #e9ecef; padding: 12px; text-align: center; }\n            #items-table th { background-color: #e9ecef; font-weight: 700; color: #343a40; }\n            #items-table tbody tr:nth-child(even) { background-color: #f8f9fa; }\n            #items-table tbody tr { cursor: pointer; transition: background-color 0.2s; }\n            #items-table tbody tr:hover { background-color: #e9ecef; }\n            .editing-item { background-color: #fffbe6 !important; border: 2px solid #ffe58f; }\n            .action-button { transition: all 0.2s; }\n            .action-button:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.15); }\n\n\n\n            .tax-row { \n    display: grid; \n    grid-template-columns: 1fr 1fr 1fr auto; \n    gap: 15px; \n    align-items: flex-end; \n    padding: 10px; \n    background: #f0f0f0; \n    border-radius: 6px; \n}\n.delete-tax-row-btn { \n    background: #f8d7da; \n    color: #721c24; \n    border: 1px solid #f5c6cb; \n    border-radius: 50%; \n    width: 32px; \n    height: 32px; \n    font-size: 20px; \n    cursor: pointer; \n}\n    /* --- âœ… Ø¨Ø¯Ø§ÙŠØ© Ø£Ù†Ù…Ø§Ø· Ù‚Ø³Ù… Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ --- */\n.summary-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 25px;\n    margin-bottom: 30px;\n}\n.summary-card {\n    background: #ffffff;\n    border-radius: 12px;\n    padding: 25px;\n    display: flex;\n    align-items: center;\n    gap: 20px;\n    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.06);\n    border: 1px solid #e9ecef;\n}\n.summary-card .card-icon {\n    font-size: 36px;\n    background-color: #e7f3ff;\n    color: #007bff;\n    width: 60px;\n    height: 60px;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n.summary-card.grand-total .card-icon {\n    background-color: #d4edda;\n    color: #155724;\n}\n.summary-card .card-content {\n    display: flex;\n    flex-direction: column;\n}\n.summary-card .card-label {\n    font-size: 15px;\n    color: #6c757d;\n    margin-bottom: 5px;\n}\n.summary-card .card-value {\n    font-size: 26px;\n    font-weight: 700;\n    color: #343a40;\n}\n.tax-details-container {\n    background: #ffffff;\n    border-radius: 12px;\n    padding: 20px;\n    margin-bottom: 30px;\n    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.06);\n}\n.tax-details-header {\n    margin: 0 0 15px 0;\n    color: #1d3557;\n    border-bottom: 1px solid #eee;\n    padding-bottom: 10px;\n}\n.tax-details-body {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n}\n.tax-detail-row {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 10px;\n    background-color: #f8f9fa;\n    border-radius: 8px;\n    font-size: 16px;\n}\n.tax-detail-row .tax-name {\n    font-weight: 600;\n    color: #495057;\n}\n.tax-detail-row .tax-amount {\n    font-weight: bold;\n    color: #212529;\n    direction: ltr;\n}\n.tax-detail-row.withholding-tax .tax-amount {\n    color: #c0392b; /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø®ØµÙ… */\n}\n.tax-placeholder {\n    text-align: center;\n    color: #888;\n    padding: 20px;\n}\n.payment-section {\n    display: grid;\n    grid-template-columns: 1fr 2fr;\n    gap: 25px;\n    align-items: flex-end;\n    margin-top: 20px;\n    border-top: 1px solid #dee2e6;\n    padding-top: 30px;\n}\n.actions-container {\n    display: flex;\n    gap: 15px;\n}\n.actions-container .action-button {\n    flex-grow: 1;\n    padding: 15px;\n    font-size: 18px;\n    font-weight: bold;\n}\n.actions-container .draft-btn { background-color: #ffc107; color: #333; }\n.actions-container .send-btn { background-color: #28a745; color: white; }\n/* --- âœ… Ù†Ù‡Ø§ÙŠØ© Ø£Ù†Ù…Ø§Ø· Ù‚Ø³Ù… Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ --- */\n\n/* --- âœ… Ø¨Ø¯Ø§ÙŠØ© Ø£Ù†Ù…Ø§Ø· Ù‚Ø³Ù… Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø±Ø£Ø³ÙŠ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ --- */\n.summary-container {\n    background: #ffffff;\n    border-radius: 12px;\n    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.07);\n    border: 1px solid #e9ecef;\n    overflow: hidden;\n    margin-bottom: 30px;\n}\n.summary-header {\n    margin: 0;\n    padding: 18px 25px;\n    background-color: #f8f9fa;\n    color: #1d3557;\n    font-size: 18px;\n    border-bottom: 1px solid #dee2e6;\n}\n.summary-list {\n    padding: 15px 25px;\n}\n.summary-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 15px 0;\n    border-bottom: 1px dashed #e0e0e0;\n}\n.summary-list .summary-item:last-child {\n    border-bottom: none;\n}\n.summary-label {\n    font-size: 16px;\n    color: #495057;\n    font-weight: 600;\n}\n.summary-value {\n    font-size: 18px;\n    font-weight: 700;\n    direction: ltr;\n}\n.summary-value.sales { color: #007bff; }\n.summary-value.discount { color: #e67e22; }\n\n.tax-detail-row {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 12px 0;\n    border-bottom: 1px dashed #e0e0e0;\n}\n.tax-detail-row .tax-name {\n    font-size: 15px;\n    color: #6c757d;\n}\n.tax-detail-row .tax-amount {\n    font-weight: 600;\n    color: #28a745;\n    direction: ltr;\n}\n.tax-detail-row.withholding-tax .tax-amount {\n    color: #c0392b; /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø®ØµÙ… */\n}\n\n.summary-item.grand-total {\n    background-color: #f8f9fa;\n    padding: 20px 25px;\n    margin: 15px -25px -15px -25px;\n    border-top: 1px solid #dee2e6;\n}\n.summary-item.grand-total .summary-label {\n    font-size: 18px;\n    color: #1d3557;\n}\n.summary-item.grand-total .summary-value {\n    font-size: 28px;\n    color: #155724;\n}\n.payment-section-vertical {\n    margin-bottom: 30px;\n}\n.payment-section-vertical label {\n    font-weight: bold;\n    margin-bottom: 10px;\n    display: block;\n}\n.payment-section-vertical select {\n    width: 100%;\n    padding: 12px;\n    font-size: 16px;\n}\n.actions-container {\n    display: flex;\n    gap: 15px;\n}\n.actions-container .action-button {\n    flex-grow: 1;\n    padding: 15px;\n    font-size: 18px;\n    font-weight: bold;\n}\n.actions-container .draft-btn { background-color: #ffc107; color: #333; }\n.actions-container .send-btn { background-color: #28a745; color: white; }\n/* --- âœ… Ù†Ù‡Ø§ÙŠØ© Ø£Ù†Ù…Ø§Ø· Ù‚Ø³Ù… Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø±Ø£Ø³ÙŠ --- */\n\n        ";
      document.head.appendChild(v122);
    }
    const v123 = p58.querySelector("#manualSendModal");
    const v124 = p58.querySelector(".manual-modal-header");
    makeDraggable(v123, v124);
    const v125 = p58.querySelector("#manual-buyer-id");
    const v126 = p58.querySelector("#nid-validation-status");
    async function validateNID(p63) {
      if (!p63 || p63.length !== 14 || !/^\d+$/.test(p63)) {
        return {
          valid: false,
          message: "ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ 14 Ø±Ù‚Ù…Ù‹Ø§ ØµØ­ÙŠØ­Ù‹Ø§."
        };
      }
      try {
        const v_0x57971a = getAccessToken();
        if (!v_0x57971a) {
          return {
            valid: false,
            message: "Ø®Ø·Ø£ Ù…ØµØ§Ø¯Ù‚Ø©."
          };
        }
        const v127 = await fetch("https://api-portal.invoicing.eta.gov.eg/api/v1/person/" + p63, {
          headers: {
            Authorization: "Bearer " + v_0x57971a
          }
        });
        if (v127.status === 200) {
          const v128 = await v127.json();
          const v129 = ((v128.firstName || "") + " " + (v128.otherNames || "")).trim();
          return {
            valid: true,
            message: "ØµØ­ÙŠØ­ (" + (v129 || "Ø´Ø®Øµ") + ")"
          };
        } else if (v127.status === 400) {
          const v130 = await v127.json();
          return {
            valid: false,
            message: v130.error.details[0].message || "Ø±Ù‚Ù… Ù‚ÙˆÙ…ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­."
          };
        } else {
          return {
            valid: false,
            message: "Ø®Ø·Ø£ " + v127.status + " Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…."
          };
        }
      } catch (e9) {
        return {
          valid: false,
          message: "ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù‚Ù…."
        };
      }
    }
    v125.addEventListener("blur", async () => {
      const v131 = v125.value.trim();
      if (!v131) {
        v126.textContent = "";
        v125.style.backgroundColor = "";
        v125.style.borderColor = "";
        return;
      }
      v126.textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...";
      v126.style.color = "#007bff";
      const v132 = await validateNID(v131);
      if (v132.valid) {
        v126.textContent = "âœ… " + v132.message;
        v126.style.color = "#28a745";
        v125.style.backgroundColor = "#d4edda";
        v125.style.borderColor = "#28a745";
      } else {
        v126.textContent = "âŒ " + v132.message;
        v126.style.color = "#dc3545";
        v125.style.backgroundColor = "#f8d7da";
        v125.style.borderColor = "#dc3545";
      }
    });
    v125.addEventListener("input", () => {
      if (v125.style.backgroundColor !== "") {
        v126.textContent = "";
        v125.style.backgroundColor = "";
        v125.style.borderColor = "";
      }
    });
    p58.querySelector("#closeManualModalBtn").onclick = () => {
      v123.style.display = "none";
      p58.innerHTML = "";
    };
    const v133 = p58.querySelector("#pos-device-select");
    v133.addEventListener("change", p64 => {
      const v134 = p64.target.options[p64.target.selectedIndex];
      const v135 = JSON.parse(v134.dataset.address || "{}");
      let v136 = v135.buildingNumber || "";
      let v137 = v135.street || "";
      if (v137 && !v136) {
        const v138 = v137.match(/^(\d+)\s+/);
        if (v138) {
          v136 = v138[1];
          v137 = v137.substring(v138[0].length).trim();
        }
      }
      p58.querySelector("#manual-seller-governate").value = v135.governate || "";
      p58.querySelector("#manual-seller-regionCity").value = v135.regionCity || "";
      p58.querySelector("#manual-seller-street").value = v137;
      p58.querySelector("#manual-seller-building").value = v136;
    });
    v133.dispatchEvent(new Event("change"));
    const v139 = Array.from(p58.querySelectorAll(".manual-tab-btn"));
    const v140 = Array.from(p58.querySelectorAll(".manual-tab-content"));
    const v141 = p58.querySelector("#prevTabBtn");
    const v142 = p58.querySelector("#nextTabBtn");
    let vLN02 = 0;
    function switchTab(p65) {
      if (p65 < 0 || p65 >= v139.length) {
        return;
      }
      f29();
      v139.forEach(p66 => p66.classList.remove("active"));
      v140.forEach(p67 => p67.classList.remove("active"));
      v139[p65].classList.add("active");
      v140[p65].classList.add("active");
      vLN02 = p65;
      v141.disabled = vLN02 === 0;
      v142.disabled = vLN02 === v139.length - 1;
    }
    v139.forEach(p68 => p68.addEventListener("click", () => switchTab(parseInt(p68.dataset.tabIndex))));
    v141.addEventListener("click", () => switchTab(vLN02 - 1));
    v142.addEventListener("click", () => switchTab(vLN02 + 1));
    function validateTab(p69) {
      const v143 = v140[p69];
      const v144 = v139[p69].querySelector(".tab-status-indicator");
      let v145 = true;
      if (p69 === 1) {
        v145 = vA6.length > 0;
      } else {
        const v146 = v143.querySelectorAll("[required]");
        for (const v147 of v146) {
          if (!v147.value.trim()) {
            v145 = false;
            break;
          }
        }
      }
      v144.classList.remove("valid", "invalid");
      v144.classList.add(v145 ? "valid" : "invalid");
    }
    function f29() {
      v139.forEach((p70, p71) => validateTab(p71));
    }
    v123.querySelectorAll("input[required], select[required]").forEach(p72 => p72.addEventListener("input", f29));
    const v148 = p58.querySelector("#add-new-item-button");
    const v149 = p58.querySelector("#item-form-wrapper");
    v148.addEventListener("click", () => {
      v149.style.display = "block";
      v148.style.display = "none";
      dragMouseDown();
      v149.scrollIntoView({
        behavior: "smooth",
        block: "start"
      });
    });
    function dragMouseDown() {
      v173.reset();
      v158.innerHTML = "";
      vF4();
      v109 = -1;
      v175.textContent = "Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù";
      v176.style.display = "none";
      v174.querySelectorAll("tr").forEach(p73 => p73.classList.remove("editing-item"));
      v149.style.display = "none";
      v148.style.display = "block";
    }
    const v150 = p58.querySelector("#item-quantity");
    const v151 = p58.querySelector("#item-unit-price");
    const v152 = p58.querySelector("#item-currency");
    const v153 = p58.querySelector("#item-exchange-rate");
    const v154 = p58.querySelector("#item-total-egp");
    const vF5 = () => {
      const v155 = parseFloat(v150.value) || 0;
      const v156 = parseFloat(v151.value) || 0;
      const v157 = parseFloat(v153.value) || 1;
      v154.value = (v155 * v156 * v157).toFixed(5);
    };
    v152.addEventListener("change", () => {
      if (v152.value === "EGP") {
        v153.value = 1;
        v153.readOnly = true;
        v153.style.backgroundColor = "#eee";
      } else {
        v153.readOnly = false;
        v153.style.backgroundColor = "white";
      }
      vF5();
    });
    [v150, v151, v153, v152].forEach(p74 => p74.addEventListener("input", vF5));
    v152.dispatchEvent(new Event("change"));
    const v158 = p58.querySelector("#item-taxes-container");
    let vLN03 = 0;
    function addTaxRow(p75 = null) {
      if (v158.children.length >= 2) {
        f74("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø£ÙƒØ«Ø± Ù…Ù† Ø¶Ø±ÙŠØ¨ØªÙŠÙ†.", 3000);
        return;
      }
      const v159 = document.createElement("div");
      v159.className = "tax-row";
      v159.innerHTML = "\n        <div class=\"form-group\"><label>Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</label><select class=\"tax-type\">" + vA4.map(p76 => "<option value=\"" + p76.Code + "\">" + p76.Desc_ar + "</option>").join("") + "</select></div>\n        <div class=\"form-group\"><label>Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ</label><select class=\"tax-subtype\"></select></div>\n        <div class=\"form-group\"><label>Ø§Ù„Ù†Ø³Ø¨Ø© %</label><input type=\"number\" class=\"tax-rate\" step=\"any\" placeholder=\"Ù…Ø«Ø§Ù„: 14\"></div>\n        <button type=\"button\" class=\"delete-tax-row-btn\" title=\"Ø­Ø°Ù Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©\">&times;</button>\n    ";
      v158.appendChild(v159);
      const v160 = v159.querySelector(".tax-type");
      const v161 = v159.querySelector(".tax-subtype");
      const vF6 = () => {
        const v162 = v160.value;
        const v163 = vA5.filter(p77 => {
          const v164 = vA4.find(p78 => p78.Code === v162);
          return p77.TaxtypeReference === v164?.Desc_ar || p77.TaxtypeReference === v162;
        });
        v161.innerHTML = v163.map(p79 => "<option value=\"" + p79.Code + "\">" + p79.Desc_ar + "</option>").join("");
        if (v162 === "T1") {
          v161.value = "V009";
        }
      };
      v160.addEventListener("change", vF6);
      vF6();
      if (p75) {
        v160.value = p75.taxType;
        vF6();
        v161.value = p75.subType;
        v159.querySelector(".tax-rate").value = p75.rate;
      }
      v159.querySelector(".delete-tax-row-btn").onclick = () => {
        v159.remove();
        updateSummary();
      };
      v159.querySelector(".tax-rate").addEventListener("input", updateSummary);
    }
    p58.querySelector("#add-tax-row-btn").onclick = () => addTaxRow();
    const v165 = p58.querySelector("#item-code");
    const v166 = p58.querySelector("#item-code-name");
    const v167 = p58.querySelector("#item-code-type");
    const v168 = v165.parentElement;
    v168.style.position = "relative";
    const v169 = document.createElement("span");
    v169.innerHTML = "ğŸ”";
    Object.assign(v169.style, {
      position: "absolute",
      left: "10px",
      top: "50%",
      transform: "translateY(-50%)",
      cursor: "pointer",
      fontSize: "18px",
      display: v167.value === "EGS" ? "block" : "none"
    });
    v168.appendChild(v169);
    const vF7 = () => {
      v169.style.display = v167.value === "EGS" ? "block" : "none";
    };
    v167.addEventListener("change", vF7);
    v169.addEventListener("click", p80 => {
      p80.stopPropagation();
      showEgsCodeSearchModal(p81 => {
        v165.value = p81.codeLookupValue;
        v166.value = p81.codeNameSecondaryLang;
        p58.querySelector("#item-description").value = p81.codeNameSecondaryLang;
      });
    });
    const vF10 = async () => {
      const v170 = v165.value.trim();
      const v171 = v167.value;
      if (!v170) {
        v166.value = "";
        return;
      }
      v166.value = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...";
      let v172 = null;
      if (v171 === "EGS") {
        v172 = await f92(v170);
      } else if (v171 === "GS1") {
        v172 = await f93(v170);
      }
      v166.value = v172 ? v172.codeNameSecondaryLang : "!! ÙƒÙˆØ¯ ØºÙŠØ± ØµØ§Ù„Ø­ !!";
    };
    v165.addEventListener("blur", vF10);
    v167.addEventListener("change", vF10);
    const v173 = p58.querySelector("#item-form");
    const v174 = p58.querySelector("#items-table tbody");
    const v175 = p58.querySelector("#add-item-btn");
    const v176 = p58.querySelector("#cancel-edit-btn");
    function dragMouseDown() {
      v173.reset();
      v158.innerHTML = "";
      vLN03 = 0;
      vF4();
      v109 = -1;
      v175.textContent = "Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù";
      v176.style.display = "none";
      v174.querySelectorAll("tr").forEach(p82 => p82.classList.remove("editing-item"));
    }
    v176.addEventListener("click", dragMouseDown);
    function populateItemForm(p83) {
      p58.querySelector("#item-code-type").value = p83.itemType;
      p58.querySelector("#item-code").value = p83.itemCode;
      p58.querySelector("#item-description").value = p83.description;
      p58.querySelector("#item-quantity").value = p83.quantity;
      const v177 = p58.querySelector("#item-currency");
      const v178 = p58.querySelector("#item-exchange-rate");
      const v179 = p58.querySelector("#item-unit-price");
      v177.value = p83.currencySold || "EGP";
      v178.value = p83.exchangeRate || 1;
      v179.value = p83.unitPrice;
      v177.dispatchEvent(new Event("change"));
      vF5();
      const v180 = p58.querySelector("#item-taxes-container");
      v180.innerHTML = "";
      if (p83.taxableItems && p83.taxableItems.length > 0) {
        p83.taxableItems.forEach(p84 => {
          addTaxRow(p84);
        });
      }
      p58.querySelector("#item-code").dispatchEvent(new Event("blur"));
    }
    function renderItemsTable() {
      v174.innerHTML = "";
      vA6.forEach((p85, p86) => {
        const v181 = v174.insertRow();
        v181.dataset.index = p86;
        v181.className = p86 === v109 ? "editing-item" : "";
        const v182 = p85.taxableItems.map(p87 => p87.taxType + "(" + p87.rate + "%)").join(", ") || "<span style=\"color: #999;\">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>";
        v181.innerHTML = "\n    <td>" + p85.itemCode + "</td>\n    <td>" + p85.description + "</td>\n    <td>" + p85.quantity + "</td>\n    <td>" + p85.unitPrice.toFixed(2) + "</td>\n    <td style=\"font-size: 12px; font-weight: bold;\">" + v182 + "</td>\n    <td>" + p85.total.toFixed(5) + "</td>\n    <td><button class=\"delete-item-btn\" data-index=\"" + p86 + "\" style=\"background: #dc3545; color: white; border: none; border-radius: 50%; cursor: pointer; width: 28px; height: 28px;\">&times;</button></td>\n";
        v181.addEventListener("click", p88 => {
          if (p88.target.classList.contains("delete-item-btn")) {
            return;
          }
          v174.querySelectorAll("tr").forEach(p89 => p89.classList.remove("editing-item"));
          v181.classList.add("editing-item");
          v109 = p86;
          populateItemForm(vA6[p86]);
          v175.textContent = "Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª";
          v176.style.display = "inline-block";
          v173.scrollIntoView({
            behavior: "smooth"
          });
        });
      });
      p58.querySelectorAll(".delete-item-btn").forEach(p90 => {
        p90.onclick = p91 => {
          p91.stopPropagation();
          vA6.splice(p90.dataset.index, 1);
          if (v109 == p90.dataset.index) {
            dragMouseDown();
          }
          renderItemsTable();
          f29();
        };
      });
      updateSummary();
      if (vA6.length === 0) {
        v149.style.display = "none";
        v148.style.display = "block";
      } else {
        v149.style.display = "block";
        v148.style.display = "none";
      }
    }
    v173.addEventListener("submit", p92 => {
      p92.preventDefault();
      const vO5 = {
        itemType: p58.querySelector("#item-code-type").value,
        itemCode: p58.querySelector("#item-code").value,
        description: p58.querySelector("#item-description").value,
        unitType: "EA",
        quantity: parseFloat(v150.value) || 0,
        unitPrice: parseFloat(v151.value) || 0,
        currencySold: v152.value,
        exchangeRate: parseFloat(v153.value) || 1,
        total: parseFloat(v154.value) || 0,
        taxableItems: []
      };
      const v183 = v158.querySelectorAll(".tax-row");
      v183.forEach((p93, p94) => {
        const v184 = p93.querySelector(".tax-rate");
        const v185 = p93.querySelector(".tax-type");
        const v186 = p93.querySelector(".tax-subtype");
        if (v184 && v184.value.trim() !== "") {
          const vParseFloat = parseFloat(v184.value);
          if (!isNaN(vParseFloat)) {
            const vO6 = {
              taxType: v185.value,
              subType: v186.value,
              rate: vParseFloat
            };
            vO5.taxableItems.push(vO6);
          } else {}
        } else {}
      });
      if (v109 > -1) {
        vA6[v109] = vO5;
      } else {
        vA6.push(vO5);
      }
      dragMouseDown();
      renderItemsTable();
      f29();
    });
    if (v101) {
      const v187 = p58.querySelector("#fetch-invoice-details-btn");
      const v188 = p58.querySelector("#original-invoice-items-container");
      const v189 = p58.querySelector("#original-items-list");
      const v190 = p58.querySelector("#add-selected-to-return-btn");
      v187.addEventListener("click", async () => {
        const v191 = p58.querySelector("#manual-reference-uuid").value.trim();
        if (!v191) {
          alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ UUID Ø£ÙˆÙ„Ø§Ù‹.");
          return;
        }
        const v192 = v187.textContent;
        v187.textContent = "â³";
        v187.disabled = true;
        try {
          const v_0x57971a2 = getAccessToken();
          if (!v_0x57971a2) {
            throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙˆÙƒÙ† Ø§Ù„Ø¯Ø®ÙˆÙ„.");
          }
          const v193 = "https://api-portal.invoicing.eta.gov.eg/api/v1/receipts/" + v191 + "/details";
          const v194 = await fetch(v193, {
            headers: {
              Authorization: "Bearer " + v_0x57971a2
            }
          });
          if (!v194.ok) {
            const v195 = await v194.text();
            throw new Error(v195 || "ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø±Ù…Ø² Ø§Ù„Ø­Ø§Ù„Ø©: " + v194.status + ")");
          }
          const v196 = await v194.json();
          v110 = v196.receipt;
          p58.querySelector("#manual-buyer-name").value = v110.buyer?.buyerName || "";
          p58.querySelector("#manual-buyer-id").value = v110.buyer?.buyerId || "";
          f74("âœ… ØªÙ… Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­.", 3000);
          if (v110.itemData && v110.itemData.length > 0) {
            v189.innerHTML = v110.itemData.map((p95, p96) => "\n                        <div style=\"padding: 8px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 10px;\">\n                            <input type=\"checkbox\" class=\"original-item-checkbox\" data-index=\"" + p96 + "\" style=\"width: 18px; height: 18px;\">\n                            <label style=\"flex-grow: 1;\">\n                                " + p95.description + " (Ø§Ù„ÙƒÙ…ÙŠØ©: " + p95.quantity + ", Ø§Ù„Ø³Ø¹Ø±: " + p95.unitPrice.toFixed(2) + ")\n                            </label>\n                        </div>\n                    ").join("");
            v188.style.display = "block";
          } else {
            v189.innerHTML = "<p style=\"color: #888;\">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙ†Ø§Ù ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©.</p>";
          }
        } catch (e10) {
          alert("âŒ Ø®Ø·Ø£: " + e10.message);
          v188.style.display = "none";
        } finally {
          v187.textContent = v192;
          v187.disabled = false;
        }
      });
      v190.addEventListener("click", () => {
        const v197 = p58.querySelectorAll(".original-item-checkbox:checked");
        if (v197.length === 0) {
          alert("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ ØµÙ†Ù ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ù„Ù…Ø±ØªØ¬Ø¹.");
          return;
        }
        const v198 = v110.currency || "EGP";
        const v199 = v110.exchangeRate || 1;
        v197.forEach(p97 => {
          const vParseInt = parseInt(p97.dataset.index, 10);
          const v200 = v110.itemData[vParseInt];
          if (v200) {
            let v201;
            if (v198 !== "EGP" && v200.unitValue && typeof v200.unitValue.amountSold !== "undefined") {
              v201 = v200.unitValue.amountSold;
            } else {
              v201 = v200.unitPrice;
            }
            const vO7 = {
              itemType: v200.itemType,
              itemCode: v200.itemCode,
              description: v200.description,
              unitType: v200.unitType,
              quantity: v200.quantity,
              unitPrice: v201,
              currencySold: v198,
              exchangeRate: v199,
              total: v200.total,
              taxableItems: v200.taxableItems.map(p98 => ({
                taxType: p98.taxType,
                subType: p98.subType,
                rate: p98.rate,
                amount: p98.amount
              }))
            };
            vA6.push(vO7);
          }
        });
        renderItemsTable();
        f29();
        v188.style.display = "none";
        f74("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© " + v197.length + " ØµÙ†Ù Ù„Ù„Ù…Ø±ØªØ¬Ø¹.", 3000);
      });
    }
    function updateSummary() {
      const vO8 = {
        T1: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©",
        T2: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ù†Ø³Ø¨ÙŠØ©)",
        T3: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø§Ù„Ù†ÙˆØ¹ÙŠØ©)",
        T4: "Ø®ØµÙ… Ù…Ù† Ø§Ù„Ù…Ù†Ø¨Ø¹",
        T5: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¯Ù…ØºØ© (Ù†Ø³Ø¨ÙŠØ©)",
        T6: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¯Ù…ØºØ© (Ù‚Ø·Ø¹ÙŠØ©)",
        T7: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù…Ù„Ø§Ù‡ÙŠ",
        T8: "Ø±Ø³Ù… ØªÙ†Ù…ÙŠØ© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯",
        T9: "Ø±Ø³Ù… Ø®Ø¯Ù…Ø©",
        T10: "Ø±Ø³Ù… Ø§Ù„Ù…Ø­Ù„ÙŠØ§Øª",
        T11: "Ø±Ø³Ù… Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„ØµØ­ÙŠ",
        T12: "Ø±Ø³ÙˆÙ… Ø£Ø®Ø±Ù‰"
      };
      const v202 = p58.querySelector("#summary-tax-details");
      const v203 = p58.querySelector("#summary-discount-row");
      let vLN04 = 0;
      let vLN05 = 0;
      const v204 = new Map();
      vA6.forEach(p99 => {
        const v205 = p99.quantity || 0;
        const v206 = p99.unitPrice || 0;
        const v207 = p99.exchangeRate || 1;
        const v208 = v205 * v206 * v207;
        vLN04 += v208;
        const v209 = p99.discount?.amount || 0;
        vLN05 += v209;
        const v210 = v208 - v209;
        let vLN06 = 0;
        p99.taxableItems.forEach(p100 => {
          if (p100.taxType === "T2" || p100.taxType === "T3") {
            vLN06 += v210 * ((p100.rate || 0) / 100);
          }
        });
        const v211 = v210 + vLN06;
        p99.taxableItems.forEach(p101 => {
          const v212 = p101.taxType === "T1" ? v211 : v210;
          const v213 = v212 * ((p101.rate || 0) / 100);
          v204.set(p101.taxType, (v204.get(p101.taxType) || 0) + v213);
        });
      });
      if (vLN05 > 0) {
        v203.style.display = "flex";
        p58.querySelector("#summary-discount-total").textContent = "-" + vLN05.toFixed(2) + " Ø¬.Ù…";
      } else {
        v203.style.display = "none";
      }
      let v214 = vLN04 - vLN05;
      let vLS3 = "";
      if (v204.size > 0) {
        v204.forEach((p102, p103) => {
          const v215 = vO8[p103] || p103;
          const v216 = p103 === "T4";
          v214 += v216 ? -p102 : p102;
          vLS3 += "\n                <div class=\"tax-detail-row " + (v216 ? "withholding-tax" : "") + "\">\n                    <span class=\"tax-name\">" + v215 + "</span>\n                    <span class=\"tax-amount\">" + (v216 ? "-" : "") + p102.toFixed(5) + " Ø¬.Ù…</span>\n                </div>\n            ";
        });
        v202.innerHTML = vLS3;
      } else {
        v202.innerHTML = "<div class=\"tax-placeholder\">Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ø¶Ø±Ø§Ø¦Ø¨.</div>";
      }
      p58.querySelector("#summary-sales-total").textContent = vLN04.toFixed(2) + " Ø¬.Ù…";
      p58.querySelector("#summary-grand-total").textContent = v214.toFixed(2) + " Ø¬.Ù…";
    }
    function collectRawDataFromGroup(p104) {
      const vO9 = {};
      p104.querySelectorAll("[data-field], [data-issuer-field], [data-receiver-field], [data-invoice-field]").forEach(p105 => {
        const v217 = p105.dataset.field || p105.dataset.issuerField || p105.dataset.receiverField || p105.dataset.invoiceField;
        if (v217) {
          vO9[v217] = p105.textContent.trim();
        }
      });
      let vLN07 = 0;
      let vLN08 = 0;
      const v218 = new Map();
      const vA7 = [];
      const vA8 = [];
      p104.querySelectorAll(".items-table tbody tr").forEach(p106 => {
        const vO10 = {};
        p106.querySelectorAll("[data-field]").forEach(p107 => {
          if (p107.querySelectorAll("span[data-field]").length > 0) {
            p107.querySelectorAll("span[data-field]").forEach(p108 => {
              vO10[p108.dataset.field] = p108.textContent.trim();
            });
          } else {
            vO10[p107.dataset.field] = p107.textContent.trim();
          }
        });
        vA8.push(vO10);
        const v219 = parseFloat(vO10.quantity) || 0;
        const v220 = parseFloat(vO10.unit_price) || 0;
        const vParseFloat2 = parseFloat((v219 * v220).toFixed(5));
        vLN07 += vParseFloat2;
        const v221 = parseFloat(vO10.discount_amount) || vParseFloat2 * (parseFloat(vO10.discount_rate) || 0) / 100;
        vLN08 += v221;
        const vParseFloat3 = parseFloat((vParseFloat2 - v221).toFixed(5));
        const vA9 = [];
        let vLN09 = 0;
        for (let vLN1 = 1; vLN1 <= 3; vLN1++) {
          const v222 = vO10["tax_type_" + vLN1]?.trim().toUpperCase();
          const v223 = vO10["tax_rate_" + vLN1];
          if (v222 && v223 != null && v223.trim() !== "" && !isNaN(parseFloat(v223))) {
            const vParseFloat4 = parseFloat(v223);
            const vParseFloat5 = parseFloat((vParseFloat3 * (vParseFloat4 / 100)).toFixed(5));
            const v224 = vO10["tax_subtype_" + vLN1]?.trim() || vO64[v222] || "";
            vA9.push({
              taxType: v222,
              amount: vParseFloat5,
              subType: v224,
              rate: vParseFloat4
            });
            vLN09 += v222 === "T4" ? -vParseFloat5 : vParseFloat5;
            v218.set(v222, (v218.get(v222) || 0) + vParseFloat5);
          }
        }
        vA7.push({
          description: vO10.item_description,
          itemType: vO10.item_type,
          itemCode: vO10.item_code,
          internalCode: vO10.item_internal_code || vO10.item_code,
          unitType: vO10.unit_type,
          quantity: v219,
          unitValue: {
            currencySold: "EGP",
            amountEGP: v220
          },
          salesTotal: vParseFloat2,
          discount: {
            amount: v221
          },
          netTotal: vParseFloat3,
          taxableItems: vA9,
          total: parseFloat((vParseFloat3 + vLN09).toFixed(5)),
          valueDifference: 0,
          totalTaxableFees: 0,
          itemsDiscount: 0
        });
      });
      const v225 = Array.from(v218, ([v226, v227]) => ({
        taxType: v226,
        amount: parseFloat(v227.toFixed(5))
      }));
      const v228 = vA7.reduce((p109, p110) => p109 + p110.total, 0);
      const vO11 = {
        tags: ["FullInvoice", "SignatureRequired"],
        document: {
          documentType: "I",
          documentTypeVersion: "1.0",
          dateTimeIssued: firstLine.dateTimeIssued && !isNaN(new Date(firstLine.dateTimeIssued)) ? new Date(firstLine.dateTimeIssued).toISOString().split(".")[0] + "Z" : new Date().toISOString().split(".")[0] + "Z",
          serviceDeliveryDate: firstLine.serviceDeliveryDate && !isNaN(new Date(firstLine.serviceDeliveryDate)) ? new Date(firstLine.serviceDeliveryDate).toISOString().split("T")[0] : undefined,
          taxpayerActivityCode: document.getElementById("activity-select-editor")?.value || "4690",
          internalID: vO9.internalID,
          issuer: {
            type: "B",
            id: vO9.id,
            name: vO9.name,
            address: {
              branchID: "0",
              country: "EG",
              governate: vO9.governate,
              regionCity: vO9.regionCity,
              street: vO9.street,
              buildingNumber: vO9.buildingNumber
            }
          },
          receiver: {
            type: vO9.receiver_type,
            id: vO9.receiver_id,
            name: vO9.receiver_name,
            address: {
              country: vO9.receiver_country,
              governate: vO9.receiver_governate,
              regionCity: vO9.receiver_city,
              street: vO9.receiver_street,
              buildingNumber: vO9.receiver_building
            }
          },
          invoiceLines: vA7,
          totalSalesAmount: parseFloat(vLN07.toFixed(5)),
          totalDiscountAmount: parseFloat(vLN08.toFixed(5)),
          netAmount: parseFloat((vLN07 - vLN08).toFixed(5)),
          taxTotals: v225,
          totalAmount: parseFloat(v228.toFixed(5)),
          signatures: [{
            signatureType: "I",
            value: "VGVtcG9yYXJ5IFNpZ25hdHVyZSBIb2xkZXI="
          }]
        },
        lineItemCodes: vA8.map(p111 => ({
          codeType: p111.item_type,
          itemCode: p111.item_code,
          codeNamePrimaryLang: p111.item_code_name || p111.item_description,
          codeNameSecondaryLang: p111.item_code_name || p111.item_description
        }))
      };
      return vO11;
    }
    function collectDataForDraft() {
      if (vA6.length === 0) {
        alert("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­ÙØ¸ Ù…Ø³ÙˆØ¯Ø© ÙØ§Ø±ØºØ©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.");
        return null;
      }
      const v229 = p58.querySelector("#manual-datetime-issued").value;
      const vO12 = {
        receiptNumber: p58.querySelector("#manual-receipt-number").value,
        dateTimeIssued: v229,
        buyerName: p58.querySelector("#manual-buyer-name").value,
        buyerId: p58.querySelector("#manual-buyer-id").value,
        documentType: p60,
        referenceUUID: v101 ? p58.querySelector("#manual-reference-uuid")?.value || "" : undefined,
        items: vA6
      };
      return vO12;
    }
    p58.querySelector("#save-draft-btn").onclick = () => {
      const vF37 = collectDataForDraft();
      if (vF37) {
        const v230 = JSON.parse(localStorage.getItem("receiptDrafts") || "[]");
        v230.unshift(vF37);
        localStorage.setItem("receiptDrafts", JSON.stringify(v230));
        f74("âœ… ØªÙ… Ø­ÙØ¸ \"" + vF37.receiptNumber + "\" ÙƒÙ…Ø³ÙˆØ¯Ø© Ø¨Ù†Ø¬Ø§Ø­.", 4000);
        const v231 = p58.querySelector("#manualSendModal");
        v231.style.display = "none";
        p58.innerHTML = "";
        renderReceiptDrafts();
      }
    };
    p58.querySelector("#read-json-btn").onclick = async () => {
      f29();
      if (p58.querySelector(".tab-status-indicator.invalid")) {
        alert("ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¹Ù„Ø§Ù…Ø© (âœ–) ÙˆØªØµØ­ÙŠØ­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù‚Ø¨Ù„ Ù‚Ø±Ø§Ø¡Ø© JSON.");
        return;
      }
      const v232 = p58.querySelector("#pos-device-select").value;
      const v233 = p58.querySelector("#manual-activity-code").value;
      const vF372 = collectDataForDraft();
      if (!vF372) {
        return;
      }
      const v234 = vF372.items.map(p112 => ({
        receiptNumber: vF372.receiptNumber,
        buyerName: vF372.buyerName,
        buyerId: vF372.buyerId,
        paymentMethod: p58.querySelector("#payment-method").value,
        referenceUUID: vF372.referenceUUID,
        ...p112
      }));
      v234.forEach(p113 => {
        const v235 = parseFloat(p113.quantity) || 0;
        const v236 = parseFloat(p113.unitPrice) || 0;
        const v237 = v235 * v236;
        let vLN010 = 0;
        p113.taxableItems.forEach(p114 => {
          if (p114.taxType === "T2" || p114.taxType === "T3") {
            vLN010 += v237 * (parseFloat(p114.rate) / 100);
          }
        });
        const v238 = v237 + vLN010;
        p113.taxableItems.forEach(p115 => {
          const v239 = p115.taxType === "T1" ? v238 : v237;
          p115.amount = parseFloat((v239 * (parseFloat(p115.rate) / 100)).toFixed(5));
        });
      });
      let v240 = v101 ? calculateReceiptData(v234, v106, v232, v233) : calculateReturnReceiptData(v234, v106, v232, v233);
      const v241 = p58.querySelector("#manual-datetime-issued").value;
      v240.header.dateTimeIssued = f4(v241);
      const vO13 = {
        receipts: [v240]
      };
      try {
        const v242 = JSON.stringify(vO13, null, 4);
        const v243 = window.open("", "_blank");
        v243.document.write("<pre style=\"direction: ltr; text-align: left; white-space: pre-wrap; word-wrap: break-word;\">" + v242 + "</pre>");
        v243.document.close();
      } catch (e11) {
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ JSON: " + e11.message);
      }
    };
    p58.querySelector("#send-manual-receipt-btn").onclick = async () => {
      f29();
      if (p58.querySelector(".tab-status-indicator.invalid")) {
        alert("ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¹Ù„Ø§Ù…Ø© (âœ–) ÙˆØªØµØ­ÙŠØ­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");
        return;
      }
      const v244 = p58.querySelector("#summary-grand-total")?.textContent || "0";
      const vParseFloat6 = parseFloat(v244.replace(/[^0-9.]/g, ""));
      const v245 = p58.querySelector("#manual-buyer-id").value.trim();
      if (vParseFloat6 > 150000) {
        if (!v245) {
          alert("âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ø£Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙŠØªØ¬Ø§ÙˆØ² 150,000 Ø¬Ù†ÙŠÙ‡.");
          return;
        }
        const v246 = await validateNID(v245);
        if (!v246.valid) {
          alert("âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ø§Ù„Ù…Ø¯Ø®Ù„ ØºÙŠØ± ØµØ­ÙŠØ­. (" + v246.message + ")");
          return;
        }
      } else if (v245) {
        const v247 = await validateNID(v245);
        if (!v247.valid) {
          alert("âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ø§Ù„Ù…Ø¯Ø®Ù„ ØºÙŠØ± ØµØ­ÙŠØ­. (" + v247.message + ")");
          return;
        }
      }
      const v248 = p58.querySelector("#pos-device-select").value;
      const v249 = p58.querySelector("#manual-activity-code").value;
      const vF373 = collectDataForDraft();
      if (!vF373) {
        return;
      }
      const v250 = vF373.items.map(p116 => ({
        receiptNumber: vF373.receiptNumber,
        buyerName: vF373.buyerName,
        buyerId: vF373.buyerId,
        paymentMethod: p58.querySelector("#payment-method").value,
        referenceUUID: vF373.referenceUUID,
        ...p116
      }));
      v250.forEach(p117 => {
        const v251 = parseFloat(p117.quantity) || 0;
        const v252 = parseFloat(p117.unitPrice) || 0;
        const v253 = parseFloat(p117.exchangeRate) || 1;
        const v254 = v251 * v252;
        let vLN011 = 0;
        p117.taxableItems.forEach(p118 => {
          if (p118.taxType === "T2" || p118.taxType === "T3") {
            vLN011 += v254 * (parseFloat(p118.rate) / 100);
          }
        });
        const v255 = v254 + vLN011;
        p117.taxableItems.forEach(p119 => {
          const v256 = p119.taxType === "T1" ? v255 : v254;
          p119.amount = parseFloat((v256 * (parseFloat(p119.rate) / 100)).toFixed(5));
        });
      });
      let v257 = v101 ? calculateReceiptData(v250, v106, v248, v249) : calculateReturnReceiptData(v250, v106, v248, v249);
      const v258 = p58.querySelector("#manual-datetime-issued").value;
      v257.header.dateTimeIssued = f4(v258);
      const v259 = JSON.stringify({
        receipts: [v257]
      });
      v257.header.uuid = await vF.computeUuidFromRawText(v259);
      if (!v257.header.uuid) {
        alert("ÙØ´Ù„ ØªÙˆÙ„ÙŠØ¯ UUID. Ù„Ù† ÙŠØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.");
        return;
      }
      const vO14 = {
        receipts: [v257]
      };
      const v260 = await sendReceipts_V3(vO14, "Ø¥Ø±Ø³Ø§Ù„ ÙŠØ¯ÙˆÙŠ: " + v257.header.receiptNumber);
      if (v260.success) {
        alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ " + (v101 ? "Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø±ØªØ¬Ø¹" : "Ø§Ù„Ø¥ÙŠØµØ§Ù„") + " Ø¨Ù†Ø¬Ø§Ø­.");
        const v261 = p58.querySelector("#manualSendModal");
        v261.style.display = "none";
        p58.innerHTML = "";
      } else {
        alert("ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯. Ø§Ù„Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…: " + v260.error);
      }
    };
    p58.querySelector("#manual-datetime-issued").valueAsDate = new Date();
    dragMouseDown();
    f29();
  }
  async function showEgsCodeSearchModal(p120) {
    const v262 = document.createElement("div");
    v262.className = "code-search-modal";
    v262.innerHTML = "\n        <div class=\"code-search-content\">\n            <div class=\"code-search-header\">\n                <h4>Ø§Ø®ØªØ± ÙƒÙˆØ¯ EGS</h4>\n                <input type=\"text\" id=\"egs-search-input\" placeholder=\"Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯...\">\n                <button id=\"close-code-search-btn\" title=\"Ø¥ØºÙ„Ø§Ù‚\" style=\"background:none; border:none; font-size:24px; cursor:pointer;\">&times;</button>\n            </div>\n            <div class=\"code-search-body\">\n                <div class=\"code-search-placeholder\">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯...</div>\n                <table class=\"code-search-table\" style=\"display:none;\">\n                    <thead><tr><th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ</th><th>Ø§Ù„ÙƒÙˆØ¯</th></tr></thead>\n                    <tbody></tbody>\n                </table>\n            </div>\n        </div>\n    ";
    document.body.appendChild(v262);
    const v263 = v262.querySelector("#egs-search-input");
    const v264 = v262.querySelector(".code-search-table tbody");
    const v265 = v262.querySelector(".code-search-table");
    const v266 = v262.querySelector(".code-search-placeholder");
    const vF11 = () => v262.remove();
    v262.querySelector("#close-code-search-btn").onclick = vF11;
    v262.addEventListener("click", p121 => {
      if (p121.target === v262) {
        vF11();
      }
    });
    let vA10 = [];
    try {
      const v_0x57971a3 = getAccessToken();
      if (!v_0x57971a3) {
        throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙˆÙƒÙ† Ø§Ù„Ø¯Ø®ÙˆÙ„.");
      }
      const v267 = await fetch("https://api-portal.invoicing.eta.gov.eg/api/v1/codetypes/codes/my?CodeTypeID=9&Ps=1000", {
        headers: {
          Authorization: "Bearer " + v_0x57971a3
        }
      });
      if (!v267.ok) {
        throw new Error("ÙØ´Ù„ Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯.");
      }
      const v268 = await v267.json();
      vA10 = v268.result || [];
      if (vA10.length === 0) {
        v266.textContent = "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙƒÙˆØ§Ø¯ EGS Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ø­Ø³Ø§Ø¨Ùƒ.";
      } else {
        v266.style.display = "none";
        v265.style.display = "table";
        f39(vA10);
      }
    } catch (e12) {
      v266.textContent = "Ø®Ø·Ø£: " + e12.message;
    }
    function f39(p122) {
      v264.innerHTML = p122.map(p123 => "\n            <tr data-code='" + JSON.stringify(p123) + "'>\n                <td>" + p123.codeNameSecondaryLang + "</td>\n                <td class=\"code-value\">" + p123.codeLookupValue + "</td>\n            </tr>\n        ").join("");
      v264.querySelectorAll("tr").forEach(p124 => {
        p124.onclick = () => {
          const v269 = JSON.parse(p124.dataset.code);
          p120(v269);
          vF11();
        };
      });
    }
    v263.addEventListener("input", () => {
      const v270 = v263.value.toLowerCase().trim();
      const v271 = vA10.filter(p125 => p125.codeNameSecondaryLang.toLowerCase().includes(v270) || p125.codeLookupValue.toLowerCase().includes(v270));
      f39(v271);
    });
  }
  function renderReceiptDrafts() {
    const v272 = document.getElementById("drafts-container");
    if (!v272) {
      return;
    }
    const v273 = JSON.parse(localStorage.getItem("receiptDrafts") || "[]");
    const vLSDraftscardstyles = "drafts-card-styles";
    if (!document.getElementById(vLSDraftscardstyles)) {
      const v274 = document.createElement("style");
      v274.id = vLSDraftscardstyles;
      v274.innerHTML = "\n            .drafts-list { display: flex; flex-direction: column; gap: 15px; }\n            .draft-card {\n                background: #fff;\n                border-radius: 10px;\n                border: 1px solid #e9ecef;\n                box-shadow: 0 3px 10px rgba(0,0,0,0.05);\n                display: grid;\n                grid-template-columns: auto 1fr auto;\n                align-items: center;\n                gap: 20px;\n                padding: 15px 20px;\n                transition: all 0.2s ease-in-out;\n            }\n            .draft-card:hover {\n                transform: translateY(-3px);\n                box-shadow: 0 5px 15px rgba(0,0,0,0.08);\n                border-color: #007bff;\n            }\n            .draft-card .select-col { display: flex; align-items: center; }\n            .draft-card .draft-checkbox { width: 20px; height: 20px; }\n            .draft-card .info-col { display: flex; flex-direction: column; gap: 5px; }\n            .draft-card .receipt-number { font-weight: 700; font-size: 17px; color: #1d3557; }\n            .draft-card .details-row { display: flex; gap: 15px; font-size: 14px; color: #6c757d; }\n            .draft-card .actions-col { display: flex; gap: 10px; }\n            .draft-card .action-btn {\n                padding: 8px 15px;\n                font-size: 14px;\n                font-weight: 600;\n                border: none;\n                border-radius: 6px;\n                cursor: pointer;\n                transition: all 0.2s;\n            }\n            .draft-card .edit-btn { background-color: #e7f3ff; color: #0056b3; }\n            .draft-card .edit-btn:hover { background-color: #007bff; color: white; }\n            .draft-card .delete-btn { background-color: #f8d7da; color: #721c24; }\n            .draft-card .delete-btn:hover { background-color: #dc3545; color: white; }\n        ";
      document.head.appendChild(v274);
    }
    if (v273.length === 0) {
      v272.innerHTML = "<p style=\"text-align: center; color: #888; padding: 20px;\">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³ÙˆØ¯Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.</p>";
      return;
    }
    v272.innerHTML = "\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 10px; background-color: #f8f9fa; border-radius: 8px;\">\n            <label style=\"font-weight: bold; display: flex; align-items: center; gap: 8px;\">\n                <input type=\"checkbox\" id=\"selectAllDraftsCheckbox\" style=\"width: 18px; height: 18px;\">\n                ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„\n            </label>\n            <button id=\"sendSelectedDraftsBtn\" class=\"action-button\" style=\"background-color: #28a745; color: white; padding: 10px 20px; font-size: 15px; width: auto;\">\n                ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø­Ø¯Ø¯ (0)\n            </button>\n        </div>\n        <div class=\"drafts-list\">\n            " + v273.map((p126, p127) => "\n                <div class=\"draft-card\">\n                    <div class=\"select-col\">\n                        <input type=\"checkbox\" class=\"draft-checkbox\" data-index=\"" + p127 + "\">\n                    </div>\n                    <div class=\"info-col\">\n                        <span class=\"receipt-number\">" + p126.receiptNumber + "</span>\n                        <div class=\"details-row\">\n                            <span>" + (p126.documentType === "return" ? "â†©ï¸ Ø¥Ø´Ø¹Ø§Ø± Ù…Ø±ØªØ¬Ø¹" : "ğŸ§¾ Ø¥ÙŠØµØ§Ù„ Ø¨ÙŠØ¹") + "</span>\n                            <span>|</span>\n                            <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ù†ÙˆØ¯: " + p126.items.length + "</span>\n                        </div>\n                    </div>\n                    <div class=\"actions-col\">\n                        <button class=\"action-btn edit-btn edit-draft-btn\" data-index=\"" + p127 + "\">ØªØ¹Ø¯ÙŠÙ„</button>\n                        <button class=\"action-btn delete-btn delete-draft-btn\" data-index=\"" + p127 + "\">Ø­Ø°Ù</button>\n                    </div>\n                </div>\n            ").join("") + "\n        </div>\n    ";
    const v275 = document.getElementById("sendSelectedDraftsBtn");
    const v276 = document.getElementById("selectAllDraftsCheckbox");
    const v277 = v272.querySelectorAll(".draft-checkbox");
    function updateSendButtonCount() {
      const v278 = v272.querySelectorAll(".draft-checkbox:checked").length;
      v275.textContent = "ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø­Ø¯Ø¯ (" + v278 + ")";
      v275.disabled = v278 === 0;
    }
    v276.addEventListener("change", p128 => {
      v277.forEach(p129 => p129.checked = p128.target.checked);
      updateSendButtonCount();
    });
    v277.forEach(p130 => {
      p130.addEventListener("change", updateSendButtonCount);
    });
    v275.addEventListener("click", sendSelectedDrafts);
    v272.querySelectorAll(".edit-draft-btn").forEach(p131 => {
      p131.addEventListener("click", p132 => {
        p132.stopPropagation();
        openDraftForEditing(p131.dataset.index);
      });
    });
    v272.querySelectorAll(".delete-draft-btn").forEach(p133 => {
      p133.addEventListener("click", p134 => {
        p134.stopPropagation();
        deleteDraft(p133.dataset.index);
      });
    });
    updateSendButtonCount();
  }
  async function sendSelectedDrafts() {
    const v279 = document.querySelectorAll("#drafts-container .draft-checkbox:checked");
    if (v279.length === 0) {
      alert("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…Ø³ÙˆØ¯Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§.");
      return;
    }
    if (!confirm("Ø³ÙŠØªÙ… Ø§Ù„Ø¢Ù† Ø¥Ø±Ø³Ø§Ù„ " + v279.length + " Ù…Ø³ØªÙ†Ø¯. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ")) {
      return;
    }
    const v_0x39bd1e3 = f74("Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² " + v279.length + " Ù…Ø³ØªÙ†Ø¯ Ù„Ù„Ø¥Ø±Ø³Ø§Ù„...", 0);
    const v280 = JSON.parse(localStorage.getItem("receiptDrafts") || "[]");
    const vA11 = [];
    const vA12 = [];
    try {
      if (!window.receiptUploaderData) {
        throw new Error("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø§ÙØ¹ (Ø§Ù„Ø¨Ø§Ø¦Ø¹ ÙˆÙ†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹) ØºÙŠØ± Ù…Ù‡ÙŠØ£Ø©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©.");
      }
      const {
        seller: _0x80c466,
        serial: _0x174060
      } = window.receiptUploaderData;
      let v281 = (JSON.parse(localStorage.getItem("receiptHistory") || "[]")[0] || {}).uuid || "";
      for (const v282 of v279) {
        const vParseInt2 = parseInt(v282.dataset.index, 10);
        const v283 = v280[vParseInt2];
        if (!v283) {
          continue;
        }
        const v284 = v283.items.map(p135 => ({
          ...p135,
          ...v283
        }));
        const v285 = v283.documentType === "return" ? calculateReceiptData(v284, _0x80c466, _0x174060) : calculateReturnReceiptData(v284, _0x80c466, _0x174060);
        v285.header.previousUUID = v281;
        const v286 = JSON.stringify({
          receipts: [v285]
        });
        const v287 = await vF.computeUuidFromRawText(v286);
        if (!v287) {
          throw new Error("ÙØ´Ù„ ØªÙˆÙ„ÙŠØ¯ UUID Ù„Ø£Ø­Ø¯ Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª.");
        }
        v285.header.uuid = v287;
        vA12.push(v285);
        v281 = v287;
        vA11.push(vParseInt2);
      }
      if (vA12.length === 0) {
        throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø³ÙˆØ¯Ø§Øª ØµØ§Ù„Ø­Ø© Ù„Ù„Ø¥Ø±Ø³Ø§Ù„.");
      }
      v_0x39bd1e3.update("Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ " + vA12.length + " Ù…Ø³ØªÙ†Ø¯...");
      const vO15 = {
        receipts: vA12
      };
      const v288 = await sendReceipts_V3(vO15, "Ø¯ÙØ¹Ø© Ù…Ù† " + vA12.length + " Ù…Ø³ÙˆØ¯Ø©");
      if (v288.success) {
        vA11.sort((p136, p137) => p137 - p136).forEach(p138 => v280.splice(p138, 1));
        localStorage.setItem("receiptDrafts", JSON.stringify(v280));
        v_0x39bd1e3.remove();
        f74("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ " + vA12.length + " Ù…Ø³ØªÙ†Ø¯ Ø¨Ù†Ø¬Ø§Ø­!", 5000);
        renderReceiptDrafts();
      } else {
        throw new Error(v288.error || "ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¯ÙØ¹Ø©.");
      }
    } catch (e13) {
      v_0x39bd1e3.remove();
      alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: " + e13.message);
    }
  }
  async function openDraftForEditing(p139) {
    const v289 = JSON.parse(localStorage.getItem("receiptDrafts") || "[]");
    const v290 = v289[p139];
    if (!v290) {
      alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");
      return;
    }
    document.querySelector(".sidebar-btn[data-target=\"panel-manual\"]").click();
    const v291 = document.getElementById("manualDocumentTypeSelect");
    v291.value = v290.documentType;
    v291.dispatchEvent(new Event("change"));
    const v292 = document.getElementById("dynamicManualSendContent");
    let vLN012 = 0;
    const maxAttempts = 50;
    while (!v292.querySelector("#manual-receipt-number") && vLN012 < maxAttempts) {
      await new Promise(p140 => setTimeout(p140, 100));
      vLN012++;
    }
    if (!v292.querySelector("#manual-receipt-number")) {
      f74("âŒ Ø®Ø·Ø£: ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", 4000);
      return;
    }
    v292.querySelector("#manual-receipt-number").value = v290.receiptNumber;
    v292.querySelector("#manual-buyer-name").value = v290.buyerName || "Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ";
    if (v290.dateTimeIssued) {
      v292.querySelector("#manual-datetime-issued").value = v290.dateTimeIssued;
    }
    if (v290.documentType === "return" && v290.referenceUUID) {
      v292.querySelector("#manual-reference-uuid").value = v290.referenceUUID;
    }
    for (const v293 of v290.items) {
      v292.querySelector("#item-code-type").value = v293.itemType;
      v292.querySelector("#item-code").value = v293.itemCode;
      v292.querySelector("#item-description").value = v293.description;
      v292.querySelector("#item-quantity").value = v293.quantity;
      v292.querySelector("#item-unit-price").value = v293.unitPrice;
      v292.querySelector("#item-code").dispatchEvent(new Event("blur"));
      await new Promise(p141 => setTimeout(p141, 300));
      const v294 = v292.querySelector("#item-taxes-container");
      v294.innerHTML = "";
      if (v293.taxableItems && v293.taxableItems.length > 0) {
        for (const v295 of v293.taxableItems) {
          if (!v295 || !v295.taxType) {
            continue;
          }
          document.getElementById("add-tax-row-btn").click();
          await new Promise(p142 => setTimeout(p142, 50));
          const v296 = v294.lastElementChild;
          if (v296) {
            const v297 = v296.querySelector(".tax-type");
            v297.value = v295.taxType;
            v297.dispatchEvent(new Event("change"));
            await new Promise(p143 => setTimeout(p143, 50));
            v296.querySelector(".tax-subtype").value = v295.subType;
            v296.querySelector(".tax-rate").value = v295.rate;
            v296.querySelector(".tax-rate").dispatchEvent(new Event("input"));
          }
        }
      } else {}
      await new Promise(p144 => setTimeout(p144, 50));
      v292.querySelector("#add-item-btn").click();
    }
    f74("ØªÙ… ÙØªØ­ Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„. Ø§Ø¶ØºØ· \"Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø©\" Ø£Ùˆ \"Ø¥Ø±Ø³Ø§Ù„\" Ù„Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª.", 5000);
  }
  window.sendDraft = async function (p145) {
    const v298 = JSON.parse(localStorage.getItem("receiptDrafts") || "[]");
    const v299 = v298[p145];
    if (!v299) {
      return;
    }
    if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø±Ù‚Ù… \"" + v299.receiptNumber + "\"ØŸ")) {
      return;
    }
    if (!window.receiptUploaderData) {
      alert("Ø®Ø·Ø£: Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø§ÙØ¹ ØºÙŠØ± Ù…Ù‡ÙŠØ£Ø©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©.");
      return;
    }
    const v_0x6cb45c = calculateReturnReceiptData(v299.items);
    const v300 = await sendReceipts(v_0x6cb45c);
    if (v300) {
      v298.splice(p145, 1);
      localStorage.setItem("receiptDrafts", JSON.stringify(v298));
      renderReceiptDrafts();
      alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­.");
    } else {
      alert("ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠØµØ§Ù„.");
    }
  };
  window.deleteDraft = function (p146) {
    const v301 = JSON.parse(localStorage.getItem("receiptDrafts") || "[]");
    const v302 = v301[p146];
    if (!v302) {
      return;
    }
    if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ø±Ù‚Ù… \"" + v302.receiptNumber + "\"ØŸ")) {
      return;
    }
    v301.splice(p146, 1);
    localStorage.setItem("receiptDrafts", JSON.stringify(v301));
    renderReceiptDrafts();
    alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ÙˆØ¯Ø©.");
  };
  async function injectReceiptUploaderUI() {
    if (document.getElementById("receiptUploaderUI")) {
      document.getElementById("receiptUploaderUI").style.display = "flex";
      return;
    }
    const v303 = document.createElement("div");
    v303.id = "receiptUploaderUI";
    Object.assign(v303.style, {
      position: "fixed",
      top: "50%",
      left: "50%",
      transform: "translate(-50%, -50%)",
      width: "800px",
      height: "600px",
      backgroundColor: "#f4f7fa",
      borderRadius: "12px",
      boxShadow: "0 10px 40px rgba(0, 0, 0, 0.2)",
      zIndex: "9999",
      fontFamily: "'Cairo', 'Segoe UI', Tahoma, sans-serif",
      display: "flex",
      flexDirection: "column",
      direction: "rtl"
    });
    v303.innerHTML = "\n        <div style=\"padding: 15px 25px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; background-color: #fff;\">\n            <h3 style=\"margin: 0; color: #1d3557;\">Ø±ÙØ¹ Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª Ù…Ù† Ù…Ù„Ù Excel</h3>\n            <button id=\"closeReceiptUIBtn\" title=\"Ø¥ØºÙ„Ø§Ù‚\" style=\"background: none; border: none; font-size: 24px; cursor: pointer;\">&times;</button>\n        </div>\n        <div style=\"display: flex; flex-grow: 1; overflow: hidden;\">\n            <div style=\"width: 300px; padding: 20px; border-left: 1px solid #e0e0e0; display: flex; flex-direction: column; gap: 20px; background-color: #fff;\">\n                <div>\n                    <label class=\"content-label\" style=\"font-weight: bold; margin-bottom: 10px; display: block;\">Ø§Ù„Ø®Ø·ÙˆØ© 1: ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</label>\n                    <a id=\"downloadReceiptTemplateBtn\" class=\"action-button download-btn\" style=\"display: block; text-align: center; padding: 12px; background-color: #5a67d8; color: white; border-radius: 8px; text-decoration: none; cursor: pointer;\">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ Excel</a>\n                </div>\n                <hr style=\"border: none; border-top: 1px solid #eee;\">\n                <div>\n                    <label class=\"content-label\" style=\"font-weight: bold; margin-bottom: 10px; display: block;\">Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù</label>\n                    <label for=\"receiptExcelInput\" class=\"action-button upload-btn\" style=\"display: block; text-align: center; padding: 12px; background-color: #38a169; color: white; border-radius: 8px; cursor: pointer;\">ğŸ“‚ Ø§Ø®ØªØ± Ù…Ù„Ù Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª</label>\n                    <input type=\"file\" id=\"receiptExcelInput\" accept=\".xlsx, .xls\" style=\"display: none;\">\n                </div>\n            </div>\n            <div style=\"flex-grow: 1; padding: 20px; display: flex; flex-direction: column;\">\n                <h4 style=\"margin-top: 0; color: #333;\">Ø³Ø¬Ù„ Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø©</h4>\n                <div style=\"flex-grow: 1; overflow-y: auto; border: 1px solid #ccc; border-radius: 8px; background: #fff;\">\n                    <table id=\"receiptHistoryTable\" style=\"width: 100%; border-collapse: collapse;\">\n                        <thead>\n                            <tr style=\"background-color: #e9ecef; position: sticky; top: 0;\">\n                                <th style=\"padding: 10px; text-align: right;\">Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØµØ§Ù„</th>\n                                <th style=\"padding: 10px; text-align: left;\">UUID</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø³Ø¬Ù„ Ù‡Ù†Ø§ -->\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        </div>\n    ";
    document.body.appendChild(v303);
    document.getElementById("closeReceiptUIBtn").onclick = () => v303.style.display = "none";
    document.getElementById("receiptExcelInput").onchange = handleReceiptExcelUpload;
    document.getElementById("downloadReceiptTemplateBtn").onclick = downloadReceiptExcelTemplate;
    renderReceiptHistory();
    const v_0x39bd1e4 = f74("Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø§Ø¦Ø¹ ÙˆÙ†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹...");
    try {
      const v304 = await f51();
      if (!v304) {
        throw new Error("ÙØ´Ù„ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø§Ø¦Ø¹.");
      }
      const v305 = await getDeviceSerialNumber();
      if (!v305) {
        throw new Error("ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹.");
      }
      window.receiptUploaderData = {
        seller: v304,
        serial: v305
      };
      v_0x39bd1e4.remove();
      f74("âœ… Ø§Ù„Ø£Ø¯Ø§Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ø±ÙØ¹ Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª.", 3000);
    } catch (e14) {
      v_0x39bd1e4.remove();
      alert("âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø¯Ø§Ø©: " + e14.message + ". ÙŠØ±Ø¬Ù‰ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙˆÙØªØ­Ù‡Ø§ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
      v303.style.display = "none";
    }
  }
  function renderReceiptHistory() {
    const v306 = JSON.parse(localStorage.getItem("receiptHistory") || "[]");
    const v307 = document.querySelector("#receiptHistoryTable tbody");
    if (!v307) {
      return;
    }
    v307.innerHTML = "";
    v306.forEach(p147 => {
      const v308 = v307.insertRow(0);
      v308.innerHTML = "\n            <td style=\"padding: 8px; text-align: center; font-family: monospace;\">" + p147.receiptNumber + "</td>\n            <td style=\"padding: 8px; text-align: center; font-family: monospace; font-size: 12px; direction: ltr;\">" + p147.uuid + "</td>\n        ";
    });
  }
  async function downloadReceiptExcelTemplate() {
    const v_0x39bd1e5 = f74("Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„Ø¨ÙŠØ¹...", 0);
    try {
      if (typeof ExcelJS === "undefined") {
        throw new Error("Ù…ÙƒØªØ¨Ø© ExcelJS ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©.");
      }
      const v309 = new ExcelJS.Workbook();
      const v310 = v309.addWorksheet("Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª");
      const v311 = v309.addWorksheet("Lists");
      const vA13 = [{
        code: "EGS"
      }, {
        code: "GS1"
      }];
      const vA14 = [{
        code: "EA",
        desc_ar: "Ù‚Ø·Ø¹Ø©"
      }, {
        code: "KGM",
        desc_ar: "ÙƒÙŠÙ„ÙˆØ¬Ø±Ø§Ù…"
      }, {
        code: "LTR",
        desc_ar: "Ù„ØªØ±"
      }, {
        code: "MTR",
        desc_ar: "Ù…ØªØ±"
      }];
      const vO16 = {
        T1: {
          desc: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©",
          subtypes: [{
            code: "V009",
            desc: "Ø³Ù„Ø¹ Ø¹Ø§Ù…Ø© (14%)"
          }, {
            code: "V003",
            desc: "Ø³Ù„Ø¹Ø© Ù…Ø¹ÙØ§Ø©"
          }]
        },
        T4: {
          desc: "Ø®ØµÙ… ØªØ­Øª Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©",
          subtypes: [{
            code: "W002",
            desc: "ØªÙˆØ±ÙŠØ¯Ø§Øª"
          }]
        }
      };
      v311.getCell("A1").value = "CodeTypes";
      v311.getCell("B1").value = "UnitTypes";
      v311.getCell("C1").value = "MainTaxTypes";
      vA13.forEach((p148, p149) => {
        v311.getCell("A" + (p149 + 2)).value = p148.code;
      });
      vA14.forEach((p150, p151) => {
        v311.getCell("B" + (p151 + 2)).value = p150.desc_ar;
      });
      Object.values(vO16).forEach((p152, p153) => {
        v311.getCell("C" + (p153 + 2)).value = p152.desc;
      });
      let vLN4 = 4;
      Object.values(vO16).forEach(p154 => {
        const v312 = v311.getCell(1, vLN4);
        v312.value = p154.desc.replace(/[ ()]/g, "_");
        p154.subtypes.forEach((p155, p156) => {
          v311.getCell(p156 + 2, vLN4).value = p155.desc;
        });
        vLN4++;
      });
      const vO17 = {
        "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„ÙØ§ØªÙˆØ±Ø©": "Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ù„ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø³Ø±ÙŠØ§Ù„ ",
        "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø£Ø¯Ø®Ù„ ØªØ§Ø±ÙŠØ® Ø¥ØµØ¯Ø§Ø± Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨ØµÙŠØºØ© YYYY-MM-DD. Ø¥Ø°Ø§ ØªØ±Ùƒ ÙØ§Ø±ØºÙ‹Ø§ØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ.",
        "ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø£Ø¯Ø®Ù„ ØªØ§Ø±ÙŠØ® ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø®Ø¯Ù…Ø© Ø£Ùˆ Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø© Ø¨ØµÙŠØºØ© YYYY-MM-DD.",
        "Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ„Ù…": " ÙÙŠ Ø­Ø§Ù„Ù‡ Ø§Ø®ØªÙŠØ§Ø± Ø´Ø±ÙƒØ© ÙŠØªÙ… ÙƒØªØ§Ø¨Ù‡ Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 9 Ø§Ø±Ù‚Ø§Ù… - ÙÙŠ Ø­Ø§Ù„Ù‡ Ø§Ø®ØªÙŠØ§Ø± Ø´Ø®ØµÙŠ ÙŠØªÙ… ÙƒØªØ§Ø¨Ù‡ 123456789 Ø§Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ø§Ù† ÙˆØ¬Ø¯ ÙˆØ¨Ø¹Ø¯ Ø§Ù„Ø±ÙØ¹ ØªÙ‚ÙˆÙ… Ø¨Ø­Ø°ÙÙ‡  ÙˆØ§Ù„Ø§Ø¬Ù†Ø¨ÙŠ Ù†ÙØ³ Ø§Ù„Ù†Ø¸Ø§Ù… ",
        "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…": "ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨ ÙÙŠ Ø­Ø§Ù„Ù‡ ÙƒØªØ§Ø¨Ù‡ Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„",
        "Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ„Ù…": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©: B Ù„Ø´Ø±ÙƒØ©ØŒ P Ù„Ø´Ø®ØµÙŠØŒ F Ù„Ø£Ø¬Ù†Ø¨ÙŠ.",
        "Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…": "ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨ ÙÙŠ Ø­Ø§Ù„Ù‡ ÙƒØªØ§Ø¨Ù‡ Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„",
        "Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…": "ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨ ÙÙŠ Ø­Ø§Ù„Ù‡ ÙƒØªØ§Ø¨Ù‡ Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„",
        "Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…": "ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨ ÙÙŠ Ø­Ø§Ù„Ù‡ ÙƒØªØ§Ø¨Ù‡ Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„",
        "Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ø³ØªÙ„Ù…": "ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨ ÙÙŠ Ø­Ø§Ù„Ù‡ ÙƒØªØ§Ø¨Ù‡ Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„",
        "Ù…Ø¨Ù†Ù‰ Ø§Ù„Ù…Ø³ØªÙ„Ù…": "ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨ ÙÙŠ Ø­Ø§Ù„Ù‡ ÙƒØªØ§Ø¨Ù‡ Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„",
        "ÙˆØµÙ Ø§Ù„ØµÙ†Ù": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø³Ù… Ø£Ùˆ ÙˆØµÙ ÙˆØ§Ø¶Ø­ Ù„Ù„Ø³Ù„Ø¹Ø© Ø£Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©.",
        "Ù†ÙˆØ¹ ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù": "ÙÙŠ Ø­Ø§Ù„Ù‡ Ø§Ø®ØªÙŠØ§Ø± GS1  ÙŠØªÙ… ÙƒØªØ§Ø¨Ù‡ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù…Ø«Ø§Ù„ : - 10007598 Ø§Ù… ÙÙŠ Ø­Ø§Ù„Ù‡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙˆØ¯ EGS  ÙŠØªÙ… ÙƒØªØ§Ø¨Ù‡ Ø§Ù„ÙƒÙˆØ¯ EG-Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„-Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù…Ø«Ø§Ù„ EG-123456789-100",
        "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù": "ÙÙŠ Ø­Ø§Ù„Ù‡ Ø§Ù„Ø§ÙŠØµØ§Ù„Ø§Øª Ù…Ø·Ù„ÙˆØ¨ Ø§Ø¬Ø¨Ø§Ø±ÙŠ ÙƒØªØ§Ø¨Ù‡ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø«Ø§Ù„ 1 Ø§Ù… ÙÙŠ Ø­Ø§Ù„Ù‡ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨ ",
        "ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø®ØªØ± ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ù…Ø«Ø§Ù„: Ù‚Ø·Ø¹Ø©).",
        Ø§Ù„ÙƒÙ…ÙŠØ©: "Ù…Ø·Ù„ÙˆØ¨: Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨Ø§Ø¹ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„ØµÙ†Ù.",
        "Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©": "Ù…Ø·Ù„ÙˆØ¨: Ø³Ø¹Ø± Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø© Ù…Ù† Ø§Ù„ØµÙ†Ù.",
        "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ù…Ø«Ø§Ù„: Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©).",
        "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ 1": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ Ù„Ù„Ø¶Ø±ÙŠØ¨Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ±Ø§Ø¨Ø·Ø©.",
        "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1": "Ù…Ø·Ù„ÙˆØ¨: Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„Ù„Ø¶Ø±ÙŠØ¨Ø© (Ù…Ø«Ø§Ù„: 14).",
        "UUID Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©": "Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª ÙÙ‚Ø·: Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ Ø§Ù„ÙØ±ÙŠØ¯ Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø£ØµÙ„ÙŠØ©."
      };
      const v313 = Object.keys(vO17);
      v310.columns = v313.map(p157 => ({
        header: p157,
        key: p157
      }));
      v310.getRow(1).eachCell(p158 => {
        const v314 = p158.value;
        p158.font = {
          name: "Arial",
          bold: true,
          size: 14,
          color: {
            argb: "FFFFFFFF"
          }
        };
        p158.fill = {
          type: "pattern",
          pattern: "solid",
          fgColor: {
            argb: "FF343A40"
          }
        };
        p158.alignment = {
          vertical: "middle",
          horizontal: "center"
        };
        if (vO17[v314]) {
          p158.note = vO17[v314];
        }
      });
      v310.autoFilter = {
        from: "A1",
        to: {
          row: 1,
          column: v313.length
        }
      };
      v310.columns.forEach(p159 => {
        p159.width = 30;
      });
      const vF12 = (p160, p161) => {
        for (let vLN22 = 2; vLN22 <= 1001; vLN22++) {
          v310.getCell("" + p160 + vLN22).dataValidation = {
            type: "list",
            allowBlank: true,
            formulae: [p161]
          };
        }
      };
      vF12("G", "=Lists!$A$2:$A$3");
      vF12("I", "=Lists!$B$2:$B$" + (vA14.length + 1));
      vF12("L", "=Lists!$C$2:$C$" + (Object.keys(vO16).length + 1));
      vF12("O", "=Lists!$C$2:$C$" + (Object.keys(vO16).length + 1));
      const vLSINDIRECTSUBSTITUTESU3 = "=INDIRECT(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(L2,\" \",\"_\"),\"(\",\"_\"),\")\",\"_\"))";
      const vLSINDIRECTSUBSTITUTESU4 = "=INDIRECT(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(O2,\" \",\"_\"),\"(\",\"_\"),\")\",\"_\"))";
      vF12("M", vLSINDIRECTSUBSTITUTESU3);
      vF12("P", vLSINDIRECTSUBSTITUTESU4);
      Object.values(vO16).forEach((p162, p163) => {
        const v315 = String.fromCharCode("A".charCodeAt(0) + 3 + p163);
        const v316 = p162.desc.replace(/[ ()]/g, "_");
        const v317 = "Lists!$" + v315 + "$2:$" + v315 + "$" + (p162.subtypes.length + 1);
        v309.definedNames.add(v317, v316);
      });
      v311.state = "hidden";
      v310.views = [{
        rightToLeft: true
      }];
      const v318 = await v309.xlsx.writeBuffer();
      const v319 = new Blob([v318], {
        type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
      });
      if (typeof saveAs === "undefined") {
        throw new Error("Ù…ÙƒØªØ¨Ø© FileSaver.js ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©.");
      }
      saveAs(v319, "Ù†Ù…ÙˆØ°Ø¬_Ø±ÙØ¹_Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª_Ù…Ø¹Ø¯Ù„.xlsx");
    } catch (e15) {
      alert("ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥ÙƒØ³ÙŠÙ„: " + e15.message);
    } finally {
      v_0x39bd1e5.remove();
    }
  }
  async function showReceiptEditor(p164, p165 = "sale") {
    document.getElementById("receiptEditorModal")?.remove();
    const vO18 = {
      T1: "Ù‚ÙŠÙ…Ø© Ù…Ø¶Ø§ÙØ©",
      T2: "Ø¬Ø¯ÙˆÙ„ (Ù†Ø³Ø¨ÙŠ)",
      T3: "Ø¬Ø¯ÙˆÙ„ (Ù†ÙˆØ¹ÙŠ)",
      T4: "Ø®ØµÙ… ØªØ­ØµÙŠÙ„",
      T5: "Ø¯Ù…ØºØ© (Ù†Ø³Ø¨ÙŠ)",
      T6: "Ø¯Ù…ØºØ© (Ù‚Ø·Ø¹ÙŠ)",
      T7: "Ù…Ù„Ø§Ù‡ÙŠ",
      T8: "ØªÙ†Ù…ÙŠØ© Ù…ÙˆØ§Ø±Ø¯",
      T9: "Ø±Ø³Ù… Ø®Ø¯Ù…Ø©",
      T10: "Ù…Ø­Ù„ÙŠØ§Øª",
      T11: "ØªØ£Ù…ÙŠÙ† ØµØ­ÙŠ",
      T12: "Ø±Ø³ÙˆÙ… Ø£Ø®Ø±Ù‰"
    };
    const v320 = document.createElement("div");
    v320.id = "receiptEditorModal";
    v320.style.cssText = "\n        position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n        background-color: rgba(0,0,0,0.6); z-index: 10000;\n        display: flex; align-items: center; justify-content: center;\n        direction: rtl; font-family: 'Segoe UI', Tahoma, sans-serif;\n    ";
    const v321 = document.createElement("div");
    v321.style.cssText = "\n        background-color: #f4f7fc; width: 95%; max-width: 1800px; height: 95%;\n        border-radius: 12px; display: flex; flex-direction: column;\n        box-shadow: 0 5px 25px rgba(0,0,0,0.2); overflow: hidden;\n    ";
    v321.innerHTML = "<div style=\"display:flex; align-items:center; justify-content:center; height:100%; font-size: 22px; color: #555;\">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø©...</div>";
    v320.appendChild(v321);
    document.body.appendChild(v320);
    let v322;
    let v323;
    let v324;
    let v325;
    try {
      v322 = await getIssuerFullData();
      if (!v322) {
        throw new Error("ÙØ´Ù„ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù…ÙˆÙ„.");
      }
      v323 = await getDeviceSerialNumber();
      if (!v323 || v323.length === 0) {
        throw new Error("ÙØ´Ù„ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹.");
      }
      v324 = v323[0];
      const v326 = v322.activities || [];
      v325 = "4690";
      let vLS4 = "";
      if (v326.length > 0) {
        const v327 = v326.find(p166 => p166.toDate === null) || v326[0];
        v325 = v327.activityTypeCode;
        vLS4 = "\n                <div class=\"form-group\">\n                    <label for=\"activity-select-editor\" class=\"select-label\">ÙƒÙˆØ¯ Ø§Ù„Ù†Ø´Ø§Ø·:</label>\n                    <select id=\"activity-select-editor\" class=\"custom-select\">\n                        " + v326.map(p167 => "<option value=\"" + p167.activityTypeCode + "\" " + (p167.activityTypeCode === v327.activityTypeCode ? "selected" : "") + ">" + p167.activityTypeCode + " - " + p167.activityTypeNameSecondaryLang + "</option>").join("") + "\n                    </select>\n                </div>";
      } else {
        vLS4 = "<div class=\"form-group\"><label class=\"select-label\">ÙƒÙˆØ¯ Ø§Ù„Ù†Ø´Ø§Ø·:</label><div class=\"info-div\">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ù†Ø´Ø·Ø©</div></div>";
      }
      let vLS5 = "";
      p164.forEach((p168, p169) => {
        const v328 = p168[0] || {};
        const v329 = p165 === "return" ? calculateReceiptData(p168, v322, v324.serialNumber, v325) : calculateReturnReceiptData(p168, v322, v324.serialNumber, v325);
        const v330 = p165 === "return" ? "Ø¥Ø´Ø¹Ø§Ø± Ù…Ø±ØªØ¬Ø¹" : "Ø¥ÙŠØµØ§Ù„ Ø¨ÙŠØ¹";
        const v331 = p165 === "return" ? "#c0392b" : "#2980b9";
        const v332 = p165 === "return" ? "<tr><th>UUID Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©</th><td style=\"font-family: monospace; font-size: 14px; direction: ltr; background: #fff5f5;\">" + (v328.referenceUUID || "<span style=\"color:red;\">Ù…Ø·Ù„ÙˆØ¨!</span>") + "</td></tr>" : "";
        const v333 = v329.itemData.map((p170, p171) => {
          const v334 = p170.taxableItems.reduce((p172, p173) => p172 + p173.amount, 0);
          return "\n                    <tr style=\"border-bottom: 1px solid #f1f1f1;\">\n                        <td style=\"padding: 10px;\">" + p170.itemType + "</td>\n                        <td style=\"padding: 10px; font-family: monospace;\">" + p170.itemCode + "</td>\n                        <td style=\"padding: 10px; background-color: #f0f8ff;\">" + (p168[p171].officialCodeName || "") + "</td>\n                        <td style=\"padding: 10px; text-align: right;\">" + p170.description + "</td>\n                        <td style=\"padding: 10px;\">" + p170.quantity + "</td>\n                        <td style=\"padding: 10px;\">" + p170.unitPrice.toFixed(2) + "</td>\n                        <td style=\"padding: 10px;\">" + p170.totalSale.toFixed(2) + "</td>\n                        <td style=\"padding: 10px; color: #c0392b;\">" + v334.toFixed(5) + "</td>\n                        <td style=\"padding: 10px; font-weight: bold;\">" + p170.total.toFixed(2) + "</td>\n                    </tr>\n                ";
        }).join("");
        const v335 = "\n                <tr><td class=\"details-total-label\">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</td><td class=\"details-total-value\">" + v329.totalSales.toFixed(2) + "</td></tr>\n                " + v329.taxTotals.map(p174 => "<tr><td class=\"details-total-label\">" + (vO18[p174.taxType] || p174.taxType) + "</td><td class=\"details-total-value\">" + p174.amount.toFixed(2) + "</td></tr>").join("") + "\n                <tr class=\"details-grand-total\"><td class=\"details-total-label\">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</td><td class=\"details-total-value\">" + v329.totalAmount.toFixed(2) + "</td></tr>\n            ";
        vLS5 += "\n               <tbody data-receipt-number=\"" + p169 + "\" data-doc-type=\"" + p165 + "\">\n                    <tr style=\"background-color: #fff; border-bottom: 1px solid #e9ecef; cursor: pointer;\" class=\"toggle-details-trigger\">\n                        <td style=\"width: 50px; padding: 15px; text-align: center; vertical-align: middle;\"><input type=\"checkbox\" class=\"receipt-checkbox\" style=\"width: 20px; height: 20px; vertical-align: middle;\"></td>\n                        <td class=\"toggle-details-icon\" style=\"font-weight: bold; font-size: 28px; width: 40px; color: #007bff; text-align: center; padding: 15px; vertical-align: middle;\">+</td>\n                        <td style=\"padding: 15px; text-align: center; vertical-align: middle; font-size: 16px;\">" + p169 + " <span style=\"color: " + v331 + "; font-weight: bold;\">(" + v330 + ")</span></td>\n                        <td style=\"padding: 15px; text-align: center; vertical-align: middle; font-size: 16px;\">" + (v328.buyerName || "Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ") + "</td>\n                        <td style=\"padding: 15px; text-align: center; vertical-align: middle; font-weight: 600; font-size: 16px;\">" + v329.totalSales.toFixed(2) + "</td>\n                        <td style=\"padding: 15px; text-align: center; vertical-align: middle; font-weight: bold; font-size: 18px;\">" + v329.totalAmount.toFixed(2) + "</td>\n                        <td style=\"padding: 15px; text-align: center; vertical-align: middle;\"><button class=\"delete-receipt-btn\" title=\"Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªÙ†Ø¯\" style=\"background: #dc3545; color: white; border: none; border-radius: 50%; cursor: pointer; width: 32px; height: 32px; font-size: 20px; line-height: 32px;\">&times;</button></td>\n                    </tr>\n                    <tr class=\"receipt-details-row\" style=\"display: none;\">\n                        <td colspan=\"7\" style=\"padding: 0 !important;\">\n                            <div style=\"padding: 25px; background-color: #f0f2f5; border-top: 4px solid #0d6efd;\">\n                                <div class=\"details-grid\">\n                                    <div class=\"details-card receiver-card\">\n                                        <h4 class=\"details-card-header\">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù… (Ø§Ù„Ù…Ø´ØªØ±ÙŠ)</h4>\n                                        <table class=\"details-table\">\n                                            <tbody>\n                                                " + v332 + "\n                                               <tr><th>Ø§Ù„Ø§Ø³Ù…</th><td>" + (v328.buyerName || "") + "</td></tr>\n                                                <tr><th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</th><td>" + (v328.buyerId || "") + "</td></tr>\n                                            </tbody>\n                                        </table>\n                                    </div>\n                                    <div class=\"details-card items-details-card\">\n                                        <h4 class=\"details-card-header\">Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…Ø³ØªÙ†Ø¯</h4>\n                                        <table class=\"details-table items-details-table\">\n                                            <thead>\n                                                <tr>\n                                                    <th>Ù†ÙˆØ¹ Ø§Ù„ÙƒÙˆØ¯</th><th>ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø³Ù…ÙŠ</th><th>Ø§Ù„ÙˆØµÙ</th>\n                                                    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</th>\n                                                </tr>\n                                            </thead>\n                                            <tbody>" + v333 + "</tbody>\n                                        </table>\n                                    </div>\n                                    <div class=\"details-card totals-details-card\">\n                                        <h4 class=\"details-card-header\">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª</h4>\n                                        <table class=\"details-table totals-details-table\">\n                                            <tbody>" + v335 + "</tbody>\n                                        </table>\n                                    </div>\n                                </div>\n                            </div>\n                        </td>\n                    </tr>\n                </tbody>";
      });
      v321.innerHTML = "\n            <div style=\"padding: 20px 25px; border-bottom: 1px solid #ddd; background-color: #f8f9fa; flex-shrink: 0;\">\n                <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;\">\n                    <h3 style=\"margin: 0; color: #2161a1; font-size: 22px;\">Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª (" + p164.size + ")</h3>\n                    <div style=\"display: flex; gap: 12px;\">\n                        <button id=\"saveAllAsDraftsBtn\" class=\"header-btn\" style=\"background-color: #ffc107; color: #333;\">ğŸ“ Ø­ÙØ¸ Ø§Ù„ÙƒÙ„ ÙƒÙ…Ø³ÙˆØ¯Ø§Øª</button>\n                        <button id=\"sendSelectedReceiptsBtn\" class=\"header-btn send-btn\">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø­Ø¯Ø¯</button>\n                        <button id=\"readJsonBtn\" class=\"header-btn\" style=\"background-color: #fd7e14; color: white;\">ğŸ” Ù‚Ø±Ø§Ø¡Ø© JSON</button>\n                        <button id=\"closeReceiptEditorBtn\" class=\"header-btn close-btn\">Ø¥ØºÙ„Ø§Ù‚</button>\n                    </div>\n                </div>\n                \n                <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px 20px; background-color: #e9ecef; padding: 20px; border-radius: 8px;\">\n                    <div class=\"form-group\">\n                        <label for=\"pos-select-editor\" class=\"select-label\">Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ (POS):</label>\n                        <select id=\"pos-select-editor\" class=\"custom-select\">\n                            " + v323.map(p175 => {
        const v336 = p175.address || {};
        const v337 = (p175.formatedAddress || (v336.street || "") + ", " + (v336.regionCity || "")).replace(/^0\s+/, "").trim();
        let vO19 = {};
        if (p175.formatedAddress) {
          const v338 = p175.formatedAddress.trim();
          const v339 = v338.split(",");
          const v340 = v339[0] || "";
          const v341 = v340.match(/^(\d+)\s+/);
          let vLS6 = "";
          let vV340 = v340;
          if (v341) {
            vLS6 = v341[1];
            vV340 = v340.substring(v341[0].length).trim();
          }
          vO19 = {
            buildingNumber: vLS6,
            street: vV340,
            regionCity: v339[1]?.trim() || "",
            governate: v339[2]?.trim() || ""
          };
        } else if (p175.address) {
          vO19 = {
            ...p175.address,
            buildingNumber: p175.address.buildingNo || ""
          };
        }
        return "<option value=\"" + p175.serialNumber + "\" data-address='" + JSON.stringify(vO19) + "' " + (p175.serialNumber === v324.serialNumber ? "selected" : "") + ">\n                                            " + (v337 || p175.serialNumber) + "\n                                        </option>";
      }).join("") + "\n                        </select>\n                    </div>\n                    " + vLS4 + "\n                    <div class=\"form-group\"><label for=\"editor-seller-name\" class=\"select-label\">Ø§Ø³Ù… Ø§Ù„Ù…ØµØ¯Ø±:</label><input type=\"text\" id=\"editor-seller-name\" class=\"custom-select\" value=\"" + v322.name + "\"></div>\n                    <div class=\"form-group\"><label for=\"editor-seller-governate\" class=\"select-label\">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©:</label><input type=\"text\" id=\"editor-seller-governate\" class=\"custom-select\" value=\"" + v322.governate + "\"></div>\n                    <div class=\"form-group\"><label for=\"editor-seller-regionCity\" class=\"select-label\">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</label><input type=\"text\" id=\"editor-seller-regionCity\" class=\"custom-select\" value=\"" + v322.regionCity + "\"></div>\n                    <div class=\"form-group\"><label for=\"editor-seller-street\" class=\"select-label\">Ø§Ù„Ø´Ø§Ø±Ø¹:</label><input type=\"text\" id=\"editor-seller-street\" class=\"custom-select\" value=\"" + v322.street + "\"></div>\n                    <div class=\"form-group\"><label for=\"editor-seller-building\" class=\"select-label\">Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰:</label><input type=\"text\" id=\"editor-seller-building\" class=\"custom-select\" value=\"" + (v322.buildingNumber || "") + "\"></div>\n                </div>\n            </div>\n            <div style=\"overflow-y: auto; flex-grow: 1;\">\n                <table style=\"width: 100%; border-collapse: collapse;\">\n                    <thead style=\"position: sticky; top: 0; background: #020b18ff; color: white; z-index: 10;\">\n                       <tr>\n                            <th style=\"padding: 15px; text-align: center;\"><input type=\"checkbox\" id=\"selectAllCheckbox\" style=\"width: 20px; height: 20px;\"></th>\n                            <th></th><th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ (ÙˆØ§Ù„Ù†ÙˆØ¹)</th><th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</th>\n                            <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</th><th>Ø­Ø°Ù</th>\n                       </tr>\n                    </thead>\n                    <tbody>" + vLS5 + "</tbody>\n                </table>\n            </div>\n            <div style=\"padding: 15px 25px; background-color: #343a40; color: white; text-align: center; border-top: 4px solid #0d6efd; flex-shrink: 0;\">\n                <strong style=\"font-size: 18px;\">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©: <span id=\"grandTotalAmount\" style=\"color: #28a745; font-size: 22px;\">0.00</span></strong>\n            </div>\n        ";
      const v342 = document.createElement("style");
      v342.innerHTML = "\n            .details-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; }\n            .issuer-card { display: none; } /* Ø¥Ø®ÙØ§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© */\n            .receiver-card { grid-column: 1 / 2; grid-row: 1 / 2; }\n            .items-details-card { grid-column: 2 / 3; grid-row: 1 / 3; }\n            .totals-details-card { grid-column: 1 / 2; grid-row: 2 / 3; }\n            .details-card { background: #fff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; }\n            .details-card-header { color: #0d6efd; border-bottom: 2px solid #eee; padding-bottom: 8px; margin-top: 0; margin-bottom: 15px; font-size: 16px; }\n            .details-table { width: 100%; border-collapse: collapse; }\n            .details-table th, .details-table td { border: 1px solid #f0f0f0; padding: 8px; text-align: right; font-size: 13px; }\n            .details-table th { background-color: #f8f9fa; width: 100px; font-weight: 600; }\n            .items-details-table th, .items-details-table td { text-align: center; padding: 6px; white-space: nowrap; }\n            .totals-details-table .details-total-label { font-weight: bold; }\n            .totals-details-table .details-grand-total td { font-size: 16px; font-weight: bold; background-color: #e9ecef; }\n            .header-btn { padding: 10px 22px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 15px; }\n            .send-btn { background-color: #28a745; color: white; }\n            .close-btn { background-color: #6c757d; color: white; }\n            .form-group { display: flex; flex-direction: column; }\n            .select-label { font-size: 14px; font-weight: 600; margin-bottom: 5px; display: block; color: #343a40; }\n            .custom-select { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 14px; }\n            .info-div { padding: 10px; background-color: #fff; border-radius: 5px; border: 1px solid #ccc; }\n        ";
      v320.appendChild(v342);
      const vF13 = () => v320.remove();
      document.getElementById("closeReceiptEditorBtn").onclick = vF13;
      v320.querySelectorAll(".toggle-details-trigger").forEach(p176 => {
        p176.onclick = p177 => {
          if (p177.target.tagName === "BUTTON" || p177.target.tagName === "INPUT") {
            return;
          }
          const v343 = p176.nextElementSibling;
          const v344 = p176.querySelector(".toggle-details-icon");
          const v345 = v343.style.display !== "none";
          v343.style.display = v345 ? "none" : "table-row";
          v344.textContent = v345 ? "+" : "-";
        };
      });
      v320.querySelectorAll(".delete-receipt-btn").forEach(p178 => {
        p178.onclick = p179 => {
          p179.stopPropagation();
          const v346 = p179.target.closest("tbody");
          if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø±Ù‚Ù… \"" + v346.dataset.receiptNumber + "\"ØŸ")) {
            v346.remove();
            vF14();
          }
        };
      });
      const v347 = document.getElementById("grandTotalAmount");
      const vF14 = () => {
        let vLN013 = 0;
        const v348 = document.getElementById("activity-select-editor")?.value || v325;
        const v349 = document.getElementById("pos-select-editor").value;
        const vO20 = {
          id: v322.id,
          name: document.getElementById("editor-seller-name").value,
          governate: document.getElementById("editor-seller-governate").value,
          regionCity: document.getElementById("editor-seller-regionCity").value,
          street: document.getElementById("editor-seller-street").value,
          buildingNumber: document.getElementById("editor-seller-building").value
        };
        v320.querySelectorAll(".receipt-checkbox:checked").forEach(p180 => {
          const v350 = p180.closest("tbody");
          const v351 = v350.dataset.receiptNumber;
          const v352 = v350.dataset.docType;
          const v353 = p164.get(v351);
          const v354 = v352 === "return" ? calculateReceiptData(v353, vO20, v349, v348) : calculateReturnReceiptData(v353, vO20, v349, v348);
          vLN013 += v354.totalAmount;
        });
        v347.textContent = vLN013.toFixed(2);
      };
      document.getElementById("selectAllCheckbox").onchange = p181 => {
        v320.querySelectorAll(".receipt-checkbox").forEach(p182 => p182.checked = p181.target.checked);
        vF14();
      };
      v320.querySelectorAll(".receipt-checkbox, #pos-select-editor, #activity-select-editor, #editor-seller-name, #editor-seller-governate, #editor-seller-regionCity, #editor-seller-street, #editor-seller-building").forEach(p183 => {
        p183.onchange = vF14;
        p183.oninput = vF14;
      });
      vF14();
      document.getElementById("saveAllAsDraftsBtn").onclick = () => {};
      document.getElementById("sendSelectedReceiptsBtn").onclick = async () => {
        const v355 = document.getElementById("sendSelectedReceiptsBtn");
        const v356 = Array.from(v320.querySelectorAll(".receipt-checkbox:checked")).map(p184 => p184.closest("tbody"));
        if (v356.length === 0) {
          alert("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…Ø³ØªÙ†Ø¯ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡.");
          return;
        }
        if (!confirm("Ø³ÙŠØªÙ… Ø§Ù„Ø¢Ù† ØªØ¬Ù…ÙŠØ¹ " + v356.length + " Ù…Ø³ØªÙ†Ø¯ ÙÙŠ Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø© ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡Ø§. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ")) {
          return;
        }
        v355.disabled = true;
        const v_0x39bd1e6 = f74("Ø¬Ø§Ø±ÙŠ Ø¨Ù†Ø§Ø¡ Ø³Ù„Ø³Ù„Ø© UUID Ù„Ù€ " + v356.length + " Ù…Ø³ØªÙ†Ø¯...");
        try {
          const v357 = document.getElementById("pos-select-editor").value;
          const v358 = document.getElementById("activity-select-editor");
          const v359 = v358 ? v358.value : v325;
          const vO21 = {
            id: v322.id,
            name: document.getElementById("editor-seller-name").value,
            governate: document.getElementById("editor-seller-governate").value,
            regionCity: document.getElementById("editor-seller-regionCity").value,
            street: document.getElementById("editor-seller-street").value,
            buildingNumber: document.getElementById("editor-seller-building").value
          };
          const vA15 = [];
          let v360 = (JSON.parse(localStorage.getItem("receiptHistory") || "[]")[0] || {}).uuid || "";
          for (const v361 of v356) {
            const v362 = v361.dataset.receiptNumber;
            const v363 = v361.dataset.docType;
            const v364 = p164.get(v362);
            const v365 = v363 === "return" ? calculateReceiptData(v364, vO21, v357, v359) : calculateReturnReceiptData(v364, vO21, v357, v359);
            v365.header.previousUUID = v360;
            const v366 = JSON.stringify({
              receipts: [v365]
            });
            const v367 = await vF.computeUuidFromRawText(v366);
            v365.header.uuid = v367;
            vA15.push(v365);
            v360 = v367;
          }
          const vO22 = {
            receipts: vA15
          };
          const v368 = await sendReceipts_V3(vO22, "Ø¯ÙØ¹Ø© Ù…Ù† " + vA15.length + " Ù…Ø³ØªÙ†Ø¯");
          if (v368.success) {
            v_0x39bd1e6.remove();
            alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¯ÙØ¹Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ " + vA15.length + " Ù…Ø³ØªÙ†Ø¯ Ø¨Ù†Ø¬Ø§Ø­!");
            vF13();
          } else {
            throw new Error(v368.error || "ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¯ÙØ¹Ø©.");
          }
        } catch (e16) {
          v_0x39bd1e6.remove();
          alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙØ§Ø¯Ø­ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: " + e16.message);
        } finally {
          v355.disabled = false;
        }
      };
      document.getElementById("readJsonBtn").addEventListener("click", async () => {
        const v369 = Array.from(document.querySelectorAll("#receiptEditorModal .receipt-checkbox:checked")).map(p185 => p185.closest("tbody"));
        if (v369.length === 0) {
          alert("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…Ø³ØªÙ†Ø¯ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙ‡.");
          return;
        }
        try {
          const v370 = document.getElementById("pos-select-editor").value;
          const v371 = document.getElementById("activity-select-editor");
          const v372 = v371 ? v371.value : v325;
          const vO23 = {
            id: v322.id,
            name: document.getElementById("editor-seller-name").value,
            governate: document.getElementById("editor-seller-governate").value,
            regionCity: document.getElementById("editor-seller-regionCity").value,
            street: document.getElementById("editor-seller-street").value,
            buildingNumber: document.getElementById("editor-seller-building").value
          };
          const vA16 = [];
          let v373 = (JSON.parse(localStorage.getItem("receiptHistory") || "[]")[0] || {}).uuid || "";
          for (const v374 of v369) {
            const v375 = v374.dataset.receiptNumber;
            const v376 = v374.dataset.docType;
            const v377 = p164.get(v375);
            if (!v377) {
              continue;
            }
            const v378 = v376 === "return" ? calculateReceiptData(v377, vO23, v370, v372) : calculateReturnReceiptData(v377, vO23, v370, v372);
            v378.header.previousUUID = v373;
            const v379 = JSON.stringify({
              receipts: [v378]
            });
            const v380 = await vF.computeUuidFromRawText(v379);
            v378.header.uuid = v380;
            v373 = v380;
            vA16.push(v378);
          }
          const vO24 = {
            receipts: vA16
          };
          const v381 = JSON.stringify(vO24, null, 4);
          const v382 = window.open("", "_blank");
          v382.document.write("<pre style=\"direction: ltr; text-align: left; white-space: pre-wrap; word-wrap: break-word;\">" + v381 + "</pre>");
          v382.document.close();
        } catch (e17) {
          alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¨Ù†Ø§Ø¡ JSON: " + e17.message);
        }
      });
      const v383 = document.getElementById("pos-select-editor");
      if (v383) {
        v383.addEventListener("change", p186 => {
          const v384 = p186.target.options[p186.target.selectedIndex];
          const v385 = JSON.parse(v384.dataset.address || "{}");
          document.getElementById("editor-seller-governate").value = v385.governate || "";
          document.getElementById("editor-seller-regionCity").value = v385.regionCity || "";
          document.getElementById("editor-seller-street").value = v385.street || "";
          document.getElementById("editor-seller-building").value = v385.buildingNumber || "";
        });
        v383.dispatchEvent(new Event("change"));
      }
    } catch (e18) {
      v321.innerHTML = "<div style=\"display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; font-size: 22px; color: #d9534f; text-align: center; padding: 20px;\">\n            <p>ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©.</p>\n            <p style=\"font-size: 16px; color: #555;\">Ø§Ù„Ø®Ø·Ø£: " + e18.message + "</p>\n            <button id=\"closeErrorModal\" class=\"header-btn close-btn\" style=\"margin-top: 20px;\">Ø¥ØºÙ„Ø§Ù‚</button>\n        </div>";
      v321.querySelector("#closeErrorModal").onclick = () => v320.remove();
    }
  }
  async function sendReceipts(p187, p188) {
    let vLS7 = "";
    try {
      const v386 = p187.receipts;
      if (!v386 || v386.length === 0) {
        throw new Error("ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ÙƒØ§Ø¦Ù† Ø§Ù„Ø¯ÙØ¹Ø© ÙØ§Ø±Øº Ø£Ùˆ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¥ÙŠØµØ§Ù„Ø§Øª.");
      }
      vLS7 = v386[v386.length - 1].header.uuid;
      const v387 = JSON.stringify(p187, null, 2);
      const v388 = new JSZip();
      v388.file("receipts.json", v387);
      const v389 = await v388.generateAsync({
        type: "blob",
        compression: "DEFLATE"
      });
      const v390 = document.querySelector("input[type=\"file\"]");
      if (!v390) {
        throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª.");
      }
      const v391 = new File([v389], "receipts.zip", {
        type: "application/zip"
      });
      const v392 = new DataTransfer();
      v392.items.add(v391);
      v390.files = v392.files;
      v390.dispatchEvent(new Event("change", {
        bubbles: true
      }));
      await new Promise(p189 => setTimeout(p189, 200));
      const v393 = Array.from(document.querySelectorAll("button span.ms-Button-label")).find(p190 => p190.textContent.trim() === "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©");
      if (!v393) {
        throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø± \"Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©\".");
      }
      const v394 = v393.closest("button");
      v394.click();
      await new Promise((p191, p192) => {
        const maxWaitTime = 30000;
        const checkInterval = 250;
        let vLN015 = 0;
        const vSetInterval3 = setInterval(() => {
          const v395 = document.body.contains(v394) && v394.offsetParent !== null;
          if (!v395) {
            clearInterval(vSetInterval3);
            p191();
          } else if (vLN015 >= maxWaitTime) {
            clearInterval(vSetInterval3);
            p191();
          }
          vLN015 += checkInterval;
        }, checkInterval);
      });
      return {
        success: true,
        uuid: vLS7,
        error: null
      };
    } catch (e19) {
      return {
        success: false,
        uuid: vLS7,
        error: e19.message
      };
    }
  }
  function calculateReturnReceiptData(p193, p194, p195, p196, p197 = null) {
    const vO25 = {
      id: (p194 || window.receiptUploaderData.seller).id,
      name: f120(document.getElementById("editor-seller-name")?.value || (p194 || window.receiptUploaderData.seller).name),
      governate: f120(document.getElementById("editor-seller-governate")?.value || (p194 || window.receiptUploaderData.seller).governate),
      regionCity: f120(document.getElementById("editor-seller-regionCity")?.value || (p194 || window.receiptUploaderData.seller).regionCity),
      street: f120(document.getElementById("editor-seller-street")?.value || (p194 || window.receiptUploaderData.seller).street),
      buildingNumber: String(document.getElementById("editor-seller-building")?.value || (p194 || window.receiptUploaderData.seller).buildingNumber || "0").trim()
    };
    const v396 = p195 || window.receiptUploaderData.serial;
    const v397 = p196 || (p194 || window.receiptUploaderData.seller).taxpayerActivityCode || "4690";
    const v398 = p193[0];
    const v399 = JSON.parse(localStorage.getItem("receiptHistory") || "[]");
    const v400 = v399.length > 0 ? v399[0].uuid : "";
    let vLSEGP = "EGP";
    let vLN016 = 0;
    const v401 = p193.find(p198 => p198.currencySold && p198.currencySold !== "EGP");
    if (v401) {
      vLSEGP = v401.currencySold;
      vLN016 = parseFloat(v401.exchangeRate) || 1;
    }
    const vO26 = {
      dateTimeIssued: f4(v398.dateTimeIssued),
      receiptNumber: String(v398.receiptNumber || "RCPT_" + Math.floor(Date.now() / 1000)),
      previousUUID: v400,
      uuid: "",
      currency: vLSEGP,
      exchangeRate: parseFloat(vLN016.toFixed(5))
    };
    let vLN017 = 0;
    const v402 = new Map();
    const v403 = p193.map(p199 => {
      const vParseFloat7 = parseFloat((parseFloat(p199.quantity) || 0).toFixed(5));
      const vParseFloat8 = parseFloat((parseFloat(p199.unitPrice) || 0).toFixed(5));
      const vVParseFloat8 = vParseFloat8;
      const vParseFloat9 = parseFloat((vParseFloat7 * vVParseFloat8).toFixed(5));
      const vVParseFloat9 = vParseFloat9;
      const vA17 = [];
      let vLN018 = 0;
      for (let vLN12 = 1; vLN12 <= 2; vLN12++) {
        const v404 = p199["taxType_" + vLN12];
        const vParseFloat10 = parseFloat(p199["taxRate_" + vLN12]);
        if (v404 && !isNaN(vParseFloat10) && vParseFloat10 > 0) {
          const vParseFloat11 = parseFloat((vVParseFloat9 * (vParseFloat10 / 100)).toFixed(5));
          vA17.push({
            taxType: String(v404),
            amount: vParseFloat11,
            subType: String(p199["taxSubType_" + vLN12]),
            rate: vParseFloat10
          });
          vLN018 += v404 === "T4" ? -vParseFloat11 : vParseFloat11;
          v402.set(String(v404), (v402.get(String(v404)) || 0) + vParseFloat11);
        }
      }
      const vParseFloat12 = parseFloat((vVParseFloat9 + vLN018).toFixed(5));
      vLN017 += vParseFloat9;
      return {
        internalCode: String(p199.internalCode || p199.itemCode),
        description: f120(String(p199.description), 100).padEnd(5, " "),
        itemType: String(p199.itemType || "EGS"),
        itemCode: String(p199.itemCode),
        unitType: String(p199.unitType || "EA"),
        quantity: vParseFloat7,
        unitPrice: vVParseFloat8,
        netSale: vVParseFloat9,
        totalSale: vParseFloat9,
        total: vParseFloat12,
        valueDifference: 0,
        taxableItems: vA17,
        itemDiscountData: []
      };
    });
    const vO27 = {
      header: vO26,
      documentType: {
        receiptType: "S",
        typeVersion: "1.2"
      },
      seller: {
        rin: vO25.id,
        companyTradeName: vO25.name,
        branchCode: "0",
        branchAddress: {
          country: "EG",
          governate: vO25.governate,
          regionCity: vO25.regionCity,
          street: vO25.street,
          buildingNumber: vO25.buildingNumber
        },
        deviceSerialNumber: v396,
        activityCode: v397
      },
      buyer: {
        type: "P",
        id: v398.buyerId,
        name: v398.buyerName || undefined,
        mobileNumber: "",
        paymentNumber: ""
      },
      itemData: v403,
      totalSales: parseFloat(vLN017.toFixed(5)),
      totalItemsDiscount: 0,
      netAmount: parseFloat(vLN017.toFixed(5)),
      taxTotals: Array.from(v402, ([v405, v406]) => ({
        taxType: v405,
        amount: parseFloat(v406.toFixed(5))
      })),
      totalAmount: parseFloat(v403.reduce((p200, p201) => p200 + p201.total, 0).toFixed(5)),
      paymentMethod: "C",
      feesAmount: 0,
      adjustment: 0
    };
    return vO27;
  }
  async function sendReceipts(p202) {
    const v_0x39bd1e7 = f74("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...");
    try {
      const v407 = JSON.stringify({
        receipts: [p202]
      });
      const v408 = await vF.computeUuidFromRawText(v407);
      p202.header.uuid = v408;
      const v409 = JSON.stringify({
        receipts: [p202]
      }, null, 2);
      const v410 = new JSZip();
      v410.file("receipts.json", v409);
      const v411 = await v410.generateAsync({
        type: "blob",
        compression: "DEFLATE"
      });
      const v412 = document.querySelector("input[type=\"file\"]");
      if (!v412) {
        throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª.");
      }
      const v413 = new File([v411], "receipts.zip", {
        type: "application/zip"
      });
      const v414 = new DataTransfer();
      v414.items.add(v413);
      v412.files = v414.files;
      v412.dispatchEvent(new Event("change", {
        bubbles: true
      }));
      const v415 = Array.from(document.querySelectorAll("button span.ms-Button-label")).find(p203 => p203.textContent.trim() === "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©");
      if (!v415) {
        throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø± \"Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©\".");
      }
      v415.closest("button").click();
      const v416 = JSON.parse(localStorage.getItem("receiptHistory") || "[]");
      const vO28 = {
        receiptNumber: p202.header.receiptNumber,
        uuid: p202.header.uuid
      };
      v416.unshift(vO28);
      localStorage.setItem("receiptHistory", JSON.stringify(v416.slice(0, 50)));
      renderReceiptHistory();
      v_0x39bd1e7.remove();
      f74("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠØµØ§Ù„ " + vO28.receiptNumber + " Ø¨Ù†Ø¬Ø§Ø­!", 5000);
    } catch (e20) {
      alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙØ§Ø¯Ø­ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: " + e20.message);
    } finally {
      if (v_0x39bd1e7) {
        v_0x39bd1e7.remove();
      }
    }
  }
  async function f51() {
    return await getIssuerFullData();
  }
  async function getDeviceSerialNumber() {
    const v_0x57971a4 = getAccessToken();
    if (!v_0x57971a4) {
      return null;
    }
    try {
      const apiUrl = "https://api-portal.invoicing.eta.gov.eg/api/v1/pos/devices/current?Ps=100";
      const v417 = await fetch(apiUrl, {
        headers: {
          Authorization: "Bearer " + v_0x57971a4
        }
      });
      if (!v417.ok) {
        const v418 = await v417.text();
        return null;
      }
      const v419 = await v417.json();
      const v420 = v419?.data?.filter(p204 => p204.status === "Active");
      if (v420 && v420.length > 0) {
        v420.sort((p205, p206) => {
          const v421 = new Date(p205.firstAuthenticationDate);
          const v422 = new Date(p206.firstAuthenticationDate);
          return v422 - v421;
        });
        return v420;
      } else {
        return [];
      }
    } catch (e21) {
      return null;
    }
  }
  let v423 = false;
  let vLN019 = 0;
  const vLN10 = 10;
  const vO29 = {
    T1: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©",
    T2: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ù†Ø³Ø¨ÙŠØ©)",
    T3: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø§Ù„Ù†ÙˆØ¹ÙŠØ©)",
    T4: "Ø§Ù„Ø®ØµÙ… ØªØ­Øª Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©",
    T5: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¯Ù…ØºØ© (Ù†Ø³Ø¨ÙŠØ©)",
    T6: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¯Ù…ØºØ© (Ù‚Ø·Ø¹ÙŠØ© Ø¨Ù…Ù‚Ø¯Ø§Ø± Ø«Ø§Ø¨Øª)",
    T7: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù…Ù„Ø§Ù‡ÙŠ",
    T8: "Ø±Ø³Ù… ØªÙ†Ù…ÙŠØ© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯",
    T9: "Ø±Ø³Ù… Ø®Ø¯Ù…Ø©",
    T10: "Ø±Ø³Ù… Ø§Ù„Ù…Ø­Ù„ÙŠØ§Øª",
    T11: "Ø±Ø³Ù… Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„ØµØ­ÙŠ",
    T12: "Ø±Ø³ÙˆÙ… Ø£Ø®Ø±Ù‰",
    T13: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¯Ù…ØºØ© (Ù†Ø³Ø¨ÙŠØ©)",
    T14: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¯Ù…ØºØ© (Ù‚Ø·Ø¹ÙŠØ© Ø¨Ù…Ù‚Ø¯Ø§Ø± Ø«Ø§Ø¨Øª)",
    T15: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù…Ù„Ø§Ù‡ÙŠ",
    T16: "Ø±Ø³Ù… ØªÙ†Ù…ÙŠØ© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯",
    T17: "Ø±Ø³Ù… Ø®Ø¯Ù…Ø©",
    T18: "Ø±Ø³Ù… Ø§Ù„Ù…Ø­Ù„ÙŠØ§Øª",
    T19: "Ø±Ø³Ù… Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„ØµØ­ÙŠ",
    T20: "Ø±Ø³ÙˆÙ… Ø£Ø®Ø±Ù‰"
  };
  async function getIssuerFullData() {
    try {
      const v_0x57971a5 = getAccessToken();
      const v424 = JSON.parse(localStorage.getItem("USER_DATA") || "{}");
      const v425 = v424?.profile?.TaxRin || v424?.profile?.taxRin;
      if (!v_0x57971a5 || !v425) {
        return null;
      }
      const v426 = await fetch("https://api-portal.invoicing.eta.gov.eg/api/v1/taxpayers/" + v425 + "/light", {
        headers: {
          Authorization: "Bearer " + v_0x57971a5,
          Accept: "application/json"
        }
      });
      if (!v426.ok) {
        return null;
      }
      const v427 = await v426.json();
      const v428 = v427.taxpayerBranchs?.[0];
      const v429 = v428?.address;
      const v430 = v428?.taxpayerActivities || [];
      let vLS4690 = "4690";
      if (v430.length > 0) {
        const v431 = v430.find(p207 => p207.toDate === null);
        if (v431) {
          vLS4690 = v431.activityTypeCode;
        } else {
          vLS4690 = v430[v430.length - 1].activityTypeCode;
        }
      } else {}
      return {
        id: v427.registrationNumber,
        name: v427.nameSecondaryLang || v427.namePrimaryLang || "Ø§Ø³Ù… ØºÙŠØ± Ù…Ø­Ø¯Ø¯",
        taxpayerActivityCode: vLS4690,
        activities: v430,
        governate: v429?.governorateNameSecondaryLang || "",
        regionCity: v429?.cityNameSecondaryLang || "",
        street: v429?.streetName || "",
        buildingNumber: v429?.buildingNo || ""
      };
    } catch (e22) {
      return null;
    }
  }
  function addInvoiceCreatorButton() {
    if (window.location.pathname !== "/newdocument") {
      return;
    }
    if (document.getElementById("customInvoiceCreatorBtn")) {
      return;
    }
    const v432 = document.querySelector("button[id^='Pivot'][id$='-Tab3']");
    if (!v432) {
      if (vLN019 < vLN10) {
        vLN019++;
        setTimeout(addInvoiceCreatorButton, 500);
        return;
      }
      return;
    }
    const v433 = document.createElement("button");
    v433.id = "customInvoiceCreatorBtn";
    v433.type = "button";
    v433.className = v432.className.replace("is-selected", "").replace("linkIsSelected-135", "");
    const vLSsvgWidth24Height24Vi2 = "\n        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n            <path d=\"M14 2H6C4.89543 2 4 2.89543 4 4V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V8L14 2Z\" fill=\"#107C41\"/>\n            <path d=\"M14 2V8H20\" fill=\"#10B981\" fill-opacity=\"0.5\"/>\n            <path d=\"M12.5 13.5L15 17M15 13.5L12.5 17\" stroke=\"white\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n            <path d=\"M9.5 17H10.5L12 14.75L10.5 12H9.5L8 14.25L9.5 17Z\" stroke=\"white\" stroke-width=\"1.5\" stroke-linejoin=\"round\"/>\n        </svg>\n    ";
    v433.innerHTML = "\n        <span class=\"btn-content-wrapper\">\n            <span class=\"btn-icon-container\">" + vLSsvgWidth24Height24Vi2 + "</span>\n            <span class=\"ms-Pivot-text btn-text\">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù† Excel</span>\n        </span>\n    ";
    const v434 = document.createElement("style");
    v434.id = "customButtonStyles";
    if (!document.getElementById(v434.id)) {
      v434.innerHTML = "\n            #customInvoiceCreatorBtn {\n                background: rgba(22, 163, 74, 0.1);\n                border: 1px solid rgba(22, 163, 74, 0.3);\n                border-radius: 6px;\n                backdrop-filter: blur(10px);\n                -webkit-backdrop-filter: blur(10px);\n                transition: all 0.3s ease;\n                margin: 0 10px;\n                position: relative;\n                overflow: hidden;\n            }\n            #customInvoiceCreatorBtn .btn-content-wrapper {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                padding: 4px 8px;\n            }\n            #customInvoiceCreatorBtn .btn-icon-container {\n                background-color: #16A34A;\n                border-radius: 4px;\n                padding: 4px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                box-shadow: 0 1px 3px rgba(0,0,0,0.2);\n            }\n            #customInvoiceCreatorBtn .btn-text {\n                color: #14532d;\n                font-weight: 600;\n            }\n            #customInvoiceCreatorBtn::before {\n                content: '';\n                position: absolute;\n                top: 50%; left: 50%;\n                width: 300px; height: 300px;\n                background: radial-gradient(circle, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 70%);\n                transform: translate(-50%, -50%) scale(0);\n                transition: transform 0.5s ease;\n                opacity: 0;\n            }\n            #customInvoiceCreatorBtn:hover::before {\n                transform: translate(-50%, -50%) scale(1);\n                opacity: 1;\n            }\n            #customInvoiceCreatorBtn:hover {\n                border-color: rgba(22, 163, 74, 0.5);\n                background: rgba(22, 163, 74, 0.2);\n                box-shadow: 0 4px 15px rgba(22, 163, 74, 0.2);\n            }\n        ";
      document.head.appendChild(v434);
    }
    v433.addEventListener("click", async p208 => {
      p208.preventDefault();
      const v435 = await signDataLocally();
      injectInvoiceCreatorUI(v435);
    });
    v432.parentNode.insertBefore(v433, v432);
    vLN019 = 0;
  }
  async function injectInvoiceCreatorUI(p209 = true) {
    if (document.getElementById("invoiceCreatorMainUI")) {
      const v436 = document.getElementById("invoiceCreatorMainUI");
      v436.style.display = "flex";
      v436.querySelector(".sidebar-btn[data-target=\"panel-create\"]").click();
      return;
    }
    const v437 = document.createElement("link");
    v437.href = "https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Kufam:wght@600&display=swap";
    v437.rel = "stylesheet";
    document.head.appendChild(v437);
    const v438 = document.createElement("div");
    v438.id = "invoiceCreatorMainUI";
    Object.assign(v438.style, {
      position: "fixed",
      top: "50%",
      left: "50%",
      transform: "translate(-50%, -50%)",
      width: "1080px",
      height: "700px",
      backgroundColor: "#ffffff",
      borderRadius: "12px",
      boxShadow: "0 10px 40px rgba(0, 0, 0, 0.2)",
      zIndex: "9999",
      fontFamily: "'Cairo', 'Segoe UI', Tahoma, sans-serif",
      overflow: "hidden",
      display: "flex",
      direction: "rtl"
    });
    v438.innerHTML = "\n        \n       <div class=\"sidebar\">\n            <div class=\"sidebar-header\"><h3>ğŸš€ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h3></div>\n            <div class=\"sidebar-menu\">\n                " + (p209 ? "\n                    <button class=\"sidebar-btn\" data-target=\"panel-create\"><span class=\"btn-icon\">â•</span> Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù† Excel</button>\n                    <button class=\"sidebar-btn\" data-target=\"panel-credit-note\"><span class=\"btn-icon\">â†©ï¸</span> Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø§Ø¦Ù†</button>\n                " : "") + "\n                <button class=\"sidebar-btn\" data-target=\"panel-drafts\"><span class=\"btn-icon\">ğŸ–¨ï¸</span> Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ÙˆØ¯Ø§Øª</button>\n                <button class=\"sidebar-btn\" data-target=\"panel-taxpayer-query\"><span class=\"btn-icon\">ğŸ”</span> Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ù…Ù…ÙˆÙ„</button>\n                <button class=\"sidebar-btn\" data-target=\"panel-codes-explorer\"><span class=\"btn-icon\">ğŸ“¦</span> Ù…Ø³ØªÙƒØ´Ù Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</button>\n                " + (!p209 ? "\n                    <button class=\"sidebar-btn active\" data-target=\"panel-subscription\" style=\"margin-top: auto; background-color: #1a4a7d;\">\n                        <span class=\"btn-icon\">â­</span> Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ§Ù„Ø¯Ø¹Ù…\n                    </button>\n                " : "") + "\n            </div>\n        </div>\n        <div class=\"main-panel\">\n            <button id=\"closeInvoiceCreatorBtn\" title=\"Ø¥ØºÙ„Ø§Ù‚\">&times;</button>\n            <div class=\"panel-content-wrapper\">\n                " + (p209 ? "\n                    <div id=\"panel-create\" class=\"panel-content\"></div>\n                    <div id=\"panel-credit-note\" class=\"panel-content\"></div>\n                " : "") + "\n                <div id=\"panel-drafts\" class=\"panel-content\"></div>\n                <div id=\"panel-taxpayer-query\" class=\"panel-content\"></div>\n                <div id=\"panel-codes-explorer\" class=\"panel-content\"></div>\n                " + (!p209 ? "\n                    <div id=\"panel-subscription\" class=\"panel-content\"></div>\n                " : "") + "\n            </div>\n            <div id=\"info-sidebar\" class=\"info-sidebar\">\n                <div id=\"taxpayer-info-box\" class=\"info-card\">\n                    <div class=\"card-header\"><span class=\"card-icon\">ğŸ‘¤</span><h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù…ÙˆÙ„</h3></div>\n                    <div class=\"card-body\"><p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p></div>\n                </div>\n                <div class=\"info-card prayer-card\"><p>Ø§Ù„Ù„Ù‡ÙÙ… ØµÙ„Ù‘Ù Ø¹Ù„Ù‰ Ù…ÙØ­Ù…Ø¯</p></div>\n                <div id=\"designer-info-box\" class=\"info-card\">\n                     <div class=\"card-header\"><span class=\"card-icon\">ğŸ’»</span><h3>Ø§Ù„Ù…ØµÙ…Ù…</h3></div>\n                     <div class=\"card-body\">\n                        <p class=\"designer-name\">Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ : Ù…Ø­Ù…Ø¯ ØµØ¨Ø±ÙŠ</p>\n                        <p class=\"designer-contact\"><span class=\"card-icon\" style=\"font-size: 14px;\">ğŸ“</span>ÙˆØ§ØªØ³Ø§Ø¨: 01060872599</p>\n                     </div>\n                </div>\n            </div>\n        </div>\n    ";
    populateCreditNoteTab();
    const v439 = document.createElement("style");
    v439.innerHTML = "\n        .sidebar { width: 220px; background-color: #0d1b2a; color: #e0e1dd; display: flex; flex-direction: column; flex-shrink: 0; }\n        .sidebar-header { padding: 20px; text-align: center; border-bottom: 1px solid #415a77; }\n        .sidebar-menu { flex-grow: 1; padding-top: 15px; }\n        .sidebar-btn { display: flex; align-items: center; width: 100%; padding: 15px 20px; background-color: transparent; border: none; color: #e0e1dd; font-size: 16px; font-family: 'Cairo', sans-serif; text-align: right; cursor: pointer; transition: background-color 0.3s, color 0.3s; border-right: 4px solid transparent; }\n        .sidebar-btn:hover { background-color: #1b263b; }\n        .sidebar-btn.active { background-color: #415a77; color: #ffffff; font-weight: 700; border-right-color: #778da9; }\n        .sidebar-btn .btn-icon { margin-left: 12px; font-size: 18px; }\n        .main-panel { flex-grow: 1; background-color: #f4f7fa; display: flex; position: relative; }\n        #closeInvoiceCreatorBtn { position: absolute; top: 10px; left: 10px; width: 32px; height: 32px; background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; border-radius: 50%; font-size: 24px; line-height: 30px; text-align: center; cursor: pointer; z-index: 10; transition: all 0.2s ease; }\n        #closeInvoiceCreatorBtn:hover { background-color: #e63946; color: white; transform: scale(1.1); box-shadow: 0 2px 8px rgba(0,0,0,0.2); }\n        .panel-content-wrapper { flex-grow: 1; overflow-y: auto; position: relative; }\n        .panel-content { display: none; padding: 25px; height: 100%; box-sizing: border-box; }\n        .panel-content.active { display: block; animation: fadeIn 0.5s; }\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }\n        .info-sidebar { width: 350px; flex-shrink: 0; background-color: #e9ecef; border-right: 1px solid #dee2e6; padding: 20px 15px; display: flex; flex-direction: column; gap: 20px; transition: opacity 0.3s, visibility 0.3s; }\n        .info-card { background-color: #fff; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.07); border: 1px solid #dbe4f0; }\n        .info-card .card-header { display: flex; align-items: center; gap: 10px; background-color: #f8f9fa; padding: 10px 15px; border-bottom: 1px solid #e9ecef; border-top-left-radius: 9px; border-top-right-radius: 9px; }\n        .info-card .card-header h3 { margin: 0; font-size: 15px; color: #1d3557; }\n        .info-card .card-icon { font-size: 18px; color: #457b9d; }\n        .info-card .card-body { padding: 15px; font-size: 14px; color: #343a40; }\n        .info-card .card-body p { margin: 5px 0; line-height: 1.6; }\n        #taxpayer-info-box strong { color: #0d1b2a; }\n        .prayer-card { text-align: center; padding: 20px; background: linear-gradient(135deg, #1d3557, #457b9d); color: #fff; text-shadow: 1px 1px 3px rgba(0,0,0,0.3); }\n        .prayer-card p { font-family: 'Kufam', cursive; font-size: 22px; font-weight: 600; margin: 0; }\n        #designer-info-box .designer-name { font-weight: bold; color: #1d3557; }\n        #designer-info-box .designer-contact { font-size: 13px; color: #007bff; display: flex; align-items: center; gap: 8px; }\n        .panel-header { border-bottom: 1px solid #dee2e6; padding-bottom: 15px; margin-bottom: 25px; }\n        .panel-header h2 { margin: 0 0 5px 0; color: #0d1b2a; font-size: 22px; }\n        .panel-header p { margin: 0; color: #6c757d; font-size: 15px; }\n        .content-step { margin-bottom: 20px; }\n        .content-label { display: block; font-size: 15px; font-weight: 600; color: #343a40; margin-bottom: 8px; }\n        .content-select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ced4da; font-size: 15px; }\n        .button-group { display: flex; gap: 15px; }\n        .action-button { padding: 12px 20px; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 15px; flex-grow: 1; text-align: center; display: flex; align-items: center; justify-content: center; transition: transform 0.2s; }\n        .action-button:hover { transform: translateY(-2px); }\n        .download-btn { background-color: #5a67d8; }\n        .upload-btn { background-color: #38a169; }\n        .drafts-btn-main { background-color: #dd6b20; width: 60%; margin: 20px auto; padding: 15px; font-size: 18px; }\n        .comments-area { display: flex; flex-direction: column; height: 100%; }\n        .comments-container { flex-grow: 1; overflow-y: auto; padding: 10px; background: #e9ecef; border-radius: 8px; margin-bottom: 20px; }\n        .comment-box { background: white; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-right: 5px solid #a8dadc; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; }\n        .comment-box.admin-comment { border-right-color: #fca311; }\n        .comment-image { max-width: 150px; max-height: 150px; border-radius: 8px; margin-top: 10px; cursor: pointer; transition: transform 0.3s; object-fit: cover; }\n        .admin-form-container { background-color: #fff; padding: 40px; border-radius: 12px; text-align: center; max-width: 400px; margin: 40px auto; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }\n        .admin-input { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; text-align: center; }\n        .admin-submit-btn { background-color: #1d3557; color: white; padding: 12px 30px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; width: 100%; }\n        .help-section { margin-bottom: 25px; }\n        .help-title { font-size: 18px; color: #1d3557; border-bottom: 2px solid #a8dadc; padding-bottom: 8px; margin-bottom: 15px; }\n        .help-table { width: 100%; border-collapse: collapse; font-size: 14px; }\n        .help-table th, .help-table td { border: 1px solid #dee2e6; padding: 12px; text-align: right; vertical-align: middle; }\n        .help-table th { background-color: #f8f9fa; font-weight: 700; color: #495057; }\n        .help-table tbody tr:nth-child(even) { background-color: #f9f9f9; }\n        .help-table td strong { color: #0d1b2a; }\n        .required-star { color: #e63946; font-weight: bold; margin-right: 4px; }\n        .help-notes { background-color: #fffbe6; border: 1px solid #ffe58f; border-right: 5px solid #fca311; padding: 15px 20px; border-radius: 8px; }\n        .help-notes ul { padding-right: 20px; margin: 0; }\n        .help-notes li { margin-bottom: 12px; line-height: 1.7; font-size: 15px; }\n        .note-highlight { font-weight: bold; color: #1d3557; }\n        .query-container { display: flex; gap: 10px; margin-bottom: 20px; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 12px; border: 1px solid #e9ecef; }\n        #taxpayerQueryInput { flex-grow: 1; padding: 12px 15px; border: 1px solid #ced4da; border-radius: 8px; font-size: 16px; text-align: left; direction: ltr; transition: all 0.3s ease; }\n        #taxpayerQueryInput:focus { border-color: #007bff; box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.15); outline: none; }\n        #taxpayerQueryBtn { padding: 12px 25px; font-size: 16px; font-weight: bold; background: linear-gradient(145deg, #007bff, #0056b3); color: white; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2); }\n        #taxpayerQueryBtn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0, 123, 255, 0.3); }\n        #queryResultContainer { background-color: #e9ecef; border-radius: 8px; padding: 15px; height: calc(100% - 150px); overflow-y: auto; }\n        .query-placeholder { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; font-size: 20px; color: #6c757d; text-align: center; }\n        .query-placeholder svg { width: 80px; height: 80px; margin-bottom: 20px; opacity: 0.5; }\n        .profile-card, .branch-card, .activity-card { background: #ffffff; border-radius: 12px; margin-bottom: 20px; border: 1px solid #dee2e6; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05); overflow: hidden; animation: fadeIn 0.5s ease-out; }\n        .card-header { display: flex; align-items: center; gap: 12px; padding: 15px 20px; background: #f8f9fa; border-bottom: 1px solid #e9ecef; }\n        .card-header .icon { font-size: 24px; color: #007bff; }\n        .card-header h3 { margin: 0; font-size: 18px; font-weight: 700; color: #343a40; }\n        .card-body { padding: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px 25px; }\n        .info-field { display: flex; align-items: center; background: #f8f9fa; border-radius: 8px; padding: 8px 12px; border: 1px solid #e9ecef; }\n        .info-field .label-icon { font-size: 18px; color: #6c757d; margin-left: 10px; }\n        .info-field .value { font-size: 15px; color: #212529; font-weight: 500; }\n        .info-field .value.ltr { direction: ltr; text-align: left; flex-grow: 1; }\n        .info-field .status { padding: 4px 10px; border-radius: 15px; font-weight: bold; font-size: 13px; }\n        .info-field .status.active { background-color: #d4edda; color: #155724; }\n        .info-field .status.inactive { background-color: #f8d7da; color: #721c24; }\n        .activity-card { border-left: 5px solid #17a2b8; }\n        .activity-card .card-header .icon { color: #17a2b8; }\n        .codes-explorer-grid { display: grid; grid-template-columns: 350px 1fr; gap: 20px; height: 100%; }\n        .search-panel { display: flex; flex-direction: column; background: #f8f9fa; border-radius: 12px; padding: 15px; border: 1px solid #e9ecef; }\n        .details-panel { display: flex; flex-direction: column; }\n        .search-options { display: flex; gap: 10px; margin-bottom: 15px; }\n        .search-options select { flex-grow: 1; padding: 10px; border: 1px solid #ced4da; border-radius: 8px; }\n        #code-search-input { width: 100%; padding: 12px 15px; border: 1px solid #ced4da; border-radius: 8px; font-size: 16px; margin-bottom: 15px; }\n        #search-results-list { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex-grow: 1; border: 1px solid #e9ecef; border-radius: 8px; background: #fff; }\n        .search-result-item { padding: 12px 15px; border-bottom: 1px solid #e9ecef; cursor: pointer; transition: background-color 0.2s; }\n        .search-result-item:last-child { border-bottom: none; }\n        .search-result-item:hover, .search-result-item.selected { background-color: #e0e7ff; }\n        .search-result-item strong { display: block; color: #1d3557; font-size: 15px; }\n        .search-result-item span { font-size: 13px; color: #007bff; font-family: monospace; }\n        #code-details-container { padding: 20px; background: #fff; border-radius: 12px; border: 1px solid #dee2e6; overflow-y: auto; flex-grow: 1; }\n        .detail-card { background: #f8f9fa; border-radius: 8px; padding: 15px; margin-bottom: 15px; border-left: 4px solid #007bff; }\n        .detail-card h4 { margin: 0 0 10px 0; color: #343a40; font-size: 16px; }\n        .detail-card p { margin: 5px 0; font-size: 15px; }\n        .detail-card p .label { font-weight: 600; color: #495057; min-width: 100px; display: inline-block; }\n        .detail-card p .value { color: #1d3557; }\n        .detail-card p .value.code { color: #e63946; font-family: monospace; font-weight: bold; }\n        .list-placeholder { text-align: center; color: #888; padding: 20px; }\n    ";
    document.body.appendChild(v439);
    document.body.appendChild(v438);
    function populateCreditNoteTab() {
      const v440 = document.getElementById("panel-credit-note");
      if (!v440) {
        return;
      }
      v440.innerHTML = "\n        <div class=\"panel-header\">\n            <h2>Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø§Ø¦Ù† (Credit Note) Ù…Ù† Ù…Ù„Ù Excel</h2>\n            <p>Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ù„Ø±ÙØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¯Ø§Ø¦Ù†Ø©.</p>\n        </div>\n\n        <!-- 1. Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯Ø§Ø¦Ù† -->\n        <div class=\"content-step\">\n            <label class=\"content-label\">Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯Ø§Ø¦Ù†</label>\n            <select id=\"creditNoteTypeSelect\" class=\"content-select\">\n                <option value=\"with_reference\" selected>Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø§Ø¦Ù† Ø¨Ø±Ø¨Ø· (ÙŠØªØ·Ù„Ø¨ UUID Ù„ÙØ§ØªÙˆØ±Ø© Ø³Ø§Ø¨Ù‚Ø©)</option>\n                <option value=\"without_reference\">Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø§Ø¦Ù† Ø¨Ø¯ÙˆÙ† Ø±Ø¨Ø·</option>\n            </select>\n        </div>\n\n        <!-- 2. Ø§Ø®ØªÙŠØ§Ø± Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø³ØªÙ†Ø¯ -->\n        <div class=\"content-step\">\n            <label class=\"content-label\">Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ø®ØªØ± Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø³ØªÙ†Ø¯</label>\n            <select id=\"creditNoteVersionSelect\" class=\"content-select\">\n                <option value=\"1.0\" selected>Ø¥ØµØ¯Ø§Ø± 1.0 (Ù…Ø³ØªÙ†Ø¯ Ù†Ù‡Ø§Ø¦ÙŠ ÙˆÙ…ÙˆÙ‚Ø¹)</option>\n                <option value=\"0.9\">Ø¥ØµØ¯Ø§Ø± 0.9 (Ù…Ø³ÙˆØ¯Ø© ØºÙŠØ± Ù…ÙˆÙ‚Ø¹Ø©)</option>\n            </select>\n        </div>\n\n        <!-- 3. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØ±ÙØ¹ Ø§Ù„Ù…Ù„Ù -->\n        <div class=\"content-step\">\n            <label class=\"content-label\">Ø§Ù„Ø®Ø·ÙˆØ© 3: ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØ±ÙØ¹ Ø§Ù„Ù…Ù„Ù</label>\n            <div class=\"button-group\">\n                <button id=\"downloadCreditNoteTemplateBtn\" class=\"action-button download-btn\" style=\"background-color: #c0392b;\">\n                    <span class=\"btn-icon\">ğŸ“¥</span> ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯Ø§Ø¦Ù†\n                </button>\n                <label for=\"creditNoteExcelUploadInput\" class=\"action-button upload-btn\" style=\"background-color: #e67e22;\">\n                    <span class=\"btn-icon\">ğŸ“‚</span> Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯Ø§Ø¦Ù†\n                </label>\n                <input type=\"file\" id=\"creditNoteExcelUploadInput\" accept=\".xlsx, .xls\" style=\"display: none;\">\n            </div>\n        </div>\n\n        <!-- 4. Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªÙˆØ¶ÙŠØ­ÙŠØ© -->\n        <div id=\"creditNoteHelp\" class=\"help-notes\" style=\"margin-top: 20px;\">\n            <!-- Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->\n        </div>\n    ";
      const v441 = document.getElementById("creditNoteTypeSelect");
      const v442 = document.getElementById("creditNoteHelp");
      function updateHelpNotes() {
        if (v441.value === "with_reference") {
          v442.innerHTML = "\n                <h3 class=\"help-title\">Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø© (Ù„Ù„Ø±Ø¨Ø·)</h3>\n                <p>Ù„Ø±Ø¨Ø· Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©ØŒ ÙŠØ¬Ø¨ ÙˆØ¶Ø¹ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ (UUID) Ù„Ù„ÙØ§ØªÙˆØ±Ø© ÙÙŠ Ø¹Ù…ÙˆØ¯ \"Ù…Ø±Ø¬Ø¹ Ø´Ø±Ø§Ø¡\" ÙÙŠ Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³ÙŠÙ„. Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø©.</p>\n            ";
        } else {
          v442.innerHTML = "\n                <h3 class=\"help-title\">Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø© (Ø¨Ø¯ÙˆÙ† Ø±Ø¨Ø·)</h3>\n                <p>ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙˆØ¶Ø¹ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ±Ùƒ Ø¹Ù…ÙˆØ¯ \"Ù…Ø±Ø¬Ø¹ Ø´Ø±Ø§Ø¡\" ÙØ§Ø±ØºÙ‹Ø§. Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø§Ø¦Ù† Ù…Ø³ØªÙ‚Ù„ ØºÙŠØ± Ù…Ø±ØªØ¨Ø· Ø¨ÙØ§ØªÙˆØ±Ø© Ø³Ø§Ø¨Ù‚Ø©.</p>\n            ";
        }
      }
      v441.addEventListener("change", updateHelpNotes);
      document.getElementById("downloadCreditNoteTemplateBtn").addEventListener("click", downloadCreditNoteTemplate);
      document.getElementById("creditNoteExcelUploadInput").addEventListener("change", handleCreditNoteUpload_Final);
      updateHelpNotes();
    }
    async function downloadCreditNoteTemplate() {
      const v_0x281f75 = showToastNotification("Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯Ø§Ø¦Ù† Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ...", 0);
      try {
        if (typeof ExcelJS === "undefined") {
          await injectScriptFromLocal("exceljs.min.js");
        }
        const v443 = new ExcelJS.Workbook();
        const v444 = v443.addWorksheet("CreditNotes");
        const v445 = v443.addWorksheet("Lists");
        v445.getCell("A1").value = "ReceiverTypes";
        vA50.forEach((p210, p211) => {
          v445.getCell("A" + (p211 + 2)).value = p210.desc;
        });
        v445.getCell("B1").value = "CodeTypes";
        vA51.forEach((p212, p213) => {
          v445.getCell("B" + (p213 + 2)).value = p212.code;
        });
        v445.getCell("C1").value = "UnitTypes";
        vA53.forEach((p214, p215) => {
          v445.getCell("C" + (p215 + 2)).value = p214.desc_ar;
        });
        v445.getCell("D1").value = "Countries";
        vA52.forEach((p216, p217) => {
          v445.getCell("D" + (p217 + 2)).value = p216.Desc_ar;
        });
        v445.getCell("E1").value = "MainTaxTypes";
        Object.values(vO62).forEach((p218, p219) => {
          v445.getCell("E" + (p219 + 2)).value = p218.desc;
        });
        let vLN6 = 6;
        Object.values(vO62).forEach(p220 => {
          const v446 = v445.getCell(1, vLN6);
          const v447 = p220.desc.replace(/[ ()]/g, "_");
          v446.value = v447;
          p220.subtypes.forEach((p221, p222) => {
            v445.getCell(p222 + 2, vLN6).value = p221.desc;
          });
          const v448 = String.fromCharCode("A".charCodeAt(0) + vLN6 - 1);
          const v449 = "'Lists'!$" + v448 + "$2:$" + v448 + "$" + (p220.subtypes.length + 1);
          v443.definedNames.add(v449, v447);
          vLN6++;
        });
        const vA18 = ["Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„Ø¥Ø´Ø¹Ø§Ø± (*)", "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±", "Ù…Ø±Ø¬Ø¹ Ø´Ø±Ø§Ø¡ (*)", "Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)", "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…", "Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)", "Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…", "Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…", "Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…", "Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ø³ØªÙ„Ù…", "Ù…Ø¨Ù†Ù‰ Ø§Ù„Ù…Ø³ØªÙ„Ù…", "ÙˆØµÙ Ø§Ù„ØµÙ†Ù (*)", "Ù†ÙˆØ¹ ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (*)", "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (*)", "ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ (*)", "Ø§Ù„ÙƒÙ…ÙŠØ© (*)", "Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© (*)", "Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ…", "Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…", "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)", "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ 1 (*)", "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)", "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 2", "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ 2", "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 2", "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 3", "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ 3", "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 3"];
        const vO30 = {
          "Ù…Ø±Ø¬Ø¹ Ø´Ø±Ø§Ø¡ (*)": "Ø¥Ø¬Ø¨Ø§Ø±ÙŠ: Ø¶Ø¹ Ù‡Ù†Ø§ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ (UUID) Ù„Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©.",
          "Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº Ø§Ù„Ø®ØµÙ… Ø¨Ø§Ù„Ø¬Ù†ÙŠÙ‡. Ø¥Ø°Ø§ ØªÙ… Ø¥Ø¯Ø®Ø§Ù„Ù‡ØŒ Ø³ÙŠØªÙ… ØªØ¬Ø§Ù‡Ù„ Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ….",
          "Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ…": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø£Ø¯Ø®Ù„ Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… (Ù…Ø«Ø§Ù„: 5 Ù„Ù€ 5%). Ø³ÙŠØªÙ… ØªØ¬Ø§Ù‡Ù„Ù‡ Ø¥Ø°Ø§ ØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ….",
          "Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ØµØ­ÙŠØ­Ø§Ù‹.",
          "Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.",
          "Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ø³ØªÙ„Ù…": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.",
          "Ù…Ø¨Ù†Ù‰ Ø§Ù„Ù…Ø³ØªÙ„Ù…": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹."
        };
        v444.columns = vA18.map(p223 => ({
          header: p223,
          key: p223,
          width: 30
        }));
        v444.getRow(1).eachCell(p224 => {
          p224.note = vO30[p224.value] || vO55[p224.value.replace(" (*)", "")] || "";
          p224.font = {
            name: "Arial",
            bold: true,
            size: 12,
            color: {
              argb: "FFFFFFFF"
            }
          };
          p224.fill = {
            type: "pattern",
            pattern: "solid",
            fgColor: {
              argb: "FFD9534F"
            }
          };
          p224.alignment = {
            vertical: "middle",
            horizontal: "center"
          };
        });
        const vF15 = (p225, p226) => {
          for (let vLN23 = 2; vLN23 <= 1001; vLN23++) {
            v444.getCell("" + p225 + vLN23).dataValidation = {
              type: "list",
              allowBlank: true,
              formulae: [p226]
            };
          }
        };
        vF15("F", "=Lists!$A$2:$A$4");
        vF15("G", "=Lists!$D$2:$D$" + (vA52.length + 1));
        vF15("M", "=Lists!$B$2:$B$3");
        vF15("O", "=Lists!$C$2:$C$" + (vA53.length + 1));
        vF15("T", "=Lists!$E$2:$E$" + (Object.keys(vO62).length + 1));
        vF15("W", "=Lists!$E$2:$E$" + (Object.keys(vO62).length + 1));
        vF15("Z", "=Lists!$E$2:$E$" + (Object.keys(vO62).length + 1));
        const vLSINDIRECTSUBSTITUTESU5 = "=INDIRECT(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(T2,\" \",\"_\"),\"(\",\"_\"),\")\",\"_\"))";
        const vLSINDIRECTSUBSTITUTESU6 = "=INDIRECT(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(W2,\" \",\"_\"),\"(\",\"_\"),\")\",\"_\"))";
        const vLSINDIRECTSUBSTITUTESU7 = "=INDIRECT(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(Z2,\" \",\"_\"),\"(\",\"_\"),\")\",\"_\"))";
        vF15("U", vLSINDIRECTSUBSTITUTESU5);
        vF15("X", vLSINDIRECTSUBSTITUTESU6);
        vF15("AA", vLSINDIRECTSUBSTITUTESU7);
        v445.state = "hidden";
        v444.views = [{
          rightToLeft: true
        }];
        const v450 = await v443.xlsx.writeBuffer();
        const v451 = new Blob([v450], {
          type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
        });
        saveAs(v451, "Ù†Ù…ÙˆØ°Ø¬_Ø¥Ø´Ø¹Ø§Ø±_Ø¯Ø§Ø¦Ù†_Ø§Ø­ØªØ±Ø§ÙÙŠ_ÙƒØ§Ù…Ù„.xlsx");
      } catch (e23) {
        alert("ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥ÙƒØ³ÙŠÙ„: " + e23.message);
      } finally {
        v_0x281f75.remove();
      }
    }
    function f59(p227, p228) {
      if (p227.length === 0) {
        return p228.length;
      }
      if (p228.length === 0) {
        return p227.length;
      }
      const v452 = Array(p228.length + 1).fill(null).map(() => Array(p227.length + 1).fill(null));
      for (let vLN020 = 0; vLN020 <= p227.length; vLN020++) {
        v452[0][vLN020] = vLN020;
      }
      for (let vLN021 = 0; vLN021 <= p228.length; vLN021++) {
        v452[vLN021][0] = vLN021;
      }
      for (let vLN13 = 1; vLN13 <= p228.length; vLN13++) {
        for (let vLN14 = 1; vLN14 <= p227.length; vLN14++) {
          const v453 = p227[vLN14 - 1] === p228[vLN13 - 1] ? 0 : 1;
          v452[vLN13][vLN14] = Math.min(v452[vLN13 - 1][vLN14] + 1, v452[vLN13][vLN14 - 1] + 1, v452[vLN13 - 1][vLN14 - 1] + v453);
        }
      }
      return v452[p228.length][p227.length];
    }
    async function handleCreditNoteUpload_Final(p229) {
      const v454 = p229.target.files[0];
      if (!v454) {
        return;
      }
      const v_0x3bc673 = showNonBlockingProgress_CN("Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù...");
      try {
        const v455 = new ExcelJS.Workbook();
        await v455.xlsx.load(await v454.arrayBuffer());
        const v456 = v455.getWorksheet(1);
        const v457 = v456.getRow(1).values.slice(1).map(p230 => String(p230 || "").trim());
        const vA19 = [];
        v456.eachRow({
          includeEmpty: false
        }, (p231, p232) => {
          if (p232 > 1) {
            const vO31 = {};
            p231.values.slice(1).forEach((p233, p234) => {
              const v458 = v457[p234];
              if (v458) {
                vO31[v458] = p233;
              }
            });
            vA19.push(vO31);
          }
        });
        if (vA19.length === 0) {
          throw new Error("Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³ÙŠÙ„ ÙØ§Ø±Øº!");
        }
        const vO32 = {
          "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„Ø¥Ø´Ø¹Ø§Ø± (*)": "internalID",
          "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±": "dateTimeIssued",
          "Ù…Ø±Ø¬Ø¹ Ø´Ø±Ø§Ø¡ (*)": "references",
          "Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)": "receiver_id",
          "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…": "receiver_name",
          "Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)": "receiver_type",
          "Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…": "receiver_country",
          "Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…": "receiver_governate",
          "Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…": "receiver_city",
          "Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ø³ØªÙ„Ù…": "receiver_street",
          "Ù…Ø¨Ù†Ù‰ Ø§Ù„Ù…Ø³ØªÙ„Ù…": "receiver_building",
          "ÙˆØµÙ Ø§Ù„ØµÙ†Ù (*)": "item_description",
          "Ù†ÙˆØ¹ ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (*)": "item_type",
          "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (*)": "item_code",
          "ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ (*)": "unit_type",
          "Ø§Ù„ÙƒÙ…ÙŠØ© (*)": "quantity",
          "Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© (*)": "unit_price",
          "Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ…": "discount_rate",
          "Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…": "discount_amount",
          "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)": "tax_type_1",
          "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ 1 (*)": "tax_subtype_1",
          "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)": "tax_rate_1",
          "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 2": "tax_type_2",
          "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ 2": "tax_subtype_2",
          "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 2": "tax_rate_2",
          "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 3": "tax_type_3",
          "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ 3": "tax_subtype_3",
          "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 3": "tax_rate_3"
        };
        const v459 = vA19.map(p235 => {
          const vO33 = {};
          for (const v460 in p235) {
            const v461 = vO32[v460.trim()];
            if (v461) {
              let v462 = p235[v460];
              if (vO63.units[v462]) {
                v462 = vO63.units[v462];
              } else if (vO63.taxTypes[v462]) {
                v462 = vO63.taxTypes[v462];
              } else if (vO63.taxSubtypes[v462]) {
                v462 = vO63.taxSubtypes[v462];
              } else if (vO63.receiverTypes[v462]) {
                v462 = vO63.receiverTypes[v462];
              }
              vO33[v461] = v462;
            }
          }
          return vO33;
        });
        const v463 = new Map();
        v459.forEach(p236 => {
          const v464 = p236.internalID;
          if (!v464) {
            return;
          }
          if (!v463.has(v464)) {
            v463.set(v464, []);
          }
          v463.get(v464).push(p236);
        });
        v_0x3bc673.update("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...");
        const {
          validatedMap: _0x464ccb,
          validationErrors: _0x112553
        } = await validateAndEnrichCreditNoteData_CN(v463, v_0x3bc673);
        v_0x3bc673.success("Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ù‚Ù‚!");
        if (_0x112553.length > 0) {
          showErrorModal(_0x112553, () => {
            if (_0x464ccb.size > 0) {
              f66(_0x464ccb);
            }
          });
        } else {
          f66(_0x464ccb);
        }
      } catch (e24) {
        v_0x3bc673.error("ÙØ´Ù„: " + e24.message);
      } finally {
        p229.target.value = "";
      }
    }
    async function validateAndEnrichCreditNoteData_CN(p237, p238) {
      const vA20 = [];
      const v465 = new Map();
      const v_0x57971a6 = getAccessToken();
      let vLN022 = 0;
      const v466 = p237.size;
      if (p238) {
        p238.update("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª... (0 / " + v466 + ")", 0);
      }
      async function getOriginalDocumentBySearch(p239) {
        if (!p239 || String(p239).trim() === "") {
          return {
            valid: false,
            message: "Ø­Ù‚Ù„ UUID Ù„Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø¥Ø¬Ø¨Ø§Ø±ÙŠ."
          };
        }
        const v467 = String(p239).trim();
        try {
          const v468 = "https://api-portal.invoicing.eta.gov.eg/api/v1/documents/search?Query=uuid%3A%22" + v467 + "%22&Status=Valid&Direction=sent&Page=1&PageSize=1";
          const v469 = await fetch(v468, {
            headers: {
              Authorization: "Bearer " + v_0x57971a6
            }
          });
          if (!v469.ok) {
            return {
              valid: false,
              message: "Ø®Ø·Ø£ " + v469.status + " Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø­Ø«."
            };
          }
          const v470 = await v469.json();
          if (!v470.result || v470.result.length === 0) {
            return {
              valid: false,
              message: "Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© Ø£Ùˆ ØºÙŠØ± ØµØ§Ù„Ø­Ø©."
            };
          }
          const v471 = "https://api-portal.invoicing.eta.gov.eg/api/v1/documents/" + v467 + "/raw";
          const v472 = await fetch(v471, {
            headers: {
              Authorization: "Bearer " + v_0x57971a6
            }
          });
          if (!v472.ok) {
            return {
              valid: false,
              message: "ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù… (Status: " + v472.status + ")."
            };
          }
          const v473 = await v472.json();
          if (v473.document) {
            const v474 = JSON.parse(v473.document);
            const v475 = v474.taxpayerActivityCode;
            if (v475) {
              return {
                valid: true,
                activityCode: v475
              };
            }
          }
          return {
            valid: false,
            message: "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒÙˆØ¯ Ø§Ù„Ù†Ø´Ø§Ø· ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©."
          };
        } catch (e25) {
          return {
            valid: false,
            message: "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† UUID."
          };
        }
      }
      async function f63(p240) {
        if (!p240 || p240.length !== 14 || !/^\d+$/.test(p240)) {
          return {
            valid: false,
            message: "ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ† Ù…Ù† 14 Ø±Ù‚Ù…Ù‹Ø§."
          };
        }
        try {
          const v476 = await fetch("https://api-portal.invoicing.eta.gov.eg/api/v1/person/" + p240, {
            headers: {
              Authorization: "Bearer " + v_0x57971a6
            }
          });
          if (v476.status === 200) {
            return {
              valid: true
            };
          }
          if (v476.status === 400) {
            return {
              valid: false,
              message: "Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø£Ùˆ ØºÙŠØ± ØµØ­ÙŠØ­."
            };
          }
          return {
            valid: false,
            message: "Ø®Ø·Ø£ " + v476.status + " Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…."
          };
        } catch (e26) {
          return {
            valid: false,
            message: "ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù‚Ù…."
          };
        }
      }
      for (const [v477, v478] of p237.entries()) {
        const v479 = v478[0];
        let v480 = null;
        const v481 = document.getElementById("creditNoteTypeSelect").value;
        if (v481 === "with_reference") {
          const v482 = await getOriginalDocumentBySearch(v479.references);
          if (v482.valid) {
            v480 = v482.activityCode;
          } else {
            vA20.push({
              id: v477,
              field: "Ù…Ø±Ø¬Ø¹ Ø´Ø±Ø§Ø¡ (UUID)",
              value: v479.references,
              message: v482.message
            });
          }
        }
        const v483 = (v479.receiver_type || "").toUpperCase().trim();
        let v484 = (v479.receiver_id || "").toString().trim();
        let v485 = null;
        if (v483 === "P") {
          if (!v484) {
            v484 = "29507011000000";
            v479.receiver_id = v484;
          }
          if (!v479.receiver_name || String(v479.receiver_name).trim() === "") {
            v479.receiver_name = "Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ";
          }
          const v486 = await f63(v484);
          if (!v486.valid) {
            vA20.push({
              id: v477,
              field: "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø³ØªÙ„Ù…",
              value: v484,
              message: v486.message
            });
          }
        } else if (v483 === "B") {
          v485 = await fetchTaxpayerData(v479.receiver_id);
          if (!v485) {
            vA20.push({
              id: v477,
              field: "Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ„Ù…",
              value: v479.receiver_id,
              message: "Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ ØºÙŠØ± Ù…Ø³Ø¬Ù„."
            });
          }
        }
        const v487 = v478.map(async p241 => {
          const vO34 = {
            ...p241,
            officialCodeName: ""
          };
          if (v480) {
            vO34.originalActivityCode = v480;
          }
          if (v485) {
            vO34.receiver_name = v485.namePrimaryLang;
            const v488 = v485.taxpayerBranchs?.[0]?.address;
            if (v488) {
              vO34.receiver_governate = v488.governorateNameSecondaryLang || "";
              vO34.receiver_city = v488.cityNameSecondaryLang || "";
              vO34.receiver_street = v488.streetName || "";
              vO34.receiver_building = v488.buildingNo || "";
            }
          } else if (v483 === "P") {
            vO34.receiver_id = v479.receiver_id;
            vO34.receiver_name = v479.receiver_name;
          }
          const v489 = (p241.item_type || "").toUpperCase().trim();
          const v490 = (p241.item_code || "").toString().trim();
          if (v489 && v490) {
            let v491 = null;
            if (v489 === "EGS") {
              v491 = await f92(v490);
            } else if (v489 === "GS1") {
              v491 = await f93(v490);
            }
            const v492 = Array.isArray(v491) ? v491 : v491 ? [v491] : [];
            if (v492.length > 0) {
              const v493 = v492.find(p242 => p242.codeLookupValue.toUpperCase() === v490.toUpperCase());
              if (v493) {
                vO34.officialCodeName = v493.codeNameSecondaryLang || "!! Ø§Ø³Ù… Ø±Ø³Ù…ÙŠ ØºÙŠØ± Ù…Ø³Ø¬Ù„ !!";
              } else {
                vA20.push({
                  id: v477,
                  field: "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (" + v489 + ")",
                  value: v490,
                  message: "Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­ (Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªØ·Ø§Ø¨Ù‚ ØªØ§Ù…)."
                });
              }
            } else {
              vA20.push({
                id: v477,
                field: "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (" + v489 + ")",
                value: v490,
                message: "ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…."
              });
            }
          } else {
            vA20.push({
              id: v477,
              field: "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù",
              value: "",
              message: "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù ÙˆÙ†ÙˆØ¹Ù‡ Ø­Ù‚ÙˆÙ„ Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ©."
            });
          }
          return vO34;
        });
        const v494 = await Promise.all(v487);
        v465.set(v477, v494);
        if (p238) {
          vLN022++;
          p238.updateProgress(vLN022, v466);
        }
      }
      return {
        validatedMap: v465,
        validationErrors: vA20
      };
    }
    function showNonBlockingProgress_CN(p243) {
      document.getElementById("cn-nonblocking-progress")?.remove();
      const v495 = document.createElement("div");
      v495.id = "cn-nonblocking-progress";
      Object.assign(v495.style, {
        position: "fixed",
        bottom: "20px",
        right: "20px",
        width: "320px",
        backgroundColor: "#ffffff",
        color: "#333",
        borderRadius: "10px",
        boxShadow: "0 5px 20px rgba(0, 0, 0, 0.15)",
        zIndex: "20002",
        fontFamily: "'Cairo', 'Segoe UI', sans-serif",
        overflow: "hidden",
        opacity: "0",
        transform: "translateX(20px)",
        transition: "all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1)"
      });
      v495.innerHTML = "\n        <div style=\"padding: 15px;\">\n            <div style=\"display: flex; align-items: center; gap: 12px; margin-bottom: 10px;\">\n                <div class=\"cn-progress-spinner\" style=\"width: 24px; height: 24px; border: 3px solid #e0e0e0; border-top-color: #007bff; border-radius: 50%; animation: spin 1s linear infinite; flex-shrink: 0;\"></div>\n                <span id=\"cn-progress-message\" style=\"font-size: 15px; font-weight: 600; color: #1d3557;\">" + p243 + "</span>\n            </div>\n            <div style=\"display: flex; justify-content: space-between; align-items: center; font-size: 13px; margin-bottom: 5px; color: #6c757d;\">\n                <span>Ø§Ù„ØªÙ‚Ø¯Ù…</span>\n                <span id=\"cn-progress-counter\" style=\"font-family: monospace; font-weight: bold;\">-</span>\n            </div>\n            <div style=\"background-color: #e9ecef; border-radius: 5px; overflow: hidden;\">\n                <div id=\"cn-progress-bar\" style=\"width: 0%; height: 8px; background-color: #007bff; transition: width 0.3s ease;\"></div>\n            </div>\n        </div>\n    ";
      document.body.appendChild(v495);
      setTimeout(() => {
        v495.style.opacity = "1";
        v495.style.transform = "translateX(0)";
      }, 10);
      let v496 = null;
      const vF16 = (p244 = 3000) => {
        v496 = setTimeout(() => {
          v495.style.opacity = "0";
          v495.style.transform = "translateX(20px)";
          setTimeout(() => v495.remove(), 500);
        }, p244);
      };
      v495.update = (p245, p246 = -1) => {
        clearTimeout(v496);
        v495.querySelector("#cn-progress-message").textContent = p245;
        if (p246 >= 0) {
          v495.querySelector("#cn-progress-bar").style.width = p246 + "%";
        }
      };
      v495.updateProgress = (p247, p248) => {
        const v497 = Math.round(p247 / p248 * 100);
        v495.update("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª...", v497);
        v495.querySelector("#cn-progress-counter").textContent = p247 + " / " + p248;
      };
      v495.success = (p249, p250 = 3000) => {
        v495.querySelector(".cn-progress-spinner").style.display = "none";
        v495.querySelector("#cn-progress-bar").style.backgroundColor = "#28a745";
        v495.update(p249, 100);
        vF16(p250);
      };
      v495.error = (p251, p252 = 8000) => {
        v495.querySelector(".cn-progress-spinner").style.display = "none";
        v495.querySelector("#cn-progress-bar").style.backgroundColor = "#dc3545";
        v495.update(p251, 100);
        vF16(p252);
      };
      return v495;
    }
    function createLoadingIndicator_CN(p253) {
      const v498 = document.createElement("div");
      v498.id = "creditNoteLoadingIndicator";
      v498.style.cssText = "\n        position: fixed; top: 0; left: 0; width: 100%; height: 100%; \n        background: rgba(0,0,0,0.75); color: white; \n        display: flex; flex-direction: column; align-items: center; justify-content: center; \n        z-index: 20002; font-family: 'Cairo', 'Segoe UI', sans-serif;\n        backdrop-filter: blur(5px);\n    ";
      v498.innerHTML = "\n        <div style=\"text-align: center;\">\n            <div id=\"cn-indicator-spinner\" style=\"width: 50px; height: 50px; border: 5px solid rgba(255, 255, 255, 0.3); border-top-color: #3498db; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px;\"></div>\n            <p id=\"cn-indicator-message\" style=\"font-size: 20px; margin: 0;\">" + p253 + "</p>\n        </div>\n    ";
      v498.update = p254 => {
        const v499 = v498.querySelector("#cn-indicator-message");
        if (v499) {
          v499.textContent = p254;
        }
      };
      return v498;
    }
    async function f66(p255) {
      document.getElementById("creditNoteEditorModal")?.remove();
      const v500 = document.createElement("div");
      v500.id = "creditNoteEditorModal";
      v500.style.cssText = "position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); z-index: 10000; display: flex; align-items: center; justify-content: center; direction: rtl; font-family: 'Segoe UI', Tahoma, sans-serif;";
      const v501 = document.createElement("div");
      v501.style.cssText = "background-color: #fff; width: 95%; height: 90%; border-radius: 12px; display: flex; flex-direction: column; box-shadow: 0 5px 25px rgba(0,0,0,0.2); overflow: hidden;";
      const v502 = await getIssuerFullData();
      const v503 = v502 && v502.activities && v502.activities.length > 0 ? "\n        <div class=\"details-card-cn\" style=\"padding: 10px 15px;\">\n            <label for=\"activity-select-editor-cn\" style=\"font-weight: bold; margin-bottom: 5px; display: block;\">Ø§Ø®ØªØ± ÙƒÙˆØ¯ Ø§Ù„Ù†Ø´Ø§Ø·:</label>\n            <select id=\"activity-select-editor-cn\" style=\"width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ccc;\">\n                " + v502.activities.map(p256 => "<option value=\"" + p256.activityTypeCode + "\" " + (p256.activityTypeCode === v502.taxpayerActivityCode ? "selected" : "") + ">" + p256.activityTypeCode + " - " + p256.activityTypeNameSecondaryLang + "</option>").join("") + "\n            </select>\n        </div>" : "<div class=\"details-card-cn\" style=\"padding: 10px 15px;\">ÙƒÙˆØ¯ Ø§Ù„Ù†Ø´Ø§Ø·: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ù†Ø´Ø·Ø©.</div>";
      let vLS8 = "";
      p255.forEach((p257, p258) => {
        const v504 = p257[0];
        vLS8 += "\n           <tbody class=\"credit-note-group\" data-internal-id=\"" + p258 + "\">\n                <tr class=\"credit-note-header-row\">\n                    <td class=\"toggle-details-cn\" style=\"font-weight: bold; font-size: 20px; text-align: center; cursor: pointer;\">+</td>\n                    <td><span contenteditable=\"true\" data-field=\"internalID\">" + p258 + "</span></td>\n                    <td><span contenteditable=\"true\" data-field=\"references\">" + (v504.references || "") + "</span></td>\n                    <td><span contenteditable=\"true\" data-field=\"receiver_id\">" + (v504.receiver_id || "") + "</span></td>\n                    <td><span contenteditable=\"true\" data-field=\"receiver_name\">" + (v504.receiver_name || "") + "</span></td>\n                    <td><button class=\"delete-cn-btn\">&times;</button></td>\n                </tr>\n                <tr class=\"credit-note-details-row\" style=\"display: none;\">\n                    <td colspan=\"6\">\n                        <div class=\"details-wrapper-cn\">\n                            <div class=\"details-grid-cn\">\n                                <div class=\"details-card-cn\">\n                                    <h4 class=\"details-header-cn\">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ¯Ø± (Ø§Ù„Ø¨Ø§Ø¦Ø¹)</h4>\n                                    <table class=\"issuer-details-table-cn details-table-cn\">\n                                        <tbody>\n                                            <tr><th>Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th><td data-issuer-field=\"id\">" + v502.id + "</td></tr>\n                                            <tr><th>Ø§Ø³Ù… Ø§Ù„Ù…ØµØ¯Ø±</th><td data-issuer-field=\"name\">" + v502.name + "</td></tr>\n                                            <tr><th>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</th><td data-issuer-field=\"governate\">" + v502.governate + "</td></tr>\n                                            <tr><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><td data-issuer-field=\"regionCity\">" + v502.regionCity + "</td></tr>\n                                            <tr><th>Ø§Ù„Ø´Ø§Ø±Ø¹</th><td data-issuer-field=\"street\">" + v502.street + "</td></tr>\n                                            <tr><th>Ø§Ù„Ù…Ø¨Ù†Ù‰</th><td data-issuer-field=\"buildingNumber\">" + v502.buildingNumber + "</td></tr>\n                                                    <tr><th>ÙƒÙˆØ¯ Ø§Ù„Ù†Ø´Ø§Ø·</th><td data-issuer-field=\"taxpayerActivityCode\">" + (v504.originalActivityCode || "N/A") + "</td></tr>\n\n                                        </tbody>\n                                    </table>\n                                </div>\n                                <div class=\"details-card-cn\">\n                                    <h4 class=\"details-header-cn\">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù… (Ø§Ù„Ù…Ø´ØªØ±ÙŠ)</h4>\n                                    <table class=\"receiver-details-table-cn details-table-cn\">\n                                        <tbody>\n                                            <tr><th>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ„Ù…</th><td contenteditable=\"true\" data-receiver-field=\"receiver_type\">" + (v504.receiver_type || "B") + "</td></tr>\n                                            <tr><th>Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th><td contenteditable=\"true\" data-receiver-field=\"receiver_id\">" + (v504.receiver_id || "") + "</td></tr>\n                                            <tr><th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…</th><td contenteditable=\"true\" data-receiver-field=\"receiver_name\">" + (v504.receiver_name || "") + "</td></tr>\n                                            <tr><th>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</th><td contenteditable=\"true\" data-receiver-field=\"receiver_governate\">" + (v504.receiver_governate || "") + "</td></tr>\n                                            <tr><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th><td contenteditable=\"true\" data-receiver-field=\"receiver_city\">" + (v504.receiver_city || "") + "</td></tr>\n                                            <tr><th>Ø§Ù„Ø´Ø§Ø±Ø¹</th><td contenteditable=\"true\" data-receiver-field=\"receiver_street\">" + (v504.receiver_street || "") + "</td></tr>\n                                            <tr><th>Ø§Ù„Ù…Ø¨Ù†Ù‰</th><td contenteditable=\"true\" data-receiver-field=\"receiver_building\">" + (v504.receiver_building || "") + "</td></tr>\n                                        </tbody>\n                                    </table>\n                                </div>\n                            </div>\n                            <div class=\"items-card-cn\">\n                                <h4 class=\"details-header-cn\">Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯Ø§Ø¦Ù†</h4>\n                                <div style=\"overflow-x: auto;\">\n                        <table class=\"items-table-cn\">\n    <thead>\n        <tr>\n            <th>ÙˆØµÙ Ø§Ù„ØµÙ†Ù</th><th>ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø³Ù…ÙŠ</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th>\n            <!-- âœ…âœ…âœ… Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¥Ø¶Ø§ÙØ© 2: Ø¥Ø¶Ø§ÙØ© Ø±Ø¤ÙˆØ³ Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø®ØµÙ… --- -->\n            <th>Ø®ØµÙ… (%)</th>\n            <th>Ø®ØµÙ… (Ù‚ÙŠÙ…Ø©)</th>\n            <!-- âœ…âœ…âœ… Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¥Ø¶Ø§ÙØ© 2 --- -->\n            <th>Ø¶Ø±ÙŠØ¨Ø© 1</th><th>Ø¶Ø±ÙŠØ¨Ø© 2</th>\n        </tr>\n    </thead>\n    <tbody>\n    " + p257.map(p259 => "\n        <tr>\n            <td contenteditable=\"true\" data-field=\"item_description\">" + p259.item_description + "</td>\n            <td contenteditable=\"true\" data-field=\"item_code\">" + p259.item_code + "</td>\n            <td style=\"background-color: #f0f8ff;\">" + (p259.officialCodeName || "") + "</td>\n            <td contenteditable=\"true\" data-field=\"quantity\">" + p259.quantity + "</td>\n            <td contenteditable=\"true\" data-field=\"unit_price\">" + p259.unit_price + "</td>\n            <!-- âœ…âœ…âœ… Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¥Ø¶Ø§ÙØ© 3: Ø¥Ø¶Ø§ÙØ© Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø®ØµÙ… --- -->\n            <td contenteditable=\"true\" data-field=\"discount_rate\">" + (p259.discount_rate || "") + "</td>\n            <td contenteditable=\"true\" data-field=\"discount_amount\">" + (p259.discount_amount || "") + "</td>\n            <!-- âœ…âœ…âœ… Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¥Ø¶Ø§ÙØ© 3 --- -->\n            <td><span contenteditable=\"true\" data-field=\"tax_type_1\">" + (p259.tax_type_1 || "") + "</span>/...</td>\n            <td><span contenteditable=\"true\" data-field=\"tax_type_2\">" + (p259.tax_type_2 || "") + "</span>/...</td>\n        </tr>\n    ").join("") + "\n    </tbody>\n</table>\n\n                                </div>\n                            </div>\n                        </div>\n                    </td>\n                </tr>\n            </tbody>\n        ";
      });
      v501.innerHTML = "\n        <div style=\"padding: 15px 25px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; background-color: #fffbe6;\">\n            <h3 style=\"margin: 0; color: #c0392b;\">Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ­ÙØ¸ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¯Ø§Ø¦Ù†Ø©</h3>\n            <div>\n                <button id=\"saveCreditNotesBtn_CN\" style=\"background-color: #28a745; color: white; padding: 10px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;\">Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø©</button>\n                <button id=\"closeCreditNoteEditorBtn_CN\" style=\"background-color: #6c757d; color: white; padding: 10px 25px; border: none; border-radius: 8px; cursor: pointer; margin-right: 10px;\">Ø¥ØºÙ„Ø§Ù‚</button>\n            </div>\n        </div>\n        <div style=\"padding: 10px 25px; background-color: #e9ecef;\">" + v503 + "</div>\n        <div style=\"overflow-y: auto; flex-grow: 1;\">\n            <table class=\"main-cn-table\">\n                <thead>\n                    <tr style=\"background-color: #c0392b; color: white; position: sticky; top: 0; z-index: 10;\">\n                        <th></th><th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ</th><th>UUID Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©</th><th>Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ„Ù…</th><th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…</th><th>Ø­Ø°Ù</th>\n                    </tr>\n                </thead>\n                " + vLS8 + "\n            </table>\n        </div>\n    ";
      v500.appendChild(v501);
      document.body.appendChild(v500);
      const vLSmaincntableWidth100B = "\n        .main-cn-table { width: 100%; border-collapse: collapse; }\n        .credit-note-header-row { background-color: #fff1f1; border-bottom: 2px solid #ffbaba; }\n        .credit-note-header-row td { padding: 12px; vertical-align: middle; text-align: center; }\n        .credit-note-header-row td span { background-color: #fff; padding: 5px; border-radius: 4px; border: 1px dashed #ccc; min-width: 150px; display: inline-block; }\n        .details-wrapper-cn { padding: 20px; background-color: #f9f9f9; border-top: 3px solid #c0392b; }\n        .details-grid-cn { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }\n        .details-card-cn { background: #fff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; }\n        .details-header-cn { color: #c0392b; border-bottom: 2px solid #eee; padding-bottom: 8px; margin-top: 0; margin-bottom: 15px; font-size: 18px; }\n        .details-table-cn { width: 100%; } .details-table-cn th, .details-table-cn td { padding: 8px; text-align: right; border-bottom: 1px solid #f5f5f5; } .details-table-cn tr:last-child td { border-bottom: none; } .details-table-cn th { font-weight: 600; width: 120px; }\n        .items-card-cn { grid-column: 1 / -1; }\n        .items-table-cn { width: 100%; border-collapse: collapse; } .items-table-cn th, .items-table-cn td { border: 1px solid #dee2e6; padding: 8px; text-align: center; } .items-table-cn th { background-color: #e9ecef; }\n        .delete-cn-btn { background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; padding: 4px 8px; }\n    ";
      const v505 = document.createElement("style");
      v505.innerText = vLSmaincntableWidth100B;
      document.head.appendChild(v505);
      document.getElementById("closeCreditNoteEditorBtn_CN").onclick = () => v500.remove();
      document.getElementById("saveCreditNotesBtn_CN").onclick = () => saveCreditNotesFromEditor_CN(p255);
      v500.querySelectorAll(".toggle-details-cn").forEach(p260 => {
        p260.onclick = p261 => {
          const v506 = p261.target.parentElement.nextElementSibling;
          const v507 = v506.style.display !== "none";
          v506.style.display = v507 ? "none" : "table-row";
          p261.target.textContent = v507 ? "+" : "-";
        };
      });
      v500.querySelectorAll(".delete-cn-btn").forEach(p262 => {
        p262.onclick = p263 => {
          p263.target.closest(".credit-note-group").remove();
        };
      });
    }
    async function saveCreditNotesFromEditor_CN(p264) {
      const v508 = document.getElementById("saveCreditNotesBtn_CN");
      v508.disabled = true;
      v508.textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";
      const v509 = await getIssuerFullData();
      if (!v509) {
        alert("ÙØ´Ù„ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ¯Ø± (Ø§Ù„Ø¨Ø§Ø¦Ø¹). Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.");
        v508.disabled = false;
        v508.textContent = "Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø©";
        return;
      }
      const v510 = document.getElementById("activity-select-editor-cn")?.value || v509.taxpayerActivityCode;
      v509.taxpayerActivityCode = v510;
      const vA21 = [];
      for (const [v511, v512] of p264.entries()) {
        const v513 = document.querySelector(".credit-note-group[data-internal-id=\"" + v511 + "\"]");
        if (!v513) {
          continue;
        }
        const v_0x1b6af1 = f68(v512, v509);
        const vV512 = v512;
        vA21.push({
          payload: v_0x1b6af1,
          rawLines: vV512
        });
      }
      let vLN023 = 0;
      const vA22 = [];
      for (const v514 of vA21) {
        const v515 = v514.payload.document.internalID;
        try {
          const v_0x1b6af12 = f68(v514.rawLines, v509, true);
          const v516 = await f111(v_0x1b6af12);
          if (!v516.success) {
            throw new Error(v516.error);
          }
          const v517 = v516.data.draftId;
          const v518 = await updateDraftInvoiceAPI(v517, v514.payload, v514.rawLines);
          if (!v518.success) {
            await deleteDraftInvoiceAPI(v517);
            throw new Error("ÙØ´Ù„ ÙÙŠ Ø¬Ø¹Ù„ Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ø¬Ø§Ù‡Ø²Ø©: " + v518.error);
          }
          vLN023++;
          v508.textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ (" + vLN023 + " / " + vA21.length + ")...";
        } catch (e27) {
          vA22.push({
            id: v515,
            field: "Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…",
            value: "ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸",
            message: e27.message
          });
        }
      }
      v508.disabled = false;
      v508.textContent = "Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø©";
      if (vA22.length > 0) {
        showErrorModal(vA22);
      }
      if (vLN023 > 0) {
        showSuccessModal("Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!", "ØªÙ… Ø­ÙØ¸ " + vLN023 + " Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø§Ø¦Ù† Ø¨Ù†Ø¬Ø§Ø­ ÙƒÙ…Ø³ÙˆØ¯Ø§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¥Ø±Ø³Ø§Ù„.");
        document.getElementById("creditNoteEditorModal")?.remove();
      }
    }
    function f68(p265, p266) {
      const v519 = p265[0];
      const v520 = document.getElementById("creditNoteVersionSelect")?.value || "1.0";
      const v521 = document.getElementById("creditNoteTypeSelect").value;
      const v522 = v520 === "0.9";
      const v523 = v522 ? ["CreditNote"] : v521 === "with_reference" ? ["CreditNote", "SignatureRequired"] : ["SimpleCreditWithoutRef", "SignatureRequired"];
      const v524 = v522 ? [] : [{
        signatureType: "I",
        value: "VGVtcG9yYXJ5IFNpZ25hdHVyZSBIb2xkZXI="
      }];
      const vF17 = p267 => {
        const vO35 = {};
        for (const v525 in p267) {
          vO35[v525] = p267[v525] !== null && p267[v525] !== undefined ? String(p267[v525]) : "";
        }
        return vO35;
      };
      let vLN024 = 0;
      let vLN025 = 0;
      const v526 = new Map();
      const v527 = p265.map(p268 => {
        const vVF17 = vF17(p268);
        const vParseFloat13 = parseFloat((parseFloat(vVF17.quantity) || 0).toFixed(5));
        const vParseFloat14 = parseFloat((parseFloat(vVF17.unit_price) || 0).toFixed(5));
        const vParseFloat15 = parseFloat((vParseFloat13 * vParseFloat14).toFixed(5));
        vLN024 += vParseFloat15;
        const v528 = parseFloat(vVF17.discount_amount) || vParseFloat15 * (parseFloat(vVF17.discount_rate) || 0) / 100;
        vLN025 += v528;
        const vParseFloat16 = parseFloat((vParseFloat15 - v528).toFixed(5));
        const vA23 = [];
        let vLN026 = 0;
        for (let vLN16 = 1; vLN16 <= 2; vLN16++) {
          const v529 = vVF17["tax_type_" + vLN16]?.trim().toUpperCase();
          const v530 = vVF17["tax_rate_" + vLN16];
          if (v529 && v530 && !isNaN(parseFloat(v530))) {
            const vParseFloat17 = parseFloat(v530);
            const vParseFloat18 = parseFloat((vParseFloat16 * (vParseFloat17 / 100)).toFixed(5));
            const v531 = vVF17["tax_subtype_" + vLN16]?.trim() || vO64[v529] || "";
            vA23.push({
              taxType: v529,
              amount: vParseFloat18,
              subType: v531,
              rate: vParseFloat17
            });
            vLN026 += v529 === "T4" ? -vParseFloat18 : vParseFloat18;
            v526.set(v529, (v526.get(v529) || 0) + vParseFloat18);
          }
        }
        const vParseFloat19 = parseFloat((vParseFloat16 + vLN026).toFixed(5));
        return {
          description: f120(vVF17.item_description, 100),
          itemType: vVF17.item_type,
          itemCode: vVF17.item_code,
          unitType: vVF17.unit_type,
          quantity: vParseFloat13,
          unitValue: {
            currencySold: "EGP",
            amountEGP: vParseFloat14
          },
          salesTotal: vParseFloat15,
          netTotal: vParseFloat16,
          total: vParseFloat19,
          taxableItems: vA23,
          internalCode: f120(vVF17.item_internal_code || vVF17.item_code, 50),
          discount: {
            amount: v528
          },
          valueDifference: 0,
          totalTaxableFees: 0,
          itemsDiscount: 0
        };
      });
      const v532 = Array.from(v526, ([v533, v534]) => ({
        taxType: v533,
        amount: parseFloat(v534.toFixed(5))
      }));
      const vParseFloat20 = parseFloat(v527.reduce((p269, p270) => p269 + p270.total, 0).toFixed(5));
      const vO36 = {
        issuer: {
          type: "B",
          id: String(p266.id),
          name: f120(p266.name),
          address: {
            branchID: "0",
            country: "EG",
            governate: f120(p266.governate),
            regionCity: f120(p266.regionCity),
            street: f120(p266.street),
            buildingNumber: String(p266.buildingNumber || "")
          }
        },
        receiver: {
          type: String(v519.receiver_type || "B"),
          id: String(v519.receiver_id),
          name: f120(v519.receiver_name),
          address: {
            country: "EG",
            governate: f120(v519.receiver_governate),
            regionCity: f120(v519.receiver_city),
            street: f120(v519.receiver_street),
            buildingNumber: String(v519.receiver_building || "")
          }
        },
        documentType: "C",
        documentTypeVersion: v520,
        dateTimeIssued: f4(v519.dateTimeIssued),
        taxpayerActivityCode: String(v519.originalActivityCode || p266.taxpayerActivityCode),
        internalID: String(v519.internalID),
        invoiceLines: v527,
        totalSalesAmount: parseFloat(vLN024.toFixed(5)),
        totalDiscountAmount: parseFloat(vLN025.toFixed(5)),
        netAmount: parseFloat((vLN024 - vLN025).toFixed(5)),
        taxTotals: v532,
        totalAmount: vParseFloat20,
        signatures: v524,
        payment: {},
        delivery: {},
        totalItemsDiscountAmount: 0,
        extraDiscountAmount: 0
      };
      if (v521 === "with_reference" && v519.references) {
        vO36.references = [String(v519.references)];
      }
      return {
        tags: v523,
        document: vO36,
        clientsidevalidationresult: true,
        lineItemCodes: p265.map(p271 => ({
          codeType: p271.item_type,
          itemCode: p271.item_code,
          codeNamePrimaryLang: p271.officialCodeName || p271.item_description,
          codeNameSecondaryLang: p271.officialCodeName || p271.item_description
        }))
      };
    }
    function showToastNotification(p272, p273 = 4000) {
      document.getElementById("eta-toast-notification")?.remove();
      const v535 = document.createElement("div");
      v535.id = "eta-toast-notification";
      Object.assign(v535.style, {
        position: "fixed",
        bottom: "20px",
        left: "20px",
        backgroundColor: "#34495e",
        color: "white",
        padding: "16px 24px",
        borderRadius: "10px",
        boxShadow: "0 5px 20px rgba(0, 0, 0, 0.25)",
        zIndex: "20001",
        display: "flex",
        alignItems: "center",
        gap: "15px",
        fontFamily: "'Cairo', 'Segoe UI', sans-serif",
        fontSize: "16px",
        opacity: "0",
        transform: "translateY(20px)",
        transition: "all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1)",
        maxWidth: "400px"
      });
      v535.innerHTML = "\n        <div class=\"toast-spinner\" style=\"width: 22px; height: 22px; border: 3px solid rgba(255, 255, 255, 0.3); border-top-color: #3498db; border-radius: 50%; animation: spin 1s linear infinite; flex-shrink: 0;\"></div>\n        <div id=\"toast-message-content\" style=\"line-height: 1.5;\">" + p272 + "</div>\n    ";
      const v536 = document.createElement("style");
      v536.innerText = "@keyframes spin { to { transform: rotate(360deg); } }";
      document.head.appendChild(v536);
      document.body.appendChild(v535);
      setTimeout(() => {
        v535.style.opacity = "1";
        v535.style.transform = "translateY(0)";
      }, 10);
      let v537 = null;
      if (p273 > 0) {
        v537 = setTimeout(() => v535.remove(), p273);
      }
      v535.update = (p274, p275 = p273) => {
        const v538 = v535.querySelector("#toast-message-content");
        if (v538) {
          v538.innerHTML = p274;
        }
        clearTimeout(v537);
        if (p275 > 0) {
          v537 = setTimeout(() => v535.remove(), p275);
        }
      };
      v535.updateProgress = (p276, p277) => {
        const v539 = Math.round(p276 / p277 * 100);
        v535.update("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸... (" + p276 + " / " + p277 + ") - " + v539 + "%");
      };
      v535.success = (p278, p279 = 3000) => {
        v535.querySelector(".toast-spinner").style.display = "none";
        v535.style.backgroundColor = "#27ae60";
        v535.update("âœ… " + p278, p279);
      };
      v535.error = (p280, p281 = 5000) => {
        v535.querySelector(".toast-spinner").style.display = "none";
        v535.style.backgroundColor = "#c0392b";
        v535.update("âŒ " + p280, p281);
      };
      v535.removeToast = () => {
        v535.style.opacity = "0";
        v535.style.transform = "translateY(20px)";
        setTimeout(() => {
          v535.remove();
          v536.remove();
        }, 500);
      };
      return v535;
    }
    async function f70() {
      const v540 = document.getElementById("panel-drafts");
      if (v540) {
        v540.innerHTML = "\n            <div class=\"panel-header\">\n                <h2>Ø¹Ø±Ø¶ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ÙˆØ¯Ø§Øª</h2>\n                <p>Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙƒÙ…Ø³ÙˆØ¯Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ© ÙˆØªØ¹Ø¯ÙŠÙ„Ù‡Ø§.</p>\n            </div>\n            <div class=\"panel-body\" style=\"text-align: center;\">\n                <button id=\"showDraftsBtn\" class=\"action-button drafts-btn-main\">\n                    <span class=\"btn-icon\">ğŸ”</span> Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ù…Ø³ÙˆØ¯Ø§Øª Ø§Ù„Ø¢Ù†\n                </button>\n            </div>\n        ";
        document.getElementById("showDraftsBtn").addEventListener("click", showAllDraftsInEditor);
      }
      populateCreditNoteTab();
      const v541 = document.getElementById("panel-taxpayer-query");
      if (v541) {
        v541.innerHTML = "\n            <div class=\"panel-header\">\n                <h2>Ù…Ø³ØªÙƒØ´Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù…ÙˆÙ„ÙŠÙ†</h2>\n                <p>ÙˆØ§Ø¬Ù‡Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù…ÙˆÙ„ÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† Ø¨Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø©.</p>\n            </div>\n            <div class=\"query-container\">\n                <input type=\"text\" id=\"taxpayerQueryInput\" placeholder=\"Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù‡Ù†Ø§...\">\n                <button id=\"taxpayerQueryBtn\">Ø¨Ø­Ø«</button>\n            </div>\n            <div id=\"queryResultContainer\">\n                <div class=\"query-placeholder\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M18.031 16.6168L22.3137 20.8995L20.8995 22.3137L16.6168 18.031C15.0769 19.263 13.125 20 11 20C6.02944 20 2 15.9706 2 11C2 6.02944 6.02944 2 11 2C15.9706 2 20 6.02944 20 11C20 13.125 19.263 15.0769 18.031 16.6168ZM16.0247 15.8748C17.2475 14.6146 18 12.8956 18 11C18 7.13401 14.866 4 11 4C7.13401 4 4 7.13401 4 11C4 14.866 7.13401 18 11 18C12.8956 18 14.6146 17.2475 15.8748 16.0247L16.0247 15.8748Z\"></path></svg>\n                    Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ù„Ù„Ø¨Ø¯Ø¡...\n                </div>\n            </div>\n        ";
        const v542 = document.getElementById("taxpayerQueryBtn");
        const v543 = document.getElementById("taxpayerQueryInput");
        const v544 = document.getElementById("queryResultContainer");
        v542.addEventListener("click", async () => {
          const v545 = v543.value.trim();
          if (!v545) {
            alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹.");
            return;
          }
          v544.innerHTML = "<div class=\"query-placeholder\">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</div>";
          const v546 = await fetchTaxpayerData(v545);
          if (v546) {
            let v547 = "<div class=\"profile-card\"><div class=\"card-header\"><span class=\"icon\">ğŸ‘¤</span><h3>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ù„Ù„Ù…Ù…ÙˆÙ„</h3></div><div class=\"card-body\">" + createInfoField("ğŸ†”", v546.registrationNumber, true) + createInfoField("ğŸ¢", v546.namePrimaryLang) + createInfoField("âœ‰ï¸", v546.email, true) + createInfoField("ğŸš¦", v546.isActive ? "Ù†Ø´Ø·" : "ØºÙŠØ± Ù†Ø´Ø·", false, true) + "</div></div>";
            if (v546.taxpayerBranchs && v546.taxpayerBranchs.length > 0) {
              v546.taxpayerBranchs.forEach((p282, p283) => {
                const v548 = p282.address || {};
                v547 += "<div class=\"branch-card\"><div class=\"card-header\"><span class=\"icon\">ğŸ“</span><h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±Ø¹ " + (p283 + 1) + " (Ø±Ù‚Ù…: " + p282.branchNumber + ")</h3></div><div class=\"card-body\">" + createInfoField("ğŸ›ï¸", v548.governorateNameSecondaryLang) + createInfoField("ğŸ™ï¸", v548.cityNameSecondaryLang) + createInfoField("ğŸ›£ï¸", v548.streetName) + createInfoField("ğŸ”¢", v548.buildingNo) + "</div></div>";
                if (p282.taxpayerActivities && p282.taxpayerActivities.length > 0) {
                  p282.taxpayerActivities.forEach(p284 => {
                    v547 += "<div class=\"activity-card\"><div class=\"card-header\"><span class=\"icon\">ğŸ’¼</span><h3>Ù†Ø´Ø§Ø· Ù…Ø³Ø¬Ù„ (ÙƒÙˆØ¯: " + p284.activityTypeCode + ")</h3></div><div class=\"card-body\">" + createInfoField("ğŸ“", p284.activityTypeNameSecondaryLang) + createInfoField("ğŸ“…", "ÙŠØ¨Ø¯Ø£ ÙÙŠ: " + new Date(p284.fromDate).toLocaleDateString("ar-EG")) + createInfoField("ğŸ", p284.toDate ? "ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ: " + new Date(p284.toDate).toLocaleDateString("ar-EG") : "Ø§Ù„Ø­Ø§Ù„Ø©: Ø³Ø§Ø±ÙŠ") + "</div></div>";
                  });
                }
              });
            }
            v544.innerHTML = v547;
          } else {
            v544.innerHTML = "<div class=\"query-placeholder\">ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø±Ù‚Ù…: " + v545 + ". ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø±Ù‚Ù….</div>";
          }
        });
      }
      setupCodesExplorerTab();
    }
    if (p209) {
      f70();
      f71(document.getElementById("panel-create"));
      setTimeout(() => v438.querySelector(".sidebar-btn[data-target=\"panel-create\"]")?.click(), 100);
    } else {
      f17(document.getElementById("panel-subscription"));
      setTimeout(() => v438.querySelector(".sidebar-btn[data-target=\"panel-subscription\"]")?.click(), 100);
    }
    document.getElementById("closeInvoiceCreatorBtn").addEventListener("click", () => v438.remove());
    makeDraggable(v438, v438.querySelector(".sidebar"));
    const v549 = v438.querySelectorAll(".sidebar-btn");
    const v550 = v438.querySelectorAll(".panel-content");
    const v551 = document.getElementById("info-sidebar");
    v549.forEach(p285 => {
      p285.addEventListener("click", async () => {
        const v552 = p285.getAttribute("data-target");
        const vA24 = ["panel-create", "panel-credit-note"];
        if (vA24.includes(v552)) {
          const v553 = await signDataLocally();
          if (!v553) {
            f2();
            return;
          }
        }
        v549.forEach(p286 => p286.classList.remove("active"));
        v550.forEach(p287 => p287.classList.remove("active"));
        p285.classList.add("active");
        const v554 = document.getElementById(v552);
        v554.classList.add("active");
        if (v552 === "panel-create" && v554.innerHTML.trim() === "") {
          console.log("Building 'Create Invoice' tab content now...");
          f71(v554);
        }
        const vA25 = ["panel-create", "panel-drafts"];
        v551.style.display = vA25.includes(v552) ? "flex" : "none";
      });
    });
    function f71(p288) {
      if (!p288) {
        return;
      }
      p288.innerHTML = "\n        <div class=\"panel-header\"><h2>Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ù…Ù„Ù Excel</h2><p>Ø§ØªØ¨Ø¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø£Ùˆ Ø£ÙƒØ«Ø± Ø¨Ø³Ø±Ø¹Ø©.</p></div>\n        <div class=\"content-step\"><label class=\"content-label\">Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ø®ØªØ± Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø³ØªÙ†Ø¯</label><select id=\"invoiceVersionSelect\" class=\"content-select\"><option value=\"1.0\" selected>Ø¥ØµØ¯Ø§Ø± 1.0 (Ù…Ø³ØªÙ†Ø¯ Ù†Ù‡Ø§Ø¦ÙŠ ÙˆÙ…ÙˆÙ‚Ø¹)</option><option value=\"0.9\">Ø¥ØµØ¯Ø§Ø± 0.9 (Ù…Ø³ÙˆØ¯Ø© ØºÙŠØ± Ù…ÙˆÙ‚Ø¹Ø©)</option></select></div>\n        <div class=\"content-step\"><label class=\"content-label\">Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label><div id=\"invoiceTypeSelector\" class=\"button-group\" style=\"justify-content: center;\"><button class=\"action-button invoice-type-btn active\" data-type=\"FullInvoice\" style=\"background-color: #3b82f6;\">ÙØ§ØªÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (ÙƒØ§Ù…Ù„Ø©)</button><button class=\"action-button invoice-type-btn\" data-type=\"SimpleInvoice\" style=\"background-color: #6b7280;\">ÙØ§ØªÙˆØ±Ø© Ø¨Ø³ÙŠØ·Ø©</button></div><p style=\"font-size: 13px; color: #555; text-align: center; margin-top: 8px;\">Ø§Ø®ØªØ± \"ÙƒØ§Ù…Ù„Ø©\" Ù„ØªØ¶Ù…ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ§Ù„Ø¨Ù†ÙƒØŒ Ø£Ùˆ \"Ø¨Ø³ÙŠØ·Ø©\" Ù„Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø³Ø±ÙŠØ¹Ø©.</p></div>\n        <div class=\"content-step\">\n            <label class=\"content-label\">Ø§Ù„Ø®Ø·ÙˆØ© 3: ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØ±ÙØ¹ Ø§Ù„Ù…Ù„Ù</label>\n            <div class=\"button-group\">\n                <button id=\"dynamicDownloadTemplateBtn\" class=\"action-button download-btn\">\n                    <span class=\"btn-icon\">ğŸ“¥</span> ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ Excel Ø§Ù„Ø°ÙƒÙŠ\n                </button>\n                <label for=\"excelUploadInput\" class=\"action-button upload-btn\">\n                    <span class=\"btn-icon\">ğŸ“‚</span> Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©\n                </label>\n                <input type=\"file\" id=\"excelUploadInput\" accept=\".xlsx, .xls\" style=\"display: none;\">\n            </div>\n        </div>\n    ";
      document.getElementById("dynamicDownloadTemplateBtn").addEventListener("click", downloadExcelTemplate_v3);
      document.getElementById("excelUploadInput").addEventListener("change", handleExcelUpload_v3);
      document.querySelectorAll(".invoice-type-btn").forEach(p289 => {
        p289.addEventListener("click", function () {
          document.querySelectorAll(".invoice-type-btn").forEach(p290 => {
            p290.classList.remove("active");
            p290.style.backgroundColor = "#6b7280";
          });
          this.classList.add("active");
          this.style.backgroundColor = "#3b82f6";
        });
      });
    }
    (async function displayTaxpayerInfoInBox() {
      const v555 = v438.querySelector("#taxpayer-info-box .card-body");
      try {
        const v556 = await getIssuerFullData();
        if (v556) {
          v555.innerHTML = "<p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> " + (v556.name || "ØºÙŠØ± Ù…ØªÙˆÙØ±") + "</p><p><strong>Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</strong> " + (v556.id || "ØºÙŠØ± Ù…ØªÙˆÙØ±") + "</p><p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> " + (v556.street || "") + ", " + (v556.regionCity || "") + "</p>";
        } else {
          throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù…ÙˆÙ„.");
        }
      } catch (e28) {
        v555.innerHTML = "<p style=\"color: red;\">ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: " + e28.message + "</p>";
      }
    })();
    setupCodesExplorerTab();
    setTimeout(() => {
      const v557 = document.querySelector(".sidebar-btn");
      if (v557) {
        v557.click();
      }
    }, 50);
  }
  async function fetchTaxpayerData(p291) {
    const v_0x57971a7 = getAccessToken();
    if (!v_0x57971a7) {
      return null;
    }
    const v558 = String(p291 || "").trim();
    if (!v558) {
      return null;
    }
    const v559 = "https://api-portal.invoicing.eta.gov.eg/api/v1/taxpayers/" + v558 + "/light";
    try {
      const v560 = await fetch(v559, {
        headers: {
          Authorization: "Bearer " + v_0x57971a7,
          Accept: "application/json"
        }
      });
      if (v560.ok) {
        const v561 = await v560.json();
        if (v561.error) {
          return null;
        }
        const v562 = vLSAr === "ar";
        if (v562 && v561.nameSecondaryLang) {
          v561.namePrimaryLang = v561.nameSecondaryLang;
          if (v561.taxpayerBranchs && v561.taxpayerBranchs[0]?.address) {
            v561.taxpayerBranchs[0].address.governorateNamePrimaryLang = v561.taxpayerBranchs[0].address.governorateNameSecondaryLang;
            v561.taxpayerBranchs[0].address.cityNamePrimaryLang = v561.taxpayerBranchs[0].address.cityNameSecondaryLang;
          }
        }
        return v561;
      }
      return null;
    } catch (e29) {
      return null;
    }
  }
  function f74(p292, p293 = 0) {
    const v563 = document.getElementById("non-blocking-toast");
    if (v563) {
      v563.remove();
    }
    const v564 = document.createElement("div");
    v564.id = "non-blocking-toast";
    Object.assign(v564.style, {
      position: "fixed",
      bottom: "20px",
      left: "20px",
      backgroundColor: "#2c3e50",
      color: "white",
      padding: "15px 25px",
      borderRadius: "8px",
      boxShadow: "0 4px 15px rgba(0, 0, 0, 0.2)",
      zIndex: "10006",
      display: "flex",
      alignItems: "center",
      gap: "15px",
      fontFamily: "'Cairo', 'Segoe UI', sans-serif",
      fontSize: "16px",
      opacity: "0",
      transform: "translateY(20px)",
      transition: "opacity 0.4s ease, transform 0.4s ease"
    });
    v564.innerHTML = "\n        <div class=\"toast-spinner\" style=\"\n            width: 20px; \n            height: 20px; \n            border: 3px solid rgba(255, 255, 255, 0.3); \n            border-top-color: #3498db; \n            border-radius: 50%; \n            animation: spin 1s linear infinite;\n        \"></div>\n        <span id=\"toast-message\">" + p292 + "</span>\n    ";
    const v565 = document.createElement("style");
    v565.innerText = "@keyframes spin { to { transform: rotate(360deg); } }";
    document.head.appendChild(v565);
    document.body.appendChild(v564);
    setTimeout(() => {
      v564.style.opacity = "1";
      v564.style.transform = "translateY(0)";
    }, 10);
    if (p293 > 0) {
      setTimeout(() => {
        v564.style.opacity = "0";
        v564.style.transform = "translateY(20px)";
        setTimeout(() => v564.remove(), 400);
      }, p293);
    }
    return v564;
  }
  async function fetchDraftInvoices() {
    const v_0x57971a8 = getAccessToken();
    if (!v_0x57971a8) {
      alert("Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙˆÙƒÙ† Ø§Ù„Ø¯Ø®ÙˆÙ„. ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.");
      return null;
    }
    try {
      const v566 = await fetch("https://api-portal.invoicing.eta.gov.eg/api/v1/documents/drafts?OrderBy=lastModificationDateTimeUtc", {
        headers: {
          Authorization: "Bearer " + v_0x57971a8,
          Accept: "application/json"
        }
      });
      if (!v566.ok) {
        throw new Error("ÙØ´Ù„ Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ÙˆØ¯Ø§Øª. Ø±Ù…Ø² Ø§Ù„Ø­Ø§Ù„Ø©: " + v566.status);
      }
      const v567 = await v566.json();
      return v567.result;
    } catch (e30) {
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³ÙˆØ¯Ø§Øª: " + e30.message);
      return null;
    }
  }
  async function fetchSingleDraftDetails(p294) {
    const v_0x57971a9 = getAccessToken();
    if (!v_0x57971a9) {
      return null;
    }
    try {
      const v568 = await fetch("https://api-portal.invoicing.eta.gov.eg/api/v1/documents/drafts/" + p294, {
        headers: {
          Authorization: "Bearer " + v_0x57971a9
        }
      });
      if (!v568.ok) {
        return null;
      }
      return await v568.json();
    } catch (e31) {
      return null;
    }
  }
  function f107(p295) {
    const v569 = p295.document;
    if (!v569) {
      return [];
    }
    const vO37 = {
      internalID: v569.internalID,
      receiver_id: v569.receiver.id,
      receiver_name: v569.receiver.name,
      receiver_type: v569.receiver.type,
      receiver_country: v569.receiver.address?.country,
      receiver_governate: v569.receiver.address?.governate,
      receiver_city: v569.receiver.address?.regionCity,
      receiver_street: v569.receiver.address?.street,
      receiver_building: v569.receiver.address?.buildingNumber,
      purchaseOrderReference: v569.purchaseOrderReference,
      purchaseOrderDescription: v569.purchaseOrderDescription,
      salesOrderReference: v569.salesOrderReference,
      salesOrderDescription: v569.salesOrderDescription,
      bankName: v569.payment?.bankName,
      bankAccountNo: v569.payment?.bankAccountNo,
      deliveryApproach: v569.delivery?.approach,
      deliveryPackaging: v569.delivery?.packaging
    };
    return v569.invoiceLines.map(p296 => {
      const vO38 = {
        ...vO37,
        item_description: p296.description,
        item_type: p296.itemType,
        item_code: p296.itemCode,
        item_internal_code: p296.internalCode,
        unit_type: p296.unitType,
        quantity: p296.quantity,
        unit_price: p296.unitValue.amountEGP,
        currency_sold: p296.unitValue.currencySold,
        exchange_rate: p296.unitValue.currencyExchangeRate,
        discount_rate: p296.discount?.rate,
        discount_amount: p296.discount?.amount
      };
      p296.taxableItems.forEach((p297, p298) => {
        if (p298 < 3) {
          vO38["tax_type_" + (p298 + 1)] = p297.taxType;
          vO38["tax_subtype_" + (p298 + 1)] = p297.subType;
          vO38["tax_rate_" + (p298 + 1)] = p297.rate;
        }
      });
      return vO38;
    });
  }
  async function showAllDraftsInEditor() {
    const v570 = await fetchDraftInvoices();
    if (!v570 || v570.length === 0) {
      alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ ÙÙˆØ§ØªÙŠØ± ÙÙŠ Ø§Ù„Ù…Ø³ÙˆØ¯Ø§Øª.");
      return;
    }
    const v571 = document.createElement("div");
    v571.id = "draftsLoadingIndicator";
    v571.style.cssText = "position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); color: white; display: flex; align-items: center; justify-content: center; z-index: 10005; font-size: 24px;";
    v571.textContent = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ " + v570.length + " Ù…Ø³ÙˆØ¯Ø©...";
    document.body.appendChild(v571);
    const v572 = v570.map(p299 => fetchSingleDraftDetails(p299.id));
    const v573 = await Promise.all(v572);
    let vA26 = [];
    for (const v574 of v573) {
      if (v574) {
        const vF77 = f107(v574);
        vA26.push(...vF77);
      }
    }
    v571.remove();
    if (vA26.length === 0) {
      alert("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ÙˆØ¯Ø§Øª Ø£Ùˆ Ø£Ù†Ù‡Ø§ ÙØ§Ø±ØºØ©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
      return;
    }
    f100(vA26);
  }
  function makeDraggable(p300, p301) {
    let vLN027 = 0;
    let vLN028 = 0;
    let vLN029 = 0;
    let vLN030 = 0;
    let v575 = true;
    (p301 || p300).onmousedown = f80;
    function f80(p302) {
      p302 = p302 || window.event;
      p302.preventDefault();
      vLN029 = p302.clientX;
      vLN030 = p302.clientY;
      if (v575) {
        const v576 = p300.getBoundingClientRect();
        p300.style.top = v576.top + "px";
        p300.style.left = v576.left + "px";
        p300.style.transform = "none";
        v575 = false;
      }
      document.onmouseup = f82;
      document.onmousemove = f81;
    }
    function f81(p303) {
      p303 = p303 || window.event;
      p303.preventDefault();
      vLN027 = vLN029 - p303.clientX;
      vLN028 = vLN030 - p303.clientY;
      vLN029 = p303.clientX;
      vLN030 = p303.clientY;
      p300.style.top = p300.offsetTop - vLN028 + "px";
      p300.style.left = p300.offsetLeft - vLN027 + "px";
    }
    function f82() {
      document.onmouseup = null;
      document.onmousemove = null;
    }
  }
  function getAccessToken() {
    try {
      const v577 = JSON.parse(localStorage.getItem("USER_DATA") || sessionStorage.getItem("USER_DATA") || "{}");
      return v577?.access_token || null;
    } catch {
      return null;
    }
  }
  async function handleExcelUpload_v3(p304) {
    const v578 = p304.target.files[0];
    if (!v578) {
      return;
    }
    const vF74 = f74("Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù ÙˆØªØ±Ø¬Ù…Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...");
    const v579 = new FileReader();
    v579.onload = async function (p305) {
      try {
        const v580 = new ExcelJS.Workbook();
        await v580.xlsx.load(p305.target.result);
        const v581 = v580.getWorksheet(1);
        const vA27 = [];
        v581.eachRow({
          includeEmpty: false
        }, (p306, p307) => {
          if (p307 > 1) {
            const v582 = p306.values.slice(1);
            const v583 = v582.map(p308 => p308 instanceof Date ? new Date(Date.UTC(p308.getFullYear(), p308.getMonth(), p308.getDate())) : p308);
            vA27.push(v583);
          }
        });
        if (vA27.length === 0) {
          throw new Error("Ø§Ù„Ù…Ù„Ù ÙØ§Ø±Øº Ø£Ùˆ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª.");
        }
        const v584 = vA27.map(p309 => {
          const vA28 = [...p309];
          if (vA28[5] && vO63.receiverTypes[vA28[5]]) {
            vA28[5] = vO63.receiverTypes[vA28[5]];
          }
          if (vA28[6] && vO63.countries[vA28[6]]) {
            vA28[6] = vO63.countries[vA28[6]];
          }
          if (vA28[18] && vO63.currencies[vA28[18]]) {
            vA28[18] = vO63.currencies[vA28[18]];
          }
          if (vA28[15] && vO63.units[vA28[15]]) {
            vA28[15] = vO63.units[vA28[15]];
          }
          const vA29 = [{
            main: 22,
            sub: 23
          }, {
            main: 25,
            sub: 26
          }, {
            main: 28,
            sub: 29
          }];
          vA29.forEach(p310 => {
            const v585 = vA28[p310.main];
            const v586 = vA28[p310.sub];
            if (v585 && vO63.taxTypes[v585]) {
              vA28[p310.main] = vO63.taxTypes[v585];
            }
            if (v586 && vO63.taxSubtypes[v586]) {
              vA28[p310.sub] = vO63.taxSubtypes[v586];
            }
          });
          return vA28;
        });
        const v_0x2d6384 = f91(v584);
        vF74.querySelector("#toast-message").textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
        const {
          validatedData: _0x65e72d,
          validationErrors: _0x582360
        } = await validateAndEnrichData(v_0x2d6384);
        showRawDataPreview(_0x65e72d, _0x582360);
      } catch (e32) {
        alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù: " + e32.message);
      } finally {
        vF74.remove();
        p304.target.value = "";
      }
    };
    v579.readAsArrayBuffer(v578);
  }
  async function validateAndEnrichData(p311) {
    const vA30 = [];
    const vA31 = [...p311];
    async function validateNID_API(p312) {
      if (!p312 || p312.length !== 14 || !/^\d+$/.test(p312)) {
        return {
          valid: false,
          message: "ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ† Ù…Ù† 14 Ø±Ù‚Ù…Ù‹Ø§ ØµØ­ÙŠØ­Ù‹Ø§."
        };
      }
      try {
        const vF83 = getAccessToken();
        if (!vF83) {
          return {
            valid: false,
            message: "Ø®Ø·Ø£ Ù…ØµØ§Ø¯Ù‚Ø©ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ­Ù‚Ù‚."
          };
        }
        const v587 = await fetch("https://api-portal.invoicing.eta.gov.eg/api/v1/person/" + p312, {
          headers: {
            Authorization: "Bearer " + vF83
          }
        });
        if (v587.status === 200) {
          const v588 = await v587.json();
          const v589 = ((v588.firstName || "") + " " + (v588.otherNames || "")).trim();
          return {
            valid: true,
            name: v589 || "Unnamed Person"
          };
        } else if (v587.status === 400) {
          const v590 = await v587.json();
          return {
            valid: false,
            message: v590.error?.details[0]?.message || "Ø±Ù‚Ù… Ù‚ÙˆÙ…ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­."
          };
        } else {
          return {
            valid: false,
            message: "Ø®Ø·Ø£ " + v587.status + " Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…."
          };
        }
      } catch (e33) {
        return {
          valid: false,
          message: "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ© Ù„Ù„ØªØ­Ù‚Ù‚."
        };
      }
    }
    async function f87(p313) {
      const vF832 = getAccessToken();
      if (!vF832) {
        return null;
      }
      const v591 = String(p313 || "").trim();
      if (!v591) {
        return null;
      }
      const v592 = "https://api-portal.invoicing.eta.gov.eg/api/v1/taxpayers/" + v591 + "/light";
      try {
        const v593 = await fetch(v592, {
          headers: {
            Authorization: "Bearer " + vF832,
            Accept: "application/json"
          }
        });
        if (v593.ok) {
          const v594 = await v593.json();
          if (v594.error) {
            return null;
          }
          const v595 = vLSAr === "ar";
          if (v595 && v594.nameSecondaryLang) {
            v594.namePrimaryLang = v594.nameSecondaryLang;
            if (v594.taxpayerBranchs && v594.taxpayerBranchs[0]?.address) {
              v594.taxpayerBranchs[0].address.governorateNamePrimaryLang = v594.taxpayerBranchs[0].address.governorateNameSecondaryLang;
              v594.taxpayerBranchs[0].address.cityNamePrimaryLang = v594.taxpayerBranchs[0].address.cityNameSecondaryLang;
            }
          }
          return v594;
        }
        return null;
      } catch (e34) {
        return null;
      }
    }
    async function fetchMyEGSCode(p314) {
      const vF833 = getAccessToken();
      if (!vF833) {
        return null;
      }
      const v596 = String(p314 || "").trim().toUpperCase();
      if (!v596 || !v596.startsWith("EG-")) {
        return null;
      }
      const v597 = "https://api-portal.invoicing.eta.gov.eg/api/v1/codetypes/codes/my?CodeTypeID=9&ItemCode=" + v596 + "&Ps=100";
      try {
        const v598 = await fetch(v597, {
          headers: {
            Authorization: "Bearer " + vF833
          }
        });
        if (!v598.ok) {
          return null;
        }
        const v599 = await v598.json();
        return v599.result || [];
      } catch (e35) {
        return null;
      }
    }
    async function fetchGS1Code(p315) {
      const vF834 = getAccessToken();
      if (!vF834) {
        return [];
      }
      const v600 = "https://api-portal.invoicing.eta.gov.eg/api/v1/codetypes/2/codes?CodeLookupValue=" + p315 + "&ApplyMinChoiceLevel=true&Ps=100";
      for (let vLN17 = 1; vLN17 <= 3; vLN17++) {
        try {
          const v601 = await fetch(v600, {
            headers: {
              Authorization: "Bearer " + vF834
            }
          });
          if (v601.ok) {
            const v602 = await v601.json();
            if (v602.result && v602.result.length > 0) {
              const v603 = vLSAr === "ar";
              v602.result.forEach(p316 => {
                if (v603 && p316.codeNameSecondaryLang) {
                  p316.codeNamePrimaryLang = p316.codeNameSecondaryLang;
                }
              });
              return v602.result;
            }
          } else {}
        } catch (e36) {}
        if (vLN17 < 3) {
          await new Promise(p317 => setTimeout(p317, 1000));
        }
      }
      return [];
    }
    const v604 = new Map();
    vA31.forEach(p318 => {
      const v605 = String(p318[12] || "").toUpperCase().trim();
      const v606 = String(p318[13] || "").trim();
      if ((v605 === "EGS" || v605 === "GS1") && v606) {
        const v607 = v605 + "_" + v606;
        if (!v604.has(v607)) {
          v604.set(v607, {
            type: v605,
            code: v606,
            result: null
          });
        }
      }
    });
    if (v604.size > 0) {
      const vLN102 = 10;
      const v608 = Array.from(v604.values());
      for (let vLN031 = 0; vLN031 < v608.length; vLN031 += vLN102) {
        const v609 = v608.slice(vLN031, vLN031 + vLN102);
        const v610 = v609.map(p319 => p319.type === "EGS" ? fetchMyEGSCode(p319.code) : fetchGS1Code(p319.code));
        const v611 = await Promise.all(v610);
        v611.forEach((p320, p321) => {
          const v612 = v609[p321];
          const v613 = v612.type + "_" + v612.code;
          if (v604.has(v613)) {
            v604.get(v613).result = p320;
          }
        });
        await new Promise(p322 => setTimeout(p322, 50));
      }
    }
    const v614 = vA31.map(async (p323, p324) => {
      if (p323.length < 40) {
        p323[39] = "";
      }
      const v615 = p323[0] || "ØµÙ " + (p324 + 2);
      const v616 = String(p323[5] || "").toUpperCase().trim();
      let v617 = String(p323[3] || "").trim();
      if (v616 === "P") {
        if (!v617) {
          p323[3] = "27001071000000";
          if (!p323[4] || String(p323[4]).trim() === "") {
            p323[4] = "Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ";
          }
        } else {
          const v618 = await validateNID_API(v617);
          if (!v618.valid) {
            vA30.push({
              id: v615,
              field: "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø³ØªÙ„Ù…",
              value: v617,
              message: v618.message
            });
          }
        }
      } else if (v616 === "B") {
        if (!v617) {
          vA30.push({
            id: v615,
            field: "Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ„Ù…",
            value: "ÙØ§Ø±Øº",
            message: "Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ Ù„Ù„Ø´Ø±ÙƒØ§Øª."
          });
        } else {
          const v619 = await f87(v617);
          if (v619) {
            p323[4] = v619.namePrimaryLang;
            const v620 = v619.taxpayerBranchs?.[0]?.address;
            if (v620) {
              if (!p323[6] || String(p323[6]).trim() === "") {
                p323[6] = v620.countryCode || "EG";
              }
              if (!p323[7] || String(p323[7]).trim() === "") {
                p323[7] = v620.governorateNameSecondaryLang || v620.governorate || "";
              }
              if (!p323[8] || String(p323[8]).trim() === "") {
                p323[8] = v620.cityNameSecondaryLang || v620.regionCity || "";
              }
              if (!p323[9] || String(p323[9]).trim() === "") {
                p323[9] = v620.streetName || v620.street || "";
              }
              if (!p323[10] || String(p323[10]).trim() === "") {
                p323[10] = v620.buildingNo || v620.buildingNumber || "";
              }
            }
          } else {
            vA30.push({
              id: v615,
              field: "Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ„Ù…",
              value: v617,
              message: "Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ ØºÙŠØ± Ù…Ø³Ø¬Ù„."
            });
          }
        }
      }
      const v621 = String(p323[12] || "").toUpperCase().trim();
      const v622 = String(p323[13] || "").trim();
      let vLS9 = "";
      if (v621 && v622) {
        const v623 = v621 + "_" + v622;
        const v624 = v604.get(v623)?.result;
        if (v624 && Array.isArray(v624)) {
          const v625 = v624.find(p325 => p325.codeLookupValue.toUpperCase() === v622.toUpperCase());
          if (v625) {
            const v626 = new Date();
            v626.setHours(0, 0, 0, 0);
            const v627 = v625.activeTo ? new Date(v625.activeTo) : null;
            if (v627) {
              v627.setHours(0, 0, 0, 0);
            }
            if (v625.active === false) {
              vA30.push({
                id: v615,
                field: "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (" + v621 + ")",
                value: v622,
                message: "Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± Ù†Ø´Ø· Ø­Ø§Ù„ÙŠØ§Ù‹ (active: false)."
              });
            } else if (v627 && v627 < v626) {
              vA30.push({
                id: v615,
                field: "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (" + v621 + ")",
                value: v622,
                message: "Ø§Ù„ÙƒÙˆØ¯ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ù…Ù†Ø° ØªØ§Ø±ÙŠØ® " + v627.toLocaleDateString("ar-EG") + "."
              });
            } else {
              vLS9 = v625.codeNamePrimaryLang;
              p323[39] = vLS9 || "!! Ø§Ø³Ù… Ø±Ø³Ù…ÙŠ ØºÙŠØ± Ù…Ø³Ø¬Ù„ !!";
            }
          } else {
            vA30.push({
              id: v615,
              field: "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (" + v621 + ")",
              value: v622,
              message: "Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ ØºÙŠØ± Ù…Ø³Ø¬Ù„ (Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªØ·Ø§Ø¨Ù‚ ØªØ§Ù…)."
            });
          }
        } else {
          vA30.push({
            id: v615,
            field: "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (" + v621 + ")",
            value: v622,
            message: "ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…."
          });
        }
      }
    });
    await Promise.all(v614);
    return {
      validatedData: vA31,
      validationErrors: vA30
    };
  }
  function createLoadingIndicator(p326) {
    const v628 = document.createElement("div");
    v628.id = "globalLoadingIndicator";
    v628.style.cssText = "\n        position: fixed; top: 0; left: 0; width: 100%; height: 100%; \n        background: rgba(0,0,0,0.7); color: white; \n        display: flex; align-items: center; justify-content: center; \n        z-index: 10005; font-size: 22px; font-family: 'Segoe UI', Tahoma, sans-serif;\n        text-align: center; padding: 20px;\n    ";
    v628.textContent = p326;
    return v628;
  }
  function f91(p327) {
    let vA32 = [];
    const vLN9 = 9;
    const vLN92 = 9;
    const itemCodeColumn = 11;
    const v629 = p327.map((p328, p329) => {
      const v630 = p328[vLN92] !== undefined && p328[vLN92] !== null && String(p328[vLN92]).trim() !== "";
      const v631 = p328[itemCodeColumn] !== undefined && p328[itemCodeColumn] !== null && String(p328[itemCodeColumn]).trim() !== "";
      if (!v630 && !v631) {
        return null;
      }
      const v632 = p328[0] !== undefined && p328[0] !== null && String(p328[0]).trim() !== "";
      if (v632) {
        vA32 = p328.slice(0, vLN9);
        return p328;
      } else {
        if (vA32.length === 0) {
          return null;
        }
        const vA33 = [...vA32];
        for (let vVLN9 = vLN9; vVLN9 < p328.length; vVLN9++) {
          vA33[vVLN9] = p328[vVLN9];
        }
        return vA33;
      }
    }).filter(p330 => p330 !== null);
    return v629;
  }
  async function f92(p331) {
    const vF835 = getAccessToken();
    if (!vF835) {
      return null;
    }
    const v633 = String(p331 || "").trim().toUpperCase();
    if (!v633 || !v633.startsWith("EG-")) {
      return null;
    }
    const v634 = "https://api-portal.invoicing.eta.gov.eg/api/v1/codetypes/codes/my?CodeTypeID=9&ItemCode=" + v633 + "&Ps=10000";
    try {
      const v635 = await fetch(v634, {
        headers: {
          Authorization: "Bearer " + vF835
        }
      });
      if (!v635.ok) {
        return null;
      }
      const v636 = await v635.json();
      if (v636.result && v636.result.length > 0) {
        return v636.result;
      }
      return [];
    } catch (e37) {
      return null;
    }
  }
  async function f93(p332) {
    const vF836 = getAccessToken();
    if (!vF836) {
      return null;
    }
    const v637 = "https://api-portal.invoicing.eta.gov.eg/api/v1/codetypes/2/codes?CodeLookupValue=" + p332 + "&ApplyMinChoiceLevel=true&Ps=1";
    try {
      const v638 = await fetch(v637, {
        headers: {
          Authorization: "Bearer " + vF836
        }
      });
      if (!v638.ok) {
        return null;
      }
      const v639 = await v638.json();
      if (v639.result && v639.result.length > 0) {
        const v640 = v639.result[0];
        const v641 = vLSAr === "ar";
        if (v641 && v640.codeNameSecondaryLang) {
          v640.codeNamePrimaryLang = v640.codeNameSecondaryLang;
        }
        return v640;
      }
      return null;
    } catch (e38) {
      return null;
    }
  }
  function showRawDataPreview(p333, p334 = []) {
    if (p334.length > 0) {
      showErrorModal(p334, () => {
        document.getElementById("rawDataPreviewModal")?.remove();
        f100(p333);
      });
    }
    document.getElementById("rawDataPreviewModal")?.remove();
    const v642 = document.createElement("div");
    v642.id = "rawDataPreviewModal";
    v642.style.cssText = "position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 10001; display: flex; align-items: center; justify-content: center; direction: rtl;";
    const v643 = document.createElement("div");
    v643.style.cssText = "background-color: #f4f7fc; width: 95%; height: 90%; border-radius: 10px; display: flex; flex-direction: column; font-family: 'Segoe UI', Tahoma, sans-serif; overflow: hidden;";
    const v644 = new Map();
    p334.forEach(p335 => {
      const v645 = p335.id + "-" + p335.field;
      v644.set(v645, p335.message);
    });
    const vA34 = ["Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ (*)", "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±", "ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…", "Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)", "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)", "Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)", "Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)", "Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)", "Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)", "Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)", "Ù…Ø¨Ù†Ù‰ Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)", "ÙˆØµÙ Ø§Ù„ØµÙ†Ù (*)", "Ù†ÙˆØ¹ ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (*)", "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (*)", "Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ", "ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ (*)", "Ø§Ù„ÙƒÙ…ÙŠØ© (*)", "Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© (*)", "Ø¹Ù…Ù„Ø© Ø§Ù„Ø¨ÙŠØ¹", "Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù", "Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ…", "Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…", "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)", "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ 1 (*)", "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)", "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 2", "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ 2", "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 2", "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 3", "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ 3", "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 3", "Ù…Ø±Ø¬Ø¹ Ø´Ø±Ø§Ø¡", "ÙˆØµÙ Ø´Ø±Ø§Ø¡", "Ù…Ø±Ø¬Ø¹ Ù…Ø¨ÙŠØ¹Ø§Øª", "ÙˆØµÙ Ù…Ø¨ÙŠØ¹Ø§Øª", "Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ", "Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†Ùƒ", "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„", "Ø§Ù„ØªØºÙ„ÙŠÙ"];
    let vLStableStylewidth100Bo = "<table style=\"width: 100%; border-collapse: collapse; text-align: center;\"><thead><tr style=\"background-color: #2161a1; color: white;\">";
    vA34.forEach(p336 => vLStableStylewidth100Bo += "<th style=\"padding: 10px; border: 1px solid #ddd; white-space: nowrap;\">" + p336.replace(" (*)", "") + "</th>");
    vLStableStylewidth100Bo += "</tr></thead><tbody>";
    p333.forEach((p337, p338) => {
      vLStableStylewidth100Bo += "<tr>";
      const v646 = p337[0] || "ØµÙ " + (p338 + 2);
      for (let vLN032 = 0; vLN032 < vA34.length; vLN032++) {
        const v647 = vA34[vLN032].replace(" (*)", "");
        const v648 = vLN032 === 11 ? p337[11] || p337[39] || "" : p337[vLN032] !== undefined && p337[vLN032] !== null ? p337[vLN032] : "";
        const v649 = v646 + "-" + v647;
        const v650 = v644.get(v649);
        const v651 = v650 ? "background-color: #fff1f0; color: #cf1322;" : "";
        const v652 = v650 ? "Ø®Ø·Ø£: " + v650 : "";
        vLStableStylewidth100Bo += "<td style=\"padding: 8px; border: 1px solid #eee; " + v651 + "\" title=\"" + v652 + "\">" + v648 + "</td>";
      }
      vLStableStylewidth100Bo += "</tr>";
    });
    vLStableStylewidth100Bo += "</tbody></table>";
    v643.innerHTML = "\n        <div style=\"padding: 15px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; background-color: #fff; flex-shrink: 0;\">\n            <h3 style=\"margin: 0; color: #2161a1;\">1. Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡Ø§</h3>\n            <div>\n                <button id=\"continueToEditorBtn\" style=\"background-color: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;\">\n                    " + (p334.length > 0 ? "Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ (Ù…Ø¹ ÙˆØ¬ÙˆØ¯ Ø£Ø®Ø·Ø§Ø¡)" : "Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…") + "\n                </button>\n                <button id=\"closePreviewBtn\" style=\"background-color: #6c757d; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;\">Ø¥ØºÙ„Ø§Ù‚</button>\n            </div>\n        </div>\n        " + (p334.length > 0 ? "<div style=\"padding: 10px; background-color: #fffbe6; border-bottom: 1px solid #ffe58f; text-align: center; color: #d46b08; font-weight: bold;\">Ù…Ø±Ø± Ø§Ù„ÙØ£Ø±Ø© ÙÙˆÙ‚ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ Ù„Ù…Ø¹Ø±ÙØ© Ø³Ø¨Ø¨ Ø§Ù„Ø®Ø·Ø£.</div>" : "") + "\n        <div style=\"overflow: auto; flex-grow: 1; background: #fff;\">" + vLStableStylewidth100Bo + "</div>\n    ";
    v642.appendChild(v643);
    document.body.appendChild(v642);
    document.getElementById("closePreviewBtn").onclick = () => v642.remove();
    document.getElementById("continueToEditorBtn").onclick = async () => {
      const v653 = document.getElementById("continueToEditorBtn");
      v653.disabled = true;
      v653.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±...";
      try {
        const v654 = await fetchDraftInvoices();
        const v655 = new Map(v654?.filter(p339 => p339.document?.internalID).map(p340 => [String(p340.document.internalID), p340.id]) || []);
        const v656 = p333.map(p341 => {
          const vO39 = {};
          const vA35 = ["internalID", "dateTimeIssued", "serviceDeliveryDate", "receiver_id", "receiver_name", "receiver_type", "receiver_country", "receiver_governate", "receiver_city", "receiver_street", "receiver_building", "item_description", "item_type", "item_code", "item_internal_code", "unit_type", "quantity", "unit_price", "currency_sold", "exchange_rate", "discount_rate", "discount_amount", "tax_type_1", "tax_subtype_1", "tax_rate_1", "tax_type_2", "tax_subtype_2", "tax_rate_2", "tax_type_3", "tax_subtype_3", "tax_rate_3", "purchaseOrderReference", "purchaseOrderDescription", "salesOrderReference", "salesOrderDescription", "bankName", "bankAccountNo", "deliveryApproach", "deliveryPackaging"];
          vA35.forEach((p342, p343) => {
            vO39[p342] = p341[p343] !== undefined ? p341[p343] : null;
          });
          vO39.item_code_name = p341[39] || "";
          const v657 = String(vO39.internalID).trim();
          if (v657 && v655.has(v657)) {
            vO39.draftId = v655.get(v657);
          }
          return vO39;
        });
        v642.remove();
        f100(v656);
      } catch (e39) {
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: " + e39.message);
        v653.disabled = false;
        v653.textContent = "Ù…ØªØ§Ø¨Ø¹Ø©";
      }
    };
  }
  async function processAndSaveFromModal_v3() {
    const v658 = await getIssuerFullData();
    if (!v658) {
      alert("ÙØ´Ù„ Ø­Ø§Ø³Ù…: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù…ÙˆÙ„. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.");
      const v659 = document.getElementById("saveFromModalBtn");
      if (v659) {
        v659.disabled = false;
        v659.textContent = "Ø­ÙØ¸ Ø§Ù„ÙÙˆØ§ØªÙŠØ±";
      }
      return;
    }
    const v660 = document.getElementById("modalErrorContainer");
    if (v660) {
      v660.style.display = "none";
      v660.innerHTML = "";
    }
    const v661 = new Map();
    document.querySelectorAll(".invoice-group").forEach(p344 => {
      const v662 = p344.querySelector("[data-field=\"internalID\"]").textContent.trim();
      const v663 = p344.dataset.draftId;
      const v664 = p344.querySelector(".invoice-header-row");
      const v665 = v664.querySelector("[data-field=\"dateTimeIssued\"]").textContent.trim();
      const v666 = v664.querySelector("[data-field=\"serviceDeliveryDate\"]").textContent.trim();
      const v667 = v664.querySelector("[data-field=\"receiver_name\"]").textContent.trim();
      const v668 = v664.querySelector("[data-field=\"receiver_id\"]").textContent.trim();
      const vO40 = {
        id: v658.id,
        name: document.getElementById("editor-seller-name").value,
        governate: document.getElementById("editor-seller-governate").value,
        regionCity: document.getElementById("editor-seller-regionCity").value,
        street: document.getElementById("editor-seller-street").value,
        buildingNumber: document.getElementById("editor-seller-building").value,
        taxpayerActivityCode: document.getElementById("activity-select-editor")?.value || v658.taxpayerActivityCode
      };
      const vO41 = {};
      p344.querySelectorAll(".receiver-details-table [data-receiver-field]").forEach(p345 => {
        vO41[p345.dataset.receiverField] = p345.textContent.trim();
      });
      const vO42 = {};
      p344.querySelectorAll(".extra-details-table [data-invoice-field]").forEach(p346 => {
        vO42[p346.dataset.invoiceField] = p346.textContent.trim();
      });
      const vA36 = [];
      p344.querySelectorAll(".items-table tbody tr").forEach(p347 => {
        const vO43 = {
          internalID: v662,
          receiver_name: v667,
          receiver_id: v668,
          dateTimeIssued: v665,
          serviceDeliveryDate: v666,
          ...vO41,
          ...vO42
        };
        p347.querySelectorAll("[data-field]").forEach(p348 => {
          const v669 = p348.dataset.field;
          if (v669 !== "dateTimeIssued" && v669 !== "serviceDeliveryDate") {
            if (p348.querySelectorAll("span[data-field]").length > 0) {
              p348.querySelectorAll("span[data-field]").forEach(p349 => {
                vO43[p349.dataset.field] = p349.textContent.trim();
              });
            } else {
              vO43[v669] = p348.textContent.trim();
            }
          }
        });
        vA36.push(vO43);
      });
      if (v662) {
        v661.set(v662, {
          lines: vA36,
          issuer: vO40,
          draftId: v663
        });
      }
    });
    const vA37 = [];
    for (const [v670, v671] of v661.entries()) {
      if (!v671.lines || v671.lines.length === 0) {
        vA37.push({
          internalID: v670,
          message: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù†ÙˆØ¯ Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©."
        });
      }
    }
    if (vA37.length > 0) {
      showErrorModal(vA37);
      return;
    }
    await sendInvoicesFromModal_v3(v661);
  }
  function showCustomConfirmDialog(p350, p351, p352, p353) {
    document.getElementById("customConfirmDialog")?.remove();
    const v672 = document.createElement("div");
    v672.id = "customConfirmDialog";
    v672.style.cssText = "\n        position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n        background-color: rgba(0, 0, 0, 0.6); z-index: 20000;\n        display: flex; align-items: center; justify-content: center;\n        direction: rtl; font-family: 'Cairo', 'Segoe UI', sans-serif;\n        backdrop-filter: blur(4px);\n    ";
    v672.innerHTML = "\n        <div style=\"background: #fff; width: 550px; max-width: 90%; border-radius: 12px; box-shadow: 0 5px 25px rgba(0,0,0,0.2); animation: zoomIn 0.3s ease-out;\">\n            <div style=\"padding: 20px 25px; background-color: #fffbe6; color: #d46b08; border-top-left-radius: 12px; border-top-right-radius: 12px; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid #ffe58f;\">\n                <span style=\"font-size: 32px;\">âš ï¸</span>\n                <h3 style=\"margin: 0; font-size: 20px;\">" + p350 + "</h3>\n            </div>\n            <div style=\"padding: 25px; font-size: 16px; line-height: 1.8; color: #333;\">\n                " + p351 + "\n            </div>\n            <div style=\"padding: 20px 25px; display: flex; justify-content: flex-end; gap: 15px; background-color: #f8f9fa; border-bottom-left-radius: 12px; border-bottom-right-radius: 12px;\">\n                <button id=\"dialogCancelBtn\" style=\"background: #6c757d; color: white; padding: 10px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 15px;\">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­ÙØ¸</button>\n                <button id=\"dialogConfirmBtn\" style=\"background: #28a745; color: white; padding: 10px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 15px;\">Ù†Ø¹Ù…ØŒ Ù…ÙˆØ§ÙÙ‚ ÙˆÙ…ØªØ§Ø¨Ø¹Ø©</button>\n            </div>\n        </div>\n        <style> @keyframes zoomIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } } </style>\n    ";
    document.body.appendChild(v672);
    const v673 = document.getElementById("dialogConfirmBtn");
    const v674 = document.getElementById("dialogCancelBtn");
    v673.onclick = () => {
      v672.remove();
      if (typeof p352 === "function") {
        p352();
      }
    };
    v674.onclick = () => {
      v672.remove();
      if (typeof p353 === "function") {
        p353();
      }
    };
  }
  async function computeUuidFromServer(p354, p355 = false) {
    const vLSHttplocalhost8080sig = "http://localhost:8080/sign";
    const vF742 = f74("ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹...", 0);
    try {
      const v675 = await fetch(vLSHttplocalhost8080sig, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          data: p354,
          is_hash: p355
        })
      });
      vF742.remove();
      if (!v675.ok) {
        const v676 = await v675.json().catch(() => ({
          error: "Ø±Ø¯ ØºÙŠØ± ØµØ§Ù„Ø­ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…."
        }));
        throw new Error(v676.error || "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø§Ø¯Ù… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ (Ø§Ù„Ø­Ø§Ù„Ø©: " + v675.status + ").");
      }
      const v677 = await v675.json();
      if (v677.success && v677.signature) {
        f74("âœ… ØªÙ… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­!", 3000);
        return v677.signature;
      } else {
        throw new Error(v677.error || "Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ ÙÙŠ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹.");
      }
    } catch (e40) {
      if (vF742) {
        vF742.remove();
      }
      alert("âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø­Ù„ÙŠ.\n\nØ§Ù„Ø³Ø¨Ø¨: " + e40.message + "\n\nÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø¨Ø±Ù†Ø§Ù…Ø¬ \"signer_app.py\" ÙˆØªÙˆØµÙŠÙ„ ÙÙ„Ø§Ø´Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹.");
      return null;
    }
  }
  function deleteDraft(p356) {
    const v678 = JSON.parse(localStorage.getItem("receiptDrafts") || "[]");
    const v679 = v678[p356];
    if (!v679) {
      return;
    }
    if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ø±Ù‚Ù… \"" + v679.receiptNumber + "\" Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
      v678.splice(p356, 1);
      localStorage.setItem("receiptDrafts", JSON.stringify(v678));
      renderReceiptDrafts();
      f74("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ø¨Ù†Ø¬Ø§Ø­.", 3000);
    }
  }
  async function deleteDraftInvoiceAPI(p357) {
    const vF837 = getAccessToken();
    if (!vF837) {
      alert("Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙˆÙƒÙ† Ø§Ù„Ø¯Ø®ÙˆÙ„.");
      return false;
    }
    if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù… " + p357 + " Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø³ÙˆØ¯Ø§ØªØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.")) {
      return false;
    }
    try {
      const v680 = await fetch("https://api-portal.invoicing.eta.gov.eg/api/v1/documents/drafts/" + p357, {
        method: "DELETE",
        headers: {
          Authorization: "Bearer " + vF837
        }
      });
      if (!v680.ok) {
        const v681 = await v680.json();
        throw new Error(v681.error?.message || "ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù…Ø³ÙˆØ¯Ø©. Ø±Ù…Ø² Ø§Ù„Ø­Ø§Ù„Ø©: " + v680.status);
      }
      return true;
    } catch (e41) {
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ø³ÙˆØ¯Ø©: " + e41.message);
      return false;
    }
  }
  async function f100(p358) {
    const v682 = document.getElementById("dataEditorModal");
    if (v682) {
      v682.remove();
    }
    let v683 = null;
    try {
      const v684 = JSON.parse(localStorage.getItem("USER_DATA") || "{}");
      v683 = v684?.profile?.NatId;
    } catch (e42) {}
    p358.forEach(p359 => {
      const v685 = String(p359.receiver_type || "").toUpperCase().trim();
      if (v685 === "P") {
        if ((!p359.receiver_id || String(p359.receiver_id).trim() === "") && v683) {
          p359.receiver_id = v683;
        }
        if (!p359.receiver_name || String(p359.receiver_name).trim() === "") {
          p359.receiver_name = "Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ";
        }
      }
    });
    const v686 = document.createElement("div");
    v686.id = "dataEditorModal";
    v686.style.cssText = "position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); z-index: 10000; display: flex; align-items: center; justify-content: center; direction: rtl; font-family: 'Segoe UI', Tahoma, sans-serif;";
    const v687 = document.createElement("div");
    v687.style.cssText = "background-color: #fff; width: 95%; height: 90%; border-radius: 10px; display: flex; flex-direction: column; box-shadow: 0 5px 25px rgba(0,0,0,0.2); overflow: hidden;";
    const v688 = new Map();
    p358.forEach((p360, p361) => {
      const v689 = p360.internalID;
      if (!v689) {
        return;
      }
      if (!v688.has(v689)) {
        v688.set(v689, {
          invoiceData: p360,
          lines: []
        });
      }
      v688.get(v689).lines.push({
        ...p360,
        originalIndex: p361
      });
    });
    let vO44 = {};
    const v690 = await getIssuerFullData();
    if (v690) {
      vO44 = v690;
    } else {
      try {
        const v691 = JSON.parse(localStorage.getItem("USER_DATA") || "{}");
        const v692 = v691.profile || {};
        vO44 = {
          id: v692.TaxRin || v692.taxRin || "",
          name: localStorage.getItem("TaxpayerNameAR") || v692.legalName || "",
          taxpayerActivityCode: v692.activityCode || "4690",
          governate: v692.address?.governorate || "",
          regionCity: v692.address?.regionCity || "",
          street: v692.address?.street || "",
          buildingNumber: v692.address?.buildingNumber || ""
        };
      } catch (e43) {}
    }
    const v693 = v690.taxpayerBranchs || [];
    let vLS10 = "";
    if (v693.length > 0) {
      vLS10 = "\n        <div class=\"details-card\" style=\"padding: 10px 15px;\">\n            <label for=\"address-select-editor\" style=\"font-weight: bold; margin-bottom: 5px; display: block;\">Ø§Ø®ØªØ± Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ØµØ¯Ø± (Ø§Ù„Ø¨Ø§Ø¦Ø¹):</label>\n            <select id=\"address-select-editor\" style=\"width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ccc;\">\n                " + v693.map((p362, p363) => {
        const v694 = p362.address || {};
        const v695 = [v694.streetName, v694.regionCity, v694.governorateNameSecondaryLang].filter(Boolean).join(", ");
        return "<option value=\"" + p363 + "\" data-address='" + JSON.stringify(v694) + "'>\n                                " + (v695 || "ÙØ±Ø¹ Ø±Ù‚Ù… " + (p362.branchNumber || p363 + 1)) + "\n                            </option>";
      }).join("") + "\n            </select>\n        </div>";
    }
    let vLS11 = "";
    if (v690 && v690.activities && v690.activities.length > 0) {
      const v696 = v690.activities.find(p364 => p364.toDate === null) || v690.activities[0];
      vLS11 = "\n            <div class=\"details-card\" style=\"padding: 10px 15px;\">\n                <label for=\"activity-select-editor\" style=\"font-weight: bold; margin-bottom: 5px; display: block;\">Ø§Ø®ØªØ± ÙƒÙˆØ¯ Ø§Ù„Ù†Ø´Ø§Ø·:</label>\n                <select id=\"activity-select-editor\" style=\"width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ccc;\">\n                    " + v690.activities.map(p365 => "\n                        <option value=\"" + p365.activityTypeCode + "\" " + (p365.activityTypeCode === v696.activityTypeCode ? "selected" : "") + ">\n                            " + p365.activityTypeCode + " - " + p365.activityTypeNameSecondaryLang + "\n                        </option>\n                    ").join("") + "\n                </select>\n            </div>\n        ";
    } else {
      vLS11 = "<div class=\"details-card\" style=\"padding: 10px 15px;\">ÙƒÙˆØ¯ Ø§Ù„Ù†Ø´Ø§Ø·: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ù†Ø´Ø·Ø©.</div>";
    }
    let vLS12 = "";
    v688.forEach((p366, p367) => {
      const v697 = p366.invoiceData;
      const v698 = new Date().toLocaleDateString("ar-EG");
      vLS12 += "\n           <tbody class=\"invoice-group\" data-internal-id=\"" + p367 + "\" data-draft-id=\"" + (v697.draftId || "") + "\">\n                <tr class=\"invoice-header-row\">\n                    <td class=\"toggle-details\" style=\"font-weight: bold; font-size: 20px; text-align: center;\">+</td>\n                    <td><span contenteditable=\"true\" data-field=\"internalID\">" + p367 + "</span></td>\n<td>\n    <span contenteditable=\"true\" data-field=\"dateTimeIssued\">\n        " + (v697.dateTimeIssued ? new Date(v697.dateTimeIssued).toLocaleDateString("en-CA") : new Date().toLocaleDateString("en-CA")) + "\n    </span>\n</td>\n<td>\n    <span contenteditable=\"true\" data-field=\"serviceDeliveryDate\">\n        " + (v697.serviceDeliveryDate ? new Date(v697.serviceDeliveryDate).toLocaleDateString("en-CA") : "") + "\n    </span>\n</td>\n                    <td><span contenteditable=\"true\" data-field=\"receiver_id\">" + (v697.receiver_id || "") + "</span></td>\n                    <td><span contenteditable=\"true\" data-field=\"receiver_name\">" + (v697.receiver_name || "") + "</span></td>\n                    <td class=\"numeric\" id=\"totalBeforeTax_" + p367 + "\">0.00</td>\n                    <td class=\"numeric\" id=\"taxTotals_" + p367 + "\"></td>\n                    <td class=\"numeric\" id=\"grandTotal_" + p367 + "\" style=\"font-weight: bold;\">0.00</td>\n                    <td><button class=\"print-invoice-btn\" data-invoice-id=\"" + p367 + "\" title=\"Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©\">ğŸ–¨ï¸</button></td>\n                    <td><button class=\"delete-invoice-btn\" title=\"Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø©\">&times;</button></td>\n                </tr>\n                <tr class=\"invoice-details-row\" style=\"display: none;\">\n                    <td colspan=\"10\">\n                        <div class=\"details-wrapper\">\n                            <div class=\"details-grid\">\n                                <div class=\"details-card\">\n                                    <h4 class=\"details-header\">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ¯Ø± (Ø§Ù„Ø¨Ø§Ø¦Ø¹)</h4>\n                                    <table class=\"issuer-details-table details-table\">\n                                        <tbody>\n                                            <tr><th>Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th><td contenteditable=\"true\" data-issuer-field=\"id\">" + vO44.id + "</td></tr>\n                                            <tr><th>Ø§Ø³Ù… Ø§Ù„Ù…ØµØ¯Ø±</th><td contenteditable=\"true\" data-issuer-field=\"name\">" + vO44.name + "</td></tr>\n                                            <tr><th>ÙƒÙˆØ¯ Ø§Ù„Ù†Ø´Ø§Ø·</th><td contenteditable=\"true\" data-issuer-field=\"taxpayerActivityCode\" class=\"notranslate\" translate=\"no\">" + vO44.taxpayerActivityCode + "</td></tr>\n                                            <tr><th>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</th><td contenteditable=\"true\" data-issuer-field=\"governate\">" + vO44.governate + "</td></tr>\n                                            <tr><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©/Ø§Ù„Ù‚Ø³Ù…</th><td contenteditable=\"true\" data-issuer-field=\"regionCity\">" + vO44.regionCity + "</td></tr>\n                                            <tr><th>Ø§Ù„Ø´Ø§Ø±Ø¹</th><td contenteditable=\"true\" data-issuer-field=\"street\">" + vO44.street + "</td></tr>\n                                            <tr><th>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰</th><td contenteditable=\"true\" data-issuer-field=\"buildingNumber\">" + vO44.buildingNumber + "</td></tr>\n                                            <tr><th>ÙƒÙˆØ¯ Ø§Ù„Ù†Ø´Ø§Ø·</th><td contenteditable=\"true\" data-issuer-field=\"taxpayerActivityCode\" class=\"notranslate\" translate=\"no\">" + vO44.taxpayerActivityCode + "</td></tr>\n\n                                        </tbody>\n                                    </table>\n                                </div>\n                                <div class=\"details-card\">\n                                    <h4 class=\"details-header\">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù… (Ø§Ù„Ù…Ø´ØªØ±ÙŠ)</h4>\n                                    <table class=\"receiver-details-table details-table\">\n                                        <tbody>\n                                            <tr><th>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ„Ù…</th><td contenteditable=\"true\" data-receiver-field=\"receiver_type\" class=\"notranslate\" translate=\"no\">" + (v697.receiver_type ?? "B") + "</td></tr>\n                                            <tr>\n                                                <th>Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>\n                                                <td style=\"display: flex; align-items: center; gap: 5px;\">\n                                                    <span contenteditable=\"true\" data-receiver-field=\"receiver_id\" style=\"flex-grow: 1;\">" + (v697.receiver_id ?? "") + "</span>\n                                                    <button class=\"verify-receiver-btn\" title=\"ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹\">ğŸ”</button>\n                                                </td>\n                                            </tr>\n                                            <tr><th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…</th><td contenteditable=\"true\" data-receiver-field=\"receiver_name\">" + (v697.receiver_name ?? "") + "</td></tr>\n<tr><th>Ø§Ù„Ø¯ÙˆÙ„Ø©</th><td contenteditable=\"true\" data-receiver-field=\"receiver_country\" class=\"notranslate\" translate=\"no\">" + (v697.receiver_country ?? "") + "</td></tr>\n                                            <tr><th>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</th><td contenteditable=\"true\" data-receiver-field=\"receiver_governate\">" + (v697.receiver_governate ?? "") + "</td></tr>\n                                            <tr><th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©/Ø§Ù„Ù‚Ø³Ù…</th><td contenteditable=\"true\" data-receiver-field=\"receiver_city\">" + (v697.receiver_city ?? "") + "</td></tr>\n                                            <tr><th>Ø§Ù„Ø´Ø§Ø±Ø¹</th><td contenteditable=\"true\" data-receiver-field=\"receiver_street\">" + (v697.receiver_street ?? "") + "</td></tr>\n                                            <tr><th>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰</th><td contenteditable=\"true\" data-receiver-field=\"receiver_building\">" + (v697.receiver_building ?? "") + "</td></tr>\n                                        </tbody>\n                                    </table>\n                                </div>\n                                <div class=\"details-card\">\n                                    <h4 class=\"details-header\">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</h4>\n                                    <table class=\"extra-details-table details-table\">\n                                        <tbody>\n                                            <tr><th>Ù…Ø±Ø¬Ø¹ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡</th><td contenteditable=\"true\" data-invoice-field=\"purchaseOrderReference\">" + (v697.purchaseOrderReference || "") + "</td></tr>\n                                            <tr><th>ÙˆØµÙ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡</th><td contenteditable=\"true\" data-invoice-field=\"purchaseOrderDescription\">" + (v697.purchaseOrderDescription || "") + "</td></tr>\n                                            <tr><th>Ù…Ø±Ø¬Ø¹ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</th><td contenteditable=\"true\" data-invoice-field=\"salesOrderReference\">" + (v697.salesOrderReference || "") + "</td></tr>\n                                            <tr><th>ÙˆØµÙ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</th><td contenteditable=\"true\" data-invoice-field=\"salesOrderDescription\">" + (v697.salesOrderDescription || "") + "</td></tr>\n                                            <tr><th>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ</th><td contenteditable=\"true\" data-invoice-field=\"bankName\">" + (v697.bankName || "") + "</td></tr>\n                                            <tr><th>Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†Ùƒ</th><td contenteditable=\"true\" data-invoice-field=\"bankAccountNo\">" + (v697.bankAccountNo || "") + "</td></tr>\n                                            <tr><th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„</th><td contenteditable=\"true\" data-invoice-field=\"deliveryApproach\">" + (v697.deliveryApproach || "") + "</td></tr>\n                                            <tr><th>Ø§Ù„ØªØºÙ„ÙŠÙ</th><td contenteditable=\"true\" data-invoice-field=\"deliveryPackaging\">" + (v697.deliveryPackaging || "") + "</td></tr>\n                                        </tbody>\n                                    </table>\n                                </div>\n                            </div>\n                            <div class=\"items-card\">\n                                <h4 class=\"details-header\">Ø¨Ù†ÙˆØ¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h4>\n                                <div style=\"overflow-x: auto;\">\n                                    <table class=\"items-table\">\n                                        <thead>\n                                     \n\n                                            <tr>\n                                                <th>Ù†ÙˆØ¹ Ø§Ù„ÙƒÙˆØ¯</th><th>ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù</th><th>ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³</th>\n                                                            <th>Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ</th> \n\n                                                            \n\n                                                <th>Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ¯ (Ø±Ø³Ù…ÙŠ)</th>\n                                                <th>ÙˆØµÙ Ø§Ù„ØµÙ†Ù (Ø¨Ø§Ù„ÙØ§ØªÙˆØ±Ø©)</th>\n                                                <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø¹Ù…Ù„Ø©</th><th>Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù</th>\n                                                <th>Ø®ØµÙ… (%)</th><th>Ø®ØµÙ… (Ù‚ÙŠÙ…Ø©)</th>\n                                                <th>Ø¶Ø±ÙŠØ¨Ø© 1</th><th>Ø¶Ø±ÙŠØ¨Ø© 2</th><th>Ø¶Ø±ÙŠØ¨Ø© 3</th><th>Ø­Ø°Ù</th>\n                                            </tr>\n                                        </thead>\n                                        <tbody>\n                                    " + p366.lines.map(p368 => {
        const v699 = p368.item_description || p368.item_code_name || "";
        const v700 = p368.item_internal_code || "";
        return "\n                <tr data-line-index=\"" + p368.originalIndex + "\">\n                    <td contenteditable=\"true\" data-field=\"item_type\" class=\"notranslate\" translate=\"no\">" + (p368.item_type ?? "") + "</td>\n                    <td contenteditable=\"true\" data-field=\"item_code\" class=\"notranslate\" translate=\"no\">" + (p368.item_code ?? "") + "</td>\n                    <td contenteditable=\"true\" data-field=\"unit_type\" class=\"notranslate\" translate=\"no\">" + (p368.unit_type ?? "") + "</td>\n                    \n                    <td contenteditable=\"true\" data-field=\"item_internal_code\">" + v700 + "</td>\n\n                    <td data-field=\"item_code_name\" style=\"background-color: #f0f8ff;\">" + (p368.item_code_name ?? "") + "</td>\n                    <td contenteditable=\"true\" data-field=\"item_description\">" + v699 + "</td>\n                    \n                    <td contenteditable=\"true\" data-field=\"quantity\" class=\"numeric\">" + (p368.quantity ?? "") + "</td>\n                    <td contenteditable=\"true\" data-field=\"unit_price\" class=\"numeric\">" + (p368.unit_price ?? "") + "</td>\n                    <td contenteditable=\"true\" data-field=\"currency_sold\" class=\"notranslate\" translate=\"no\">" + (p368.currency_sold || "EGP") + "</td>\n                    <td contenteditable=\"true\" data-field=\"exchange_rate\" class=\"numeric\">" + (p368.exchange_rate || 1) + "</td>\n                    <td contenteditable=\"true\" data-field=\"discount_rate\" class=\"numeric\">" + (p368.discount_rate || "") + "</td>\n                    <td contenteditable=\"true\" data-field=\"discount_amount\" class=\"numeric\">" + (p368.discount_amount || "") + "</td>\n                    \n                    <td class=\"notranslate\" translate=\"no\">\n                        <span contenteditable=\"true\" data-field=\"tax_type_1\">" + (p368.tax_type_1 ?? "") + "</span> / \n                        <span contenteditable=\"true\" data-field=\"tax_subtype_1\">" + (p368.tax_subtype_1 ?? "") + "</span> / \n                        <span contenteditable=\"true\" data-field=\"tax_rate_1\" class=\"numeric\">" + (p368.tax_rate_1 ?? "") + "</span>\n                    </td>\n                    <td class=\"notranslate\" translate=\"no\">\n                        <span contenteditable=\"true\" data-field=\"tax_type_2\">" + (p368.tax_type_2 ?? "") + "</span> / \n                        <span contenteditable=\"true\" data-field=\"tax_subtype_2\">" + (p368.tax_subtype_2 ?? "") + "</span> / \n                        <span contenteditable=\"true\" data-field=\"tax_rate_2\" class=\"numeric\">" + (p368.tax_rate_2 ?? "") + "</span>\n                    </td>\n                    <td class=\"notranslate\" translate=\"no\">\n                        <span contenteditable=\"true\" data-field=\"tax_type_3\">" + (p368.tax_type_3 ?? "") + "</span> / \n                        <span contenteditable=\"true\" data-field=\"tax_subtype_3\">" + (p368.tax_subtype_3 ?? "") + "</span> / \n                        <span contenteditable=\"true\" data-field=\"tax_rate_3\" class=\"numeric\">" + (p368.tax_rate_3 ?? "") + "</span>\n                    </td>\n                    <td><button class=\"delete-line-btn\">&times;</button></td>\n                </tr>\n            ";
      }).join("") + "\n                                        </tbody>\n                                    </table>\n                                </div>\n                            </div>\n                        </div>\n                    </td>\n                </tr>\n            </tbody>\n        ";
    });
    v687.innerHTML = "\n        <div style=\"padding: 15px 25px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; background-color: #f8f9fa;\">\n            <h3 style=\"margin: 0; color: #2161a1;\">Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h3>\n            <div>\n                <button id=\"saveFromModalBtn\" style=\"background-color: #28a745; color: white; padding: 10px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px;\">Ø­ÙØ¸ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</button>\n                            <button id=\"saveAsTemplateBtn\" style=\"background-color: #007bff; color: white; padding: 10px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px;\">Ø­ÙØ¸ ÙƒÙ†Ù…ÙˆØ°Ø¬</button>\n                              \n\n                <button id=\"closeModalBtn\" style=\"background-color: #6c757d; color: white; padding: 10px 25px; border: none; border-radius: 8px; cursor: pointer; margin-right: 10px;\">Ø¥ØºÙ„Ø§Ù‚</button>\n            </div>\n        </div>\n     \n        <div style=\"padding: 10px 25px; background-color: #e9ecef; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; align-items: flex-end;\">\n    \n    <!-- âœ…âœ…âœ… Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¥Ø¶Ø§ÙØ© 2: ÙˆØ¶Ø¹ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù‡Ù†Ø§ âœ…âœ…âœ… -->\n    " + vLS11 + "\n    " + vLS10 + "\n    \n    <div class=\"details-card\" style=\"padding: 10px 15px;\">\n        <label for=\"editor-seller-name\" style=\"font-weight: bold; margin-bottom: 5px; display: block;\">Ø§Ø³Ù… Ø§Ù„Ù…ØµØ¯Ø±:</label>\n        <input type=\"text\" id=\"editor-seller-name\" style=\"width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ccc;\" value=\"" + v690.name + "\">\n    </div>\n    <div class=\"details-card\" style=\"padding: 10px 15px;\">\n        <label for=\"editor-seller-country\" style=\"font-weight: bold; margin-bottom: 5px; display: block;\">Ø§Ù„Ø¯ÙˆÙ„Ø©:</label>\n        <input type=\"text\" id=\"editor-seller-country\" style=\"width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ccc;\" value=\"EG\" readonly>\n    </div>\n    <div class=\"details-card\" style=\"padding: 10px 15px;\">\n        <label for=\"editor-seller-governate\" style=\"font-weight: bold; margin-bottom: 5px; display: block;\">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©:</label>\n        <input type=\"text\" id=\"editor-seller-governate\" style=\"width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ccc;\" value=\"" + v690.governate + "\">\n    </div>\n    <div class=\"details-card\" style=\"padding: 10px 15px;\">\n        <label for=\"editor-seller-regionCity\" style=\"font-weight: bold; margin-bottom: 5px; display: block;\">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</label>\n        <input type=\"text\" id=\"editor-seller-regionCity\" style=\"width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ccc;\" value=\"" + v690.regionCity + "\">\n    </div>\n    <div class=\"details-card\" style=\"padding: 10px 15px;\">\n        <label for=\"editor-seller-street\" style=\"font-weight: bold; margin-bottom: 5px; display: block;\">Ø§Ù„Ø´Ø§Ø±Ø¹:</label>\n        <input type=\"text\" id=\"editor-seller-street\" style=\"width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ccc;\" value=\"" + v690.street + "\">\n    </div>\n    <div class=\"details-card\" style=\"padding: 10px 15px;\">\n        <label for=\"editor-seller-building\" style=\"font-weight: bold; margin-bottom: 5px; display: block;\">Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰:</label>\n        <input type=\"text\" id=\"editor-seller-building\" style=\"width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ccc;\" value=\"" + (v690.buildingNumber || "") + "\">\n    </div>\n    <!-- âœ…âœ…âœ… Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¥Ø¶Ø§ÙØ© 2 --- -->\n\n</div>\n\n        <div style=\"overflow-y: auto; flex-grow: 1;\">\n            <table class=\"main-invoice-table\">\n                <thead>\n                   <tr style=\"background-color: #020b18ff; color: white; position: sticky; top: 0; z-index: 10;\">\n                        <th style=\"padding: 12px; width: 40px;\"></th>\n                        <th style=\"padding: 12px;\">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ</th>\n<th style=\"padding: 12px;\">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±</th>\n<th style=\"padding: 12px;\">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…</th>\n                        \n                        <th style=\"padding: 12px;\">Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>\n                        <th style=\"padding: 12px;\">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…</th>\n                        <th style=\"padding: 12px;\">Ø§Ù„Ù‚ÙŠÙ…Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</th>\n                        <th style=\"padding: 12px;\">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨</th>\n                        <th style=\"padding: 12px;\">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</th>\n                        <th style=\"padding: 12px; width: 60px;\">Ø·Ø¨Ø§Ø¹Ø©</th>\n                        <th style=\"padding: 12px; width: 60px;\">Ø­Ø°Ù</th>\n                   </tr>\n                </thead>\n                " + vLS12 + "\n            </table>\n        </div>\n        <div id=\"modalErrorContainer\" style=\"padding: 10px; background-color: #f8d7da; color: #721c24; display: none; max-height: 120px; overflow-y: auto; flex-shrink: 0;\"></div>\n        <div id=\"totalsFooter\" style=\"padding: 12px 25px; background-color: #343a40; color: white; display: flex; justify-content: space-around; align-items: center; flex-shrink: 0; border-top: 3px solid #0d6efd; font-size: 14px;\">\n            <div>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©: <span id=\"totalBeforeTax\" style=\"font-weight: bold; color: #ffc107;\">0.00</span></div>\n            <div id=\"taxTotalsContainer\" style=\"display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;\"></div>\n            <div style=\"font-size: 16px;\"><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: <span id=\"grandTotal\" style=\"font-weight: bold; color: #198754;\">0.00</span></strong></div>\n        </div>\n    ";
    v686.appendChild(v687);
    document.body.appendChild(v686);
    const vLSmaininvoicetableWidt = "\n        .main-invoice-table { width: 100%; border-collapse: collapse; }\n        .main-invoice-table thead tr { background-color: #020b18ff; color: white; position: sticky; top: 0; z-index: 10; }\n        .main-invoice-table th { padding: 12px; text-align: center; }\n        .invoice-header-row { background-color: #f8f9fa; border-bottom: 2px solid #dee2e6; cursor: pointer; transition: background-color 0.2s; }\n        .invoice-header-row:hover { background-color: #e9ecef; }\n        .invoice-header-row td { padding: 10px 12px; vertical-align: middle; text-align: center; border-left: 1px solid #eee; }\n        .invoice-header-row td:first-child { border-left: none; }\n        .invoice-header-row td span[contenteditable=\"true\"] { background-color: #fff; padding: 5px; border-radius: 4px; border: 1px dashed #ccc; min-width: 100px; display: inline-block; }\n        .numeric { font-family: 'Segoe UI', Tahoma, sans-serif; font-weight: 500; }\n        .details-wrapper { padding: 20px; background-color: #f9f9f9; border-top: 3px solid #0d6efd; }\n        .details-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 25px; }\n        .details-card, .items-card { background: #fff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }\n        .details-header { color: #0d6efd; border-bottom: 2px solid #eee; padding-bottom: 8px; margin-top: 0; margin-bottom: 15px; font-size: 18px; }\n        .details-table { width: 100%; border-collapse: collapse; font-size: 15px; }\n        .details-table th, .details-table td { border: 1px solid #f0f0f0; padding: 9px; text-align: right; }\n        .details-table th { background-color: #f8f9fa; width: 150px; font-weight: 600; }\n        .details-table td[contenteditable=\"true\"] { background-color: #fff9e6; outline: none; }\n        .items-table { width: 100%; border-collapse: collapse; }\n        .items-table th, .items-table td { border: 1px solid #dee2e6; padding: 8px; text-align: center; font-size: 14px; vertical-align: middle; }\n        .items-table th { background-color: #e9ecef; font-weight: 600; }\n        .items-table tbody tr:nth-child(even) { background-color: #f9f9f9; }\n        .items-table td[contenteditable=\"true\"], .items-table span[contenteditable=\"true\"] { background-color: #fff9e6; outline: none; }\n        .delete-invoice-btn, .delete-line-btn, .print-invoice-btn { background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; padding: 4px 8px; font-size: 14px; }\n        .print-invoice-btn { background: #17a2b8; }\n        .delete-line-btn { font-size: 18px; padding: 2px 8px; }\n    ";
    const v701 = document.createElement("style");
    v701.id = "dataEditorModalStyles";
    v701.innerText = vLSmaininvoicetableWidt;
    document.head.appendChild(v701);
    document.getElementById("closeModalBtn").onclick = () => {
      v686.remove();
      v701.remove();
    };
    const v702 = document.getElementById("address-select-editor");
    if (v702) {
      const vF18 = () => {
        const v703 = v702.options[v702.selectedIndex];
        const v704 = JSON.parse(v703.dataset.address || "{}");
        document.getElementById("editor-seller-governate").value = v704.governorateNameSecondaryLang || "";
        document.getElementById("editor-seller-regionCity").value = v704.cityNameSecondaryLang || "";
        document.getElementById("editor-seller-street").value = v704.streetName || "";
        document.getElementById("editor-seller-building").value = v704.buildingNo || "";
        document.querySelectorAll(".issuer-details-table").forEach(p369 => {
          p369.querySelector("[data-issuer-field=\"governate\"]").textContent = v704.governorateNameSecondaryLang || "";
          p369.querySelector("[data-issuer-field=\"regionCity\"]").textContent = v704.cityNameSecondaryLang || "";
          p369.querySelector("[data-issuer-field=\"street\"]").textContent = v704.streetName || "";
          p369.querySelector("[data-issuer-field=\"buildingNumber\"]").textContent = v704.buildingNo || "";
        });
      };
      v702.addEventListener("change", vF18);
      vF18();
    }
    document.getElementById("saveFromModalBtn").onclick = () => processAndSaveFromModal_v3();
    document.querySelectorAll(".invoice-header-row").forEach(p370 => {
      p370.onclick = p371 => {
        if (p371.target.tagName === "BUTTON" || p371.target.isContentEditable || p371.target.parentElement.isContentEditable) {
          return;
        }
        const v705 = p370.nextElementSibling;
        const v706 = p370.querySelector(".toggle-details");
        const v707 = v705.style.display !== "none";
        v705.style.display = v707 ? "none" : "table-row";
        v706.textContent = v707 ? "+" : "-";
      };
    });
    document.querySelectorAll(".delete-invoice-btn").forEach(p372 => {
      p372.onclick = async p373 => {
        p373.stopPropagation();
        const v708 = p373.target.closest(".invoice-group");
        const v709 = v708.dataset.draftId;
        const v710 = v708.dataset.internalId;
        if (!v709) {
          if (confirm("Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© (" + v710 + ") Ù„Ù… ÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ø¹Ø¯. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø²Ø§Ù„ØªÙ‡Ø§ Ù…Ù† Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„ÙŠØŸ")) {
            v708.remove();
            updateAllTotals();
          }
          return;
        }
        const v711 = await deleteDraftInvoiceAPI(v709);
        if (v711) {
          v708.remove();
          updateAllTotals();
          alert("ØªÙ… Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù… " + v710 + " Ø¨Ù†Ø¬Ø§Ø­ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù….");
        }
      };
    });
    document.getElementById("saveAsTemplateBtn").onclick = () => {
      const v712 = document.querySelector(".invoice-group");
      if (!v712) {
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø£Ùˆ Ø­ÙØ¸Ù‡Ø§ ÙƒÙ†Ù…ÙˆØ°Ø¬.");
        return;
      }
      const v_0x426bbb = createCreditNotePayload_CN(v712);
      showSaveAsTemplatePopup(async (p374, p375) => {
        const vO45 = {
          ...v_0x426bbb,
          templateName: p374,
          templateScope: p375
        };
        const v713 = await saveInvoiceAsTemplateAPI(vO45);
        if (v713.success) {
          alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ \"" + p374 + "\" Ø¨Ù†Ø¬Ø§Ø­!");
        } else {
          alert("âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬. Ø§Ù„Ø®Ø·Ø£: " + v713.error);
        }
      });
    };
    document.querySelectorAll(".print-invoice-btn").forEach(p376 => {
      p376.onclick = p377 => {
        p377.stopPropagation();
        const v714 = p377.target.dataset.invoiceId;
        const v715 = p377.target.closest(".invoice-group");
        printInvoice(v714, v715);
      };
    });
    document.querySelectorAll(".delete-line-btn").forEach(p378 => {
      p378.onclick = p379 => {
        p379.stopPropagation();
        const v716 = p379.target.closest("tr");
        const v717 = v716.parentElement;
        v716.remove();
        if (v717.children.length === 0) {
          v717.closest(".invoice-group").remove();
        }
        updateAllTotals();
      };
    });
    v686.addEventListener("input", p380 => {
      if (p380.target.isContentEditable) {
        updateAllTotals();
      }
    });
    updateAllTotals();
    v686.querySelectorAll(".verify-receiver-btn").forEach(p381 => {
      p381.onclick = async p382 => {
        p382.stopPropagation();
        const v718 = p382.target;
        const v719 = v718.closest("tr");
        const v720 = v719.querySelector("[data-receiver-field=\"receiver_id\"]");
        const v721 = v720.textContent.trim();
        const v722 = v718.textContent;
        v718.textContent = "â³";
        v718.disabled = true;
        const v723 = await fetchTaxpayerData(v721);
        if (v723) {
          const v724 = v718.closest(".details-grid").querySelector(".receiver-details-table");
          const v725 = v724.querySelector("[data-receiver-field=\"receiver_name\"]");
          const v726 = v724.querySelector("[data-receiver-field=\"receiver_governate\"]");
          const v727 = v724.querySelector("[data-receiver-field=\"receiver_city\"]");
          const v728 = v724.querySelector("[data-receiver-field=\"receiver_street\"]");
          const v729 = v724.querySelector("[data-receiver-field=\"receiver_building\"]");
          if (v725) {
            v725.textContent = v723.namePrimaryLang || "";
          }
          const v730 = v723.taxpayerBranchs?.[0]?.address;
          if (v730) {
            if (v726) {
              v726.textContent = v730.governorateNameSecondaryLang || v730.governorate || "";
            }
            if (v727) {
              v727.textContent = v730.cityNameSecondaryLang || v730.regionCity || "";
            }
            if (v728) {
              v728.textContent = v730.streetName || v730.street || "";
            }
            if (v729) {
              v729.textContent = v730.buildingNo || v730.buildingNumber || "";
            }
          }
          const v731 = v718.closest(".invoice-group").querySelector(".invoice-header-row");
          const v732 = v731.querySelector("[data-field=\"receiver_name\"]");
          if (v732) {
            v732.textContent = v723.namePrimaryLang || "";
          }
          alert("ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ ÙˆÙ…Ù„Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
        } else {
          alert("ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡ ØµØ­ÙŠØ­.");
        }
        v718.textContent = v722;
        v718.disabled = false;
      };
    });
  }
  async function saveInvoiceAsTemplateAPI(p383) {
    const vF838 = getAccessToken();
    if (!vF838) {
      return {
        success: false,
        error: "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙˆÙƒÙ† Ø§Ù„Ø¯Ø®ÙˆÙ„."
      };
    }
    try {
      const v733 = await fetch("https://api-portal.invoicing.eta.gov.eg/api/v1/documents/templates", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: "Bearer " + vF838
        },
        body: JSON.stringify(p383)
      });
      if (!v733.ok) {
        const v734 = await v733.json();
        const v735 = v734.error?.details?.[0]?.message || v734.error?.message || JSON.stringify(v734);
        throw new Error(v735);
      }
      return {
        success: true,
        error: null
      };
    } catch (e44) {
      return {
        success: false,
        error: e44.message
      };
    }
  }
  function createCreditNotePayload_CN(p384) {
    const vO46 = {};
    p384.querySelectorAll("[data-field], [data-issuer-field], [data-receiver-field], [data-invoice-field]").forEach(p385 => {
      const v736 = p385.dataset.field || p385.dataset.issuerField || p385.dataset.receiverField || p385.dataset.invoiceField;
      if (v736) {
        vO46[v736] = p385.textContent.trim();
      }
    });
    let vLN033 = 0;
    let vLN034 = 0;
    const v737 = new Map();
    const vA38 = [];
    const vA39 = [];
    p384.querySelectorAll(".items-table tbody tr").forEach(p386 => {
      const vO47 = {};
      p386.querySelectorAll("[data-field]").forEach(p387 => {
        if (p387.querySelectorAll("span[data-field]").length > 0) {
          p387.querySelectorAll("span[data-field]").forEach(p388 => {
            vO47[p388.dataset.field] = p388.textContent.trim();
          });
        } else {
          vO47[p387.dataset.field] = p387.textContent.trim();
        }
      });
      vA39.push(vO47);
      const v738 = parseFloat(vO47.quantity) || 0;
      const v739 = parseFloat(vO47.unit_price) || 0;
      const vParseFloat21 = parseFloat((v738 * v739).toFixed(5));
      vLN033 += vParseFloat21;
      const v740 = parseFloat(vO47.discount_amount) || vParseFloat21 * (parseFloat(vO47.discount_rate) || 0) / 100;
      vLN034 += v740;
      const vParseFloat22 = parseFloat((vParseFloat21 - v740).toFixed(5));
      const vA40 = [];
      let vLN035 = 0;
      for (let vLN18 = 1; vLN18 <= 3; vLN18++) {
        const v741 = vO47["tax_type_" + vLN18]?.trim().toUpperCase();
        const v742 = vO47["tax_rate_" + vLN18];
        if (v741 && v742 != null && v742.trim() !== "" && !isNaN(parseFloat(v742))) {
          const vParseFloat23 = parseFloat(v742);
          const vParseFloat24 = parseFloat((vParseFloat22 * (vParseFloat23 / 100)).toFixed(5));
          const v743 = vO47["tax_subtype_" + vLN18]?.trim() || vO64[v741] || "";
          vA40.push({
            taxType: v741,
            amount: vParseFloat24,
            subType: v743,
            rate: vParseFloat23
          });
          vLN035 += v741 === "T4" ? -vParseFloat24 : vParseFloat24;
          v737.set(v741, (v737.get(v741) || 0) + vParseFloat24);
        }
      }
      vA38.push({
        description: vO47.item_description,
        itemType: vO47.item_type,
        itemCode: vO47.item_code,
        internalCode: vO47.item_internal_code || vO47.item_code,
        unitType: vO47.unit_type,
        quantity: v738,
        unitValue: {
          currencySold: "EGP",
          amountEGP: v739
        },
        salesTotal: vParseFloat21,
        discount: {
          amount: v740
        },
        netTotal: vParseFloat22,
        taxableItems: vA40,
        total: parseFloat((vParseFloat22 + vLN035).toFixed(5)),
        valueDifference: 0,
        totalTaxableFees: 0,
        itemsDiscount: 0
      });
    });
    const v744 = Array.from(v737, ([v745, v746]) => ({
      taxType: v745,
      amount: parseFloat(v746.toFixed(5))
    }));
    const v747 = vA38.reduce((p389, p390) => p389 + p390.total, 0);
    const vO48 = {
      tags: ["FullInvoice", "SignatureRequired"],
      document: {
        documentType: "I",
        documentTypeVersion: "1.0",
        dateTimeIssued: firstLine.dateTimeIssued && !isNaN(new Date(firstLine.dateTimeIssued)) ? new Date(firstLine.dateTimeIssued).toISOString().split(".")[0] + "Z" : new Date().toISOString().split(".")[0] + "Z",
        serviceDeliveryDate: firstLine.serviceDeliveryDate && !isNaN(new Date(firstLine.serviceDeliveryDate)) ? new Date(firstLine.serviceDeliveryDate).toISOString().split("T")[0] : undefined,
        taxpayerActivityCode: document.getElementById("activity-select-editor")?.value || "4690",
        internalID: vO46.internalID,
        issuer: {
          type: "B",
          id: vO46.id,
          name: vO46.name,
          address: {
            branchID: "0",
            country: "EG",
            governate: vO46.governate,
            regionCity: vO46.regionCity,
            street: vO46.street,
            buildingNumber: vO46.buildingNumber
          }
        },
        receiver: {
          type: vO46.receiver_type,
          id: vO46.receiver_id,
          name: vO46.receiver_name,
          address: {
            country: vO46.receiver_country,
            governate: vO46.receiver_governate,
            regionCity: vO46.receiver_city,
            street: vO46.receiver_street,
            buildingNumber: vO46.receiver_building
          }
        },
        invoiceLines: vA38,
        totalSalesAmount: parseFloat(vLN033.toFixed(5)),
        totalDiscountAmount: parseFloat(vLN034.toFixed(5)),
        netAmount: parseFloat((vLN033 - vLN034).toFixed(5)),
        taxTotals: v744,
        totalAmount: parseFloat(v747.toFixed(5)),
        signatures: [{
          signatureType: "I",
          value: "VGVtcG9yYXJ5IFNpZ25hdHVyZSBIb2xkZXI="
        }]
      },
      lineItemCodes: vA39.map(p391 => ({
        codeType: p391.item_type,
        itemCode: p391.item_code,
        codeNamePrimaryLang: p391.item_code_name || p391.item_description,
        codeNameSecondaryLang: p391.item_code_name || p391.item_description
      }))
    };
    return vO48;
  }
  function showSaveAsTemplatePopup(p392) {
    document.getElementById("saveTemplatePopup")?.remove();
    const v748 = document.createElement("div");
    v748.id = "saveTemplatePopup";
    v748.style.cssText = "\n        position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n        background-color: rgba(0,0,0,0.5); z-index: 10002;\n        display: flex; align-items: center; justify-content: center; direction: rtl;\n    ";
    v748.innerHTML = "\n        <div style=\"background: #fff; padding: 25px; border-radius: 10px; width: 400px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);\">\n            <h4 style=\"margin-top: 0; color: #007bff;\">Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙƒÙ†Ù…ÙˆØ°Ø¬</h4>\n            <div style=\"margin-bottom: 15px;\">\n                <label for=\"templateNameInput\" style=\"display: block; margin-bottom: 5px; font-weight: bold;\">Ø§Ø³Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:</label>\n                <input type=\"text\" id=\"templateNameInput\" placeholder=\"Ù…Ø«Ø§Ù„: Ù†Ù…ÙˆØ°Ø¬ ÙÙˆØ§ØªÙŠØ± Ø´Ø±ÙƒØ© X\" style=\"width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px;\">\n            </div>\n            <div style=\"margin-bottom: 20px;\">\n                <label for=\"templateScopeSelect\" style=\"display: block; margin-bottom: 5px; font-weight: bold;\">Ø­ÙØ¸ Ù„Ù€:</label>\n                <select id=\"templateScopeSelect\" style=\"width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px;\">\n                    <option value=\"User\">Ø£Ù†Ø§ ÙÙ‚Ø· (User)</option>\n                    <option value=\"Taxpayer\">Ø¬Ù…ÙŠØ¹ Ù…Ù…Ø«Ù„ÙŠ Ø§Ù„Ù…Ù…ÙˆÙ„ (Taxpayer)</option>\n                </select>\n            </div>\n            <div style=\"display: flex; justify-content: flex-end; gap: 10px;\">\n                <button id=\"cancelTemplateSave\" style=\"background: #6c757d; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;\">Ø¥Ù„ØºØ§Ø¡</button>\n                <button id=\"confirmTemplateSave\" style=\"background: #007bff; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;\">Ø­ÙØ¸</button>\n            </div>\n        </div>\n    ";
    document.body.appendChild(v748);
    document.getElementById("cancelTemplateSave").onclick = () => v748.remove();
    document.getElementById("confirmTemplateSave").onclick = () => {
      const v749 = document.getElementById("templateNameInput").value.trim();
      const v750 = document.getElementById("templateScopeSelect").value;
      if (!v749) {
        alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ù„Ù„Ù†Ù…ÙˆØ°Ø¬.");
        return;
      }
      p392(v749, v750);
      v748.remove();
    };
  }
  function setupCodesExplorerTab() {
    if (document.getElementById("codes-explorer-grid")) {
      return;
    }
    const v751 = document.getElementById("panel-codes-explorer");
    if (!v751) {
      return;
    }
    v751.innerHTML = "\n        <div class=\"panel-header\">\n            <h2>Ù…Ø³ØªÙƒØ´Ù Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù (EGS)</h2>\n            <p>Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ø³Ø¬Ù„Ø© ÙˆØµØ¯Ø±Ù‡Ø§ Ø¥Ù„Ù‰ Ù…Ù„Ù Excel Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù….</p>\n        </div>\n        <div id=\"codes-explorer-grid\" class=\"codes-explorer-grid\">\n            <div class=\"search-panel\">\n                <div class=\"search-options\">\n                    <select id=\"code-search-type\">\n                        <option value=\"rin\">Ø§Ù„Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ù…ÙˆÙ„</option>\n                    </select>\n                </div>\n                <input type=\"text\" id=\"code-search-input\" placeholder=\"Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù...\">\n                <div id=\"export-container\" style=\"margin-top: 15px; display: none;\">\n                    <button id=\"export-excel-btn\" style=\"width: 100%; padding: 12px; background-color: #198754; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px;\">\n                        ğŸ“¥ ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ (Excel)\n                    </button>\n                    <div id=\"export-progress\" style=\"text-align: center; color: #0d6efd; margin-top: 10px; font-weight: bold; display: none;\"></div>\n                </div>\n                <ul id=\"search-results-list\" style=\"margin-top: 15px;\"><li class=\"list-placeholder\">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬...</li></ul>\n            </div>\n            <div class=\"details-panel\">\n                <div id=\"code-details-container\">\n                    <div class=\"list-placeholder\">Ø§Ø®ØªØ± ÙƒÙˆØ¯Ø§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„Ù‡ Ù‡Ù†Ø§...</div>\n                </div>\n            </div>\n        </div>\n    ";
    const vF19 = () => JSON.parse(localStorage.getItem("USER_DATA") || "{}").access_token;
    const vF20 = async p393 => {
      const vVF19 = vF19();
      if (!vVF19) {
        alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.");
        return null;
      }
      try {
        const v752 = await fetch(p393, {
          headers: {
            Authorization: "Bearer " + vVF19
          }
        });
        if (!v752.ok) {
          throw new Error("API Error: " + v752.status);
        }
        return await v752.json();
      } catch (e45) {
        return null;
      }
    };
    const v753 = document.getElementById("code-search-type");
    const v754 = document.getElementById("code-search-input");
    const v755 = document.getElementById("search-results-list");
    const v756 = document.getElementById("code-details-container");
    const v757 = document.getElementById("export-container");
    const v758 = document.getElementById("export-excel-btn");
    const v759 = document.getElementById("export-progress");
    let v760;
    let v761 = null;
    v753.addEventListener("change", () => {
      v754.value = "";
      v755.innerHTML = "<li class=\"list-placeholder\">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬...</li>";
      v756.innerHTML = "<div class=\"list-placeholder\">Ø§Ø®ØªØ± ÙƒÙˆØ¯Ø§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„Ù‡ Ù‡Ù†Ø§...</div>";
      v757.style.display = "none";
      v761 = null;
      v754.placeholder = v753.value === "name" ? "Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù..." : "Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù„Ù„Ø¨Ø­Ø«...";
    });
    v754.addEventListener("input", () => {
      clearTimeout(v760);
      v757.style.display = "none";
      v761 = null;
      let v762 = v754.value.trim();
      if (v762.length < 3) {
        v755.innerHTML = "<li class=\"list-placeholder\">Ø§ÙƒØªØ¨ 3 Ø­Ø±ÙˆÙ/Ø£Ø±Ù‚Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„...</li>";
        return;
      }
      v755.innerHTML = "<li class=\"list-placeholder\">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</li>";
      v760 = setTimeout(async () => {
        const v763 = v753.value;
        let vV762 = v762;
        if (v763 === "rin") {
          vV762 = "EG-" + v762;
          v761 = v762;
        }
        const v764 = "https://api-portal.invoicing.eta.gov.eg/api/v1/codetypes/9/codes?CodeLookupValue=" + encodeURIComponent(vV762) + "&ApplyMinChoiceLevel=true&Ps=50&Pn=1";
        const v765 = await vF20(v764);
        const v766 = v765?.result || [];
        if (v766.length === 0) {
          v755.innerHTML = "<li class=\"list-placeholder\">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬.</li>";
          return;
        }
        if (v763 === "rin") {
          v757.style.display = "block";
        }
        v755.innerHTML = v766.map((p394, p395) => "\n                <li class=\"search-result-item\" data-index=\"" + p395 + "\">\n                    <strong>" + p394.codeNameSecondaryLang + "</strong>\n                    <span>" + p394.codeLookupValue + "</span>\n                </li>\n            ").join("");
        v755.querySelectorAll(".search-result-item").forEach(p396 => {
          p396.addEventListener("click", p397 => {
            v755.querySelectorAll(".search-result-item").forEach(p398 => p398.classList.remove("selected"));
            p397.currentTarget.classList.add("selected");
            const vParseInt3 = parseInt(p397.currentTarget.dataset.index, 10);
            const v767 = v766[vParseInt3];
            vF21(v767);
          });
        });
      }, 500);
    });
    const vF21 = p399 => {
      if (!p399) {
        v756.innerHTML = "<div class=\"list-placeholder\" style=\"color:red;\">ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„.</div>";
        return;
      }
      v756.innerHTML = "\n            <div class=\"detail-card\"><h4>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„ÙƒÙˆØ¯</h4><p><span class=\"label\">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ:</span> <span class=\"value\">" + (p399.codeNameSecondaryLang || "N/A") + "</span></p><p><span class=\"label\">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ:</span> <span class=\"value\">" + (p399.codeNamePrimaryLang || "N/A") + "</span></p><p><span class=\"label\">Ø§Ù„ÙƒÙˆØ¯ (Code):</span> <span class=\"value code\">" + (p399.codeLookupValue || "N/A") + "</span></p><p><span class=\"label\">Ø§Ù„ÙˆØµÙ:</span> <span class=\"value\">" + (p399.codeDescriptionSecondaryLang || "Ù„Ø§ ÙŠÙˆØ¬Ø¯") + "</span></p></div>\n            <div class=\"detail-card\" style=\"border-color: #28a745;\"><h4>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ù„Ùƒ</h4><p><span class=\"label\">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ:</span> <span class=\"value\">" + (p399.ownerTaxpayer?.nameAr || "N/A") + "</span></p><p><span class=\"label\">Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø§Ù„Ùƒ:</span> <span class=\"value code\">" + (p399.ownerTaxpayer?.rin || "N/A") + "</span></p></div>\n            <div class=\"detail-card\" style=\"border-color: #fd7e14;\"><h4>Ø§Ù„ØªØµÙ†ÙŠÙ (GPC)</h4><p><span class=\"label\">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1:</span> <span class=\"value\">" + (p399.codeCategorization?.level1?.nameAr || "N/A") + "</span></p><p><span class=\"label\">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 2:</span> <span class=\"value\">" + (p399.codeCategorization?.level2?.nameAr || "N/A") + "</span></p><p><span class=\"label\">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 3:</span> <span class=\"value\">" + (p399.codeCategorization?.level3?.nameAr || "N/A") + "</span></p><p><span class=\"label\">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 4:</span> <span class=\"value\">" + (p399.codeCategorization?.level4?.nameAr || "N/A") + "</span></p></div>\n        ";
    };
    v758.addEventListener("click", async () => {
      if (!v761) {
        alert("ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹.");
        return;
      }
      v758.disabled = true;
      v759.style.display = "block";
      v759.textContent = "Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
      let vA41 = [];
      let vLN19 = 1;
      let vLN110 = 1;
      try {
        do {
          const v768 = "EG-" + v761;
          const v769 = "https://api-portal.invoicing.eta.gov.eg/api/v1/codetypes/9/codes?CodeLookupValue=" + v768 + "&ApplyMinChoiceLevel=true&Ps=100&Pn=" + vLN19;
          const v770 = await vF20(v769);
          if (v770 && v770.result) {
            vA41.push(...v770.result);
            vLN110 = v770.metadata.totalPages;
            v759.textContent = "Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ ØµÙØ­Ø© " + vLN19 + " Ù…Ù† " + vLN110 + "... (" + vA41.length + " ÙƒÙˆØ¯)";
            vLN19++;
          } else {
            break;
          }
        } while (vLN19 <= vLN110);
        v759.textContent = "ØªÙ… Ø¬Ù„Ø¨ " + vA41.length + " ÙƒÙˆØ¯. Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Excel...";
        const v771 = new ExcelJS.Workbook();
        v771.creator = "ETA Exporter by Mohamed Sabry";
        v771.lastModifiedBy = "ETA Exporter";
        v771.created = new Date();
        v771.rtl = true;
        const v772 = v771.addWorksheet("Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù");
        v772.columns = [{
          header: "CodeType",
          key: "CodeType",
          width: 12
        }, {
          header: "ItemCode",
          key: "ItemCode",
          width: 20
        }, {
          header: "CodeName",
          key: "CodeName",
          width: 45
        }, {
          header: "CodeNameAr",
          key: "CodeNameAr",
          width: 45
        }, {
          header: "Description",
          key: "Description",
          width: 50
        }, {
          header: "DescriptionAr",
          key: "DescriptionAr",
          width: 50
        }, {
          header: "ActiveFrom",
          key: "ActiveFrom",
          width: 18,
          style: {
            numFmt: "dd/mm/yyyy"
          }
        }, {
          header: "ActiveTo",
          key: "ActiveTo",
          width: 18,
          style: {
            numFmt: "dd/mm/yyyy"
          }
        }, {
          header: "GPCItemLink",
          key: "GPCItemLink",
          width: 25
        }, {
          header: "EGSRelatedCode",
          key: "EGSRelatedCode",
          width: 25
        }];
        v772.getRow(1).eachCell(p400 => {
          p400.font = {
            name: "Cairo",
            bold: true,
            size: 12,
            color: {
              argb: "FFFFFFFF"
            }
          };
          p400.fill = {
            type: "pattern",
            pattern: "solid",
            fgColor: {
              argb: "FF0056B3"
            }
          };
          p400.alignment = {
            vertical: "middle",
            horizontal: "center"
          };
        });
        vA41.forEach(p401 => {
          const v773 = p401.codeLookupValue.split("-").pop() || "";
          v772.addRow({
            CodeType: "EGS",
            ItemCode: v773,
            CodeName: p401.codeNamePrimaryLang,
            CodeNameAr: p401.codeNameSecondaryLang,
            Description: p401.codeDescriptionPrimaryLang,
            DescriptionAr: p401.codeDescriptionSecondaryLang,
            ActiveFrom: p401.activeFrom ? new Date(p401.activeFrom) : null,
            ActiveTo: p401.activeTo ? new Date(p401.activeTo) : null,
            GPCItemLink: p401.parentCodeLookupValue,
            EGSRelatedCode: p401.linkedCode
          });
        });
        v772.views = [{
          state: "frozen",
          ySplit: 1,
          rightToLeft: true
        }];
        v772.autoFilter = {
          from: "A1",
          to: {
            row: 1,
            column: v772.columns.length
          }
        };
        v759.textContent = "Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù„Ù...";
        const v774 = await v771.xlsx.writeBuffer();
        const v775 = new Blob([v774], {
          type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
        });
        saveAs(v775, "Ø£ÙƒÙˆØ§Ø¯_" + v761 + ".xlsx");
      } catch (e46) {
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØµØ¯ÙŠØ± Ø§Ù„Ø£ÙƒÙˆØ§Ø¯. Ø§Ù†Ø¸Ø± Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„ Ù„Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„.");
      } finally {
        v758.disabled = false;
        v759.style.display = "none";
      }
    });
  }
  async function deleteDraftInvoiceAPI(p402) {
    const vF839 = getAccessToken();
    if (!vF839) {
      alert("Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙˆÙƒÙ† Ø§Ù„Ø¯Ø®ÙˆÙ„.");
      return false;
    }
    if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.")) {
      return false;
    }
    try {
      const v776 = await fetch("https://api-portal.invoicing.eta.gov.eg/api/v1/documents/drafts/" + p402, {
        method: "DELETE",
        headers: {
          Authorization: "Bearer " + vF839
        }
      });
      if (!v776.ok) {
        let v777 = "ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù…Ø³ÙˆØ¯Ø©. Ø±Ù…Ø² Ø§Ù„Ø­Ø§Ù„Ø©: " + v776.status;
        try {
          const v778 = await v776.json();
          v777 = v778.error?.message || JSON.stringify(v778);
        } catch (e47) {
          v777 = await v776.text();
        }
        throw new Error(v777);
      }
      return true;
    } catch (e48) {
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ø³ÙˆØ¯Ø©: " + e48.message);
      return false;
    }
  }
  async function updateDraftInvoiceAPI(p403, p404, p405) {
    const vF8310 = getAccessToken();
    if (!vF8310) {
      const errorMsg = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙˆÙƒÙ† Ø§Ù„Ø¯Ø®ÙˆÙ„.";
      return {
        success: false,
        error: errorMsg
      };
    }
    const v779 = document.getElementById("creditNoteTypeSelect").value;
    if (v779 === "without_reference" && "references" in p404.document) {
      delete p404.document.references;
    }
    if (p404.document && p404.document.references && p404.document.references.length === 1 && p404.document.references[0] === "") {
      delete p404.document.references;
    }
    const vO49 = {
      ...p404,
      clientsidevalidationresult: true,
      lineItemCodes: p405.map(p406 => ({
        codeType: p406.item_type,
        itemCode: p406.item_code,
        codeNamePrimaryLang: p406.item_code_name || p406.item_description,
        codeNameSecondaryLang: p406.item_code_name || p406.item_description
      }))
    };
    try {
      const v780 = await fetch("https://api-portal.invoicing.eta.gov.eg/api/v1/documents/drafts/" + p403, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          Authorization: "Bearer " + vF8310
        },
        body: JSON.stringify(vO49)
      });
      if (!v780.ok) {
        const v781 = await v780.json();
        const v782 = v781.error?.details?.[0]?.message || v781.error?.message || JSON.stringify(v781);
        throw new Error(v782);
      }
      const v783 = await v780.json();
      return {
        success: true,
        data: v783
      };
    } catch (e49) {
      return {
        success: false,
        error: e49.message
      };
    }
  }
  function f107(p407) {
    const v784 = p407.document;
    if (!v784) {
      return [];
    }
    const v785 = p407.id;
    const vO50 = {
      draftId: v785,
      internalID: v784.internalID,
      receiver_id: v784.receiver.id,
      receiver_name: v784.receiver.name,
      receiver_type: v784.receiver.type,
      receiver_country: v784.receiver.address?.country,
      receiver_governate: v784.receiver.address?.governate,
      receiver_city: v784.receiver.address?.regionCity,
      receiver_street: v784.receiver.address?.street,
      receiver_building: v784.receiver.address?.buildingNumber,
      purchaseOrderReference: v784.purchaseOrderReference,
      purchaseOrderDescription: v784.purchaseOrderDescription,
      salesOrderReference: v784.salesOrderReference,
      salesOrderDescription: v784.salesOrderDescription,
      bankName: v784.payment?.bankName,
      bankAccountNo: v784.payment?.bankAccountNo,
      deliveryApproach: v784.delivery?.approach,
      deliveryPackaging: v784.delivery?.packaging
    };
    return v784.invoiceLines.map(p408 => {
      const vO51 = {
        ...vO50,
        item_description: p408.description,
        item_type: p408.itemType,
        item_code: p408.itemCode,
        item_internal_code: p408.internalCode,
        unit_type: p408.unitType,
        quantity: p408.quantity,
        unit_price: p408.unitValue.amountEGP,
        currency_sold: p408.unitValue.currencySold,
        exchange_rate: p408.unitValue.currencyExchangeRate,
        discount_rate: p408.discount?.rate,
        discount_amount: p408.discount?.amount
      };
      p408.taxableItems.forEach((p409, p410) => {
        if (p410 < 3) {
          vO51["tax_type_" + (p410 + 1)] = p409.taxType;
          vO51["tax_subtype_" + (p410 + 1)] = p409.subType;
          vO51["tax_rate_" + (p410 + 1)] = p409.rate;
        }
      });
      return vO51;
    });
  }
  function updateAllTotals() {
    let vLN036 = 0;
    const v786 = new Map();
    document.querySelectorAll(".invoice-group").forEach(p411 => {
      const v787 = p411.dataset.internalId;
      let vLN037 = 0;
      const v788 = new Map();
      p411.querySelectorAll(".items-table tbody tr").forEach(p412 => {
        const v789 = parseFloat(p412.querySelector("[data-field=\"quantity\"]").textContent) || 0;
        const v790 = parseFloat(p412.querySelector("[data-field=\"unit_price\"]").textContent) || 0;
        const v791 = parseFloat(p412.querySelector("[data-field=\"exchange_rate\"]").textContent) || 1;
        const v792 = parseFloat(p412.querySelector("[data-field=\"discount_rate\"]").textContent) || 0;
        const v793 = parseFloat(p412.querySelector("[data-field=\"discount_amount\"]").textContent) || 0;
        const v794 = v789 * v790 * v791;
        const v795 = v793 || v794 * (v792 / 100);
        const v796 = v794 - v795;
        vLN037 += v796;
        let vLN038 = 0;
        for (let vLN111 = 1; vLN111 <= 3; vLN111++) {
          const v797 = p412.querySelector("[data-field=\"tax_type_" + vLN111 + "\"]").textContent.trim().toUpperCase();
          const v798 = parseFloat(p412.querySelector("[data-field=\"tax_rate_" + vLN111 + "\"]").textContent) || 0;
          if ((v797 === "T2" || v797 === "T3") && v798 > 0) {
            const vParseFloat25 = parseFloat((v796 * (v798 / 100)).toFixed(5));
            vLN038 += vParseFloat25;
            v788.set(v797, (v788.get(v797) || 0) + vParseFloat25);
          }
        }
        const vParseFloat26 = parseFloat((v796 + vLN038).toFixed(5));
        for (let vLN112 = 1; vLN112 <= 3; vLN112++) {
          const v799 = p412.querySelector("[data-field=\"tax_type_" + vLN112 + "\"]").textContent.trim().toUpperCase();
          const v800 = parseFloat(p412.querySelector("[data-field=\"tax_rate_" + vLN112 + "\"]").textContent) || 0;
          if (v799 === "T2" || v799 === "T3") {
            continue;
          }
          if (v799 && v800 > 0) {
            let v801 = v799 === "T1" ? parseFloat((vParseFloat26 * (v800 / 100)).toFixed(5)) : parseFloat((v796 * (v800 / 100)).toFixed(5));
            v788.set(v799, (v788.get(v799) || 0) + v801);
          }
        }
      });
      let vVLN037 = vLN037;
      let vLS14 = "";
      v788.forEach((p413, p414) => {
        vVLN037 += (p414 === "T4" ? -1 : 1) * p413;
        const v802 = vO29[p414] || p414;
        const v803 = p414 === "T4" ? "color: #dc3545;" : "color: #28a745;";
        vLS14 += "<div style=\"" + v803 + " font-size: 12px;\">" + v802 + ": " + p413.toFixed(2) + "</div>";
      });
      document.getElementById("totalBeforeTax_" + v787).textContent = vLN037.toFixed(2);
      document.getElementById("taxTotals_" + v787).innerHTML = vLS14 || "Ù„Ø§ ØªÙˆØ¬Ø¯";
      document.getElementById("grandTotal_" + v787).textContent = vVLN037.toFixed(2);
      vLN036 += vLN037;
      v788.forEach((p415, p416) => {
        v786.set(p416, (v786.get(p416) || 0) + p415);
      });
    });
    let vVLN036 = vLN036;
    let vLS15 = "";
    v786.forEach((p417, p418) => {
      vVLN036 += (p418 === "T4" ? -1 : 1) * p417;
      const v804 = vO29[p418] || p418;
      const v805 = p418 === "T4" ? "style=\"color: #ff6b6b;\"" : "";
      vLS15 += "<span " + v805 + ">" + v804 + ": " + p417.toFixed(2) + "</span>";
    });
    document.getElementById("totalBeforeTax").textContent = vLN036.toFixed(2);
    document.getElementById("taxTotalsContainer").innerHTML = vLS15;
    document.getElementById("grandTotal").textContent = vVLN036.toFixed(2);
  }
  async function sendInvoicesFromModal_v3(p419) {
    const v806 = document.getElementById("saveFromModalBtn");
    v806.disabled = true;
    v806.textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
    const vA42 = [];
    const vA43 = [];
    const vA44 = [];
    for (const [v807, v808] of p419.entries()) {
      const v809 = v808.draftId;
      const v810 = v808.lines[0];
      let v811 = false;
      if (!v810.receiver_name || String(v810.receiver_name).trim() === "") {
        vA42.push({
          id: v807,
          field: "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…",
          value: "ÙØ§Ø±Øº",
          message: "Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ."
        });
        v811 = true;
      }
      if (!v810.receiver_id || String(v810.receiver_id).trim() === "") {
        vA42.push({
          id: v807,
          field: "Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ„Ù…",
          value: "ÙØ§Ø±Øº",
          message: "Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ."
        });
        v811 = true;
      }
      if (v808.lines.length === 0) {
        vA42.push({
          id: v807,
          field: "Ø¨Ù†ÙˆØ¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø©",
          value: "Ù„Ø§ ÙŠÙˆØ¬Ø¯",
          message: "ÙŠØ¬Ø¨ Ø£Ù† ØªØ­ØªÙˆÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ù„Ù‰ Ø¨Ù†Ø¯ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„."
        });
        v811 = true;
      }
      v808.lines.forEach((p420, p421) => {
        const v812 = v807 + " (Ø§Ù„Ø¨Ù†Ø¯ " + (p421 + 1) + ")";
        if (!p420.item_description || String(p420.item_description).trim() === "") {
          vA42.push({
            id: v812,
            field: "ÙˆØµÙ Ø§Ù„ØµÙ†Ù",
            value: "ÙØ§Ø±Øº",
            message: "Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ."
          });
          v811 = true;
        }
        if (!p420.item_code || String(p420.item_code).trim() === "") {
          vA42.push({
            id: v812,
            field: "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù",
            value: "ÙØ§Ø±Øº",
            message: "Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ."
          });
          v811 = true;
        }
        if (!p420.unit_type || String(p420.unit_type).trim() === "") {
          vA42.push({
            id: v812,
            field: "ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³",
            value: "ÙØ§Ø±ØºØ©",
            message: "Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ."
          });
          v811 = true;
        }
        if (isNaN(parseFloat(p420.quantity)) || parseFloat(p420.quantity) <= 0) {
          vA42.push({
            id: v812,
            field: "Ø§Ù„ÙƒÙ…ÙŠØ©",
            value: p420.quantity,
            message: "ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø±Ù‚Ù…Ù‹Ø§ Ù…ÙˆØ¬Ø¨Ù‹Ø§ ÙˆØ£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±."
          });
          v811 = true;
        }
        if (isNaN(parseFloat(p420.unit_price))) {
          vA42.push({
            id: v812,
            field: "Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©",
            value: p420.unit_price,
            message: "ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‚ÙŠÙ…Ø© Ø±Ù‚Ù…ÙŠØ©."
          });
          v811 = true;
        }
        for (let vLN113 = 1; vLN113 <= 3; vLN113++) {
          const v813 = p420["tax_type_" + vLN113]?.trim();
          const v814 = p420["tax_rate_" + vLN113]?.trim();
          if (v813 && !v814 || !v813 && v814) {
            vA42.push({
              id: v812,
              field: "Ø¶Ø±ÙŠØ¨Ø© " + vLN113,
              value: "Ø§Ù„Ù†ÙˆØ¹: " + v813 + ", Ø§Ù„Ù†Ø³Ø¨Ø©: " + v814,
              message: "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©. ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†ÙˆØ¹ ÙˆØ§Ù„Ù†Ø³Ø¨Ø© Ù…Ø¹Ù‹Ø§."
            });
            v811 = true;
          }
        }
      });
      if (!v811) {
        const v_0x1702e1 = createInvoicePayloadFromLines_v3(v808.lines, v808.issuer);
        const v815 = v808.lines;
        if (v809) {
          vA44.push({
            draftId: v809,
            payload: v_0x1702e1,
            rawLines: v815,
            internalID: v807
          });
        } else {
          vA43.push({
            payload: v_0x1702e1,
            rawLines: v815,
            internalID: v807
          });
        }
      }
    }
    if (vA42.length > 0) {
      showErrorModal(vA42);
      v806.disabled = false;
      v806.textContent = "Ø­ÙØ¸ Ø§Ù„ÙÙˆØ§ØªÙŠØ±";
      return;
    }
    const v816 = p419.size;
    let vLN039 = 0;
    v806.textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ (0 / " + v816 + ")...";
    for (const v817 of vA44) {
      try {
        const v818 = await updateDraftInvoiceAPI(v817.draftId, v817.payload, v817.rawLines);
        if (!v818.success) {
          throw new Error(v818.error);
        }
        vLN039++;
        v806.textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ (" + vLN039 + " / " + v816 + ")...";
      } catch (e50) {
        vA42.push({
          id: v817.internalID,
          field: "Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…",
          value: "ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«",
          message: e50.message
        });
      }
    }
    for (const v819 of vA43) {
      try {
        const v820 = await f111(v819.payload);
        if (!v820.success) {
          throw new Error(v820.error);
        }
        const v821 = v820.data.draftId;
        const v822 = await updateDraftInvoiceAPI(v821, v819.payload, v819.rawLines);
        if (!v822.success) {
          await deleteDraftInvoiceAPI(v821);
          throw new Error("ÙØ´Ù„ ÙÙŠ Ø¬Ø¹Ù„ Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ø¬Ø§Ù‡Ø²Ø©: " + v822.error);
        }
        vLN039++;
        v806.textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ (" + vLN039 + " / " + v816 + ")...";
      } catch (e51) {
        vA42.push({
          id: v819.internalID,
          field: "Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…",
          value: "ÙØ´Ù„ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡",
          message: e51.message
        });
      }
    }
    v806.disabled = false;
    v806.textContent = "Ø­ÙØ¸ Ø§Ù„ÙÙˆØ§ØªÙŠØ±";
    if (vA42.length > 0) {
      showErrorModal(vA42);
    } else {
      showSuccessModal("Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!", "ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø¨Ù†Ø¬Ø§Ø­ ÙƒÙ…Ø³ÙˆØ¯Ø§Øª Ø¬Ø§Ù‡Ø²Ø© (Ø¹Ø¯Ø¯: " + v816 + ").", () => {
        document.getElementById("dataEditorModal")?.remove();
        document.getElementById("dataEditorModalStyles")?.remove();
      });
    }
  }
  function showSuccessModal(p422, p423, p424) {
    document.getElementById("customSuccessModal")?.remove();
    const v823 = document.createElement("div");
    v823.id = "customSuccessModal";
    v823.style.cssText = "\n        position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n        background-color: rgba(0, 0, 0, 0.6); z-index: 20000;\n        display: flex; align-items: center; justify-content: center;\n        direction: rtl; font-family: 'Cairo', 'Segoe UI', sans-serif;\n        backdrop-filter: blur(4px);\n    ";
    const vLSsvgWidth80Height80Vi = "\n        <svg width=\"80\" height=\"80\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n            <circle cx=\"12\" cy=\"12\" r=\"10\" fill=\"#28a745\"/>\n            <path d=\"M8.5 12.5L11 15L15.5 10\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n        </svg>\n    ";
    v823.innerHTML = "\n        <div style=\"background: #fff; width: 480px; max-width: 90%; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.2 ); text-align: center; padding: 30px 25px; animation: zoomIn 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);\">\n            <div style=\"margin-bottom: 20px;\">" + vLSsvgWidth80Height80Vi + "</div>\n            <h2 style=\"margin: 0 0 15px 0; font-size: 24px; color: #1d3557;\">" + p422 + "</h2>\n            <p style=\"margin: 0 0 30px 0; font-size: 17px; line-height: 1.7; color: #495057;\">" + p423 + "</p>\n            <button id=\"successModalOkBtn\" style=\"background: linear-gradient(145deg, #28a745, #218838); color: white; padding: 12px 50px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);\">\n                Ù…ÙˆØ§ÙÙ‚\n            </button>\n        </div>\n        <style> \n            @keyframes zoomIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }\n            #successModalOkBtn:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4); }\n        </style>\n    ";
    document.body.appendChild(v823);
    const v824 = document.getElementById("successModalOkBtn");
    v824.onclick = () => {
      v823.remove();
      if (typeof p424 === "function") {
        p424();
      }
    };
  }
  async function f111(p425) {
    const vF8311 = getAccessToken();
    if (!vF8311) {
      return {
        success: false,
        error: "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙˆÙƒÙ† Ø§Ù„Ø¯Ø®ÙˆÙ„."
      };
    }
    const vO52 = {
      "receiver id is required": "Ø­Ù‚Ù„ 'Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ„Ù…' Ø¥Ø¬Ø¨Ø§Ø±ÙŠ.",
      "receiver name is required": "Ø­Ù‚Ù„ 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…' Ø¥Ø¬Ø¨Ø§Ø±ÙŠ.",
      "invalid receiver registration number": "Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ„Ù… (Ø§Ù„Ù…Ø´ØªØ±ÙŠ) ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø©.",
      "issuer and receiver cannot be the same": "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø¨Ø§Ø¦Ø¹ ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠ Ù†ÙØ³ Ø§Ù„Ø´Ø®Øµ (Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…ØªØ·Ø§Ø¨Ù‚).",
      "must be one of [b, p, f]": "Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ„Ù… ØºÙŠØ± ØµØ­ÙŠØ­. ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 'B' Ù„Ø´Ø±ÙƒØ©ØŒ 'P' Ù„Ø´Ø®Øµ Ø·Ø¨ÙŠØ¹ÙŠØŒ Ø£Ùˆ 'F' Ù„Ø£Ø¬Ù†Ø¨ÙŠ.",
      "the submitted document has been processed before": "Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Ø¨Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ) ØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù…Ø³Ø¨Ù‚Ù‹Ø§.",
      "invalid document structure": "Ù‡ÙŠÙƒÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØºÙŠØ± ØµØ­ÙŠØ­. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ© Ù…Ù…ØªÙ„Ø¦Ø©.",
      "document is not valid": "Ø§Ù„Ù…Ø³ØªÙ†Ø¯ ØºÙŠØ± ØµØ§Ù„Ø­. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.",
      "internal id is required": "Ø­Ù‚Ù„ 'Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„ÙØ§ØªÙˆØ±Ø©' Ø¥Ø¬Ø¨Ø§Ø±ÙŠ.",
      "datetimeissued is required": "ØªØ§Ø±ÙŠØ® Ø¥ØµØ¯Ø§Ø± Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ø·Ù„ÙˆØ¨.",
      "invoicelines is required": "ÙŠØ¬Ø¨ Ø£Ù† ØªØ­ØªÙˆÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ù„Ù‰ Ø¨Ù†Ø¯ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.",
      arrayitemnotvalid: "ÙŠÙˆØ¬Ø¯ Ø®Ø·Ø£ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø­Ø¯ Ø§Ù„Ø¨Ù†ÙˆØ¯. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© (ÙƒÙˆØ¯ Ø§Ù„ØµÙ†ÙØŒ ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ØŒ Ø£Ùˆ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨).",
      "item code not found": "Ø£Ø­Ø¯ Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù (EGS/GS1) ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„Ù‡.",
      "invalid item code": "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø£Ø­Ø¯ Ø§Ù„Ø¨Ù†ÙˆØ¯ ØºÙŠØ± ØµØ§Ù„Ø­.",
      "invalid unit type": "ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙˆØ¯ ÙˆØ­Ø¯Ø© Ù‚ÙŠØ§Ø³ ØºÙŠØ± ØµØ§Ù„Ø­ ÙÙŠ Ø£Ø­Ø¯ Ø§Ù„Ø¨Ù†ÙˆØ¯.",
      "description is required": "Ø­Ù‚Ù„ 'ÙˆØµÙ Ø§Ù„ØµÙ†Ù' Ø¥Ø¬Ø¨Ø§Ø±ÙŠ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù†ÙˆØ¯.",
      "quantity is required": "Ø­Ù‚Ù„ 'Ø§Ù„ÙƒÙ…ÙŠØ©' Ø¥Ø¬Ø¨Ø§Ø±ÙŠ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù†ÙˆØ¯ ÙˆÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø±Ù‚Ù…Ù‹Ø§.",
      "unitvalue is required": "Ø­Ù‚Ù„ 'Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©' Ø¥Ø¬Ø¨Ø§Ø±ÙŠ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù†ÙˆØ¯.",
      "invalid tax type": "ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙˆØ¹ Ø¶Ø±ÙŠØ¨Ø© ØºÙŠØ± ØµØ§Ù„Ø­ ÙÙŠ Ø£Ø­Ø¯ Ø§Ù„Ø¨Ù†ÙˆØ¯.",
      "invalid tax subtype": "ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙˆØ¹ Ø¶Ø±ÙŠØ¨Ø© ÙØ±Ø¹ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­ ÙÙŠ Ø£Ø­Ø¯ Ø§Ù„Ø¨Ù†ÙˆØ¯.",
      "taxableitems is required": "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ù…Ø·Ù„ÙˆØ¨Ø© Ù„ÙƒÙ„ Ø¨Ù†Ø¯ Ø®Ø§Ø¶Ø¹ Ù„Ù„Ø¶Ø±ÙŠØ¨Ø©.",
      "tax type is required": "Ø­Ù‚Ù„ 'Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©' Ø¥Ø¬Ø¨Ø§Ø±ÙŠ Ù„Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø®Ø§Ø¶Ø¹Ø© Ù„Ù„Ø¶Ø±ÙŠØ¨Ø©.",
      "total amount does not equal": "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª. Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„Ø§ ÙŠØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¨Ù†ÙˆØ¯ ÙˆØ§Ù„Ø¶Ø±Ø§Ø¦Ø¨.",
      "netamount must be equal to": "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª. ØµØ§ÙÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø© Ù„Ø§ ÙŠØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ (Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª - Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙ…).",
      "totalsalesamount must be equal to": "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª. Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù„Ø§ ÙŠØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ù…Ø¬Ù…ÙˆØ¹ Ù‚ÙŠÙ… Ø§Ù„Ø¨Ù†ÙˆØ¯.",
      unauthorized: "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©. Ù‚Ø¯ ØªÙƒÙˆÙ† Ø¬Ù„Ø³Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‚Ø¯ Ø§Ù†ØªÙ‡Øª. Ø­Ø§ÙˆÙ„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙˆØ§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",
      "bad request": "Ø·Ù„Ø¨ ØºÙŠØ± ØµØ§Ù„Ø­. Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©.",
      "the request is invalid": "Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± ØµØ§Ù„Ø­. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©.",
      "an error has occurred": "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø¹Ø§Ù… ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ù‹Ø§."
    };
    function translateApiError(p426) {
      if (!p426 || !p426.error) {
        const v825 = String(p426).toLowerCase();
        for (const v826 in vO52) {
          if (v825.includes(v826)) {
            return vO52[v826];
          }
        }
        return p426;
      }
      const v827 = p426.error.details || [];
      if (v827.length === 0) {
        const v828 = String(p426.error.message || "").toLowerCase();
        for (const v829 in vO52) {
          if (v828.includes(v829)) {
            return vO52[v829];
          }
        }
        return p426.error.message || "Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù….";
      }
      const v830 = v827.map(p427 => {
        const v831 = p427.message;
        const v832 = p427.target || "";
        let v833 = "Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªØ±Ø¬Ù…: " + v831;
        for (const v834 in vO52) {
          if (String(v831).toLowerCase().includes(v834)) {
            v833 = vO52[v834];
            break;
          }
        }
        const v835 = v832.match(/invoiceLines\[(\d+)\]/);
        if (v835 && v835[1]) {
          const v836 = parseInt(v835[1], 10) + 1;
          return "ÙÙŠ (Ø§Ù„Ø¨Ù†Ø¯ Ø±Ù‚Ù… " + v836 + "): " + v833;
        }
        return v833;
      });
      return v830.join("\n");
    }
    try {
      const v837 = await fetch("https://api-portal.invoicing.eta.gov.eg/api/v1/documents/drafts", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: "Bearer " + vF8311
        },
        body: JSON.stringify(p425)
      });
      if (!v837.ok) {
        const v838 = await v837.json();
        const vF112 = translateApiError(v838);
        throw new Error(vF112);
      }
      const v839 = await v837.json();
      return {
        success: true,
        data: v839
      };
    } catch (e52) {
      return {
        success: false,
        error: e52.message
      };
    }
  }
  async function validateAndEnrichReceiptData(p428) {
    const vA45 = [];
    const v840 = new Map();
    const vO53 = {
      description: "ÙˆØµÙ Ø§Ù„ØµÙ†Ù",
      itemType: "Ù†ÙˆØ¹ ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù",
      itemCode: "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù",
      quantity: "Ø§Ù„ÙƒÙ…ÙŠØ©",
      unitPrice: "Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©"
    };
    async function f114(p429) {
      if (!p429 || p429.length !== 14 || !/^\d+$/.test(p429)) {
        return {
          valid: false,
          message: "ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ† Ù…Ù† 14 Ø±Ù‚Ù…Ù‹Ø§."
        };
      }
      try {
        const vF8312 = getAccessToken();
        if (!vF8312) {
          return {
            valid: false,
            message: "Ø®Ø·Ø£ Ù…ØµØ§Ø¯Ù‚Ø©."
          };
        }
        const v841 = await fetch("https://api-portal.invoicing.eta.gov.eg/api/v1/person/" + p429, {
          headers: {
            Authorization: "Bearer " + vF8312
          }
        });
        if (v841.status === 200) {
          return {
            valid: true
          };
        }
        if (v841.status === 400) {
          return {
            valid: false,
            message: "Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø£Ùˆ ØºÙŠØ± ØµØ­ÙŠØ­."
          };
        }
        return {
          valid: false,
          message: "Ø®Ø·Ø£ " + v841.status + " Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…."
        };
      } catch (e53) {
        return {
          valid: false,
          message: "ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù‚Ù…."
        };
      }
    }
    const v842 = Array.from(p428.entries()).map(async ([v843, v844]) => {
      const vA46 = [];
      let vLN040 = 0;
      for (const [v845, v846] of v844.entries()) {
        const vO54 = {
          ...v846,
          officialCodeName: ""
        };
        vLN040 += (parseFloat(v846.quantity) || 0) * (parseFloat(v846.unitPrice) || 0);
        for (const v847 in vO53) {
          if (!vO54[v847] || String(vO54[v847]).trim() === "") {
            vA45.push({
              id: v843 + " (Ø§Ù„Ø¨Ù†Ø¯ " + (v845 + 1) + ")",
              field: vO53[v847],
              value: "ÙØ§Ø±Øº",
              message: "Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ."
            });
          }
        }
        const v848 = (vO54.itemType || "").toUpperCase().trim();
        const v849 = (vO54.itemCode || "").toString().trim();
        if (v848 && v849) {
          let v850 = null;
          if (v848 === "EGS") {
            v850 = await f92(v849);
          } else if (v848 === "GS1") {
            v850 = await f93(v849);
          }
          if (v850) {
            vO54.officialCodeName = v850.codeNameSecondaryLang || "!! Ø§Ø³Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„ !!";
          } else {
            vA45.push({
              id: v843 + " (Ø§Ù„Ø¨Ù†Ø¯ " + (v845 + 1) + ")",
              field: "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (" + v848 + ")",
              value: v849,
              message: "Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ ØºÙŠØ± Ù…Ø³Ø¬Ù„."
            });
          }
        }
        vA46.push(vO54);
      }
      const v851 = v844[0] || {};
      const v852 = (v851.buyerId || "").toString().trim();
      if (vLN040 > 150000) {
        if (!v852) {
          vA45.push({
            id: v843,
            field: "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„",
            value: "ÙØ§Ø±Øº",
            message: "Ø¥Ø¬Ø¨Ø§Ø±ÙŠ Ù„Ø£Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙŠØªØ¬Ø§ÙˆØ² 150,000 Ø¬Ù†ÙŠÙ‡."
          });
        } else {
          const v853 = await f114(v852);
          if (!v853.valid) {
            vA45.push({
              id: v843,
              field: "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„",
              value: v852,
              message: v853.message
            });
          }
        }
      } else if (v852) {
        const v854 = await f114(v852);
        if (!v854.valid) {
          vA45.push({
            id: v843,
            field: "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„",
            value: v852,
            message: v854.message
          });
        }
      }
      v840.set(v843, vA46);
    });
    await Promise.all(v842);
    return {
      validatedMap: v840,
      validationErrors: vA45
    };
  }
  const vO55 = {
    "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„ÙØ§ØªÙˆØ±Ø©": "Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ù„ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø³Ø±ÙŠØ§Ù„ ",
    "Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ„Ù…": " ÙÙŠ Ø­Ø§Ù„Ù‡ Ø§Ø®ØªÙŠØ§Ø± Ø´Ø±ÙƒØ© ÙŠØªÙ… ÙƒØªØ§Ø¨Ù‡ Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 9 Ø§Ø±Ù‚Ø§Ù… - ÙÙŠ Ø­Ø§Ù„Ù‡ Ø§Ø®ØªÙŠØ§Ø± Ø´Ø®ØµÙŠ ÙŠØªÙ… ÙƒØªØ§Ø¨Ù‡ 123456789 Ø§Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ø§Ù† ÙˆØ¬Ø¯ ÙˆØ¨Ø¹Ø¯ Ø§Ù„Ø±ÙØ¹ ØªÙ‚ÙˆÙ… Ø¨Ø­Ø°ÙÙ‡  ÙˆØ§Ù„Ø§Ø¬Ù†Ø¨ÙŠ Ù†ÙØ³ Ø§Ù„Ù†Ø¸Ø§Ù… ",
    "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…": "ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨ ÙÙŠ Ø­Ø§Ù„Ù‡ ÙƒØªØ§Ø¨Ù‡ Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„",
    "Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ„Ù…": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©: B Ù„Ø´Ø±ÙƒØ©ØŒ P Ù„Ø´Ø®ØµÙŠØŒ F Ù„Ø£Ø¬Ù†Ø¨ÙŠ.",
    "Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…": "ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨ ÙÙŠ Ø­Ø§Ù„Ù‡ ÙƒØªØ§Ø¨Ù‡ Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„",
    "Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…": "ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨ ÙÙŠ Ø­Ø§Ù„Ù‡ ÙƒØªØ§Ø¨Ù‡ Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„",
    "Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…": "ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨ ÙÙŠ Ø­Ø§Ù„Ù‡ ÙƒØªØ§Ø¨Ù‡ Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„",
    "Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ø³ØªÙ„Ù…": "ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨ ÙÙŠ Ø­Ø§Ù„Ù‡ ÙƒØªØ§Ø¨Ù‡ Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„",
    "Ù…Ø¨Ù†Ù‰ Ø§Ù„Ù…Ø³ØªÙ„Ù…": "ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨ ÙÙŠ Ø­Ø§Ù„Ù‡ ÙƒØªØ§Ø¨Ù‡ Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„",
    "ÙˆØµÙ Ø§Ù„ØµÙ†Ù": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø³Ù… Ø£Ùˆ ÙˆØµÙ ÙˆØ§Ø¶Ø­ Ù„Ù„Ø³Ù„Ø¹Ø© Ø£Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©.",
    "Ù†ÙˆØ¹ ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù": "ÙÙŠ Ø­Ø§Ù„Ù‡ Ø§Ø®ØªÙŠØ§Ø± GS1  ÙŠØªÙ… ÙƒØªØ§Ø¨Ù‡ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù…Ø«Ø§Ù„ : - 10007598 Ø§Ù… ÙÙŠ Ø­Ø§Ù„Ù‡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙˆØ¯ EGS  ÙŠØªÙ… ÙƒØªØ§Ø¨Ù‡ Ø§Ù„ÙƒÙˆØ¯ EG-Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„-Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù…Ø«Ø§Ù„ EG-123456789-100",
    "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù": "ÙÙŠ Ø­Ø§Ù„Ù‡ Ø§Ù„Ø§ÙŠØµØ§Ù„Ø§Øª Ù…Ø·Ù„ÙˆØ¨ Ø§Ø¬Ø¨Ø§Ø±ÙŠ ÙƒØªØ§Ø¨Ù‡ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø«Ø§Ù„ 1 Ø§Ù… ÙÙŠ Ø­Ø§Ù„Ù‡ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨ ",
    "ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø®ØªØ± ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ù…Ø«Ø§Ù„: Ù‚Ø·Ø¹Ø©).",
    Ø§Ù„ÙƒÙ…ÙŠØ©: "Ù…Ø·Ù„ÙˆØ¨: Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨Ø§Ø¹ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„ØµÙ†Ù.",
    "Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©": "Ù…Ø·Ù„ÙˆØ¨: Ø³Ø¹Ø± Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø© Ù…Ù† Ø§Ù„ØµÙ†Ù.",
    "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ù…Ø«Ø§Ù„: Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©).",
    "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ 1": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ Ù„Ù„Ø¶Ø±ÙŠØ¨Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ±Ø§Ø¨Ø·Ø©.",
    "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1": "Ù…Ø·Ù„ÙˆØ¨: Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„Ù„Ø¶Ø±ÙŠØ¨Ø© (Ù…Ø«Ø§Ù„: 14).",
    "UUID Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©": "Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª ÙÙ‚Ø·: Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ Ø§Ù„ÙØ±ÙŠØ¯ Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø£ØµÙ„ÙŠØ©."
  };
  async function collectSelectedReceiptsForProcessing() {
    const v855 = Array.from(document.querySelectorAll("#receiptEditorModal .receipt-checkbox:checked")).map(p430 => p430.closest("tbody"));
    if (v855.length === 0) {
      alert("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…Ø³ØªÙ†Ø¯ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.");
      return null;
    }
    const v856 = await getIssuerFullData();
    const vO56 = {
      id: v856.id,
      name: document.getElementById("editor-seller-name").value,
      governate: document.getElementById("editor-seller-governate").value,
      regionCity: document.getElementById("editor-seller-regionCity").value,
      street: document.getElementById("editor-seller-street").value,
      buildingNumber: document.getElementById("editor-seller-building").value
    };
    const v857 = document.getElementById("pos-select-editor").value;
    const v858 = document.getElementById("activity-select-editor");
    const v859 = v858 ? v858.value : "4690";
    const vA47 = [];
    let v860 = (JSON.parse(localStorage.getItem("receiptHistory") || "[]")[0] || {}).uuid || "";
    for (const v861 of v855) {
      const v862 = v861.dataset.receiptNumber;
      const v863 = v861.dataset.docType;
      const v864 = receiptsMap.get(v862);
      const v865 = v863 === "return" ? calculateReceiptData(v864, vO56, v857, v859) : calculateReturnReceiptData(v864, vO56, v857, v859);
      v865.header.previousUUID = v860;
      const v866 = JSON.stringify({
        receipts: [v865]
      });
      const v867 = await vF.computeUuidFromRawText(v866);
      v865.header.uuid = v867;
      vA47.push(v865);
      v860 = v867;
    }
    return {
      receipts: vA47
    };
  }
  async function handleReceiptExcelUpload(p431) {
    const v868 = document.getElementById("receiptUploaderTabbedUI");
    if (v868) {
      v868.style.display = "none";
    }
    const v869 = p431.target.files[0];
    if (!v869) {
      return;
    }
    const vF743 = f74("Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© ÙˆØªØ±Ø¬Ù…Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥ÙŠØµØ§Ù„...");
    try {
      const v870 = new ExcelJS.Workbook();
      await v870.xlsx.load(await v869.arrayBuffer());
      const v871 = v870.getWorksheet(1);
      const v872 = v871.getRow(1).values.slice(1).map(p432 => String(p432 || "").trim());
      const vA48 = [];
      v871.eachRow({
        includeEmpty: false
      }, (p433, p434) => {
        if (p434 > 1) {
          const vO57 = {};
          p433.values.slice(1).forEach((p435, p436) => {
            const v873 = v872[p436];
            if (v873) {
              vO57[v873] = p435 ?? "";
            }
          });
          vA48.push(vO57);
        }
      });
      if (vA48.length === 0) {
        throw new Error("Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„ ÙØ§Ø±Øº!");
      }
      const vO58 = {
        "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø± (YYYY-MM-DD)": "dateTimeIssued",
        "Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ (*)": "receiptNumber",
        "Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "buyerName",
        "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "buyerId",
        "Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„ØµÙ†Ù": "internalCode",
        "ÙˆØµÙ Ø§Ù„ØµÙ†Ù (*)": "description",
        "Ù†ÙˆØ¹ ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (*)": "itemType",
        "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (*)": "itemCode",
        "ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ (*)": "unitType",
        "Ø§Ù„ÙƒÙ…ÙŠØ© (*)": "quantity",
        "Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© (*)": "unitPrice",
        "Ø¹Ù…Ù„Ø© Ø§Ù„Ø¨ÙŠØ¹": "currencySold",
        "Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù": "exchangeRate",
        "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)": "taxType_1",
        "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ Ù„Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)": "taxSubType_1",
        "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)": "taxRate_1",
        "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 2 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "taxType_2",
        "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ Ù„Ù„Ø¶Ø±ÙŠØ¨Ø© 2 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "taxSubType_2",
        "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 2 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "taxRate_2"
      };
      const v874 = vA48.map(p437 => {
        const vO59 = {};
        for (const v875 in p437) {
          const v876 = vO58[v875.trim()];
          if (v876) {
            let v877 = p437[v875];
            if (v876 === "unitType" && vO63.units[v877]) {
              v877 = vO63.units[v877];
            } else if (v876 === "currencySold" && vO.currencies[v877]) {
              v877 = vO.currencies[v877];
            } else if (v876.startsWith("taxType_") && vO63.taxTypes[v877]) {
              v877 = vO63.taxTypes[v877];
            } else if (v876.startsWith("taxSubType_") && vO63.taxSubtypes[v877]) {
              v877 = vO63.taxSubtypes[v877];
            }
            vO59[v876] = v877;
          }
        }
        return vO59;
      });
      const v878 = new Map();
      let v879 = null;
      let vO60 = {};
      v874.forEach(p438 => {
        if (!p438.description && !p438.itemCode) {
          return;
        }
        const v880 = String(p438.receiptNumber || "").trim();
        if (v880) {
          v879 = v880;
          vO60 = {
            dateTimeIssued: p438.dateTimeIssued,
            buyerName: p438.buyerName,
            buyerId: p438.buyerId
          };
          if (!v878.has(v879)) {
            v878.set(v879, []);
          }
        }
        if (!v879) {
          return;
        }
        const vO61 = {
          ...vO60,
          ...p438
        };
        v878.get(v879).push(vO61);
      });
      vF743.querySelector("#toast-message").textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯...";
      const {
        validatedMap: _0x348b52,
        validationErrors: _0x4e0bd7
      } = await validateAndEnrichReceiptData(v878);
      vF743.remove();
      if (_0x4e0bd7.length > 0) {
        showErrorModal(_0x4e0bd7, () => {
          showReceiptEditor(_0x348b52, "sale");
        });
      } else {
        showReceiptEditor(_0x348b52, "sale");
      }
    } catch (e54) {
      alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„Ù Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª: " + e54.message);
    } finally {
      if (vF743) {
        vF743.remove();
      }
      p431.target.value = "";
    }
  }
  function showErrorModal(p439) {
    document.getElementById("invoiceErrorModal")?.remove();
    const v881 = document.createElement("div");
    v881.id = "invoiceErrorModal";
    v881.style.cssText = "\n        position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n        background-color: rgba(0,0,0,0.6); z-index: 10002;\n        display: flex; align-items: center; justify-content: center;\n        direction: rtl; font-family: 'Segoe UI', Tahoma, sans-serif;\n    ";
    v881.innerHTML = "\n        <div style=\"background: #fff; width: 800px; max-width: 90%; max-height: 80%; border-radius: 10px; display: flex; flex-direction: column; box-shadow: 0 5px 20px rgba(0,0,0,0.3); animation: fadeIn 0.3s ease-out;\">\n            \n            <!-- Ø±Ø£Ø³ Ø§Ù„Ù†Ø§ÙØ°Ø© -->\n            <div style=\"padding: 15px 20px; background-color: #d9534f; color: white; border-top-left-radius: 10px; border-top-right-radius: 10px; display: flex; align-items: center; gap: 10px;\">\n                <span style=\"font-size: 24px;\">ğŸš¨</span>\n                <h3 style=\"margin: 0; font-size: 20px;\">ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (" + p439.length + ")</h3>\n            </div>\n\n            <!-- Ø¬Ø³Ù… Ø§Ù„Ù†Ø§ÙØ°Ø© ÙˆØ¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ -->\n            <div style=\"overflow-y: auto; padding: 20px;\">\n                <p style=\"margin-top: 0; color: #333;\">\n                    ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªØ§Ù„ÙŠØ© ÙˆØªØµØ­ÙŠØ­Ù‡Ø§ ÙÙŠ Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³ÙŠÙ„ Ø«Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø±ÙØ¹.\n                </p>\n                <table style=\"width: 100%; border-collapse: collapse; font-size: 14px;\">\n                    <thead style=\"background-color: #f8f9fa; position: sticky; top: 0;\">\n                        <tr>\n                            <th style=\"padding: 10px; border: 1px solid #ddd; text-align: right;\">Ø§Ù„Ù…ÙØ¹Ø±Ù‘Ù (Ø§Ù„ÙØ§ØªÙˆØ±Ø©/Ø§Ù„Ø¨Ù†Ø¯)</th>\n                            <th style=\"padding: 10px; border: 1px solid #ddd; text-align: right;\">Ø§Ù„Ø­Ù‚Ù„</th>\n                            <th style=\"padding: 10px; border: 1px solid #ddd; text-align: right;\">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø©</th>\n                            <th style=\"padding: 10px; border: 1px solid #ddd; text-align: right;\">Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        " + p439.map(p440 => "\n                            <tr style=\"background-color: #fff1f0;\">\n                                <td style=\"padding: 8px; border: 1px solid #ffccc7;\">" + (p440.id || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯") + "</td>\n                                <td style=\"padding: 8px; border: 1px solid #ffccc7;\"><strong>" + (p440.field || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯") + "</strong></td>\n                                <td style=\"padding: 8px; border: 1px solid #ffccc7; font-family: monospace; direction: ltr; text-align: left;\">" + (p440.value || "") + "</td>\n                                <td style=\"padding: 8px; border: 1px solid #ffccc7;\">" + (p440.message || "Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ") + "</td>\n                            </tr>\n                        ").join("") + "\n                    </tbody>\n                </table>\n            </div>\n\n            <!-- ØªØ°ÙŠÙŠÙ„ Ø§Ù„Ù†Ø§ÙØ°Ø© ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± -->\n            <div style=\"padding: 15px 20px; text-align: left; border-top: 1px solid #eee; background-color: #f8f9fa; display: flex; justify-content: flex-end; align-items: center;\">\n                <button id=\"closeErrorModalBtn\" style=\"background: #6c757d; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.2s;\">\n                    Ø¥ØºÙ„Ø§Ù‚\n                </button>\n            </div>\n        </div>\n    ";
    document.body.appendChild(v881);
    const v882 = document.createElement("style");
    v882.id = "errorModalStyles";
    v882.innerText = "@keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } } #closeErrorModalBtn:hover { background-color: #5a6268; }";
    document.head.appendChild(v882);
    document.getElementById("closeErrorModalBtn").onclick = () => {
      v881.remove();
      v882.remove();
    };
  }
  function renderInvoiceCreationTab() {
    const v883 = document.getElementById("etaExporterTabContent");
    if (!v883) {
      return;
    }
    v883.innerHTML = "\n        <div style=\"direction: rtl; text-align: right; padding: 15px; font-family: 'Segoe UI', Tahoma, sans-serif;\">\n            <h4 style=\"margin: 0 0 10px 0; color: #2161a1; border-bottom: 2px solid #ddd; padding-bottom: 10px;\">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙÙˆØ§ØªÙŠØ± (Ù…Ø¹ Ø¯Ø¹Ù… Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø¨Ù†ÙˆØ¯)</h4>\n            <p style=\"font-size: 14px; color: #555; line-height: 1.6;\">\n                Ù„Ø¥Ø¶Ø§ÙØ© Ø¹Ø¯Ø© Ø¨Ù†ÙˆØ¯ Ù„Ù†ÙØ³ Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŒ ÙƒØ±Ø± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Ù…Ø«Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…) ÙÙŠ Ø¹Ø¯Ø© Ø³Ø·ÙˆØ± Ù…Ø¹ ØªØºÙŠÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ù†Ø¯ ÙÙ‚Ø·.\n            </p>\n\n            <!-- âœ… --- Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Checkbox Ø¨Ù‚Ø§Ø¦Ù…Ø© Ù…Ù†Ø³Ø¯Ù„Ø© --- âœ… -->\n            <div style=\"background: #eef7ff; border: 1px solid #bde0ff; border-radius: 8px; padding: 15px; margin: 20px 0;\">\n                <label for=\"invoiceVersionSelect\" style=\"display: block; font-weight: bold; color: #0056b3; margin-bottom: 10px;\">1. Ø­Ø¯Ø¯ Ù†ÙˆØ¹ Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Ø§Ù„Ø¥ØµØ¯Ø§Ø±):</label>\n                <select id=\"invoiceVersionSelect\" style=\"width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 16px;\">\n                    <option value=\"1.0\" selected>ÙØ§ØªÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø© ÙˆÙ…ÙˆÙ‚Ø¹Ø© (Ø¥ØµØ¯Ø§Ø± 1.0)</option>\n                    <option value=\"0.9\">Ù…Ø³ÙˆØ¯Ø© ØºÙŠØ± Ù…ÙˆÙ‚Ø¹Ø© (Ø¥ØµØ¯Ø§Ø± 0.9)</option>\n                </select>\n                <p style=\"font-size: 13px; color: #0056b3; margin: 8px 5px 0 0;\">\n                    Ø§Ø®ØªØ± \"Ø¥ØµØ¯Ø§Ø± 1.0\" Ù„Ù„Ø­ÙØ¸ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØŒ Ø£Ùˆ \"Ø¥ØµØ¯Ø§Ø± 0.9\" Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ±ÙŠØ¯ Ø­ÙØ¸Ù‡Ø§ ÙƒÙ…Ø³ÙˆØ¯Ø© Ø¨Ø¯ÙˆÙ† ØªÙˆÙ‚ÙŠØ¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.\n                </p>\n            </div>\n            <!-- âœ… --- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ --- âœ… -->\n\n            <div style=\"margin: 20px 0; display: flex; gap: 15px;\">\n                <button id=\"downloadTemplateBtn_v3\" style=\"padding: 10px 15px; background-color: #17a2b8; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; flex-grow: 1;\">\n                    ğŸ“¥ 2. ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ Excel\n                </button>\n                <label for=\"excelUploadInput_v3\" style=\"padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; flex-grow: 1; text-align: center;\">\n                    ğŸ“‚ 3. Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ø­ÙØ¸\n                </label>\n                <input type=\"file\" id=\"excelUploadInput_v3\" accept=\".xlsx, .xls\" style=\"display: none;\">\n            </div>\n        </div>\n    ";
    document.getElementById("downloadTemplateBtn_v3").addEventListener("click", downloadExcelTemplate_v3);
    document.getElementById("excelUploadInput_v3").addEventListener("change", handleExcelUpload_v3);
  }
  const vA49 = [{
    code: "EGP",
    desc: "Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ"
  }, {
    code: "USD",
    desc: "Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ"
  }, {
    code: "EUR",
    desc: "ÙŠÙˆØ±Ùˆ"
  }, {
    code: "GBP",
    desc: "Ø¬Ù†ÙŠÙ‡ Ø¥Ø³ØªØ±Ù„ÙŠÙ†ÙŠ"
  }, {
    code: "SAR",
    desc: "Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ"
  }];
  const vA50 = [{
    code: "B",
    desc: "Ø´Ø±ÙƒØ©"
  }, {
    code: "P",
    desc: "Ø´Ø®ØµÙŠ"
  }, {
    code: "F",
    desc: "Ø£Ø¬Ù†Ø¨ÙŠ"
  }];
  const vA51 = [{
    code: "EGS",
    desc: "EGS"
  }, {
    code: "GS1",
    desc: "GS1"
  }];
  const vA52 = [{
    code: "EG",
    Desc_ar: "Ù…ØµØ±"
  }, {
    code: "AD",
    Desc_ar: "Ø£Ù†Ø¯ÙˆØ±Ø§"
  }, {
    code: "AE",
    Desc_ar: "Ø§Ù„Ø§Ù…Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…ØªØ­Ø¯Ø©"
  }, {
    code: "TR",
    Desc_ar: "ØªØ±ÙƒÙŠØ§"
  }, {
    code: "DE",
    Desc_ar: "Ø£Ù„Ù…Ø§Ù†ÙŠØ§"
  }, {
    code: "SG",
    Desc_ar: "Ø³Ù†ØºØ§ÙÙˆØ±Ø©"
  }, {
    code: "US",
    Desc_ar: "Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ù…ØªØ­Ø¯Ø©"
  }, {
    code: "ES",
    Desc_ar: "Ø£Ø³Ø¨Ø§Ù†ÙŠØ§"
  }, {
    code: "NZ",
    Desc_ar: "Ù†ÙŠÙˆØ²ÙŠÙ„Ø§Ù†Ø¯Ø§"
  }, {
    code: "RU",
    Desc_ar: "Ø±ÙˆØ³ÙŠØ§"
  }, {
    code: "OM",
    Desc_ar: "Ø¹Ù…Ø§Ù†"
  }, {
    code: "KP",
    Desc_ar: "ÙƒÙˆØ±ÙŠØ§ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©"
  }, {
    code: "KR",
    Desc_ar: "ÙƒÙˆØ±ÙŠØ§ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©"
  }, {
    code: "MH",
    Desc_ar: "Ø¬Ø²Ø± Ù…Ø§Ø±Ø´Ø§Ù„"
  }, {
    code: "AF",
    Desc_ar: "Ø£ÙØºØ§Ù†Ø³ØªØ§Ù†"
  }, {
    code: "AG",
    Desc_ar: "Ø£Ù†ØªÙŠØºÙˆØ§ ÙˆØ¨Ø§Ø±Ø¨ÙˆØ¯Ø§"
  }, {
    code: "AI",
    Desc_ar: "Ø£Ù†Ø¬ÙˆÙŠÙ„Ø§"
  }, {
    code: "AL",
    Desc_ar: "Ø£Ù„Ø¨Ø§Ù†ÙŠØ§"
  }, {
    code: "AM",
    Desc_ar: "Ø£Ø±Ù…ÙŠÙ†ÙŠØ§"
  }, {
    code: "AO",
    Desc_ar: "Ø£Ù†Ø¬ÙˆÙ„Ø§"
  }, {
    code: "AQ",
    Desc_ar: "Ø§Ù„Ù‚Ø§Ø±Ø© Ø§Ù„Ù‚Ø·Ø¨ÙŠØ© Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©"
  }, {
    code: "AR",
    Desc_ar: "Ø§Ù„Ø£Ø±Ø¬Ù†ØªÙŠÙ†"
  }, {
    code: "AS",
    Desc_ar: "Ø³Ø§Ù…ÙˆØ§ Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠØ©"
  }, {
    code: "AT",
    Desc_ar: "Ø§Ù„Ù†Ù…Ø³Ø§"
  }, {
    code: "AU",
    Desc_ar: "Ø£Ø³ØªØ±Ø§Ù„ÙŠØ§"
  }, {
    code: "AW",
    Desc_ar: "Ø¢Ø±ÙˆØ¨Ø§"
  }, {
    code: "AX",
    Desc_ar: "Ø¬Ø²Ø± Ø£ÙˆÙ„Ø§Ù†"
  }, {
    code: "AZ",
    Desc_ar: "Ø£Ø°Ø±Ø¨ÙŠØ¬Ø§Ù†"
  }, {
    code: "BA",
    Desc_ar: "Ø§Ù„Ø¨ÙˆØ³Ù†Ø© ÙˆØ§Ù„Ù‡Ø±Ø³Ùƒ"
  }, {
    code: "BB",
    Desc_ar: "Ø¨Ø±Ø¨Ø§Ø¯ÙˆØ³"
  }, {
    code: "BD",
    Desc_ar: "Ø¨Ù†Ø¬Ù„Ø§Ø¯ÙŠØ´"
  }, {
    code: "BE",
    Desc_ar: "Ø¨Ù„Ø¬ÙŠÙƒØ§"
  }, {
    code: "BF",
    Desc_ar: "Ø¨ÙˆØ±ÙƒÙŠÙ†Ø§ ÙØ§Ø³Ùˆ"
  }, {
    code: "BG",
    Desc_ar: "Ø¨Ù„ØºØ§Ø±ÙŠØ§"
  }, {
    code: "BH",
    Desc_ar: "Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†"
  }, {
    code: "BI",
    Desc_ar: "Ø¨ÙˆØ±ÙˆÙ†Ø¯ÙŠ"
  }, {
    code: "BJ",
    Desc_ar: "Ø¨Ù†ÙŠÙ†"
  }, {
    code: "BL",
    Desc_ar: "Ø³Ø§Ù† Ø¨Ø§Ø±ØªÙŠÙ„Ù…ÙŠ"
  }, {
    code: "BM",
    Desc_ar: "Ø¨Ø±Ù…ÙˆØ¯Ø§"
  }, {
    code: "BN",
    Desc_ar: "Ø¨Ø±ÙˆÙ†Ø§ÙŠ"
  }, {
    code: "BO",
    Desc_ar: "Ø¨ÙˆÙ„ÙŠÙÙŠØ§"
  }, {
    code: "BQ",
    Desc_ar: "Ø§Ù„Ø¬Ø²Ø± Ø§Ù„ÙƒØ§Ø±ÙŠØ¨ÙŠØ© Ø§Ù„Ù‡ÙˆÙ„Ù†Ø¯ÙŠØ©"
  }, {
    code: "BR",
    Desc_ar: "Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„"
  }, {
    code: "BS",
    Desc_ar: "Ø§Ù„Ø¨Ø§Ù‡Ø§Ù…Ø§"
  }, {
    code: "BT",
    Desc_ar: "Ø¨ÙˆØªØ§Ù†"
  }, {
    code: "BV",
    Desc_ar: "Ø¬Ø²ÙŠØ±Ø© Ø¨ÙˆÙÙŠÙ‡"
  }, {
    code: "BW",
    Desc_ar: "Ø¨ØªØ³ÙˆØ§Ù†Ø§"
  }, {
    code: "BY",
    Desc_ar: "Ø±ÙˆØ³ÙŠØ§ Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡"
  }, {
    code: "BZ",
    Desc_ar: "Ø¨Ù„ÙŠØ²"
  }, {
    code: "CA",
    Desc_ar: "ÙƒÙ†Ø¯Ø§"
  }, {
    code: "CC",
    Desc_ar: "Ø¬Ø²Ø± ÙƒÙˆÙƒÙˆØ³"
  }, {
    code: "CD",
    Desc_ar: "Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„ÙƒÙˆÙ†ØºÙˆ Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ©"
  }, {
    code: "CF",
    Desc_ar: "Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø£ÙØ±ÙŠÙ‚ÙŠØ§ Ø§Ù„ÙˆØ³Ø·Ù‰"
  }, {
    code: "CG",
    Desc_ar: "Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„ÙƒÙˆÙ†ØºÙˆ"
  }, {
    code: "CH",
    Desc_ar: "Ø³ÙˆÙŠØ³Ø±Ø§"
  }, {
    code: "CI",
    Desc_ar: "Ø³Ø§Ø­Ù„ Ø§Ù„Ø¹Ø§Ø¬"
  }, {
    code: "CK",
    Desc_ar: "Ø¬Ø²Ø± ÙƒÙˆÙƒ"
  }, {
    code: "CL",
    Desc_ar: "Ø´ÙŠÙ„ÙŠ"
  }, {
    code: "CM",
    Desc_ar: "Ø§Ù„ÙƒØ§Ù…ÙŠØ±ÙˆÙ†"
  }, {
    code: "CN",
    Desc_ar: "Ø§Ù„ØµÙŠÙ†"
  }, {
    code: "CO",
    Desc_ar: "ÙƒÙˆÙ„ÙˆÙ…Ø¨ÙŠØ§"
  }, {
    code: "CR",
    Desc_ar: "ÙƒÙˆØ³ØªØ§Ø±ÙŠÙƒØ§"
  }, {
    code: "CU",
    Desc_ar: "ÙƒÙˆØ¨Ø§"
  }, {
    code: "CV",
    Desc_ar: "Ø§Ù„Ø±Ø£Ø³ Ø§Ù„Ø£Ø®Ø¶Ø±"
  }, {
    code: "CW",
    Desc_ar: "ÙƒÙˆØ±Ø§Ø³Ø§Ùˆ"
  }, {
    code: "CX",
    Desc_ar: "Ø¬Ø²ÙŠØ±Ø© Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯"
  }, {
    code: "CY",
    Desc_ar: "Ù‚Ø¨Ø±Øµ"
  }, {
    code: "CZ",
    Desc_ar: "Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„ØªØ´ÙŠÙƒ"
  }, {
    code: "DE",
    Desc_ar: "Ø£Ù„Ù…Ø§Ù†ÙŠØ§"
  }, {
    code: "DJ",
    Desc_ar: "Ø¬ÙŠØ¨ÙˆØªÙŠ"
  }, {
    code: "DK",
    Desc_ar: "Ø§Ù„Ø¯Ø§Ù†Ù…Ø±Ùƒ"
  }, {
    code: "DM",
    Desc_ar: "Ø¯ÙˆÙ…ÙŠÙ†ÙŠÙƒØ§"
  }, {
    code: "DO",
    Desc_ar: "Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†ÙŠÙƒØ§Ù†"
  }, {
    code: "DZ",
    Desc_ar: "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±"
  }, {
    code: "EC",
    Desc_ar: "Ø§Ù„Ø§ÙƒÙˆØ§Ø¯ÙˆØ±"
  }, {
    code: "EE",
    Desc_ar: "Ø§Ø³ØªÙˆÙ†ÙŠØ§"
  }, {
    code: "EH",
    Desc_ar: "Ø§Ù„ØµØ­Ø±Ø§Ø¡ Ø§Ù„ØºØ±Ø¨ÙŠØ©"
  }, {
    code: "ER",
    Desc_ar: "Ø§Ø±ÙŠØªØ±ÙŠØ§"
  }, {
    code: "ES",
    Desc_ar: "Ø£Ø³Ø¨Ø§Ù†ÙŠØ§"
  }, {
    code: "ET",
    Desc_ar: "Ø§Ø«ÙŠÙˆØ¨ÙŠØ§"
  }, {
    code: "FI",
    Desc_ar: "ÙÙ†Ù„Ù†Ø¯Ø§"
  }, {
    code: "FJ",
    Desc_ar: "ÙÙŠØ¬ÙŠ"
  }, {
    code: "FK",
    Desc_ar: "Ø¬Ø²Ø± ÙÙˆÙƒÙ„Ø§Ù†Ø¯"
  }, {
    code: "FM",
    Desc_ar: "Ù…ÙŠÙƒØ±ÙˆÙ†ÙŠØ²ÙŠØ§"
  }, {
    code: "FO",
    Desc_ar: "Ø¬Ø²Ø± ÙØ§Ø±Ùˆ"
  }, {
    code: "FR",
    Desc_ar: "ÙØ±Ù†Ø³Ø§"
  }, {
    code: "GA",
    Desc_ar: "Ø§Ù„Ø¬Ø§Ø¨ÙˆÙ†"
  }, {
    code: "GB",
    Desc_ar: "Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù…ØªØ­Ø¯Ø©"
  }, {
    code: "GD",
    Desc_ar: "Ø¬Ø±ÙŠÙ†Ø§Ø¯Ø§"
  }, {
    code: "GE",
    Desc_ar: "Ø¬ÙˆØ±Ø¬ÙŠØ§"
  }, {
    code: "GF",
    Desc_ar: "ØºÙˆÙŠØ§Ù†Ø§ Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©"
  }, {
    code: "GG",
    Desc_ar: "Ø¬ÙŠØ±Ù†Ø²ÙŠ"
  }, {
    code: "GH",
    Desc_ar: "ØºØ§Ù†Ø§"
  }, {
    code: "GI",
    Desc_ar: "Ø¬Ø¨Ù„ Ø·Ø§Ø±Ù‚"
  }, {
    code: "GL",
    Desc_ar: "Ø¬Ø±ÙŠÙ†Ù„Ø§Ù†Ø¯"
  }, {
    code: "GM",
    Desc_ar: "ØºØ§Ù…Ø¨ÙŠØ§"
  }, {
    code: "GN",
    Desc_ar: "ØºÙŠÙ†ÙŠØ§"
  }, {
    code: "GP",
    Desc_ar: "Ø¬ÙˆØ§Ø¯Ù„ÙˆØ¨"
  }, {
    code: "GQ",
    Desc_ar: "ØºÙŠÙ†ÙŠØ§ Ø§Ù„Ø§Ø³ØªÙˆØ§Ø¦ÙŠØ©"
  }, {
    code: "GR",
    Desc_ar: "Ø§Ù„ÙŠÙˆÙ†Ø§Ù†"
  }, {
    code: "GS",
    Desc_ar: "Ø¬ÙˆØ±Ø¬ÙŠØ§ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ© ÙˆØ¬Ø²Ø± Ø³Ø§Ù†Ø¯ÙˆÙŠØªØ´ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©"
  }, {
    code: "GT",
    Desc_ar: "Ø¬ÙˆØ§ØªÙŠÙ…Ø§Ù„Ø§"
  }, {
    code: "GU",
    Desc_ar: "Ø¬ÙˆØ§Ù…"
  }, {
    code: "GW",
    Desc_ar: "ØºÙŠÙ†ÙŠØ§ Ø¨ÙŠØ³Ø§Ùˆ"
  }, {
    code: "GY",
    Desc_ar: "ØºÙŠØ§Ù†Ø§"
  }, {
    code: "HK",
    Desc_ar: "Ù‡ÙˆÙ†Øº ÙƒÙˆÙ†Øº"
  }, {
    code: "HM",
    Desc_ar: "Ø¬Ø²ÙŠØ±Ø© Ù‡ÙŠØ±Ø¯ ÙˆØ¬Ø²Ø± Ù…Ø§ÙƒØ¯ÙˆÙ†Ø§Ù„Ø¯"
  }, {
    code: "HN",
    Desc_ar: "Ù‡Ù†Ø¯ÙˆØ±Ø§Ø³"
  }, {
    code: "HR",
    Desc_ar: "ÙƒØ±ÙˆØ§ØªÙŠØ§"
  }, {
    code: "HT",
    Desc_ar: "Ù‡Ø§ÙŠØªÙŠ"
  }, {
    code: "HU",
    Desc_ar: "Ø§Ù„Ù…Ø¬Ø±"
  }, {
    code: "ID",
    Desc_ar: "Ø§Ù†Ø¯ÙˆÙ†ÙŠØ³ÙŠØ§"
  }, {
    code: "IE",
    Desc_ar: "Ø£ÙŠØ±Ù„Ù†Ø¯Ø§"
  }, {
    code: "IL",
    Desc_ar: "Ø§Ø³Ø±Ø§Ø¦ÙŠÙ„"
  }, {
    code: "IM",
    Desc_ar: "Ø¬Ø²ÙŠØ±Ø© Ù…Ø§Ù†"
  }, {
    code: "IN",
    Desc_ar: "Ø§Ù„Ù‡Ù†Ø¯"
  }, {
    code: "IO",
    Desc_ar: "Ø¥Ù‚Ù„ÙŠÙ… Ø§Ù„Ù…Ø­ÙŠØ· Ø§Ù„Ù‡Ù†Ø¯ÙŠ Ø§Ù„Ø¨Ø±ÙŠØ·Ø§Ù†ÙŠ"
  }, {
    code: "IQ",
    Desc_ar: "Ø§Ù„Ø¹Ø±Ø§Ù‚"
  }, {
    code: "IR",
    Desc_ar: "Ø§ÙŠØ±Ø§Ù†"
  }, {
    code: "IS",
    Desc_ar: "Ø£ÙŠØ³Ù„Ù†Ø¯Ø§"
  }, {
    code: "IT",
    Desc_ar: "Ø§ÙŠØ·Ø§Ù„ÙŠØ§"
  }, {
    code: "JE",
    Desc_ar: "Ø¬ÙŠØ±Ø³ÙŠ"
  }, {
    code: "JM",
    Desc_ar: "Ø¬Ø§Ù…Ø§ÙŠÙƒØ§"
  }, {
    code: "JO",
    Desc_ar: "Ø§Ù„Ø£Ø±Ø¯Ù†"
  }, {
    code: "JP",
    Desc_ar: "Ø§Ù„ÙŠØ§Ø¨Ø§Ù†"
  }, {
    code: "KE",
    Desc_ar: "ÙƒÙŠÙ†ÙŠØ§"
  }, {
    code: "KG",
    Desc_ar: "Ù‚Ø±ØºÙŠØ²Ø³ØªØ§Ù†"
  }];
  const vA53 = [{
    code: "EA",
    desc_ar: "Ù‚Ø·Ø¹Ø©"
  }, {
    code: "KGM",
    desc_ar: "ÙƒÙŠÙ„ÙˆØ¬Ø±Ø§Ù…"
  }, {
    code: "LTR",
    desc_ar: "Ù„ØªØ±"
  }, {
    code: "MTR",
    desc_ar: "Ù…ØªØ±"
  }, {
    code: "TNE",
    desc_ar: "Ø·Ù†"
  }, {
    code: "BOX",
    desc_ar: "ØµÙ†Ø¯ÙˆÙ‚"
  }, {
    code: "CT",
    desc_ar: "ÙƒØ±ØªÙˆÙ†Ø©"
  }, {
    code: "PK",
    desc_ar: "Ø¹Ù„Ø¨Ø©"
  }, {
    code: "SET",
    desc_ar: "Ù…Ø¬Ù…ÙˆØ¹Ø©"
  }, {
    code: "RO",
    desc_ar: "Ù„ÙØ©"
  }, {
    code: "2Z",
    desc_ar: "Ù…ÙŠÙ„ÙŠÙÙˆÙ„Øª"
  }, {
    code: "4K",
    desc_ar: "Ù…ÙŠÙ„ÙŠ Ø£Ù…Ø¨ÙŠØ±"
  }, {
    code: "4O",
    desc_ar: "Ù…ÙŠÙƒØ±ÙˆÙØ§Ø±Ø§Ø¯"
  }, {
    code: "A87",
    desc_ar: "Ø¬ÙŠØ¬Ø§ Ø£ÙˆÙ…"
  }, {
    code: "A93",
    desc_ar: "Ø¬Ø±Ø§Ù… Ù„ÙƒÙ„ Ù…ØªØ± Ù…ÙƒØ¹Ø¨"
  }, {
    code: "A94",
    desc_ar: "Ø¬Ø±Ø§Ù… Ù„ÙƒÙ„ Ø³Ù… Ù…ÙƒØ¹Ø¨"
  }, {
    code: "AMP",
    desc_ar: "Ø£Ù…Ø¨ÙŠØ±"
  }, {
    code: "ANN",
    desc_ar: "Ø³Ù†Ø©"
  }, {
    code: "B22",
    desc_ar: "ÙƒÙŠÙ„Ùˆ Ø£Ù…Ø¨ÙŠØ±"
  }, {
    code: "B49",
    desc_ar: "ÙƒÙŠÙ„Ùˆ Ø£ÙˆÙ…"
  }, {
    code: "B75",
    desc_ar: "Ù…ÙŠØ¬Ø§ Ø£ÙˆÙ…"
  }, {
    code: "B78",
    desc_ar: "Ù…ÙŠØ¬Ø§ ÙÙˆÙ„Øª"
  }, {
    code: "B84",
    desc_ar: "Ù…ÙŠÙƒØ±Ùˆ Ø£Ù…Ø¨ÙŠØ±"
  }, {
    code: "BAR",
    desc_ar: "Ø¨Ø§Ø±"
  }, {
    code: "BBL",
    desc_ar: "Ø¨Ø±Ù…ÙŠÙ„"
  }, {
    code: "BG",
    desc_ar: "Ø´Ù†Ø·Ø©"
  }, {
    code: "BO",
    desc_ar: "Ø²Ø¬Ø§Ø¬Ø©"
  }, {
    code: "C10",
    desc_ar: "Ù…ÙŠÙ„ÙŠ ÙØ§Ø±Ø§Ø¯"
  }, {
    code: "C39",
    desc_ar: "Ù†Ø§Ù†Ùˆ Ø£Ù…Ø¨ÙŠØ±"
  }, {
    code: "C41",
    desc_ar: "Ù†Ø§Ù†Ùˆ ÙØ§Ø±Ø§Ø¯"
  }, {
    code: "C45",
    desc_ar: "Ù†Ø§Ù†Ùˆ Ù…ØªØ±"
  }, {
    code: "C62",
    desc_ar: "ÙˆØ­Ø¯Ø© Ù†Ø´Ø§Ø·"
  }, {
    code: "CA",
    desc_ar: "Ø¹Ø¨ÙˆØ©"
  }, {
    code: "CMK",
    desc_ar: "Ø³Ù…Â²"
  }, {
    code: "CMQ",
    desc_ar: "Ø³Ù…Â³"
  }, {
    code: "CMT",
    desc_ar: "Ø³Ù…"
  }, {
    code: "CS",
    desc_ar: "ÙƒÙŠØ³ ÙƒØ±ØªÙˆÙ†"
  }, {
    code: "CTL",
    desc_ar: "Ø³Ù†ØªÙŠ Ù„ØªØ±"
  }, {
    code: "D10",
    desc_ar: "Ø³ÙŠÙ…Ù†Ø² Ù„ÙƒÙ„ Ù…ØªØ±"
  }, {
    code: "D33",
    desc_ar: "ØªØ³Ù„Ø§"
  }, {
    code: "D41",
    desc_ar: "Ø·Ù†/Ù…ØªØ± Ù…ÙƒØ¹Ø¨"
  }, {
    code: "DAY",
    desc_ar: "ÙŠÙˆÙ…"
  }, {
    code: "DMT",
    desc_ar: "Ø¯ÙŠØ³ÙŠ Ù…ØªØ±"
  }, {
    code: "DRM",
    desc_ar: "Ø£Ø³Ø·ÙˆØ§Ù†Ø©"
  }, {
    code: "FAR",
    desc_ar: "ÙØ§Ø±Ø§Ø¯"
  }, {
    code: "FOT",
    desc_ar: "Ù‚Ø¯Ù…"
  }, {
    code: "FTK",
    desc_ar: "Ù‚Ø¯Ù…Â²"
  }, {
    code: "FTQ",
    desc_ar: "Ù‚Ø¯Ù…Â³"
  }, {
    code: "G42",
    desc_ar: "Ù…ÙŠÙƒØ±Ùˆ Ø³ÙŠÙ…Ù†Ø² Ù„ÙƒÙ„ Ø³Ù…"
  }, {
    code: "GL",
    desc_ar: "Ø¬Ø±Ø§Ù…/Ù„ØªØ±"
  }, {
    code: "GLL",
    desc_ar: "Ø¬Ø§Ù„ÙˆÙ†"
  }, {
    code: "GM",
    desc_ar: "Ø¬Ø±Ø§Ù…/Ù…ØªØ±Â²"
  }, {
    code: "GPT",
    desc_ar: "Ø¬Ø§Ù„ÙˆÙ† Ù„ÙƒÙ„ Ø£Ù„Ù"
  }, {
    code: "GRM",
    desc_ar: "Ø¬Ø±Ø§Ù…"
  }, {
    code: "H63",
    desc_ar: "Ù…Ù„Ø¬Ù…/Ø³Ù…Â²"
  }, {
    code: "HHP",
    desc_ar: "Ø­ØµØ§Ù† Ù‡ÙŠØ¯Ø±ÙˆÙ„ÙŠÙƒÙŠ"
  }, {
    code: "HLT",
    desc_ar: "Ù‡ÙŠÙƒØªÙˆÙ„ØªØ±"
  }, {
    code: "HTZ",
    desc_ar: "Ù‡Ø±ØªØ²"
  }, {
    code: "HUR",
    desc_ar: "Ø³Ø§Ø¹Ø©"
  }, {
    code: "IE",
    desc_ar: "Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ"
  }, {
    code: "INH",
    desc_ar: "Ø¨ÙˆØµØ©"
  }, {
    code: "INK",
    desc_ar: "Ø¨ÙˆØµØ©Â²"
  }, {
    code: "JOB",
    desc_ar: "Ù…Ù‡Ù…Ø© / Ø¹Ù…Ù„"
  }, {
    code: "KHZ",
    desc_ar: "ÙƒÙŠÙ„Ùˆ Ù‡Ø±ØªØ²"
  }, {
    code: "KMH",
    desc_ar: "ÙƒÙ…/Ø³"
  }, {
    code: "KMK",
    desc_ar: "ÙƒÙ…Â²"
  }, {
    code: "KMQ",
    desc_ar: "ÙƒØ¬Ù…/Ù…Â³"
  }, {
    code: "KMT",
    desc_ar: "ÙƒÙŠÙ„ÙˆÙ…ØªØ±"
  }, {
    code: "KSM",
    desc_ar: "ÙƒØ¬Ù…/Ù…Â²"
  }, {
    code: "KVT",
    desc_ar: "ÙƒÙŠÙ„Ùˆ ÙÙˆÙ„Øª"
  }, {
    code: "KWT",
    desc_ar: "ÙƒÙŠÙ„Ùˆ ÙˆØ§Øª"
  }, {
    code: "LB",
    desc_ar: "Ø±Ø·Ù„"
  }, {
    code: "LVL",
    desc_ar: "Ù…Ø³ØªÙˆÙ‰"
  }, {
    code: "MAW",
    desc_ar: "Ù…ÙŠØ¬Ø§ ÙˆØ§Øª"
  }, {
    code: "MGM",
    desc_ar: "Ù…Ù„Ø¬Ù…"
  }, {
    code: "MHZ",
    desc_ar: "Ù…ÙŠØ¬Ø§ Ù‡Ø±ØªØ²"
  }, {
    code: "MIN",
    desc_ar: "Ø¯Ù‚ÙŠÙ‚Ø©"
  }, {
    code: "MMK",
    desc_ar: "Ù…Ù…Â²"
  }, {
    code: "MMQ",
    desc_ar: "Ù…Ù…Â³"
  }, {
    code: "MMT",
    desc_ar: "Ù…Ù„Ù„ÙŠ Ù…ØªØ±"
  }, {
    code: "MON",
    desc_ar: "Ø´Ù‡Ø±"
  }, {
    code: "MTK",
    desc_ar: "Ù…Â²"
  }, {
    code: "MTQ",
    desc_ar: "Ù…Â³"
  }, {
    code: "OHM",
    desc_ar: "Ø£ÙˆÙ…"
  }, {
    code: "ONZ",
    desc_ar: "Ø£ÙˆÙ†ØµØ©"
  }, {
    code: "PAL",
    desc_ar: "Ø¨Ø§Ø³ÙƒØ§Ù„"
  }, {
    code: "PF",
    desc_ar: "Ø·Ø¨Ø§Ù„ÙŠ"
  }, {
    code: "SMI",
    desc_ar: "Ù…ÙŠÙ„"
  }, {
    code: "ST",
    desc_ar: "Ø·Ù† Ù‚ØµÙŠØ±"
  }, {
    code: "VLT",
    desc_ar: "ÙÙˆÙ„Øª"
  }, {
    code: "WEE",
    desc_ar: "Ø£Ø³Ø¨ÙˆØ¹"
  }, {
    code: "WTT",
    desc_ar: "ÙˆØ§Øª"
  }, {
    code: "X03",
    desc_ar: "Ù…ØªØ±/Ø³Ø§Ø¹Ø©"
  }, {
    code: "YDQ",
    desc_ar: "ÙŠØ§Ø±Ø¯Ø©Â³"
  }, {
    code: "YRD",
    desc_ar: "ÙŠØ§Ø±Ø¯Ø©"
  }, {
    code: "NMP",
    desc_ar: "Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ø§ÙƒØ§Øª"
  }, {
    code: "5I",
    desc_ar: "Ù‚Ø¯Ù… Ù‚ÙŠØ§Ø³ÙŠ"
  }, {
    code: "AE",
    desc_ar: "Ø£Ù…Ø¨ÙŠØ± Ù„ÙƒÙ„ Ù…ØªØ±"
  }, {
    code: "B4",
    desc_ar: "Ø¨Ø±Ù…ÙŠÙ„ Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠ"
  }, {
    code: "BB",
    desc_ar: "Ø¨ÙŠØ² Ø¨ÙˆÙƒØ³"
  }, {
    code: "BD",
    desc_ar: "Ù„ÙˆØ­"
  }, {
    code: "BE",
    desc_ar: "Ø±Ø¨Ø·Ø©"
  }, {
    code: "BK",
    desc_ar: "Ø³Ù„Ø©"
  }, {
    code: "BL",
    desc_ar: "Ø¨Ø§Ù„Ø©"
  }, {
    code: "CH",
    desc_ar: "ÙƒÙˆÙ†ØªÙŠÙ†Ø±"
  }, {
    code: "CR",
    desc_ar: "Crate"
  }, {
    code: "DAA",
    desc_ar: "Ø¯ÙŠÙƒØ§Ø±"
  }, {
    code: "DTN",
    desc_ar: "Ø¯ÙŠØ³Ø·Ù†"
  }, {
    code: "DZN",
    desc_ar: "Ø¯Ø³ØªØ©"
  }, {
    code: "FP",
    desc_ar: "Ø±Ø·Ù„/Ù‚Ø¯Ù…Â²"
  }, {
    code: "HMT",
    desc_ar: "Ù‡ÙŠÙƒØªÙˆÙ…ØªØ±"
  }, {
    code: "INQ",
    desc_ar: "Ø¨ÙˆØµØ©Â³"
  }, {
    code: "KG",
    desc_ar: "ÙƒÙØ¬"
  }, {
    code: "KTM",
    desc_ar: "ÙƒÙ…"
  }, {
    code: "LO",
    desc_ar: "Ù„ÙˆØ·"
  }, {
    code: "MLT",
    desc_ar: "Ù…Ù„Ù„ÙŠÙ„ØªØ±"
  }, {
    code: "MT",
    desc_ar: "Ø­ØµÙŠØ±"
  }, {
    code: "NA",
    desc_ar: "Ù…Ù„Ø¬Ù…/ÙƒØ¬Ù…"
  }, {
    code: "NAR",
    desc_ar: "Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª"
  }, {
    code: "NC",
    desc_ar: "Ø¹Ø±Ø¨ÙŠØ©"
  }, {
    code: "NE",
    desc_ar: "Ù„ØªØ± ØµØ§ÙÙ"
  }, {
    code: "NPL",
    desc_ar: "Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ø±ÙˆØ¯"
  }, {
    code: "NV",
    desc_ar: "Ù…Ø±ÙƒØ¨Ø©"
  }, {
    code: "PA",
    desc_ar: "Ø¨Ø§ÙƒÙŠØª"
  }, {
    code: "PG",
    desc_ar: "Ø·Ø¨Ù‚"
  }];
  const vO62 = {
    T1: {
      desc: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©",
      subtypes: [{
        code: "V001",
        desc: "ØªØµØ¯ÙŠØ± Ù„Ù„Ø®Ø§Ø±Ø¬ (0%)"
      }, {
        code: "V002",
        desc: "ØªØµØ¯ÙŠØ± Ù…Ù†Ø§Ø·Ù‚ Ø­Ø±Ø© (0%)"
      }, {
        code: "V003",
        desc: "Ø³Ù„Ø¹Ø© Ø£Ùˆ Ø®Ø¯Ù…Ø© Ù…Ø¹ÙØ§Ø©"
      }, {
        code: "V004",
        desc: "Ø³Ù„Ø¹Ø© Ø£Ùˆ Ø®Ø¯Ù…Ø© ØºÙŠØ± Ø®Ø§Ø¶Ø¹Ø©"
      }, {
        code: "V005",
        desc: "Ø¥Ø¹ÙØ§Ø¡Ø§Øª Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠØ©"
      }, {
        code: "V008",
        desc: "Ø¥Ø¹ÙØ§Ø¡Ø§Øª Ø®Ø§ØµØ©"
      }, {
        code: "V009",
        desc: "Ø³Ù„Ø¹ Ø¹Ø§Ù…Ø© (14%)"
      }, {
        code: "V010",
        desc: "Ù†Ø³Ø¨ Ø£Ø®Ø±Ù‰"
      }]
    },
    T2: {
      desc: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ù†Ø³Ø¨ÙŠØ©)",
      subtypes: [{
        code: "Tbl01",
        desc: "Ø¶Ø±ÙŠØ¨Ø© Ø¬Ø¯ÙˆÙ„ Ù†Ø³Ø¨ÙŠØ©"
      }]
    },
    T3: {
      desc: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø§Ù„Ù†ÙˆØ¹ÙŠØ©)",
      subtypes: [{
        code: "Tbl02",
        desc: "Ø¶Ø±ÙŠØ¨Ø© Ø¬Ø¯ÙˆÙ„ Ù†ÙˆØ¹ÙŠØ© (Ù‚Ø·Ø¹ÙŠØ©)"
      }]
    },
    T4: {
      desc: "Ø§Ù„Ø®ØµÙ… ØªØ­Øª Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©",
      subtypes: [{
        code: "W001",
        desc: "Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª"
      }, {
        code: "W002",
        desc: "Ø§Ù„ØªÙˆØ±ÙŠØ¯Ø§Øª"
      }, {
        code: "W003",
        desc: "Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª"
      }, {
        code: "W004",
        desc: "Ø§Ù„Ø®Ø¯Ù…Ø§Øª"
      }, {
        code: "W010",
        desc: "Ø£ØªØ¹Ø§Ø¨ Ù…Ù‡Ù†ÙŠØ©"
      }]
    },
    T5: {
      desc: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¯Ù…ØºØ© (Ù†Ø³Ø¨ÙŠØ©)",
      subtypes: [{
        code: "ST01",
        desc: "Ø¯Ù…ØºØ© Ù†Ø³Ø¨ÙŠØ©"
      }]
    },
    T6: {
      desc: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¯Ù…ØºØ© (Ù‚Ø·Ø¹ÙŠØ©)",
      subtypes: [{
        code: "ST02",
        desc: "Ø¯Ù…ØºØ© Ù‚Ø·Ø¹ÙŠØ©"
      }]
    },
    T7: {
      desc: "Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù…Ù„Ø§Ù‡ÙŠ",
      subtypes: [{
        code: "Ent01",
        desc: "Ù…Ù„Ø§Ù‡ÙŠ (Ù†Ø³Ø¨Ø©)"
      }]
    },
    T8: {
      desc: "Ø±Ø³Ù… ØªÙ†Ù…ÙŠØ© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯",
      subtypes: [{
        code: "RD01",
        desc: "ØªÙ†Ù…ÙŠØ© Ù…ÙˆØ§Ø±Ø¯ (Ù†Ø³Ø¨Ø©)"
      }]
    },
    T9: {
      desc: "Ø±Ø³Ù… Ø®Ø¯Ù…Ø©",
      subtypes: [{
        code: "SC01",
        desc: "Ø±Ø³Ù… Ø®Ø¯Ù…Ø© (Ù†Ø³Ø¨Ø©)"
      }]
    },
    T10: {
      desc: "Ø±Ø³Ù… Ø§Ù„Ù…Ø­Ù„ÙŠØ§Øª",
      subtypes: [{
        code: "Mn01",
        desc: "Ø±Ø³Ù… Ù…Ø­Ù„ÙŠØ§Øª (Ù†Ø³Ø¨Ø©)"
      }]
    },
    T11: {
      desc: "Ø±Ø³Ù… Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„ØµØ­ÙŠ",
      subtypes: [{
        code: "MI01",
        desc: "ØªØ£Ù…ÙŠÙ† ØµØ­ÙŠ (Ù†Ø³Ø¨Ø©)"
      }]
    },
    T12: {
      desc: "Ø±Ø³ÙˆÙ… Ø£Ø®Ø±Ù‰",
      subtypes: [{
        code: "OF01",
        desc: "Ø±Ø³ÙˆÙ… Ø£Ø®Ø±Ù‰ (Ù†Ø³Ø¨Ø©)"
      }]
    }
  };
  const vO63 = {
    receiverTypes: Object.fromEntries(vA50.map(p441 => [p441.desc, p441.code])),
    itemCodeTypes: Object.fromEntries(vA51.map(p442 => [p442.desc, p442.code])),
    countries: Object.fromEntries(vA52.map(p443 => [p443.Desc_ar, p443.code])),
    units: Object.fromEntries(vA53.map(p444 => [p444.desc_ar, p444.code])),
    currencies: Object.fromEntries(vA49.map(p445 => [p445.desc, p445.code])),
    taxTypes: Object.fromEntries(Object.entries(vO62).map(([v884, v885]) => [v885.desc, v884])),
    taxSubtypes: Object.fromEntries(Object.values(vO62).flatMap(p446 => p446.subtypes.map(p447 => [p447.desc, p447.code])))
  };
  async function downloadExcelTemplate_v3() {
    const vF744 = f74("Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥ÙƒØ³ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ...", 0);
    try {
      if (typeof ExcelJS === "undefined") {
        throw new Error("Ù…ÙƒØªØ¨Ø© ExcelJS ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©.");
      }
      const v886 = new ExcelJS.Workbook();
      const v887 = v886.addWorksheet("Invoices");
      const v888 = v886.addWorksheet("Lists");
      v888.getCell("A1").value = "ReceiverTypes";
      vA50.forEach((p448, p449) => {
        v888.getCell("A" + (p449 + 2)).value = p448.desc;
      });
      v888.getCell("B1").value = "CodeTypes";
      vA51.forEach((p450, p451) => {
        v888.getCell("B" + (p451 + 2)).value = p450.code;
      });
      v888.getCell("C1").value = "UnitTypes";
      vA53.forEach((p452, p453) => {
        v888.getCell("C" + (p453 + 2)).value = p452.desc_ar;
      });
      v888.getCell("D1").value = "Currencies";
      vA49.forEach((p454, p455) => {
        v888.getCell("D" + (p455 + 2)).value = p454.desc;
      });
      v888.getCell("E1").value = "MainTaxTypes";
      Object.values(vO62).forEach((p456, p457) => {
        v888.getCell("E" + (p457 + 2)).value = p456.desc;
      });
      v888.getCell("F1").value = "Countries";
      vA52.forEach((p458, p459) => {
        v888.getCell("F" + (p459 + 2)).value = p458.Desc_ar;
      });
      let vLN7 = 7;
      Object.values(vO62).forEach(p460 => {
        const v889 = v888.getCell(1, vLN7);
        const v890 = p460.desc.replace(/[ ()]/g, "_");
        v889.value = v890;
        p460.subtypes.forEach((p461, p462) => {
          v888.getCell(p462 + 2, vLN7).value = p461.desc;
        });
        vLN7++;
      });
      const vA54 = ["Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ (*)", "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±", "ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…", "Ø±Ù‚Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)", "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)", "Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)", "Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)", "Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)", "Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)", "Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)", "Ù…Ø¨Ù†Ù‰ Ø§Ù„Ù…Ø³ØªÙ„Ù… (*)", "ÙˆØµÙ Ø§Ù„ØµÙ†Ù (*)", "Ù†ÙˆØ¹ ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (*)", "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (*)", "Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ", "ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ (*)", "Ø§Ù„ÙƒÙ…ÙŠØ© (*)", "Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© (*)", "Ø¹Ù…Ù„Ø© Ø§Ù„Ø¨ÙŠØ¹", "Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù", "Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ…", "Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…", "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)", "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ 1 (*)", "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)", "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 2", "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ 2", "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 2", "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 3", "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ 3", "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 3", "Ù…Ø±Ø¬Ø¹ Ø´Ø±Ø§Ø¡", "ÙˆØµÙ Ø´Ø±Ø§Ø¡", "Ù…Ø±Ø¬Ø¹ Ù…Ø¨ÙŠØ¹Ø§Øª", "ÙˆØµÙ Ù…Ø¨ÙŠØ¹Ø§Øª", "Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ", "Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†Ùƒ", "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„", "Ø§Ù„ØªØºÙ„ÙŠÙ"];
      v887.columns = vA54.map(p463 => ({
        header: p463,
        key: p463
      }));
      v887.getRow(1).eachCell(p464 => {
        const v891 = p464.value;
        const v892 = v891.replace(" (*)", "");
        if (vO55[v892]) {
          p464.note = vO55[v892];
        }
        p464.font = {
          name: "Arial",
          bold: true,
          size: 14,
          color: {
            argb: "FFFFFFFF"
          }
        };
        p464.fill = {
          type: "pattern",
          pattern: "solid",
          fgColor: {
            argb: "FF343A40"
          }
        };
        p464.alignment = {
          vertical: "middle",
          horizontal: "center"
        };
      });
      v887.autoFilter = {
        from: "A1",
        to: {
          row: 1,
          column: vA54.length
        }
      };
      v887.columns.forEach(p465 => {
        let vLN041 = 0;
        p465.eachCell({
          includeEmpty: true
        }, p466 => {
          const v893 = p466.value ? String(p466.value).length : 0;
          const v894 = p466.address.startsWith(p465.letter + "1") ? String(p466.value).length : 0;
          if (Math.max(v893, v894) > vLN041) {
            vLN041 = Math.max(v893, v894);
          }
        });
        p465.width = Math.max(15, Math.min(vLN041 + 5, 45));
      });
      const vF22 = (p467, p468) => {
        for (let vLN24 = 2; vLN24 <= 1001; vLN24++) {
          v887.getCell("" + p467 + vLN24).dataValidation = {
            type: "list",
            allowBlank: true,
            formulae: [p468]
          };
        }
      };
      vF22("F", "=Lists!$A$2:$A$4");
      vF22("G", "=Lists!$F$2:$F$" + (vA52.length + 1));
      vF22("M", "=Lists!$B$2:$B$3");
      vF22("P", "=Lists!$C$2:$C$" + (vA53.length + 1));
      vF22("S", "=Lists!$D$2:$D$" + (vA49.length + 1));
      vF22("W", "=Lists!$E$2:$E$" + (Object.keys(vO62).length + 1));
      vF22("Z", "=Lists!$E$2:$E$" + (Object.keys(vO62).length + 1));
      vF22("AC", "=Lists!$E$2:$E$" + (Object.keys(vO62).length + 1));
      const vLSINDIRECTSUBSTITUTESU8 = "=INDIRECT(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(W2,\" \",\"_\"),\"(\",\"_\"),\")\",\"_\"))";
      const vLSINDIRECTSUBSTITUTESU9 = "=INDIRECT(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(Z2,\" \",\"_\"),\"(\",\"_\"),\")\",\"_\"))";
      const vLSINDIRECTSUBSTITUTESU10 = "=INDIRECT(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(AC2,\" \",\"_\"),\"(\",\"_\"),\")\",\"_\"))";
      vF22("X", vLSINDIRECTSUBSTITUTESU8);
      vF22("AA", vLSINDIRECTSUBSTITUTESU9);
      vF22("AD", vLSINDIRECTSUBSTITUTESU10);
      Object.values(vO62).forEach((p469, p470) => {
        const v895 = String.fromCharCode("A".charCodeAt(0) + 6 + p470);
        const v896 = p469.desc.replace(/[ ()]/g, "_");
        const v897 = "Lists!$" + v895 + "$2:$" + v895 + "$" + (p469.subtypes.length + 1);
        v886.definedNames.add(v897, v896);
      });
      v888.state = "hidden";
      v887.views = [{
        rightToLeft: true
      }];
      const v898 = await v886.xlsx.writeBuffer();
      const v899 = new Blob([v898], {
        type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
      });
      if (typeof saveAs === "undefined") {
        throw new Error("Ù…ÙƒØªØ¨Ø© FileSaver.js ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©.");
      }
      saveAs(v899, "Ù†Ù…ÙˆØ°Ø¬_ÙÙˆØ§ØªÙŠØ±_Ø§Ø­ØªØ±Ø§ÙÙŠ_ÙƒØ§Ù…Ù„.xlsx");
    } catch (e55) {
      alert("ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥ÙƒØ³ÙŠÙ„: " + e55.message);
    } finally {
      vF744.remove();
    }
  }
  const vO64 = {
    T1: "V009",
    T2: "Tbl01",
    T3: "Tbl02",
    T4: "W001",
    T5: "ST01",
    T6: "ST02",
    T7: "Ent01",
    T8: "RD01",
    T9: "SC01",
    T10: "Mn01",
    T11: "MI01",
    T12: "OF01"
  };
  function f120(p471, p472 = 100) {
    if (p471 === null || p471 === undefined) {
      return "";
    }
    let vString = String(p471);
    if (vString.length > p472) {
      vString = vString.substring(0, p472);
    }
    return vString.trim();
  }
  function createInvoicePayloadFromLines_v3(p473, p474) {
    if (!p473 || p473.length === 0) {
      throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù†ÙˆØ¯ Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©.");
    }
    const v900 = p473[0];
    const v901 = document.querySelector(".invoice-type-btn.active");
    const v902 = v901 ? v901.dataset.type : "FullInvoice";
    const v903 = document.getElementById("activity-select-editor");
    const v904 = v903 ? v903.value : p474.taxpayerActivityCode;
    const vO65 = {
      type: "B",
      id: p474.id,
      name: f120(p474.name),
      address: {
        branchID: "0",
        country: "EG",
        governate: f120(p474.governate),
        regionCity: f120(p474.regionCity),
        street: f120(p474.street),
        buildingNumber: String(p474.buildingNumber || "").replace(/[^A-Za-z0-9\-\/]/g, ""),
        postalCode: "",
        floor: "",
        room: "",
        landmark: "",
        additionalInformation: ""
      }
    };
    if (!vO65.id || !vO65.name) {
      throw new Error("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ¯Ø± (Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ø§Ø³Ù…) Ù…Ø·Ù„ÙˆØ¨Ø©.");
    }
    let v905;
    if (v900.dateTimeIssued && !isNaN(new Date(v900.dateTimeIssued))) {
      const v906 = new Date(v900.dateTimeIssued);
      const v907 = new Date();
      v906.setHours(v907.getHours(), v907.getMinutes(), v907.getSeconds());
      v905 = v906.toISOString().split(".")[0] + "Z";
    } else {
      v905 = new Date().toISOString().split(".")[0] + "Z";
    }
    let v908;
    if (v900.serviceDeliveryDate && !isNaN(new Date(v900.serviceDeliveryDate))) {
      v908 = new Date(v900.serviceDeliveryDate).toISOString().split("T")[0];
    } else {
      v908 = undefined;
    }
    let vLN042 = 0;
    let vLN043 = 0;
    const v909 = new Map();
    const v910 = p473.map(p475 => {
      const vParseFloat27 = parseFloat((parseFloat(p475.quantity) || 0).toFixed(5));
      const vParseFloat28 = parseFloat((parseFloat(p475.unit_price) || 0).toFixed(5));
      const v911 = parseFloat(p475.exchange_rate) || 1;
      const vParseFloat29 = parseFloat((vParseFloat28 * v911).toFixed(5));
      const vParseFloat30 = parseFloat((vParseFloat27 * vParseFloat29).toFixed(5));
      vLN042 += vParseFloat30;
      let v912 = parseFloat(p475.discount_amount) || vParseFloat30 * (parseFloat(p475.discount_rate) || 0) / 100;
      v912 = parseFloat(v912.toFixed(5));
      vLN043 += v912;
      const vParseFloat31 = parseFloat((vParseFloat30 - v912).toFixed(5));
      const vA55 = [];
      let vLN044 = 0;
      let vLN045 = 0;
      for (let vLN114 = 1; vLN114 <= 3; vLN114++) {
        const v913 = p475["tax_type_" + vLN114]?.trim().toUpperCase();
        const v914 = p475["tax_rate_" + vLN114];
        if ((v913 === "T2" || v913 === "T3") && v914 && !isNaN(parseFloat(v914))) {
          const vParseFloat32 = parseFloat(v914);
          const vParseFloat33 = parseFloat((vParseFloat31 * (vParseFloat32 / 100)).toFixed(5));
          const v915 = p475["tax_subtype_" + vLN114]?.trim() || vO64[v913] || "";
          vA55.push({
            taxType: v913,
            amount: vParseFloat33,
            subType: v915,
            rate: vParseFloat32
          });
          vLN045 += vParseFloat33;
          vLN044 += vParseFloat33;
          v909.set(v913, (v909.get(v913) || 0) + vParseFloat33);
        }
      }
      const v916 = vParseFloat31 + vLN045;
      for (let vLN115 = 1; vLN115 <= 3; vLN115++) {
        const v917 = p475["tax_type_" + vLN115]?.trim().toUpperCase();
        const v918 = p475["tax_rate_" + vLN115];
        if (v917 === "T2" || v917 === "T3") {
          continue;
        }
        if (v917 && v918 && !isNaN(parseFloat(v918))) {
          const vParseFloat34 = parseFloat(v918);
          let v919 = v917 === "T1" ? parseFloat((v916 * (vParseFloat34 / 100)).toFixed(5)) : parseFloat((vParseFloat31 * (vParseFloat34 / 100)).toFixed(5));
          const v920 = p475["tax_subtype_" + vLN115]?.trim() || vO64[v917] || "";
          vA55.push({
            taxType: v917,
            amount: v919,
            subType: v920,
            rate: vParseFloat34
          });
          vLN044 += v917 === "T4" ? -v919 : v919;
          v909.set(v917, (v909.get(v917) || 0) + v919);
        }
      }
      const v921 = (p475.currency_sold || "EGP").toUpperCase();
      const vO66 = {
        currencySold: v921,
        amountEGP: vParseFloat29,
        amountSold: 0
      };
      if (v921 !== "EGP") {
        vO66.amountSold = vParseFloat28;
        vO66.currencyExchangeRate = v911;
      }
      const vParseFloat35 = parseFloat((vParseFloat31 + vLN044).toFixed(5));
      return {
        description: f120(p475.item_description || p475.item_code_name || p475.item_code, 100),
        itemType: p475.item_type,
        itemCode: p475.item_code,
        internalCode: f120(p475.item_internal_code),
        unitType: p475.unit_type,
        quantity: vParseFloat27,
        salesTotal: vParseFloat30,
        discount: {
          amount: v912
        },
        netTotal: vParseFloat31,
        total: vParseFloat35,
        unitValue: vO66,
        taxableItems: vA55,
        valueDifference: 0,
        totalTaxableFees: 0,
        itemsDiscount: 0
      };
    });
    const v922 = Array.from(v909, ([v923, v924]) => ({
      taxType: v923,
      amount: parseFloat(v924.toFixed(5))
    }));
    const vParseFloat36 = parseFloat(vLN042.toFixed(5));
    const vParseFloat37 = parseFloat(vLN043.toFixed(5));
    const vParseFloat38 = parseFloat((vParseFloat36 - vParseFloat37).toFixed(5));
    const vParseFloat39 = parseFloat(v910.reduce((p476, p477) => p476 + p477.total, 0).toFixed(5));
    const v925 = document.getElementById("invoiceVersionSelect")?.value || "1.0";
    const v926 = v925 === "0.9";
    const v927 = v926 ? ["SimpleInvoice"] : [v902, "SignatureRequired"];
    const v928 = v926 ? [] : [{
      signatureType: "I",
      value: "VGVtcG9yYXJ5IFNpZ25hdHVyZSBIb2xkZXI="
    }];
    const vO67 = {
      country: (v900.receiver_country || "").toUpperCase().trim(),
      governate: f120(v900.receiver_governate),
      regionCity: f120(v900.receiver_city),
      street: f120(v900.receiver_street),
      buildingNumber: String(v900.receiver_building || "").replace(/[^A-Za-z0-9\-\/]/g, ""),
      postalCode: "",
      floor: "",
      room: "",
      landmark: "",
      additionalInformation: ""
    };
    const vO68 = {
      issuer: vO65,
      receiver: {
        address: vO67,
        type: v900.receiver_type || "B",
        id: v900.receiver_type === "P" && !v900.receiver_id ? "20101012100000" : v900.receiver_id,
        name: f120(v900.receiver_name)
      },
      documentType: "I",
      documentTypeVersion: v925,
      dateTimeIssued: v905,
      taxpayerActivityCode: v904,
      internalID: v900.internalID,
      invoiceLines: v910,
      totalSalesAmount: vParseFloat36,
      totalDiscountAmount: vParseFloat37,
      netAmount: vParseFloat38,
      taxTotals: v922,
      totalAmount: vParseFloat39,
      totalItemsDiscountAmount: 0,
      extraDiscountAmount: 0,
      signatures: v928
    };
    if (v908) {
      vO68.serviceDeliveryDate = v908;
    }
    if (v902 === "FullInvoice") {
      vO68.purchaseOrderReference = f120(v900.purchaseOrderReference);
      vO68.purchaseOrderDescription = f120(v900.purchaseOrderDescription);
      vO68.salesOrderReference = f120(v900.salesOrderReference);
      vO68.salesOrderDescription = f120(v900.salesOrderDescription);
      vO68.proformaInvoiceNumber = "";
      vO68.payment = {
        bankName: f120(v900.bankName),
        bankAccountNo: f120(v900.bankAccountNo),
        swiftCode: ""
      };
      vO68.delivery = {
        approach: f120(v900.deliveryApproach),
        packaging: f120(v900.deliveryPackaging)
      };
    } else {
      vO68.payment = {};
      vO68.delivery = {};
    }
    return {
      tags: v927,
      document: vO68
    };
  }
  function showErrorModal(p478) {
    document.getElementById("invoiceErrorModal")?.remove();
    const v929 = document.createElement("div");
    v929.id = "invoiceErrorModal";
    v929.style.cssText = "\n        position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n        background-color: rgba(0,0,0,0.6); z-index: 10002;\n        display: flex; align-items: center; justify-content: center;\n        direction: rtl; font-family: 'Segoe UI', Tahoma, sans-serif;\n    ";
    v929.innerHTML = "\n        <div style=\"background: #fff; width: 800px; max-width: 90%; max-height: 80%; border-radius: 10px; display: flex; flex-direction: column; box-shadow: 0 5px 20px rgba(0,0,0,0.3); animation: fadeIn 0.3s ease-out;\">\n            \n            <!-- Ø±Ø£Ø³ Ø§Ù„Ù†Ø§ÙØ°Ø© -->\n            <div style=\"padding: 15px 20px; background-color: #d9534f; color: white; border-top-left-radius: 10px; border-top-right-radius: 10px; display: flex; align-items: center; gap: 10px;\">\n                <span style=\"font-size: 24px;\">ğŸš¨</span>\n                <h3 style=\"margin: 0; font-size: 20px;\">ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (" + p478.length + ")</h3>\n            </div>\n\n            <!-- Ø¬Ø³Ù… Ø§Ù„Ù†Ø§ÙØ°Ø© ÙˆØ¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ -->\n            <div style=\"overflow-y: auto; padding: 20px;\">\n                <p style=\"margin-top: 0; color: #333;\">\n                    ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªØ§Ù„ÙŠØ© ÙˆØªØµØ­ÙŠØ­Ù‡Ø§ ÙÙŠ Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³ÙŠÙ„ Ø«Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø±ÙØ¹.\n                </p>\n                <table style=\"width: 100%; border-collapse: collapse; font-size: 14px;\">\n                    <thead style=\"background-color: #f8f9fa; position: sticky; top: 0;\">\n                        <tr>\n                            <th style=\"padding: 10px; border: 1px solid #ddd; text-align: right;\">Ø§Ù„Ù…ÙØ¹Ø±Ù‘Ù (Ø§Ù„ÙØ§ØªÙˆØ±Ø©/Ø§Ù„Ø¨Ù†Ø¯)</th>\n                            <th style=\"padding: 10px; border: 1px solid #ddd; text-align: right;\">Ø§Ù„Ø­Ù‚Ù„</th>\n                            <th style=\"padding: 10px; border: 1px solid #ddd; text-align: right;\">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø©</th>\n                            <th style=\"padding: 10px; border: 1px solid #ddd; text-align: right;\">Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        " + p478.map(p479 => "\n                            <tr style=\"background-color: #fff1f0;\">\n                                <td style=\"padding: 8px; border: 1px solid #ffccc7;\">" + (p479.id || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯") + "</td>\n                                <td style=\"padding: 8px; border: 1px solid #ffccc7;\"><strong>" + (p479.field || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯") + "</strong></td>\n                                <td style=\"padding: 8px; border: 1px solid #ffccc7; font-family: monospace; direction: ltr; text-align: left;\">" + (p479.value || "") + "</td>\n                                <td style=\"padding: 8px; border: 1px solid #ffccc7;\">" + (p479.message || "Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ") + "</td>\n                            </tr>\n                        ").join("") + "\n                    </tbody>\n                </table>\n            </div>\n\n            <!-- ØªØ°ÙŠÙŠÙ„ Ø§Ù„Ù†Ø§ÙØ°Ø© ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± -->\n            <div style=\"padding: 15px 20px; text-align: left; border-top: 1px solid #eee; background-color: #f8f9fa; display: flex; justify-content: flex-end; align-items: center;\">\n                <button id=\"closeErrorModalBtn\" style=\"background: #6c757d; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.2s;\">\n                    Ø¥ØºÙ„Ø§Ù‚\n                </button>\n            </div>\n        </div>\n    ";
    document.body.appendChild(v929);
    const v930 = document.createElement("style");
    v930.id = "errorModalStyles";
    v930.innerText = "@keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } } #closeErrorModalBtn:hover { background-color: #5a6268; }";
    document.head.appendChild(v930);
    document.getElementById("closeErrorModalBtn").onclick = () => {
      v929.remove();
      v930.remove();
    };
  }
  function printInvoice(p480, p481) {
    const v931 = p481.querySelector(".invoice-header-row");
    const v932 = v931.querySelector("[data-field=\"internalID\"]").textContent.trim();
    const v933 = v931.querySelector("[data-field=\"receiver_name\"]").textContent.trim();
    const v934 = v931.querySelector("[data-field=\"receiver_id\"]").textContent.trim();
    const v935 = v931.querySelector("[data-field=\"dateTimeIssued\"]").textContent.trim();
    const v936 = v931.querySelector("[data-field=\"serviceDeliveryDate\"]").textContent.trim();
    const vO69 = {};
    p481.querySelectorAll(".receiver-details-table [data-receiver-field]").forEach(p482 => {
      const v937 = p482.dataset.receiverField;
      vO69[v937] = p482.textContent.trim();
    });
    const vO70 = {};
    p481.querySelectorAll(".issuer-details-table [data-issuer-field]").forEach(p483 => {
      const v938 = p483.dataset.issuerField;
      vO70[v938] = p483.textContent.trim();
    });
    const vO71 = {};
    p481.querySelectorAll(".extra-details-table [data-invoice-field]").forEach(p484 => {
      const v939 = p484.dataset.invoiceField;
      vO71[v939] = p484.textContent.trim();
    });
    const vA56 = [];
    p481.querySelectorAll(".items-table tbody tr").forEach(p485 => {
      const vO72 = {};
      p485.querySelectorAll("[data-field]").forEach(p486 => {
        const v940 = p486.dataset.field;
        if (p486.children.length > 1) {
          p486.querySelectorAll("span[data-field]").forEach(p487 => {
            vO72[p487.dataset.field] = p487.textContent.trim();
          });
        } else {
          vO72[v940] = p486.textContent.trim();
        }
      });
      vA56.push(vO72);
    });
    const v_0x29230f = f124({
      internalID: v932,
      receiver_name: v933,
      receiver_id: v934,
      receiverAddress: vO69,
      issuerData: vO70,
      extraInvoiceData: vO71,
      invoiceLines: vA56,
      invoiceDate: new Date().toLocaleDateString("ar-EG")
    });
    const v941 = window.open("", "_blank", "width=800,height=600");
    v941.document.write(v_0x29230f);
    v941.document.close();
    v941.onload = function () {
      const v942 = v941.document.createElement("button");
      v942.textContent = "Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©";
      v942.style.cssText = "position: fixed; top: 10px; right: 10px; padding: 10px 15px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;";
      v942.onclick = function () {
        v941.print();
      };
      v941.document.body.appendChild(v942);
    };
  }
  function f124(p488) {
    let vLN046 = 0;
    let vLN047 = 0;
    const v943 = new Map();
    const v944 = p488.invoiceLines.map(p489 => {
      const vParseFloat40 = parseFloat(p489.quantity || 0);
      const vParseFloat41 = parseFloat(p489.unit_price || 0);
      const vParseFloat42 = parseFloat(p489.exchange_rate || 1);
      const v945 = vParseFloat40 * vParseFloat41 * vParseFloat42;
      let v946 = parseFloat(p489.discount_amount) || v945 * (parseFloat(p489.discount_rate) || 0) / 100;
      const v947 = v945 - v946;
      let vLN048 = 0;
      for (let vLN116 = 1; vLN116 <= 3; vLN116++) {
        const v948 = p489["tax_type_" + vLN116]?.trim().toUpperCase();
        const vParseFloat43 = parseFloat(p489["tax_rate_" + vLN116] || 0);
        if (v948 && vParseFloat43 > 0) {
          const v949 = v947 * (vParseFloat43 / 100);
          vLN048 += (v948 === "T4" ? -1 : 1) * v949;
          v943.set(v948, (v943.get(v948) || 0) + v949);
        }
      }
      const v950 = v947 + vLN048;
      vLN047 += v946;
      vLN046 += v947;
      return "\n            <tr>\n                <td>" + (p489.item_code || "") + "</td>\n                <td>" + (p489.item_description || "") + "</td>\n                <td>" + vParseFloat40 + "</td>\n                <td>" + (p489.unit_type || "") + "</td>\n                <td>" + vParseFloat41.toFixed(2) + "</td>\n                <td>" + v947.toFixed(2) + "</td>\n                <td>" + vLN048.toFixed(2) + "</td>\n                <td>" + v950.toFixed(2) + "</td>\n            </tr>\n        ";
    }).join("");
    let v951 = "\n        <tr><td class=\"total-label\">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ø¬.Ù…)</td><td class=\"total-value\">" + (vLN046 + vLN047).toFixed(2) + "</td></tr>\n        <tr><td class=\"total-label\">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙ… (Ø¬.Ù…)</td><td class=\"total-value\">" + vLN047.toFixed(2) + "</td></tr>\n    ";
    let vVLN046 = vLN046;
    v943.forEach((p490, p491) => {
      vVLN046 += (p491 === "T4" ? -1 : 1) * p490;
      v951 += "<tr><td class=\"total-label\">" + (vO29[p491] || p491) + " (Ø¬.Ù…)</td><td class=\"total-value\">" + p490.toFixed(2) + "</td></tr>";
    });
    return "\n        <!DOCTYPE html>\n        <html dir=\"rtl\">\n        <head>\n            <meta charset=\"UTF-8\">\n            <title>Ù…Ø¹Ø§ÙŠÙ†Ø© ÙØ§ØªÙˆØ±Ø© " + p488.internalID + "</title>\n            <style>\n                body { font-family: 'Tahoma', 'Segoe UI', sans-serif; margin: 0; padding: 20px; background-color: #f9f9f9; color: #333; }\n                .invoice-container { background: white; max-width: 900px; margin: 0 auto; padding: 25px; border: 1px solid #e0e0e0; }\n                .header { text-align: center; border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-bottom: 20px; }\n                .header h1 { font-size: 28px; margin: 0; color: #000; }\n                .header .invoice-meta { font-size: 14px; margin-top: 10px; color: #555; }\n                .header .warning-text { font-size: 14px; margin-top: 10px; color: #d9534f; font-weight: bold; }\n                .info-section { display: flex; justify-content: space-between; margin-bottom: 15px; padding: 15px; border: 1px solid #ddd; background-color: #f8f9fa; }\n                .info-section > div { flex-basis: 48%; }\n                .info-section h3 { margin-top: 0; font-size: 16px; border-bottom: 1px solid #ccc; padding-bottom: 8px; color: #337ab7; }\n                .info-section p { margin: 6px 0; font-size: 13px; line-height: 1.5; }\n                /* --- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© --- */\n                .extra-details-section {\n                    padding: 10px 15px;\n                    border: 1px solid #ddd;\n                    background-color: #f8f9fa;\n                    margin-bottom: 20px;\n                    display: grid;\n                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n                    gap: 10px;\n                }\n                .extra-details-section div { font-size: 12px; }\n                .extra-details-section strong { color: #337ab7; }\n                /* --- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ --- */\n                .items-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }\n                .items-table th, .items-table td { border: 1px solid #ddd; padding: 8px; font-size: 16px; text-align: center; }\n                .items-table th { background-color: #e7e8e9; white-space: nowrap; }\n                .totals-section { width: 45%; margin-left: 0; margin-right: auto; font-size: 13px; }\n                .totals-section table { width: 100%; border-collapse: collapse; }\n                .totals-section td { padding: 8px; border-bottom: 1px solid #eee; }\n                .totals-section .total-label { font-weight: bold; text-align: right; }\n                .totals-section .total-value { text-align: left; }\n                .totals-section .grand-total td { font-weight: bold; font-size: 15px; background-color: #f2f2f2; border-top: 2px solid #333; }\n                .footer { margin-top: 40px; text-align: center; font-size: 12px; color: #777; }\n                @media print { body { background: white; padding: 0; } .invoice-container { box-shadow: none; border: none; } #printBtn { display: none; } }\n            </style>\n        </head>\n        <body>\n            <div class=\"invoice-container\">\n                <button id=\"printBtn\" style=\"position: fixed; top: 10px; left: 10px; padding: 10px 15px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;\" onclick=\"window.print()\">Ø·Ø¨Ø§Ø¹Ø©</button>\n                <div class=\"header\">\n                    <h1>ÙØ§ØªÙˆØ±Ø©</h1>\n                    <div class=\"invoice-meta\"><span>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: " + p488.internalID + "</span> | <span>Ø§Ù„ØªØ§Ø±ÙŠØ®: " + p488.invoiceDate + "</span></div>\n                    <p class=\"warning-text\">Ù…Ø¹Ø§ÙŠÙ†Ø© Ù„ÙØ§ØªÙˆØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ (ØºÙŠØ± Ù…Ø¹ØªÙ…Ø¯Ø©)</p>\n                </div>\n                <div class=\"info-section\">\n                    <div><h3>Ø§Ù„Ø¨Ø§Ø¦Ø¹</h3><p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> " + (p488.issuerData.name || "") + "</p><p><strong>Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</strong> " + (p488.issuerData.id || "") + "</p><p>" + (p488.issuerData.street || "") + ", " + (p488.issuerData.regionCity || "") + ", " + (p488.issuerData.governate || "") + "</p></div>\n                    <div><h3>Ø§Ù„Ù…Ø´ØªØ±ÙŠ</h3><p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> " + p488.receiver_name + "</p><p><strong>Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</strong> " + p488.receiver_id + "</p><p>" + (p488.receiverAddress.receiver_street || "") + ", " + (p488.receiverAddress.receiver_city || "") + ", " + (p488.receiverAddress.receiver_governate || "") + "</p></div>\n                </div>\n                \n                <!-- --- Ø¨Ø¯Ø§ÙŠØ© Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© --- -->\n                <div class=\"extra-details-section\">\n                    <div><strong>Ù…Ø±Ø¬Ø¹ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡:</strong> " + (p488.extraInvoiceData.purchaseOrderReference || "") + "</div>\n                    <div><strong>ÙˆØµÙ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡:</strong> " + (p488.extraInvoiceData.purchaseOrderDescription || "") + "</div>\n                    <div><strong>Ù…Ø±Ø¬Ø¹ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª:</strong> " + (p488.extraInvoiceData.salesOrderReference || "") + "</div>\n                    <div><strong>ÙˆØµÙ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª:</strong> " + (p488.extraInvoiceData.salesOrderDescription || "") + "</div>\n                    <div><strong>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ:</strong> " + (p488.extraInvoiceData.bankName || "") + "</div>\n                    <div><strong>Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†Ùƒ:</strong> " + (p488.extraInvoiceData.bankAccountNo || "") + "</div>\n                    <div><strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„:</strong> " + (p488.extraInvoiceData.deliveryApproach || "") + "</div>\n                    <div><strong>Ø§Ù„ØªØºÙ„ÙŠÙ:</strong> " + (p488.extraInvoiceData.deliveryPackaging || "") + "</div>\n                </div>\n                <!-- --- Ù†Ù‡Ø§ÙŠØ© Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© --- -->\n\n                <table class=\"items-table\">\n                    <thead>\n                        <tr>\n                            <th>ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„ÙˆØµÙ</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th>\n                            <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</th>\n                        </tr>\n                    </thead>\n                    <tbody>" + v944 + "</tbody>\n                </table>\n                <div class=\"totals-section\">\n                    <table>\n                        <tbody>\n                            " + v951 + "\n                            <tr class=\"grand-total\">\n                                <td class=\"total-label\">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº (Ø¬.Ù…)</td>\n                                <td class=\"total-value\">" + vVLN046.toFixed(2) + "</td>\n                            </tr>\n                        </tbody>\n                    </table>\n                </div>\n                <div class=\"footer\"><p>Ø§Ù„ØªÙˆÙ‚ÙŠØ¹: _________________________</p></div>\n            </div>\n        </body>\n        </html>\n    ";
  }
  async function downloadReturnReceiptExcelTemplate() {
    const vF745 = f74("Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„...", 0);
    try {
      if (typeof ExcelJS === "undefined") {
        throw new Error("Ù…ÙƒØªØ¨Ø© ExcelJS ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ù.");
      }
      const v952 = new ExcelJS.Workbook();
      const v953 = v952.addWorksheet("Ù‚Ø§Ù„Ø¨ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø±ØªØ¬Ø¹");
      const v954 = v952.addWorksheet("Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
      const vA57 = [{
        code: "EGS"
      }, {
        code: "GS1"
      }];
      v954.getCell("A1").value = "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯";
      vA57.forEach((p492, p493) => {
        v954.getCell("A" + (p493 + 2)).value = p492.code;
      });
      v954.getCell("B1").value = "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ÙˆØ­Ø¯Ø§Øª";
      vA53.forEach((p494, p495) => {
        v954.getCell("B" + (p495 + 2)).value = p494.desc_ar;
      });
      v954.getCell("C1").value = "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©";
      Object.values(vO62).forEach((p496, p497) => {
        v954.getCell("C" + (p497 + 2)).value = p496.desc;
      });
      v954.getCell("D1").value = "Currencies";
      vA.forEach((p498, p499) => {
        v954.getCell("D" + (p499 + 2)).value = p498.Desc_ar;
      });
      let vLN52 = 5;
      Object.values(vO62).forEach(p500 => {
        const v955 = v954.getCell(1, vLN52);
        const v956 = p500.desc.replace(/[ ()]/g, "_");
        v955.value = v956;
        p500.subtypes.forEach((p501, p502) => {
          v954.getCell(p502 + 2, vLN52).value = p501.desc;
        });
        const v957 = String.fromCharCode("A".charCodeAt(0) + vLN52 - 1);
        const v958 = "'Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'!$" + v957 + "$2:$" + v957 + "$" + (p500.subtypes.length + 1);
        v952.definedNames.add(v958, v956);
        vLN52++;
      });
      const vO73 = {
        "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø± (YYYY-MM-DD)": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø£Ø¯Ø®Ù„ ØªØ§Ø±ÙŠØ® Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø±ØªØ¬Ø¹.",
        "Ø±Ù‚Ù… Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø±ØªØ¬Ø¹ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø±Ù‚Ù… ÙØ±ÙŠØ¯ ÙŠÙ…ÙŠØ² Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù…Ø±ØªØ¬Ø¹.",
        "UUID Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ Ø§Ù„ÙØ±ÙŠØ¯ Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø£ØµÙ„ÙŠØ©.",
        "Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±ÙŠ.",
        "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ù…Ø´ØªØ±ÙŠ.",
        "Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„ØµÙ†Ù": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù†Ø¸Ø§Ù…Ùƒ.",
        "ÙˆØµÙ Ø§Ù„ØµÙ†Ù (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø³Ù… Ø£Ùˆ ÙˆØµÙ ÙˆØ§Ø¶Ø­ Ù„Ù„Ø³Ù„Ø¹Ø© Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø©.",
        "Ù†ÙˆØ¹ ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (EGS Ø£Ùˆ GS1).",
        "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù„ØµÙ†Ù.",
        "ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø®ØªØ± ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.",
        "Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø© (*)": "Ù…Ø·Ù„ÙˆØ¨: ÙƒÙ…ÙŠØ© Ø§Ù„ØµÙ†Ù Ø§Ù„ØªÙŠ ØªÙ… Ø¥Ø±Ø¬Ø§Ø¹Ù‡Ø§.",
        "Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© ÙˆÙ‚Øª Ø§Ù„Ø¨ÙŠØ¹ (*)": "Ù…Ø·Ù„ÙˆØ¨: ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù†ÙØ³ Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø°ÙŠ ØªÙ… Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ù‡ ÙÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©.",
        "Ø¹Ù…Ù„Ø© Ø§Ù„Ø¨ÙŠØ¹": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…Ù„Ø©. ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù†ÙØ³ Ø¹Ù…Ù„Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©.",
        "Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù": "Ø¥Ø¬Ø¨Ø§Ø±ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¹Ù…Ù„Ø© ØºÙŠØ± Ø§Ù„Ø¬Ù†ÙŠÙ‡. ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù†ÙØ³ Ø³Ø¹Ø± ØµØ±Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©.",
        "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ.",
        "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ Ù„Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ Ù„Ù„Ø¶Ø±ÙŠØ¨Ø©.",
        "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)": "Ù…Ø·Ù„ÙˆØ¨: Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„Ù„Ø¶Ø±ÙŠØ¨Ø©.",
        "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 2 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØµÙ†Ù Ø®Ø§Ø¶Ø¹Ù‹Ø§ Ù„Ø¶Ø±ÙŠØ¨Ø© Ø£Ø®Ø±Ù‰.",
        "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ Ù„Ù„Ø¶Ø±ÙŠØ¨Ø© 2 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ Ù„Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©.",
        "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 2 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©."
      };
      const v959 = Object.keys(vO73);
      v953.columns = v959.map(p503 => ({
        header: p503,
        key: p503,
        width: 35
      }));
      v953.getRow(1).eachCell(p504 => {
        p504.note = vO73[p504.value] || "";
        p504.font = {
          name: "Arial",
          bold: true,
          size: 12,
          color: {
            argb: "FFFFFFFF"
          }
        };
        p504.fill = {
          type: "pattern",
          pattern: "solid",
          fgColor: {
            argb: "FFC0392B"
          }
        };
        p504.alignment = {
          vertical: "middle",
          horizontal: "center",
          wrapText: true
        };
      });
      const vF23 = (p505, p506) => {
        for (let vLN25 = 2; vLN25 <= 1001; vLN25++) {
          v953.getCell("" + p505 + vLN25).dataValidation = {
            type: "list",
            allowBlank: true,
            formulae: [p506]
          };
        }
      };
      vF23("H", "='Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'!$A$2:$A$3");
      vF23("J", "='Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'!$B$2:$B$" + (vA53.length + 1));
      vF23("M", "='Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'!$D$2:$D$" + (vA.length + 1));
      vF23("O", "='Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'!$C$2:$C$" + (Object.keys(vO62).length + 1));
      vF23("R", "='Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'!$C$2:$C$" + (Object.keys(vO62).length + 1));
      const vLSINDIRECTSUBSTITUTESU11 = "=INDIRECT(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(O2,\" \",\"_\"),\"(\",\"_\"),\")\",\"_\"))";
      const vLSINDIRECTSUBSTITUTESU12 = "=INDIRECT(SUBSTITUTE(SUBSTITUTE(SUBSTITUTE(R2,\" \",\"_\"),\"(\",\"_\"),\")\",\"_\"))";
      vF23("P", vLSINDIRECTSUBSTITUTESU11);
      vF23("S", vLSINDIRECTSUBSTITUTESU12);
      v954.state = "hidden";
      v953.views = [{
        rightToLeft: true,
        state: "frozen",
        ySplit: 1
      }];
      const v960 = await v952.xlsx.writeBuffer();
      const v961 = new Blob([v960], {
        type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
      });
      if (typeof saveAs === "undefined") {
        throw new Error("Ù…ÙƒØªØ¨Ø© FileSaver.js ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©.");
      }
      saveAs(v961, "Ù†Ù…ÙˆØ°Ø¬_Ù…Ø±ØªØ¬Ø¹_Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª_Ø¨Ø§Ù„Ø¹Ù…Ù„Ø§Øª.xlsx");
    } catch (e56) {
      alert("ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø¥ÙƒØ³Ù„ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª: " + e56.message);
    } finally {
      vF745.remove();
    }
  }
  async function handleReturnReceiptExcelUpload(p507) {
    const v962 = document.getElementById("receiptUploaderTabbedUI");
    if (v962) {
      v962.style.display = "none";
    }
    const v963 = p507.target.files[0];
    if (!v963) {
      return;
    }
    const vF746 = f74("Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© ÙˆØªØ±Ø¬Ù…Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ØªØ¬Ø¹...");
    try {
      const v964 = new ExcelJS.Workbook();
      await v964.xlsx.load(await v963.arrayBuffer());
      const v965 = v964.getWorksheet(1);
      const v966 = v965.getRow(1).values.slice(1).map(p508 => String(p508 || "").trim());
      const vA58 = [];
      v965.eachRow({
        includeEmpty: false
      }, (p509, p510) => {
        if (p510 > 1) {
          const vO74 = {};
          p509.values.slice(1).forEach((p511, p512) => {
            const v967 = v966[p512];
            if (v967) {
              vO74[v967] = p511 ?? "";
            }
          });
          vA58.push(vO74);
        }
      });
      if (vA58.length === 0) {
        throw new Error("Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„ ÙØ§Ø±Øº!");
      }
      const vO75 = {
        "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø± (YYYY-MM-DD)": "dateTimeIssued",
        "Ø±Ù‚Ù… Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø±ØªØ¬Ø¹ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ (*)": "receiptNumber",
        "UUID Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© (*)": "referenceUUID",
        "Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "buyerName",
        "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "buyerId",
        "Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„ØµÙ†Ù": "internalCode",
        "ÙˆØµÙ Ø§Ù„ØµÙ†Ù (*)": "description",
        "Ù†ÙˆØ¹ ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (*)": "itemType",
        "ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù (*)": "itemCode",
        "ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ (*)": "unitType",
        "Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø© (*)": "quantity",
        "Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© ÙˆÙ‚Øª Ø§Ù„Ø¨ÙŠØ¹ (*)": "unitPrice",
        "Ø¹Ù…Ù„Ø© Ø§Ù„Ø¨ÙŠØ¹": "currencySold",
        "Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù": "exchangeRate",
        "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)": "taxType_1",
        "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ Ù„Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)": "taxSubType_1",
        "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 1 (*)": "taxRate_1",
        "Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 2 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "taxType_2",
        "Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ Ù„Ù„Ø¶Ø±ÙŠØ¨Ø© 2 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "taxSubType_2",
        "Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 2 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)": "taxRate_2"
      };
      const v968 = vA58.map(p513 => {
        const vO76 = {};
        for (const v969 in p513) {
          const v970 = vO75[v969.trim()];
          if (v970) {
            let v971 = p513[v969];
            if (v970 === "unitType" && vO63.units[v971]) {
              v971 = vO63.units[v971];
            } else if (v970 === "currencySold" && vO.currencies[v971]) {
              v971 = vO.currencies[v971];
            } else if (v970.startsWith("taxType_") && vO63.taxTypes[v971]) {
              v971 = vO63.taxTypes[v971];
            } else if (v970.startsWith("taxSubType_") && vO63.taxSubtypes[v971]) {
              v971 = vO63.taxSubtypes[v971];
            }
            vO76[v970] = v971;
          }
        }
        return vO76;
      });
      const vV968 = v968;
      const v972 = new Map();
      let vLS16 = "";
      let vO77 = {};
      vV968.forEach(p514 => {
        const v973 = String(p514.receiptNumber || vLS16).trim();
        if (!v973) {
          return;
        }
        if (v973 !== vLS16) {
          vO77 = {
            dateTimeIssued: p514.dateTimeIssued,
            referenceUUID: p514.referenceUUID,
            buyerName: p514.buyerName,
            buyerId: p514.buyerId
          };
          v972.set(v973, []);
        }
        const vO78 = {
          ...vO77,
          ...p514
        };
        v972.get(v973).push(vO78);
        vLS16 = v973;
      });
      vF746.remove();
      showReceiptEditor(v972, "return");
    } catch (e57) {
      alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„Ù Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª: " + e57.message);
    } finally {
      if (vF746) {
        vF746.remove();
      }
      p507.target.value = "";
    }
  }
  function calculateReceiptData(p515, p516, p517, p518, p519 = null) {
    const vO79 = {
      id: (p516 || window.receiptUploaderData.seller).id,
      name: document.getElementById("manual-seller-name")?.value || (p516 || window.receiptUploaderData.seller).name,
      governate: document.getElementById("manual-seller-governate")?.value || (p516 || window.receiptUploaderData.seller).governate,
      regionCity: document.getElementById("manual-seller-regionCity")?.value || (p516 || window.receiptUploaderData.seller).regionCity,
      street: document.getElementById("manual-seller-street")?.value || (p516 || window.receiptUploaderData.seller).street,
      buildingNumber: document.getElementById("manual-seller-building")?.value || (p516 || window.receiptUploaderData.seller).buildingNumber
    };
    const v974 = p517 || window.receiptUploaderData.serial;
    const v975 = p518 || vO79.taxpayerActivityCode || "4690";
    const v976 = p515[0];
    const v977 = JSON.parse(localStorage.getItem("receiptHistory") || "[]");
    const v978 = v977.length > 0 ? v977[0].uuid : "";
    let vLSEGP2 = "EGP";
    let vLN049 = 0;
    const v979 = p515.find(p520 => p520.currencySold && p520.currencySold !== "EGP");
    if (v979) {
      vLSEGP2 = v979.currencySold;
      vLN049 = parseFloat(v979.exchangeRate) || 1;
    }
    const vO80 = {
      dateTimeIssued: f4(v976.dateTimeIssued),
      receiptNumber: String(v976.receiptNumber || "RTN_" + Math.floor(Date.now() / 1000)),
      uuid: "",
      previousUUID: v978,
      referenceUUID: String(v976.referenceUUID || ""),
      currency: vLSEGP2,
      exchangeRate: parseFloat(vLN049.toFixed(5)),
      sOrderNameCode: "",
      orderdeliveryMode: "",
      grossWeight: 0,
      netWeight: 0
    };
    if (p519) {
      vO80.referenceOldUUID = p519;
    }
    let vLN050 = 0;
    const v980 = new Map();
    const v981 = p515.map(p521 => {
      const vParseFloat44 = parseFloat((parseFloat(p521.quantity) || 0).toFixed(5));
      const vParseFloat45 = parseFloat((parseFloat(p521.unitPrice) || 0).toFixed(5));
      const vParseFloat46 = parseFloat((vParseFloat44 * vParseFloat45).toFixed(5));
      const vVParseFloat46 = vParseFloat46;
      const vA59 = [];
      let vLN051 = 0;
      if (p521.taxableItems && Array.isArray(p521.taxableItems)) {
        let vLN052 = 0;
        p521.taxableItems.forEach(p522 => {
          if (p522.taxType === "T2" || p522.taxType === "T3") {
            vLN052 += vVParseFloat46 * (parseFloat(p522.rate) / 100);
          }
        });
        const v982 = vVParseFloat46 + vLN052;
        p521.taxableItems.forEach(p523 => {
          const v983 = p523.taxType === "T1" ? v982 : netSale;
          const vParseFloat47 = parseFloat((v983 * (parseFloat(p523.rate) / 100)).toFixed(5));
          vA59.push({
            taxType: String(p523.taxType),
            amount: vParseFloat47,
            subType: String(p523.subType),
            rate: parseFloat(p523.rate)
          });
          vLN051 += p523.taxType === "T4" ? -vParseFloat47 : vParseFloat47;
          v980.set(String(p523.taxType), (v980.get(String(p523.taxType)) || 0) + vParseFloat47);
        });
      }
      const vParseFloat48 = parseFloat((vVParseFloat46 + vLN051).toFixed(5));
      vLN050 += vParseFloat46;
      return {
        internalCode: String(p521.internalCode || p521.itemCode),
        description: f120(String(p521.description), 100),
        itemType: String(p521.itemType || "EGS"),
        itemCode: String(p521.itemCode),
        unitType: String(p521.unitType || "EA"),
        quantity: vParseFloat44,
        unitPrice: vParseFloat45,
        netSale: vVParseFloat46,
        totalSale: vParseFloat46,
        total: vParseFloat48,
        valueDifference: 0,
        taxableItems: vA59,
        itemDiscountData: []
      };
    });
    return {
      header: vO80,
      documentType: {
        receiptType: "R",
        typeVersion: "1.2"
      },
      seller: {
        rin: vO79.id,
        companyTradeName: vO79.name,
        branchCode: "0",
        branchAddress: {
          country: "EG",
          governate: vO79.governate,
          regionCity: vO79.regionCity,
          street: vO79.street,
          buildingNumber: vO79.buildingNumber
        },
        deviceSerialNumber: v974,
        activityCode: v975
      },
      buyer: {
        type: "P",
        id: v976.buyerId,
        name: v976.buyerName
      },
      itemData: v981,
      totalSales: parseFloat(vLN050.toFixed(5)),
      netAmount: parseFloat(vLN050.toFixed(5)),
      taxTotals: Array.from(v980, ([v984, v985]) => ({
        taxType: v984,
        amount: parseFloat(v985.toFixed(5))
      })),
      totalAmount: parseFloat(v981.reduce((p524, p525) => p524 + p525.total, 0).toFixed(5)),
      paymentMethod: "C",
      feesAmount: 0,
      adjustment: 0
    };
  }
  async function sendReceipts_V3(p526, p527) {
    const vF747 = f74("Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„: " + p527 + "...");
    try {
      const v986 = p526.receipts;
      if (!v986 || v986.length === 0) {
        throw new Error("ÙƒØ§Ø¦Ù† Ø§Ù„Ø¯ÙØ¹Ø© ÙØ§Ø±Øº.");
      }
      const v987 = v986[v986.length - 1].header.uuid;
      const v988 = JSON.stringify(p526, null, 2);
      const v989 = new JSZip();
      v989.file("receipts.json", v988);
      const v990 = await v989.generateAsync({
        type: "blob",
        compression: "DEFLATE"
      });
      const v991 = document.querySelector("input[type=\"file\"]");
      if (!v991) {
        throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª (input[type=\"file\"]).");
      }
      const v992 = new File([v990], "receipts.zip", {
        type: "application/zip"
      });
      const v993 = new DataTransfer();
      v993.items.add(v992);
      v991.files = v993.files;
      v991.dispatchEvent(new Event("change", {
        bubbles: true
      }));
      await new Promise(p528 => setTimeout(p528, 200));
      const v994 = Array.from(document.querySelectorAll("button span.ms-Button-label")).find(p529 => p529.textContent.trim() === "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©");
      if (!v994) {
        throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø± \"Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©\".");
      }
      const v995 = v994.closest("button");
      const v996 = new Promise((p530, p531) => {
        const v997 = window.fetch;
        window.fetch = async function (..._0x3102d6) {
          const v998 = _0x3102d6[0];
          if (typeof v998 === "string" && v998.includes("/api/v1/receiptsubmissions")) {
            try {
              const v999 = await v997.apply(this, _0x3102d6);
              const v1000 = v999.clone();
              const v1001 = await v1000.json();
              window.fetch = v997;
              p530(v1001);
              return v999;
            } catch (e58) {
              window.fetch = v997;
              p531(e58);
            }
          }
          return v997.apply(this, _0x3102d6);
        };
        v995.click();
      });
      const v1002 = await v996;
      if (v1002.submissionStatus === "Invalid" || v1002.inValidReceiptsCount > 0) {
        const v1003 = v1002.rejectedDocuments[0];
        const v1004 = v1003.error.details[0];
        const v1005 = "ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.\n\nØ§Ù„Ø³Ø¨Ø¨ Ù…Ù† Ø§Ù„Ù…ØµÙ„Ø­Ø©: " + v1004.message + "\nØ§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¯Ù‚ÙŠÙ‚ Ù„Ù„Ø®Ø·Ø£: " + v1004.propertyPath;
        throw new Error(v1005);
      }
      vF747.remove();
      return {
        success: true,
        uuid: v987,
        error: null
      };
    } catch (e59) {
      vF747.remove();
      return {
        success: false,
        uuid: "",
        error: e59.message
      };
    }
  }
})();